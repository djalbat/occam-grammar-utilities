'use strict';

var _createClass = function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; }();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var ruleUtilities = require('./utilities/rule');

var findRuleByName = ruleUtilities.findRuleByName;

var Configuration = function () {
  function Configuration(immediatelyLeftRecursiveDefinitionsMap, indirectlyLeftRecursiveDefinitionsMap, rules) {
    _classCallCheck(this, Configuration);

    this.immediatelyLeftRecursiveDefinitionsMap = immediatelyLeftRecursiveDefinitionsMap;

    this.indirectlyLeftRecursiveDefinitionsMap = indirectlyLeftRecursiveDefinitionsMap;

    this.rules = rules;
  }

  _createClass(Configuration, [{
    key: 'getRules',
    value: function getRules() {
      return this.rules;
    }
  }, {
    key: 'getIndirectlyLeftRecursiveRuleNames',
    value: function getIndirectlyLeftRecursiveRuleNames() {
      var indirectlyLeftRecursiveRuleNames = Object.keys(this.indirectlyLeftRecursiveDefinitionsMap);

      return indirectlyLeftRecursiveRuleNames;
    }
  }, {
    key: 'getImmediatelyLeftRecursiveRuleNames',
    value: function getImmediatelyLeftRecursiveRuleNames() {
      var immediatelyLeftRecursiveRuleNames = Object.keys(this.immediatelyLeftRecursiveDefinitionsMap);

      return immediatelyLeftRecursiveRuleNames;
    }
  }, {
    key: 'getImmediatelyLeftRecursiveDefinitions',
    value: function getImmediatelyLeftRecursiveDefinitions(ruleName) {
      var immediatelyLeftRecursiveDefinitions = this.immediatelyLeftRecursiveDefinitionsMap[ruleName];

      return immediatelyLeftRecursiveDefinitions;
    }
  }, {
    key: 'findRule',
    value: function findRule(ruleName) {
      var name = ruleName,
          ///
      rule = findRuleByName(name, this.rules);

      return rule;
    }
  }, {
    key: 'isRulePresent',
    value: function isRulePresent(ruleName) {
      var rule = this.findRule(ruleName),
          rulePresent = rule !== null;

      return rulePresent;
    }
  }, {
    key: 'isDefinitionIndirectlyLeftRecursiveDefinition',
    value: function isDefinitionIndirectlyLeftRecursiveDefinition(definition, ruleName) {
      var indirectlyLeftRecursiveDefinitions = this.indirectlyLeftRecursiveDefinitionsMap[ruleName],
          indirectlyLeftRecursiveDefinitionsIncludesDefinition = indirectlyLeftRecursiveDefinitions.includes(definition),
          definitionIndirectlyRecursiveDefinition = indirectlyLeftRecursiveDefinitionsIncludesDefinition; ///

      return definitionIndirectlyRecursiveDefinition;
    }
  }, {
    key: 'forEachRule',
    value: function forEachRule(callback) {
      this.rules.forEach(callback);
    }
  }, {
    key: 'forEachIndirectlyLeftRecursiveRule',
    value: function forEachIndirectlyLeftRecursiveRule(callback) {
      var _this = this;

      var indirectlyLeftRecursiveRuleNames = this.getIndirectlyLeftRecursiveRuleNames();

      indirectlyLeftRecursiveRuleNames.forEach(function (mappedRuleName) {
        var mappedRule = _this.findRule(mappedRuleName);

        callback(mappedRule);
      });
    }
  }, {
    key: 'forEachIndirectlyLeftRecursiveRuleName',
    value: function forEachIndirectlyLeftRecursiveRuleName(callback) {
      var indirectlyLeftRecursiveRuleNames = this.getIndirectlyLeftRecursiveRuleNames();

      indirectlyLeftRecursiveRuleNames.forEach(callback);
    }
  }, {
    key: 'forEachImmediatelyLeftRecursiveRule',
    value: function forEachImmediatelyLeftRecursiveRule(callback) {
      var _this2 = this;

      var immediatelyLeftRecursiveRuleNames = this.getImmediatelyLeftRecursiveRuleNames();

      immediatelyLeftRecursiveRuleNames.forEach(function (mappedRuleName) {
        var mappedRule = _this2.findRule(mappedRuleName);

        callback(mappedRule);
      });
    }
  }, {
    key: 'forEachImmediatelyLeftRecursiveRuleName',
    value: function forEachImmediatelyLeftRecursiveRuleName(callback) {
      var immediatelyLeftRecursiveRuleNames = this.getImmediatelyLeftRecursiveRuleNames();

      immediatelyLeftRecursiveRuleNames.forEach(callback);
    }
  }, {
    key: 'addNonRecursiveRule',
    value: function addNonRecursiveRule(nonRecursiveRule) {
      var rule = nonRecursiveRule; ///

      this.rules.push(rule);
    }
  }, {
    key: 'addRightRecursiveRule',
    value: function addRightRecursiveRule(rightRecursiveRule) {
      var rule = rightRecursiveRule; ///

      this.rules.push(rule);
    }
  }, {
    key: 'mapImmediatelyLeftRecursiveDefinition',
    value: function mapImmediatelyLeftRecursiveDefinition(ruleName, immediatelyLeftRecursiveDefinition) {
      if (!this.immediatelyLeftRecursiveDefinitionsMap[ruleName]) {
        this.immediatelyLeftRecursiveDefinitionsMap[ruleName] = [];
      }

      var immediatelyLeftRecursiveDefinitions = this.immediatelyLeftRecursiveDefinitionsMap[ruleName];

      immediatelyLeftRecursiveDefinitions.push(immediatelyLeftRecursiveDefinition);
    }
  }, {
    key: 'mapIndirectlyLeftRecursiveDefinition',
    value: function mapIndirectlyLeftRecursiveDefinition(ruleName, indirectlyLeftRecursiveDefinition) {
      if (!this.indirectlyLeftRecursiveDefinitionsMap[ruleName]) {
        this.indirectlyLeftRecursiveDefinitionsMap[ruleName] = [];
      }

      var indirectlyLeftRecursiveDefinitions = this.indirectlyLeftRecursiveDefinitionsMap[ruleName];

      indirectlyLeftRecursiveDefinitions.push(indirectlyLeftRecursiveDefinition);
    }
  }], [{
    key: 'fromRules',
    value: function fromRules(rules) {
      var immediatelyLeftRecursiveDefinitionsMap = {},
          indirectlyLeftRecursiveDefinitionsMap = {},
          configuration = new Configuration(immediatelyLeftRecursiveDefinitionsMap, indirectlyLeftRecursiveDefinitionsMap, rules);

      return configuration;
    }
  }]);

  return Configuration;
}();

module.exports = Configuration;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9jb25maWd1cmF0aW9uLmpzIl0sIm5hbWVzIjpbInJ1bGVVdGlsaXRpZXMiLCJyZXF1aXJlIiwiZmluZFJ1bGVCeU5hbWUiLCJDb25maWd1cmF0aW9uIiwiaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXAiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zTWFwIiwicnVsZXMiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyIsIk9iamVjdCIsImtleXMiLCJpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMiLCJydWxlTmFtZSIsImltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwibmFtZSIsInJ1bGUiLCJmaW5kUnVsZSIsInJ1bGVQcmVzZW50IiwiZGVmaW5pdGlvbiIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zSW5jbHVkZXNEZWZpbml0aW9uIiwiaW5jbHVkZXMiLCJkZWZpbml0aW9uSW5kaXJlY3RseVJlY3Vyc2l2ZURlZmluaXRpb24iLCJjYWxsYmFjayIsImZvckVhY2giLCJnZXRJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyIsIm1hcHBlZFJ1bGVOYW1lIiwibWFwcGVkUnVsZSIsImdldEltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyIsIm5vblJlY3Vyc2l2ZVJ1bGUiLCJwdXNoIiwicmlnaHRSZWN1cnNpdmVSdWxlIiwiaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImNvbmZpZ3VyYXRpb24iLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiQUFBQTs7Ozs7O0FBRUEsSUFBTUEsZ0JBQWdCQyxRQUFRLGtCQUFSLENBQXRCOztJQUVRQyxjLEdBQW1CRixh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RUFBNEQ7QUFDMUQsYUFBS1Asc0NBQUwsQ0FBNENPLFFBQTVDLElBQXdELEVBQXhEO0FBQ0Q7O0FBRUQsVUFBTUMsc0NBQXNDLEtBQUtSLHNDQUFMLENBQTRDTyxRQUE1QyxDQUE1Qzs7QUFFQUMsMENBQW9DaUIsSUFBcEMsQ0FBeUNFLGtDQUF6QztBQUNEOzs7eURBRW9DcEIsUSxFQUFVcUIsaUMsRUFBbUM7QUFDaEYsVUFBSSxDQUFDLEtBQUszQixxQ0FBTCxDQUEyQ00sUUFBM0MsQ0FBTCxFQUEyRDtBQUN6RCxhQUFLTixxQ0FBTCxDQUEyQ00sUUFBM0MsSUFBdUQsRUFBdkQ7QUFDRDs7QUFFRCxVQUFNTyxxQ0FBcUMsS0FBS2IscUNBQUwsQ0FBMkNNLFFBQTNDLENBQTNDOztBQUVBTyx5Q0FBbUNXLElBQW5DLENBQXdDRyxpQ0FBeEM7QUFDRDs7OzhCQUVnQjFCLEssRUFBTztBQUN0QixVQUFNRix5Q0FBeUMsRUFBL0M7QUFBQSxVQUNNQyx3Q0FBd0MsRUFEOUM7QUFBQSxVQUVNNEIsZ0JBQWdCLElBQUk5QixhQUFKLENBQWtCQyxzQ0FBbEIsRUFBMERDLHFDQUExRCxFQUFpR0MsS0FBakcsQ0FGdEI7O0FBSUEsYUFBTzJCLGFBQVA7QUFDRDs7Ozs7O0FBR0hDLE9BQU9DLE9BQVAsR0FBaUJoQyxhQUFqQiIsImZpbGUiOiJjb25maWd1cmF0aW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBydWxlVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvcnVsZScpO1xuXG5jb25zdCB7IGZpbmRSdWxlQnlOYW1lIH0gPSBydWxlVXRpbGl0aWVzO1xuXG5jbGFzcyBDb25maWd1cmF0aW9uIHtcbiAgY29uc3RydWN0b3IoaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXAsIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXAsIHJ1bGVzKSB7XG4gICAgdGhpcy5pbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc01hcCA9IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zTWFwO1xuXG4gICAgdGhpcy5pbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zTWFwID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc01hcDtcblxuICAgIHRoaXMucnVsZXMgPSBydWxlcztcbiAgfVxuXG4gIGdldFJ1bGVzKCkge1xuICAgIHJldHVybiB0aGlzLnJ1bGVzO1xuICB9XG5cbiAgZ2V0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMoKSB7XG4gICAgY29uc3QgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMgPSBPYmplY3Qua2V5cyh0aGlzLmluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXApO1xuXG4gICAgcmV0dXJuIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzO1xuICB9XG5cbiAgZ2V0SW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKCkge1xuICAgIGNvbnN0IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyA9IE9iamVjdC5rZXlzKHRoaXMuaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXApO1xuXG4gICAgcmV0dXJuIGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcztcbiAgfVxuXG4gIGdldEltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKHJ1bGVOYW1lKSB7XG4gICAgY29uc3QgaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSB0aGlzLmltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zTWFwW3J1bGVOYW1lXTtcblxuICAgIHJldHVybiBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucztcbiAgfVxuXG4gIGZpbmRSdWxlKHJ1bGVOYW1lKSB7XG4gICAgY29uc3QgbmFtZSA9IHJ1bGVOYW1lLCAgLy8vXG4gICAgICAgICAgcnVsZSA9IGZpbmRSdWxlQnlOYW1lKG5hbWUsIHRoaXMucnVsZXMpO1xuXG4gICAgcmV0dXJuIHJ1bGU7XG4gIH1cblxuICBpc1J1bGVQcmVzZW50KHJ1bGVOYW1lKSB7XG4gICAgY29uc3QgcnVsZSA9IHRoaXMuZmluZFJ1bGUocnVsZU5hbWUpLFxuICAgICAgICAgIHJ1bGVQcmVzZW50ID0gKHJ1bGUgIT09IG51bGwpO1xuXG4gICAgcmV0dXJuIHJ1bGVQcmVzZW50O1xuICB9XG5cbiAgaXNEZWZpbml0aW9uSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKGRlZmluaXRpb24sIHJ1bGVOYW1lKSB7XG4gICAgY29uc3QgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IHRoaXMuaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc01hcFtydWxlTmFtZV0sXG4gICAgICAgICAgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0luY2x1ZGVzRGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMuaW5jbHVkZXMoZGVmaW5pdGlvbiksXG4gICAgICAgICAgZGVmaW5pdGlvbkluZGlyZWN0bHlSZWN1cnNpdmVEZWZpbml0aW9uID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0luY2x1ZGVzRGVmaW5pdGlvbjsgLy8vXG5cbiAgICByZXR1cm4gZGVmaW5pdGlvbkluZGlyZWN0bHlSZWN1cnNpdmVEZWZpbml0aW9uO1xuICB9XG5cbiAgZm9yRWFjaFJ1bGUoY2FsbGJhY2spIHtcbiAgICB0aGlzLnJ1bGVzLmZvckVhY2goY2FsbGJhY2spO1xuICB9XG5cbiAgZm9yRWFjaEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZShjYWxsYmFjaykge1xuICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzID0gdGhpcy5nZXRJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcygpO1xuXG4gICAgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMuZm9yRWFjaCgobWFwcGVkUnVsZU5hbWUpID0+IHtcbiAgICAgIGNvbnN0IG1hcHBlZFJ1bGUgPSB0aGlzLmZpbmRSdWxlKG1hcHBlZFJ1bGVOYW1lKTtcblxuICAgICAgY2FsbGJhY2sobWFwcGVkUnVsZSk7XG4gICAgfSk7XG4gIH1cblxuICBmb3JFYWNoSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlTmFtZShjYWxsYmFjaykge1xuICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzID0gdGhpcy5nZXRJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcygpO1xuXG4gICAgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMuZm9yRWFjaChjYWxsYmFjayk7XG4gIH1cblxuICBmb3JFYWNoSW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlUnVsZShjYWxsYmFjaykge1xuICAgIGNvbnN0IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyA9IHRoaXMuZ2V0SW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKCk7XG5cbiAgICBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMuZm9yRWFjaCgobWFwcGVkUnVsZU5hbWUpID0+IHtcbiAgICAgIGNvbnN0IG1hcHBlZFJ1bGUgPSB0aGlzLmZpbmRSdWxlKG1hcHBlZFJ1bGVOYW1lKTtcblxuICAgICAgY2FsbGJhY2sobWFwcGVkUnVsZSk7XG4gICAgfSk7XG4gIH1cblxuICBmb3JFYWNoSW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWUoY2FsbGJhY2spIHtcbiAgICBjb25zdCBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMgPSB0aGlzLmdldEltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcygpO1xuXG4gICAgaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzLmZvckVhY2goY2FsbGJhY2spO1xuICB9XG5cbiAgYWRkTm9uUmVjdXJzaXZlUnVsZShub25SZWN1cnNpdmVSdWxlKSB7XG4gICAgY29uc3QgcnVsZSA9IG5vblJlY3Vyc2l2ZVJ1bGU7ICAvLy9cblxuICAgIHRoaXMucnVsZXMucHVzaChydWxlKTtcbiAgfVxuXG4gIGFkZFJpZ2h0UmVjdXJzaXZlUnVsZShyaWdodFJlY3Vyc2l2ZVJ1bGUpIHtcbiAgICBjb25zdCBydWxlID0gcmlnaHRSZWN1cnNpdmVSdWxlOyAgLy8vXG5cbiAgICB0aGlzLnJ1bGVzLnB1c2gocnVsZSk7XG4gIH1cblxuICBtYXBJbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKHJ1bGVOYW1lLCBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSB7XG4gICAgaWYgKCF0aGlzLmltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zTWFwW3J1bGVOYW1lXSkge1xuICAgICAgdGhpcy5pbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc01hcFtydWxlTmFtZV0gPSBbXTtcbiAgICB9XG5cbiAgICBjb25zdCBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IHRoaXMuaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXBbcnVsZU5hbWVdO1xuXG4gICAgaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMucHVzaChpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcbiAgfVxuXG4gIG1hcEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihydWxlTmFtZSwgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSB7XG4gICAgaWYgKCF0aGlzLmluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXBbcnVsZU5hbWVdKSB7XG4gICAgICB0aGlzLmluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXBbcnVsZU5hbWVdID0gW107XG4gICAgfVxuXG4gICAgY29uc3QgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IHRoaXMuaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc01hcFtydWxlTmFtZV07XG5cbiAgICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLnB1c2goaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcbiAgfVxuXG4gIHN0YXRpYyBmcm9tUnVsZXMocnVsZXMpIHtcbiAgICBjb25zdCBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc01hcCA9IHt9LFxuICAgICAgICAgIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXAgPSB7fSxcbiAgICAgICAgICBjb25maWd1cmF0aW9uID0gbmV3IENvbmZpZ3VyYXRpb24oaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXAsIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNNYXAsIHJ1bGVzKTtcblxuICAgIHJldHVybiBjb25maWd1cmF0aW9uO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gQ29uZmlndXJhdGlvbjtcbiJdfQ==