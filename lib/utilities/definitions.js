"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    mergeDirectlyLeftRecursiveDefinitions: function() {
        return mergeDirectlyLeftRecursiveDefinitions;
    },
    mergeIndirectlyLeftRecursiveDefinitions: function() {
        return mergeIndirectlyLeftRecursiveDefinitions;
    }
});
var _occamParsers = require("occam-parsers");
var _necessary = require("necessary");
var _directly = /*#__PURE__*/ _interopRequireDefault(require("../definition/recursive/left/directly"));
var _indirectly = /*#__PURE__*/ _interopRequireDefault(require("../definition/recursive/left/indirectly"));
var _part = require("../utilities/part");
var _parts = require("../utilities/parts");
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
var first = _necessary.arrayUtilities.first, tail = _necessary.arrayUtilities.tail, ChoiceOfPartsPart = _occamParsers.Parts.ChoiceOfPartsPart;
function mergeDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions) {
    var firstDirectlyLeftRecursiveDefinition = first(directlyLeftRecursiveDefinitions), ruleName = firstDirectlyLeftRecursiveDefinition.getRuleName();
    var parts = [];
    var firstPart = firstPartFromDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions), singleParts = singlePartsFromDirectlyLeftRecursiveDefinitionsAnbRuleName(directlyLeftRecursiveDefinitions, ruleName), singlePartsLength = singleParts.length;
    parts.push(firstPart);
    if (false) {
    ///
    } else if (singlePartsLength === 1) {
        var firstSinglePart = first(singleParts);
        parts.push(firstSinglePart);
    } else {
        var choiceOfSinglePartsPart = new ChoiceOfPartsPart(singleParts);
        parts.push(choiceOfSinglePartsPart);
    }
    parts = (0, _parts.cloneParts)(parts); ///
    var directlyLeftRecursiveDefinition = _directly.default.fromPartsAndRuleName(parts, ruleName);
    return directlyLeftRecursiveDefinition;
}
function mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions) {
    var firstIndirectlyLeftRecursiveDefinition = first(indirectlyLeftRecursiveDefinitions), leftRecursiveDefinitions = firstIndirectlyLeftRecursiveDefinition.getLeftRecursiveDefinitions(), ruleName = firstIndirectlyLeftRecursiveDefinition.getRuleName();
    var parts = [];
    var firstPart = firstPartFromIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions), singleParts = singlePartsFromIndirectlyLeftRecursiveDefinitionsAndRuleName(indirectlyLeftRecursiveDefinitions, ruleName), singlePartsLength = singleParts.length;
    parts.push(firstPart);
    if (false) {
    ///
    } else if (singlePartsLength === 0) {
    ///
    } else if (singlePartsLength === 1) {
        var firstSinglePart = first(singleParts);
        parts.push(firstSinglePart);
    } else {
        var choiceOfSinglePartsPart = new ChoiceOfPartsPart(singleParts);
        parts.push(choiceOfSinglePartsPart);
    }
    parts = (0, _parts.cloneParts)(parts); ///
    var indirectlyLeftRecursiveDefinition = _indirectly.default.fromPartsRuleNameAndLeftRecursiveDefinitions(parts, ruleName, leftRecursiveDefinitions);
    return indirectlyLeftRecursiveDefinition;
}
function firstPartFromDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions) {
    var firstDirectlyLeftRecursiveDefinition = first(directlyLeftRecursiveDefinitions), directlyLeftRecursiveDefinition = firstDirectlyLeftRecursiveDefinition, parts = directlyLeftRecursiveDefinition.getParts(), firstPart = first(parts);
    return firstPart;
}
function firstPartFromIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions) {
    var firstIndirectlyLeftRecursiveDefinition = first(indirectlyLeftRecursiveDefinitions), indirectlyLeftRecursiveDefinition = firstIndirectlyLeftRecursiveDefinition, parts = indirectlyLeftRecursiveDefinition.getParts(), firstPart = first(parts);
    return firstPart;
}
function singlePartsFromDirectlyLeftRecursiveDefinitionsAnbRuleName(directlyLeftRecursiveDefinitions, ruleName) {
    var previousFirstPart = null;
    var singleParts = directlyLeftRecursiveDefinitions.map(function(directlyLeftRecursiveDefinition) {
        var parts = directlyLeftRecursiveDefinition.getParts();
        var partsLength = parts.length;
        if (partsLength === 1) {
            var definition = directlyLeftRecursiveDefinition, definitionString = definition.asString();
            throw new Error("The '".concat(definitionString, "' directly left recursive definition of the '").concat(ruleName, "' rule is unary and therefore cannot be rewritten."));
        }
        var firstPart = first(parts);
        if (previousFirstPart !== null) {
            var matches = (0, _part.matchParts)(firstPart, previousFirstPart);
            if (!matches) {
                var definition1 = directlyLeftRecursiveDefinition, definitionString1 = definition1.asString();
                throw new Error("The '".concat(definitionString1, "' directly left recursive definition of the '").concat(ruleName, "' rule does not match one of its sibling directly left recursive definitions and therefore cannot be rewritten."));
            }
        }
        previousFirstPart = firstPart; ///
        var partsTail = tail(parts);
        parts = partsTail; ///
        var singlePart = (0, _parts.singlePartFromParts)(parts);
        return singlePart;
    });
    return singleParts;
}
function singlePartsFromIndirectlyLeftRecursiveDefinitionsAndRuleName(indirectlyLeftRecursiveDefinitions, ruleName) {
    var previousFirstPart = null;
    var singleParts = indirectlyLeftRecursiveDefinitions.reduce(function(singleParts, indirectlyLeftRecursiveDefinition) {
        var parts = indirectlyLeftRecursiveDefinition.getParts();
        var firstPart = first(parts);
        if (previousFirstPart !== null) {
            var matches = (0, _part.matchParts)(firstPart, previousFirstPart);
            if (!matches) {
                var definition = indirectlyLeftRecursiveDefinition, definitionString = definition.asString();
                throw new Error("The '".concat(definitionString, "' directly left recursive definition of the '").concat(ruleName, "' rule does not match one of its sibling directly left recursive definitions and therefore cannot be rewritten."));
            }
        }
        previousFirstPart = firstPart; ///
        var partsTail = tail(parts), partsTailLength = partsTail.length;
        if (partsTailLength > 0) {
            parts = partsTail; ///
            var singlePart = (0, _parts.singlePartFromParts)(parts);
            singleParts.push(singlePart);
        }
        return singleParts;
    }, []);
    return singleParts;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsaXRpZXMvZGVmaW5pdGlvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IFBhcnRzIH0gZnJvbSBcIm9jY2FtLXBhcnNlcnNcIjtcbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5pbXBvcnQgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi4vZGVmaW5pdGlvbi9yZWN1cnNpdmUvbGVmdC9kaXJlY3RseVwiO1xuaW1wb3J0IEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi4vZGVmaW5pdGlvbi9yZWN1cnNpdmUvbGVmdC9pbmRpcmVjdGx5XCI7XG5cbmltcG9ydCB7IG1hdGNoUGFydHMgfSBmcm9tIFwiLi4vdXRpbGl0aWVzL3BhcnRcIjtcbmltcG9ydCB7IGNsb25lUGFydHMsIHNpbmdsZVBhcnRGcm9tUGFydHMgfSBmcm9tIFwiLi4vdXRpbGl0aWVzL3BhcnRzXCI7XG5cbmNvbnN0IHsgZmlyc3QsIHRhaWwgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBDaG9pY2VPZlBhcnRzUGFydCB9ID0gUGFydHM7XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGNvbnN0IGZpcnN0RGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSxcbiAgICAgICAgcnVsZU5hbWUgPSBmaXJzdERpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKTtcblxuICBsZXQgcGFydHMgPSBbXTtcblxuICBjb25zdCBmaXJzdFBhcnQgPSBmaXJzdFBhcnRGcm9tRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpLFxuICAgICAgICBzaW5nbGVQYXJ0cyA9IHNpbmdsZVBhcnRzRnJvbURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zQW5iUnVsZU5hbWUoZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJ1bGVOYW1lKSxcbiAgICAgICAgc2luZ2xlUGFydHNMZW5ndGggPSBzaW5nbGVQYXJ0cy5sZW5ndGg7XG5cbiAgcGFydHMucHVzaChmaXJzdFBhcnQpO1xuXG4gIGlmIChmYWxzZSkge1xuICAgIC8vL1xuICB9IGVsc2UgaWYgKHNpbmdsZVBhcnRzTGVuZ3RoID09PSAxKSB7XG4gICAgY29uc3QgZmlyc3RTaW5nbGVQYXJ0ID0gZmlyc3Qoc2luZ2xlUGFydHMpO1xuXG4gICAgcGFydHMucHVzaChmaXJzdFNpbmdsZVBhcnQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGNob2ljZU9mU2luZ2xlUGFydHNQYXJ0ID0gbmV3IENob2ljZU9mUGFydHNQYXJ0KHNpbmdsZVBhcnRzKTtcblxuICAgIHBhcnRzLnB1c2goY2hvaWNlT2ZTaW5nbGVQYXJ0c1BhcnQpO1xuICB9XG5cbiAgcGFydHMgPSBjbG9uZVBhcnRzKHBhcnRzKTsgIC8vL1xuXG4gIGNvbnN0IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21QYXJ0c0FuZFJ1bGVOYW1lKHBhcnRzLCBydWxlTmFtZSk7XG5cbiAgcmV0dXJuIGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucykge1xuICBjb25zdCBmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpLFxuICAgICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoKSxcbiAgICAgICAgcnVsZU5hbWUgPSBmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRSdWxlTmFtZSgpO1xuXG4gIGxldCBwYXJ0cyA9IFtdO1xuXG4gIGNvbnN0IGZpcnN0UGFydCA9IGZpcnN0UGFydEZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpLFxuICAgICAgICBzaW5nbGVQYXJ0cyA9IHNpbmdsZVBhcnRzRnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNBbmRSdWxlTmFtZShpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTmFtZSksXG4gICAgICAgIHNpbmdsZVBhcnRzTGVuZ3RoID0gc2luZ2xlUGFydHMubGVuZ3RoO1xuXG4gIHBhcnRzLnB1c2goZmlyc3RQYXJ0KTtcblxuICBpZiAoZmFsc2UpIHtcbiAgICAvLy9cbiAgfSBlbHNlIGlmIChzaW5nbGVQYXJ0c0xlbmd0aCA9PT0gMCkge1xuICAgIC8vL1xuICB9IGVsc2UgaWYgKHNpbmdsZVBhcnRzTGVuZ3RoID09PSAxKSB7XG4gICAgY29uc3QgZmlyc3RTaW5nbGVQYXJ0ID0gZmlyc3Qoc2luZ2xlUGFydHMpO1xuXG4gICAgcGFydHMucHVzaChmaXJzdFNpbmdsZVBhcnQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGNob2ljZU9mU2luZ2xlUGFydHNQYXJ0ID0gbmV3IENob2ljZU9mUGFydHNQYXJ0KHNpbmdsZVBhcnRzKTtcblxuICAgIHBhcnRzLnB1c2goY2hvaWNlT2ZTaW5nbGVQYXJ0c1BhcnQpO1xuICB9XG5cbiAgcGFydHMgPSBjbG9uZVBhcnRzKHBhcnRzKTsgIC8vL1xuXG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUGFydHNSdWxlTmFtZUFuZExlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhwYXJ0cywgcnVsZU5hbWUsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyk7XG5cbiAgcmV0dXJuIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjtcbn1cblxuZnVuY3Rpb24gZmlyc3RQYXJ0RnJvbURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGNvbnN0IGZpcnN0RGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSxcbiAgICAgICAgZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0RGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgIHBhcnRzID0gZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRQYXJ0cygpLFxuICAgICAgICBmaXJzdFBhcnQgPSBmaXJzdChwYXJ0cyk7XG5cbiAgcmV0dXJuIGZpcnN0UGFydDtcbn1cblxuZnVuY3Rpb24gZmlyc3RQYXJ0RnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucykge1xuICBjb25zdCBmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpLFxuICAgICAgICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgIHBhcnRzID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFBhcnRzKCksXG4gICAgICAgIGZpcnN0UGFydCA9IGZpcnN0KHBhcnRzKTtcblxuICByZXR1cm4gZmlyc3RQYXJ0O1xufVxuXG5mdW5jdGlvbiBzaW5nbGVQYXJ0c0Zyb21EaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0FuYlJ1bGVOYW1lKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTmFtZSkge1xuICBsZXQgcHJldmlvdXNGaXJzdFBhcnQgPSBudWxsO1xuXG4gIGNvbnN0IHNpbmdsZVBhcnRzID0gZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMubWFwKChkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSA9PiB7XG4gICAgbGV0IHBhcnRzID0gZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRQYXJ0cygpO1xuXG4gICAgY29uc3QgcGFydHNMZW5ndGggPSBwYXJ0cy5sZW5ndGg7XG5cbiAgICBpZiAocGFydHNMZW5ndGggPT09IDEpIHtcbiAgICAgIGNvbnN0IGRlZmluaXRpb24gPSBkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCAvLy9cbiAgICAgICAgICAgIGRlZmluaXRpb25TdHJpbmcgPSBkZWZpbml0aW9uLmFzU3RyaW5nKCk7XG5cbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICcke2RlZmluaXRpb25TdHJpbmd9JyBkaXJlY3RseSBsZWZ0IHJlY3Vyc2l2ZSBkZWZpbml0aW9uIG9mIHRoZSAnJHtydWxlTmFtZX0nIHJ1bGUgaXMgdW5hcnkgYW5kIHRoZXJlZm9yZSBjYW5ub3QgYmUgcmV3cml0dGVuLmApO1xuICAgIH1cblxuICAgIGNvbnN0IGZpcnN0UGFydCA9IGZpcnN0KHBhcnRzKTtcblxuICAgIGlmIChwcmV2aW91c0ZpcnN0UGFydCAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgbWF0Y2hlcyA9IG1hdGNoUGFydHMoZmlyc3RQYXJ0LCBwcmV2aW91c0ZpcnN0UGFydCk7XG5cbiAgICAgIGlmICghbWF0Y2hlcykge1xuICAgICAgICBjb25zdCBkZWZpbml0aW9uID0gZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgICAgICAgIGRlZmluaXRpb25TdHJpbmcgPSBkZWZpbml0aW9uLmFzU3RyaW5nKCk7XG5cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJyR7ZGVmaW5pdGlvblN0cmluZ30nIGRpcmVjdGx5IGxlZnQgcmVjdXJzaXZlIGRlZmluaXRpb24gb2YgdGhlICcke3J1bGVOYW1lfScgcnVsZSBkb2VzIG5vdCBtYXRjaCBvbmUgb2YgaXRzIHNpYmxpbmcgZGlyZWN0bHkgbGVmdCByZWN1cnNpdmUgZGVmaW5pdGlvbnMgYW5kIHRoZXJlZm9yZSBjYW5ub3QgYmUgcmV3cml0dGVuLmApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHByZXZpb3VzRmlyc3RQYXJ0ID0gZmlyc3RQYXJ0OyAgLy8vXG5cbiAgICBjb25zdCBwYXJ0c1RhaWwgPSB0YWlsKHBhcnRzKTtcblxuICAgIHBhcnRzID0gcGFydHNUYWlsOyAgLy8vXG5cbiAgICBjb25zdCBzaW5nbGVQYXJ0ID0gc2luZ2xlUGFydEZyb21QYXJ0cyhwYXJ0cyk7XG5cbiAgICByZXR1cm4gc2luZ2xlUGFydDtcbiAgfSk7XG5cbiAgcmV0dXJuIHNpbmdsZVBhcnRzO1xufVxuXG5mdW5jdGlvbiBzaW5nbGVQYXJ0c0Zyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zQW5kUnVsZU5hbWUoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU5hbWUpIHtcbiAgbGV0IHByZXZpb3VzRmlyc3RQYXJ0ID0gbnVsbDtcblxuICBjb25zdCBzaW5nbGVQYXJ0cyA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMucmVkdWNlKChzaW5nbGVQYXJ0cywgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSA9PiB7XG4gICAgbGV0IHBhcnRzID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFBhcnRzKCk7XG5cbiAgICBjb25zdCBmaXJzdFBhcnQgPSBmaXJzdChwYXJ0cyk7XG5cbiAgICBpZiAocHJldmlvdXNGaXJzdFBhcnQgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IG1hdGNoZXMgPSBtYXRjaFBhcnRzKGZpcnN0UGFydCwgcHJldmlvdXNGaXJzdFBhcnQpO1xuXG4gICAgICBpZiAoIW1hdGNoZXMpIHtcbiAgICAgICAgY29uc3QgZGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgICAgICAgIGRlZmluaXRpb25TdHJpbmcgPSBkZWZpbml0aW9uLmFzU3RyaW5nKCk7XG5cbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJyR7ZGVmaW5pdGlvblN0cmluZ30nIGRpcmVjdGx5IGxlZnQgcmVjdXJzaXZlIGRlZmluaXRpb24gb2YgdGhlICcke3J1bGVOYW1lfScgcnVsZSBkb2VzIG5vdCBtYXRjaCBvbmUgb2YgaXRzIHNpYmxpbmcgZGlyZWN0bHkgbGVmdCByZWN1cnNpdmUgZGVmaW5pdGlvbnMgYW5kIHRoZXJlZm9yZSBjYW5ub3QgYmUgcmV3cml0dGVuLmApO1xuICAgICAgfVxuICAgIH1cblxuICAgIHByZXZpb3VzRmlyc3RQYXJ0ID0gZmlyc3RQYXJ0OyAgLy8vXG5cbiAgICBjb25zdCBwYXJ0c1RhaWwgPSB0YWlsKHBhcnRzKSxcbiAgICAgICAgICBwYXJ0c1RhaWxMZW5ndGggPSBwYXJ0c1RhaWwubGVuZ3RoO1xuXG4gICAgaWYgKHBhcnRzVGFpbExlbmd0aCA+IDApIHtcbiAgICAgIHBhcnRzID0gcGFydHNUYWlsOyAgLy8vXG5cbiAgICAgIGNvbnN0IHNpbmdsZVBhcnQgPSBzaW5nbGVQYXJ0RnJvbVBhcnRzKHBhcnRzKTtcblxuICAgICAgc2luZ2xlUGFydHMucHVzaChzaW5nbGVQYXJ0KTtcbiAgICB9XG5cbiAgICByZXR1cm4gc2luZ2xlUGFydHM7XG4gIH0sIFtdKTtcblxuICByZXR1cm4gc2luZ2xlUGFydHM7XG59XG4iXSwibmFtZXMiOlsibWVyZ2VEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsIm1lcmdlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImZpcnN0IiwiYXJyYXlVdGlsaXRpZXMiLCJ0YWlsIiwiQ2hvaWNlT2ZQYXJ0c1BhcnQiLCJQYXJ0cyIsImRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiZmlyc3REaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicnVsZU5hbWUiLCJnZXRSdWxlTmFtZSIsInBhcnRzIiwiZmlyc3RQYXJ0IiwiZmlyc3RQYXJ0RnJvbURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwic2luZ2xlUGFydHMiLCJzaW5nbGVQYXJ0c0Zyb21EaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0FuYlJ1bGVOYW1lIiwic2luZ2xlUGFydHNMZW5ndGgiLCJsZW5ndGgiLCJwdXNoIiwiZmlyc3RTaW5nbGVQYXJ0IiwiY2hvaWNlT2ZTaW5nbGVQYXJ0c1BhcnQiLCJjbG9uZVBhcnRzIiwiZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIkRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tUGFydHNBbmRSdWxlTmFtZSIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImdldExlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImZpcnN0UGFydEZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwic2luZ2xlUGFydHNGcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0FuZFJ1bGVOYW1lIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZnJvbVBhcnRzUnVsZU5hbWVBbmRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJnZXRQYXJ0cyIsInByZXZpb3VzRmlyc3RQYXJ0IiwibWFwIiwicGFydHNMZW5ndGgiLCJkZWZpbml0aW9uIiwiZGVmaW5pdGlvblN0cmluZyIsImFzU3RyaW5nIiwiRXJyb3IiLCJtYXRjaGVzIiwibWF0Y2hQYXJ0cyIsInBhcnRzVGFpbCIsInNpbmdsZVBhcnQiLCJzaW5nbGVQYXJ0RnJvbVBhcnRzIiwicmVkdWNlIiwicGFydHNUYWlsTGVuZ3RoIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7Ozs7Ozs7O0lBY0dBLHFDQUFxQztlQUFyQ0EscUNBQXFDOztJQStCckNDLHVDQUF1QztlQUF2Q0EsdUNBQXVDOzs7NEJBM0NqQyxlQUFlO3lCQUNOLFdBQVc7NkRBRUUsdUNBQXVDOytEQUNyQyx5Q0FBeUM7b0JBRTVELG1CQUFtQjtxQkFDRSxvQkFBb0I7Ozs7OztBQUVwRSxJQUFRQyxLQUFLLEdBQVdDLFVBQWMsZUFBQSxDQUE5QkQsS0FBSyxFQUFFRSxJQUFJLEdBQUtELFVBQWMsZUFBQSxDQUF2QkMsSUFBSSxFQUNiLEFBQUVDLGlCQUFpQixHQUFLQyxhQUFLLE1BQUEsQ0FBM0JELGlCQUFpQixBQUFVLEFBQUM7QUFFN0IsU0FBU0wscUNBQXFDLENBQUNPLGdDQUFnQyxFQUFFO0lBQ3RGLElBQU1DLG9DQUFvQyxHQUFHTixLQUFLLENBQUNLLGdDQUFnQyxDQUFDLEVBQzlFRSxRQUFRLEdBQUdELG9DQUFvQyxDQUFDRSxXQUFXLEVBQUUsQUFBQztJQUVwRSxJQUFJQyxLQUFLLEdBQUcsRUFBRSxBQUFDO0lBRWYsSUFBTUMsU0FBUyxHQUFHQyw2Q0FBNkMsQ0FBQ04sZ0NBQWdDLENBQUMsRUFDM0ZPLFdBQVcsR0FBR0Ms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