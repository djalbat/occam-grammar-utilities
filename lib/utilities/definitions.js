"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "mergeLeftRecursiveDefinitions", {
    get: function() {
        return mergeLeftRecursiveDefinitions;
    },
    enumerable: true
});
var _occamParsers = require("occam-parsers");
var _necessary = require("necessary");
var _part = require("../utilities/part");
var _parts = require("../utilities/parts");
var first = _necessary.arrayUtilities.first, ChoiceOfPartsPart = _occamParsers.Parts.ChoiceOfPartsPart;
function mergeLeftRecursiveDefinitions(leftRecursiveDefinitions, fromPartsAndRuleName) {
    var callback = arguments.length > 2 && arguments[2] !== void 0 ? arguments[2] : function() {};
    var leftRecursiveDefinition;
    var firstLeftRecursiveDefinition = first(leftRecursiveDefinitions), leftRecursiveDefinitionsLength = leftRecursiveDefinitions.length;
    if (leftRecursiveDefinitionsLength === 1) {
        leftRecursiveDefinition = firstLeftRecursiveDefinition; ///
        callback(leftRecursiveDefinition);
    } else {
        var ruleName = firstLeftRecursiveDefinition.getRuleName();
        var firstPart, previousFirstPart = null;
        var singleParts = leftRecursiveDefinitions.map(function(leftRecursiveDefinition) {
            callback(leftRecursiveDefinition);
            var parts = leftRecursiveDefinition.getParts();
            parts = (0, _parts.cloneParts)(parts); ///
            firstPart = first(parts);
            if (previousFirstPart !== null) {
                var matches = (0, _part.matchParts)(firstPart, previousFirstPart);
                if (!matches) {
                    var definition = leftRecursiveDefinition, definitionString = definition.asString();
                    throw new Error("The '".concat(definitionString, "' left recursive definition of the '").concat(ruleName, "' rule does not match one of its sibling left recursive definitions and therefore cannot be rewritten."));
                }
            }
            previousFirstPart = firstPart; ///
            var singlePart = (0, _parts.singlePartFromParts)(parts);
            return singlePart;
        });
        var parts = singleParts; ///
        var choiceOfPartsPart = new ChoiceOfPartsPart(parts);
        parts = [
            firstPart,
            choiceOfPartsPart
        ];
        leftRecursiveDefinition = fromPartsAndRuleName(parts, ruleName);
    }
    return leftRecursiveDefinition;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsaXRpZXMvZGVmaW5pdGlvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IFBhcnRzIH0gZnJvbSBcIm9jY2FtLXBhcnNlcnNcIjtcbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5pbXBvcnQgeyBtYXRjaFBhcnRzIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9wYXJ0XCI7XG5pbXBvcnQgeyBjbG9uZVBhcnRzLCBzaW5nbGVQYXJ0RnJvbVBhcnRzIH0gZnJvbSBcIi4uL3V0aWxpdGllcy9wYXJ0c1wiO1xuXG5jb25zdCB7IGZpcnN0IH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgQ2hvaWNlT2ZQYXJ0c1BhcnQgfSA9IFBhcnRzO1xuXG5leHBvcnQgZnVuY3Rpb24gbWVyZ2VMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBmcm9tUGFydHNBbmRSdWxlTmFtZSwgY2FsbGJhY2sgPSAoKSA9PiB7fSkge1xuICBsZXQgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG5cbiAgY29uc3QgZmlyc3RMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyksXG4gICAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0xlbmd0aCA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5sZW5ndGg7XG5cbiAgaWYgKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0xlbmd0aCA9PT0gMSkge1xuICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gZmlyc3RMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjsgLy8vXG5cbiAgICBjYWxsYmFjayhsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG4gIH0gZWxzZSB7XG4gICAgY29uc3QgcnVsZU5hbWUgPSBmaXJzdExlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCk7XG5cbiAgICBsZXQgZmlyc3RQYXJ0LFxuICAgICAgICBwcmV2aW91c0ZpcnN0UGFydCA9IG51bGw7XG5cbiAgICBjb25zdCBzaW5nbGVQYXJ0cyA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5tYXAoKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSA9PiB7XG4gICAgICBjYWxsYmFjayhsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG5cbiAgICAgIGxldCBwYXJ0cyA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFBhcnRzKCk7XG5cbiAgICAgIHBhcnRzID0gY2xvbmVQYXJ0cyhwYXJ0cyk7ICAvLy9cblxuICAgICAgZmlyc3RQYXJ0ID0gZmlyc3QocGFydHMpO1xuXG4gICAgICBpZiAocHJldmlvdXNGaXJzdFBhcnQgIT09IG51bGwpIHtcbiAgICAgICAgY29uc3QgbWF0Y2hlcyA9IG1hdGNoUGFydHMoZmlyc3RQYXJ0LCBwcmV2aW91c0ZpcnN0UGFydCk7XG5cbiAgICAgICAgaWYgKCFtYXRjaGVzKSB7XG4gICAgICAgICAgY29uc3QgZGVmaW5pdGlvbiA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCAvLy9cbiAgICAgICAgICAgICAgICBkZWZpbml0aW9uU3RyaW5nID0gZGVmaW5pdGlvbi5hc1N0cmluZygpO1xuXG4gICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJyR7ZGVmaW5pdGlvblN0cmluZ30nIGxlZnQgcmVjdXJzaXZlIGRlZmluaXRpb24gb2YgdGhlICcke3J1bGVOYW1lfScgcnVsZSBkb2VzIG5vdCBtYXRjaCBvbmUgb2YgaXRzIHNpYmxpbmcgbGVmdCByZWN1cnNpdmUgZGVmaW5pdGlvbnMgYW5kIHRoZXJlZm9yZSBjYW5ub3QgYmUgcmV3cml0dGVuLmApO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHByZXZpb3VzRmlyc3RQYXJ0ID0gZmlyc3RQYXJ0OyAgLy8vXG5cbiAgICAgIGNvbnN0IHNpbmdsZVBhcnQgPSBzaW5nbGVQYXJ0RnJvbVBhcnRzKHBhcnRzKTtcblxuICAgICAgcmV0dXJuIHNpbmdsZVBhcnQ7XG4gICAgfSk7XG5cbiAgICBsZXQgcGFydHMgPSBzaW5nbGVQYXJ0czsgIC8vL1xuXG4gICAgY29uc3QgY2hvaWNlT2ZQYXJ0c1BhcnQgPSBuZXcgQ2hvaWNlT2ZQYXJ0c1BhcnQocGFydHMpO1xuXG4gICAgcGFydHMgPSBbXG4gICAgICBmaXJzdFBhcnQsXG4gICAgICBjaG9pY2VPZlBhcnRzUGFydFxuICAgIF07XG5cbiAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZyb21QYXJ0c0FuZFJ1bGVOYW1lKHBhcnRzLCBydWxlTmFtZSk7XG4gIH1cblxuICByZXR1cm4gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG59XG4iXSwibmFtZXMiOlsibWVyZ2VMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJmaXJzdCIsImFycmF5VXRpbGl0aWVzIiwiQ2hvaWNlT2ZQYXJ0c1BhcnQiLCJQYXJ0cyIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImZyb21QYXJ0c0FuZFJ1bGVOYW1lIiwiY2FsbGJhY2siLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImZpcnN0TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNMZW5ndGgiLCJsZW5ndGgiLCJydWxlTmFtZSIsImdldFJ1bGVOYW1lIiwiZmlyc3RQYXJ0IiwicHJldmlvdXNGaXJzdFBhcnQiLCJzaW5nbGVQYXJ0cyIsIm1hcCIsInBhcnRzIiwiZ2V0UGFydHMiLCJjbG9uZVBhcnRzIiwibWF0Y2hlcyIsIm1hdGNoUGFydHMiLCJkZWZpbml0aW9uIiwiZGVmaW5pdGlvblN0cmluZyIsImFzU3RyaW5nIiwiRXJyb3IiLCJzaW5nbGVQYXJ0Iiwic2luZ2xlUGFydEZyb21QYXJ0cyIsImNob2ljZU9mUGFydHNQYXJ0Il0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7K0JBV0dBLCtCQUE2Qjs7ZUFBN0JBLDZC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