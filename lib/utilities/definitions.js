"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    mergeDirectlyLeftRecursiveDefinitions: function() {
        return mergeDirectlyLeftRecursiveDefinitions;
    },
    mergeIndirectlyLeftRecursiveDefinitions: function() {
        return mergeIndirectlyLeftRecursiveDefinitions;
    }
});
var _occamParsers = require("occam-parsers");
var _necessary = require("necessary");
var _directly = /*#__PURE__*/ _interopRequireDefault(require("../definition/recursive/left/directly"));
var _indirectly = /*#__PURE__*/ _interopRequireDefault(require("../definition/recursive/left/indirectly"));
var _part = require("../utilities/part");
var _parts = require("../utilities/parts");
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
var first = _necessary.arrayUtilities.first, tail = _necessary.arrayUtilities.tail, ChoiceOfPartsPart = _occamParsers.Parts.ChoiceOfPartsPart;
function mergeDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions) {
    var firstDirectlyLeftRecursiveDefinition = first(directlyLeftRecursiveDefinitions), ruleName = firstDirectlyLeftRecursiveDefinition.getRuleName();
    var parts = [];
    var firstPart = firstPartFromDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions), singleParts = singlePartsFromDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions), singlePartsLength = singleParts.length;
    parts.push(firstPart);
    if (false) {
    ///
    } else if (singlePartsLength === 1) {
        var firstSinglePart = first(singleParts);
        parts.push(firstSinglePart);
    } else {
        var choiceOfSinglePartsPart = new ChoiceOfPartsPart(singleParts);
        parts.push(choiceOfSinglePartsPart);
    }
    parts = (0, _parts.cloneParts)(parts); ///
    var directlyLeftRecursiveDefinition = _directly.default.fromPartsAndRuleName(parts, ruleName);
    return directlyLeftRecursiveDefinition;
}
function mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions) {
    var firstIndirectlyLeftRecursiveDefinition = first(indirectlyLeftRecursiveDefinitions), leftRecursiveDefinitions = firstIndirectlyLeftRecursiveDefinition.getLeftRecursiveDefinitions(), ruleName = firstIndirectlyLeftRecursiveDefinition.getRuleName();
    var parts = [];
    var firstPart = firstPartFromIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions), singleParts = singlePartsFromIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions), singlePartsLength = singleParts.length;
    parts.push(firstPart);
    if (false) {
    ///
    } else if (singlePartsLength === 0) {
    ///
    } else if (singlePartsLength === 1) {
        var firstSinglePart = first(singleParts);
        parts.push(firstSinglePart);
    } else {
        var choiceOfSinglePartsPart = new ChoiceOfPartsPart(singleParts);
        parts.push(choiceOfSinglePartsPart);
    }
    parts = (0, _parts.cloneParts)(parts); ///
    var indirectlyLeftRecursiveDefinition = _indirectly.default.fromPartsRuleNameAndLeftRecursiveDefinitions(parts, ruleName, leftRecursiveDefinitions);
    return indirectlyLeftRecursiveDefinition;
}
function firstPartFromDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions) {
    var firstDirectlyLeftRecursiveDefinition = first(directlyLeftRecursiveDefinitions), directlyLeftRecursiveDefinition = firstDirectlyLeftRecursiveDefinition, parts = directlyLeftRecursiveDefinition.getParts(), firstPart = first(parts), previousFirstPart = firstPart; ///
    directlyLeftRecursiveDefinitions.forEach(function(directlyLeftRecursiveDefinition) {
        var parts = directlyLeftRecursiveDefinition.getParts();
        var firstPart = first(parts), matches = (0, _part.matchParts)(firstPart, previousFirstPart);
        if (!matches) {
            var ruleName = directlyLeftRecursiveDefinition.getRuleName(), definition = directlyLeftRecursiveDefinition, definitionString = definition.asString();
            throw new Error("The '".concat(definitionString, "' directly left recursive definition of the '").concat(ruleName, "' rule does not match one of its sibling directly left recursive definitions and therefore cannot be rewritten."));
        }
    });
    return firstPart;
}
function singlePartsFromDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions) {
    var singleParts = directlyLeftRecursiveDefinitions.map(function(directlyLeftRecursiveDefinition) {
        var parts = directlyLeftRecursiveDefinition.getParts();
        var partsLength = parts.length;
        if (partsLength === 1) {
            var ruleName = directlyLeftRecursiveDefinition.getRuleName(), definition = directlyLeftRecursiveDefinition, definitionString = definition.asString();
            throw new Error("The '".concat(definitionString, "' directly left recursive definition of the '").concat(ruleName, "' rule is unary and therefore cannot be rewritten."));
        }
        var partsTail = tail(parts);
        parts = partsTail; ///
        var singlePart = (0, _parts.singlePartFromParts)(parts);
        return singlePart;
    });
    return singleParts;
}
function firstPartFromIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions) {
    var firstIndirectlyLeftRecursiveDefinition = first(indirectlyLeftRecursiveDefinitions), indirectlyLeftRecursiveDefinition = firstIndirectlyLeftRecursiveDefinition, parts = indirectlyLeftRecursiveDefinition.getParts(), firstPart = first(parts), previousFirstPart = firstPart; ///
    indirectlyLeftRecursiveDefinitions.forEach(function(indirectlyLeftRecursiveDefinition) {
        var parts = indirectlyLeftRecursiveDefinition.getParts();
        var firstPart = first(parts), matches = (0, _part.matchParts)(firstPart, previousFirstPart);
        if (!matches) {
            var ruleName = indirectlyLeftRecursiveDefinition.getRuleName(), definition = indirectlyLeftRecursiveDefinition, definitionString = definition.asString();
            throw new Error("The '".concat(definitionString, "' indirectly left recursive definition of the '").concat(ruleName, "' rule does not match one of its sibling directly left recursive definitions and therefore cannot be rewritten."));
        }
    });
    return firstPart;
}
function singlePartsFromIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions) {
    var singleParts = indirectlyLeftRecursiveDefinitions.reduce(function(singleParts, indirectlyLeftRecursiveDefinition) {
        var parts = indirectlyLeftRecursiveDefinition.getParts();
        var partsTail = tail(parts), partsTailLength = partsTail.length;
        if (partsTailLength > 0) {
            parts = partsTail; ///
            var singlePart = (0, _parts.singlePartFromParts)(parts);
            singleParts.push(singlePart);
        }
        return singleParts;
    }, []);
    return singleParts;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsaXRpZXMvZGVmaW5pdGlvbnMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IFBhcnRzIH0gZnJvbSBcIm9jY2FtLXBhcnNlcnNcIjtcbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5pbXBvcnQgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi4vZGVmaW5pdGlvbi9yZWN1cnNpdmUvbGVmdC9kaXJlY3RseVwiO1xuaW1wb3J0IEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi4vZGVmaW5pdGlvbi9yZWN1cnNpdmUvbGVmdC9pbmRpcmVjdGx5XCI7XG5cbmltcG9ydCB7IG1hdGNoUGFydHMgfSBmcm9tIFwiLi4vdXRpbGl0aWVzL3BhcnRcIjtcbmltcG9ydCB7IGNsb25lUGFydHMsIHNpbmdsZVBhcnRGcm9tUGFydHMgfSBmcm9tIFwiLi4vdXRpbGl0aWVzL3BhcnRzXCI7XG5cbmNvbnN0IHsgZmlyc3QsIHRhaWwgfSA9IGFycmF5VXRpbGl0aWVzLFxuICAgICAgeyBDaG9pY2VPZlBhcnRzUGFydCB9ID0gUGFydHM7XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGNvbnN0IGZpcnN0RGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSxcbiAgICAgICAgcnVsZU5hbWUgPSBmaXJzdERpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKTtcblxuICBsZXQgcGFydHMgPSBbXTtcblxuICBjb25zdCBmaXJzdFBhcnQgPSBmaXJzdFBhcnRGcm9tRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpLFxuICAgICAgICBzaW5nbGVQYXJ0cyA9IHNpbmdsZVBhcnRzRnJvbURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSxcbiAgICAgICAgc2luZ2xlUGFydHNMZW5ndGggPSBzaW5nbGVQYXJ0cy5sZW5ndGg7XG5cbiAgcGFydHMucHVzaChmaXJzdFBhcnQpO1xuXG4gIGlmIChmYWxzZSkge1xuICAgIC8vL1xuICB9IGVsc2UgaWYgKHNpbmdsZVBhcnRzTGVuZ3RoID09PSAxKSB7XG4gICAgY29uc3QgZmlyc3RTaW5nbGVQYXJ0ID0gZmlyc3Qoc2luZ2xlUGFydHMpO1xuXG4gICAgcGFydHMucHVzaChmaXJzdFNpbmdsZVBhcnQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGNob2ljZU9mU2luZ2xlUGFydHNQYXJ0ID0gbmV3IENob2ljZU9mUGFydHNQYXJ0KHNpbmdsZVBhcnRzKTtcblxuICAgIHBhcnRzLnB1c2goY2hvaWNlT2ZTaW5nbGVQYXJ0c1BhcnQpO1xuICB9XG5cbiAgcGFydHMgPSBjbG9uZVBhcnRzKHBhcnRzKTsgIC8vL1xuXG4gIGNvbnN0IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21QYXJ0c0FuZFJ1bGVOYW1lKHBhcnRzLCBydWxlTmFtZSk7XG5cbiAgcmV0dXJuIGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZXJnZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucykge1xuICBjb25zdCBmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpLFxuICAgICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoKSxcbiAgICAgICAgcnVsZU5hbWUgPSBmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRSdWxlTmFtZSgpO1xuXG4gIGxldCBwYXJ0cyA9IFtdO1xuXG4gIGNvbnN0IGZpcnN0UGFydCA9IGZpcnN0UGFydEZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpLFxuICAgICAgICBzaW5nbGVQYXJ0cyA9IHNpbmdsZVBhcnRzRnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyksXG4gICAgICAgIHNpbmdsZVBhcnRzTGVuZ3RoID0gc2luZ2xlUGFydHMubGVuZ3RoO1xuXG4gIHBhcnRzLnB1c2goZmlyc3RQYXJ0KTtcblxuICBpZiAoZmFsc2UpIHtcbiAgICAvLy9cbiAgfSBlbHNlIGlmIChzaW5nbGVQYXJ0c0xlbmd0aCA9PT0gMCkge1xuICAgIC8vL1xuICB9IGVsc2UgaWYgKHNpbmdsZVBhcnRzTGVuZ3RoID09PSAxKSB7XG4gICAgY29uc3QgZmlyc3RTaW5nbGVQYXJ0ID0gZmlyc3Qoc2luZ2xlUGFydHMpO1xuXG4gICAgcGFydHMucHVzaChmaXJzdFNpbmdsZVBhcnQpO1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGNob2ljZU9mU2luZ2xlUGFydHNQYXJ0ID0gbmV3IENob2ljZU9mUGFydHNQYXJ0KHNpbmdsZVBhcnRzKTtcblxuICAgIHBhcnRzLnB1c2goY2hvaWNlT2ZTaW5nbGVQYXJ0c1BhcnQpO1xuICB9XG5cbiAgcGFydHMgPSBjbG9uZVBhcnRzKHBhcnRzKTsgIC8vL1xuXG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUGFydHNSdWxlTmFtZUFuZExlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhwYXJ0cywgcnVsZU5hbWUsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyk7XG5cbiAgcmV0dXJuIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjtcbn1cblxuZnVuY3Rpb24gZmlyc3RQYXJ0RnJvbURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGNvbnN0IGZpcnN0RGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSxcbiAgICAgICAgZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0RGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgIHBhcnRzID0gZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRQYXJ0cygpLFxuICAgICAgICBmaXJzdFBhcnQgPSBmaXJzdChwYXJ0cyksXG4gICAgICAgIHByZXZpb3VzRmlyc3RQYXJ0ID0gZmlyc3RQYXJ0OyAgLy8vXG5cbiAgZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMuZm9yRWFjaCgoZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4ge1xuICAgIGxldCBwYXJ0cyA9IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UGFydHMoKTtcblxuICAgIGNvbnN0IGZpcnN0UGFydCA9IGZpcnN0KHBhcnRzKSxcbiAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hQYXJ0cyhmaXJzdFBhcnQsIHByZXZpb3VzRmlyc3RQYXJ0KTtcblxuICAgIGlmICghbWF0Y2hlcykge1xuICAgICAgY29uc3QgcnVsZU5hbWUgPSBkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICBkZWZpbml0aW9uID0gZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgICAgICBkZWZpbml0aW9uU3RyaW5nID0gZGVmaW5pdGlvbi5hc1N0cmluZygpO1xuXG4gICAgICB0aHJvdyBuZXcgRXJyb3IoYFRoZSAnJHtkZWZpbml0aW9uU3RyaW5nfScgZGlyZWN0bHkgbGVmdCByZWN1cnNpdmUgZGVmaW5pdGlvbiBvZiB0aGUgJyR7cnVsZU5hbWV9JyBydWxlIGRvZXMgbm90IG1hdGNoIG9uZSBvZiBpdHMgc2libGluZyBkaXJlY3RseSBsZWZ0IHJlY3Vyc2l2ZSBkZWZpbml0aW9ucyBhbmQgdGhlcmVmb3JlIGNhbm5vdCBiZSByZXdyaXR0ZW4uYCk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gZmlyc3RQYXJ0O1xufVxuXG5mdW5jdGlvbiBzaW5nbGVQYXJ0c0Zyb21EaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucykge1xuICBjb25zdCBzaW5nbGVQYXJ0cyA9IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLm1hcCgoZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4ge1xuICAgIGxldCBwYXJ0cyA9IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UGFydHMoKTtcblxuICAgIGNvbnN0IHBhcnRzTGVuZ3RoID0gcGFydHMubGVuZ3RoO1xuXG4gICAgaWYgKHBhcnRzTGVuZ3RoID09PSAxKSB7XG4gICAgICBjb25zdCBydWxlTmFtZSA9IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICAgIGRlZmluaXRpb24gPSBkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCAvLy9cbiAgICAgICAgICAgIGRlZmluaXRpb25TdHJpbmcgPSBkZWZpbml0aW9uLmFzU3RyaW5nKCk7XG5cbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlICcke2RlZmluaXRpb25TdHJpbmd9JyBkaXJlY3RseSBsZWZ0IHJlY3Vyc2l2ZSBkZWZpbml0aW9uIG9mIHRoZSAnJHtydWxlTmFtZX0nIHJ1bGUgaXMgdW5hcnkgYW5kIHRoZXJlZm9yZSBjYW5ub3QgYmUgcmV3cml0dGVuLmApO1xuICAgIH1cblxuICAgIGNvbnN0IHBhcnRzVGFpbCA9IHRhaWwocGFydHMpO1xuXG4gICAgcGFydHMgPSBwYXJ0c1RhaWw7ICAvLy9cblxuICAgIGNvbnN0IHNpbmdsZVBhcnQgPSBzaW5nbGVQYXJ0RnJvbVBhcnRzKHBhcnRzKTtcblxuICAgIHJldHVybiBzaW5nbGVQYXJ0O1xuICB9KTtcblxuICByZXR1cm4gc2luZ2xlUGFydHM7XG59XG5cbmZ1bmN0aW9uIGZpcnN0UGFydEZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpIHtcbiAgY29uc3QgZmlyc3RJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBmaXJzdChpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSxcbiAgICAgICAgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gZmlyc3RJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIC8vL1xuICAgICAgICBwYXJ0cyA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRQYXJ0cygpLFxuICAgICAgICBmaXJzdFBhcnQgPSBmaXJzdChwYXJ0cyksXG4gICAgICAgIHByZXZpb3VzRmlyc3RQYXJ0ID0gZmlyc3RQYXJ0OyAgLy8vXG5cbiAgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5mb3JFYWNoKChpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pID0+IHtcbiAgICBsZXQgcGFydHMgPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UGFydHMoKTtcblxuICAgIGNvbnN0IGZpcnN0UGFydCA9IGZpcnN0KHBhcnRzKSxcbiAgICAgICAgICBtYXRjaGVzID0gbWF0Y2hQYXJ0cyhmaXJzdFBhcnQsIHByZXZpb3VzRmlyc3RQYXJ0KTtcblxuICAgIGlmICghbWF0Y2hlcykge1xuICAgICAgY29uc3QgcnVsZU5hbWUgPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICAgIGRlZmluaXRpb24gPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIC8vL1xuICAgICAgICAgICAgZGVmaW5pdGlvblN0cmluZyA9IGRlZmluaXRpb24uYXNTdHJpbmcoKTtcblxuICAgICAgdGhyb3cgbmV3IEVycm9yKGBUaGUgJyR7ZGVmaW5pdGlvblN0cmluZ30nIGluZGlyZWN0bHkgbGVmdCByZWN1cnNpdmUgZGVmaW5pdGlvbiBvZiB0aGUgJyR7cnVsZU5hbWV9JyBydWxlIGRvZXMgbm90IG1hdGNoIG9uZSBvZiBpdHMgc2libGluZyBkaXJlY3RseSBsZWZ0IHJlY3Vyc2l2ZSBkZWZpbml0aW9ucyBhbmQgdGhlcmVmb3JlIGNhbm5vdCBiZSByZXdyaXR0ZW4uYCk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gZmlyc3RQYXJ0O1xufVxuXG5mdW5jdGlvbiBzaW5nbGVQYXJ0c0Zyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpIHtcbiAgY29uc3Qgc2luZ2xlUGFydHMgPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLnJlZHVjZSgoc2luZ2xlUGFydHMsIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4ge1xuICAgIGxldCBwYXJ0cyA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRQYXJ0cygpO1xuXG4gICAgY29uc3QgcGFydHNUYWlsID0gdGFpbChwYXJ0cyksXG4gICAgICAgICAgcGFydHNUYWlsTGVuZ3RoID0gcGFydHNUYWlsLmxlbmd0aDtcblxuICAgIGlmIChwYXJ0c1RhaWxMZW5ndGggPiAwKSB7XG4gICAgICBwYXJ0cyA9IHBhcnRzVGFpbDsgIC8vL1xuXG4gICAgICBjb25zdCBzaW5nbGVQYXJ0ID0gc2luZ2xlUGFydEZyb21QYXJ0cyhwYXJ0cyk7XG5cbiAgICAgIHNpbmdsZVBhcnRzLnB1c2goc2luZ2xlUGFydCk7XG4gICAgfVxuXG4gICAgcmV0dXJuIHNpbmdsZVBhcnRzO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIHNpbmdsZVBhcnRzO1xufVxuIl0sIm5hbWVzIjpbIm1lcmdlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJtZXJnZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJmaXJzdCIsImFycmF5VXRpbGl0aWVzIiwidGFpbCIsIkNob2ljZU9mUGFydHNQYXJ0IiwiUGFydHMiLCJkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImZpcnN0RGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsInJ1bGVOYW1lIiwiZ2V0UnVsZU5hbWUiLCJwYXJ0cyIsImZpcnN0UGFydCIsImZpcnN0UGFydEZyb21EaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInNpbmdsZVBhcnRzIiwic2luZ2xlUGFydHNGcm9tRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJzaW5nbGVQYXJ0c0xlbmd0aCIsImxlbmd0aCIsInB1c2giLCJmaXJzdFNpbmdsZVBhcnQiLCJjaG9pY2VPZlNpbmdsZVBhcnRzUGFydCIsImNsb25lUGFydHMiLCJkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImZyb21QYXJ0c0FuZFJ1bGVOYW1lIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImZpcnN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwibGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiZ2V0TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiZmlyc3RQYXJ0RnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJzaW5nbGVQYXJ0c0Zyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZnJvbVBhcnRzUnVsZU5hbWVBbmRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJnZXRQYXJ0cyIsInByZXZpb3VzRmlyc3RQYXJ0IiwiZm9yRWFjaCIsIm1hdGNoZXMiLCJtYXRjaFBhcnRzIiwiZGVmaW5pdGlvbiIsImRlZmluaXRpb25TdHJpbmciLCJhc1N0cmluZyIsIkVycm9yIiwibWFwIiwicGFydHNMZW5ndGgiLCJwYXJ0c1RhaWwiLCJzaW5nbGVQYXJ0Iiwic2luZ2xlUGFydEZyb21QYXJ0cyIsInJlZHVjZSIsInBhcnRzVGFpbExlbmd0aCJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7Ozs7Ozs7OztJQWNHQSxxQ0FBcUM7ZUFBckNBLHFDQUFxQzs7SUErQnJDQyx1Q0FBdUM7ZUFBdkNBLHVDQUF1Qzs7OzRCQTNDakMsZUFBZTt5QkFDTixXQUFXOzZEQUVFLHVDQUF1QzsrREFDckMseUNBQXlDO29CQUU1RCxtQkFBbUI7cUJBQ0Usb0JBQW9COzs7Ozs7QUFFcEUsSUFBUUMsS0FBSyxHQUFXQyxVQUFjLGVBQUEsQ0FBOUJELEtBQUssRUFBRUUsSUFBSSxHQUFLRCxVQUFjLGVBQUEsQ0FBdkJDLElBQUksRUFDYixBQUFFQyxpQkFBaUIsR0FBS0MsYUFBSyxNQUFBLENBQTNC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