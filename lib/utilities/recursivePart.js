'use strict';

var parsers = require('occam-parsers');

var arrayUtilities = require('../utilities/array');

var first = arrayUtilities.first;
var partTypes = parsers.partTypes,
    RuleNamePartType = partTypes.RuleNamePartType,
    OptionalPartPartType = partTypes.OptionalPartPartType,
    GroupOfPartsPartType = partTypes.GroupOfPartsPartType,
    ChoiceOfPartsPartType = partTypes.ChoiceOfPartsPartType,
    OneOrMorePartsPartType = partTypes.OneOrMorePartsPartType,
    ZeroOrMorePartsPartType = partTypes.ZeroOrMorePartsPartType;


function isPartRecursive(part) {
  var recursiveRuleNames = recursiveRuleNamesFromPart(part),
      recursiveRuleNamesLength = recursiveRuleNames.length,
      partRecursive = recursiveRuleNamesLength > 0;

  return partRecursive;
}

function isPartLeftRecursive(part) {
  var leftRecursiveRuleName = leftRecursiveRuleNameFromPart(part),
      partLeftRecursive = leftRecursiveRuleName !== null;

  return partLeftRecursive;
}

function recursiveRuleNamesFromPart(part) {
  var recursiveRuleNames = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

  var partRecursive = false;

  var partNonTerminalPart = part.isNonTerminalPart();

  if (partNonTerminalPart) {
    var type = part.getType();

    switch (type) {
      case RuleNamePartType:
        {
          var ruleNamePart = part,
              ///
          ruleName = ruleNamePart.getRuleName(),
              recursiveRuleNamesIncludesRuleName = recursiveRuleNames.includes(ruleName);

          if (!recursiveRuleNamesIncludesRuleName) {
            var recursiveRuleName = ruleName; ///

            recursiveRuleNames.push(recursiveRuleName);
          }
        }
        break;

      case OptionalPartPartType:
        {
          var optionalPartPart = part; ///

          part = optionalPartPart.getPart();

          recursiveRuleNamesFromPart(part, recursiveRuleNames);
        }
        break;

      case OneOrMorePartsPartType:
        {
          var oneOrMorePartsPart = part; ///

          part = oneOrMorePartsPart.getPart();

          recursiveRuleNamesFromPart(part, recursiveRuleNames);
        }
        break;

      case ZeroOrMorePartsPartType:
        {
          var zeroOrMorePartsPart = part; ///

          part = zeroOrMorePartsPart.getPart(); ///

          recursiveRuleNamesFromPart(part, recursiveRuleNames);
        }
        break;

      case GroupOfPartsPartType:
        {
          var groupOfPartsPart = part,
              ///
          parts = groupOfPartsPart.getParts();

          partRecursive = parts.some(function (part) {
            recursiveRuleNamesFromPart(part, recursiveRuleNames);
          });
        }
        break;

      case ChoiceOfPartsPartType:
        {
          var choiceOfPartsPart = part,
              ///
          _parts = choiceOfPartsPart.getParts();

          partRecursive = _parts.some(function (part) {
            recursiveRuleNamesFromPart(part, recursiveRuleNames);
          });
        }
        break;
    }
  }

  return partRecursive;
}

function leftRecursiveRuleNameFromPart(part) {
  var leftRecursiveRuleName = null;

  var partNonTerminalPart = part.isNonTerminalPart();

  if (partNonTerminalPart) {
    var type = part.getType();

    switch (type) {
      case RuleNamePartType:
        {
          var ruleNamePart = part,
              ///
          ruleName = ruleNamePart.getRuleName();

          leftRecursiveRuleName = ruleName; ///
        }
        break;

      case OptionalPartPartType:
        {
          var optionalPartPart = part; ///

          part = optionalPartPart.getPart();

          leftRecursiveRuleName = leftRecursiveRuleNameFromPart(part);
        }
        break;

      case OneOrMorePartsPartType:
        {
          var oneOrMorePartsPart = part; ///

          part = oneOrMorePartsPart.getPart();

          leftRecursiveRuleName = leftRecursiveRuleNameFromPart(part);
        }
        break;

      case ZeroOrMorePartsPartType:
        {
          var zeroOrMorePartsPart = part; ///

          part = zeroOrMorePartsPart.getPart();

          leftRecursiveRuleName = leftRecursiveRuleNameFromPart(part);
        }
        break;

      case GroupOfPartsPartType:
        {
          var groupOfPartsPart = part,
              ///
          parts = groupOfPartsPart.getParts(),
              firstPart = first(parts);

          part = firstPart; ///

          leftRecursiveRuleName = leftRecursiveRuleNameFromPart(part);
        }
        break;

      case ChoiceOfPartsPartType:
        {
          var choiceOfPartsPart = part,
              ///
          _parts2 = choiceOfPartsPart.getParts();

          _parts2.some(function (part) {
            leftRecursiveRuleName = leftRecursiveRuleNameFromPart(part);

            if (leftRecursiveRuleName !== null) {
              return true;
            }
          });
        }
        break;
    }
  }

  return leftRecursiveRuleName;
}

module.exports = {
  isPartRecursive: isPartRecursive,
  isPartLeftRecursive: isPartLeftRecursive,
  recursiveRuleNamesFromPart: recursiveRuleNamesFromPart,
  leftRecursiveRuleNameFromPart: leftRecursiveRuleNameFromPart
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcmVjdXJzaXZlUGFydC5qcyJdLCJuYW1lcyI6WyJwYXJzZXJzIiwicmVxdWlyZSIsImFycmF5VXRpbGl0aWVzIiwiZmlyc3QiLCJwYXJ0VHlwZXMiLCJSdWxlTmFtZVBhcnRUeXBlIiwiT3B0aW9uYWxQYXJ0UGFydFR5cGUiLCJHcm91cE9mUGFydHNQYXJ0VHlwZSIsIkNob2ljZU9mUGFydHNQYXJ0VHlwZSIsIk9uZU9yTW9yZVBhcnRzUGFydFR5cGUiLCJaZXJvT3JNb3JlUGFydHNQYXJ0VHlwZSIsImlzUGFydFJlY3Vyc2l2ZSIsInBhcnQiLCJyZWN1cnNpdmVSdWxlTmFtZXMiLCJyZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydCIsInJlY3Vyc2l2ZVJ1bGVOYW1lc0xlbmd0aCIsImxlbmd0aCIsInBhcnRSZWN1cnNpdmUiLCJpc1BhcnRMZWZ0UmVjdXJzaXZlIiwibGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lIiwibGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lRnJvbVBhcnQiLCJwYXJ0TGVmdFJlY3Vyc2l2ZSIsInBhcnROb25UZXJtaW5hbFBhcnQiLCJpc05vblRlcm1pbmFsUGFydCIsInR5cGUiLCJnZXRUeXBlIiwicnVsZU5hbWVQYXJ0IiwicnVsZU5hbWUiLCJnZXRSdWxlTmFtZSIsInJlY3Vyc2l2ZVJ1bGVOYW1lc0luY2x1ZGVzUnVsZU5hbWUiLCJpbmNsdWRlcyIsInJlY3Vyc2l2ZVJ1bGVOYW1lIiwicHVzaCIsIm9wdGlvbmFsUGFydFBhcnQiLCJnZXRQYXJ0Iiwib25lT3JNb3JlUGFydHNQYXJ0IiwiemVyb09yTW9yZVBhcnRzUGFydCIsImdyb3VwT2ZQYXJ0c1BhcnQiLCJwYXJ0cyIsImdldFBhcnRzIiwic29tZSIsImNob2ljZU9mUGFydHNQYXJ0IiwiZmlyc3RQYXJ0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsVUFBVUMsUUFBUSxlQUFSLENBQWhCOztBQUVBLElBQU1D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QUVBZixrQ0FBd0JDLDhCQUE4QlIsSUFBOUIsQ0FBeEI7QUFDRDtBQUNEOztBQUVGLFdBQUtMLG9CQUFMO0FBQTRCO0FBQ3hCLGNBQU04QixtQkFBbUJ6QixJQUF6QjtBQUFBLGNBQWdDO0FBQzFCMEIsa0JBQVFELGlCQUFpQkUsUUFBakIsRUFEZDtBQUFBLGNBRU1HLFlBQVl2QyxNQUFNbUMsS0FBTixDQUZsQjs7QUFJQTFCLGlCQUFPOEIsU0FBUCxDQUx3QixDQUtOOztBQUVsQnZCLGtDQUF3QkMsOEJBQThCUixJQUE5QixDQUF4QjtBQUNEO0FBQ0Q7O0FBRUYsV0FBS0oscUJBQUw7QUFBNkI7QUFDekIsY0FBTWlDLG9CQUFvQjdCLElBQTFCO0FBQUEsY0FBZ0M7QUFDMUIwQixvQkFBUUcsa0JBQWtCRixRQUFsQixFQURkOztBQUdBRCxrQkFBTUUsSUFBTixDQUFXLFVBQUM1QixJQUFELEVBQVU7QUFDbkJPLG9DQUF3QkMsOEJBQThCUixJQUE5QixDQUF4Qjs7QUFFQSxnQkFBSU8sMEJBQTBCLElBQTlCLEVBQW9DO0FBQ2xDLHFCQUFPLElBQVA7QUFDRDtBQUNGLFdBTkQ7QUFPRDtBQUNEO0FBM0RKO0FBNkREOztBQUVELFNBQU9BLHFCQUFQO0FBQ0Q7O0FBRUR3QixPQUFPQyxPQUFQLEdBQWlCO0FBQ2ZqQyxrQ0FEZTtBQUVmTywwQ0FGZTtBQUdmSix3REFIZTtBQUlmTTtBQUplLENBQWpCIiwiZmlsZSI6InJlY3Vyc2l2ZVBhcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHBhcnNlcnMgPSByZXF1aXJlKCdvY2NhbS1wYXJzZXJzJyk7XG5cbmNvbnN0IGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FycmF5Jyk7XG5cbmNvbnN0IHsgZmlyc3QgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5jb25zdCB7IHBhcnRUeXBlcyB9ID0gcGFyc2VycyxcbiAgICAgIHsgUnVsZU5hbWVQYXJ0VHlwZSxcbiAgICAgICAgT3B0aW9uYWxQYXJ0UGFydFR5cGUsXG4gICAgICAgIEdyb3VwT2ZQYXJ0c1BhcnRUeXBlLFxuICAgICAgICBDaG9pY2VPZlBhcnRzUGFydFR5cGUsXG4gICAgICAgIE9uZU9yTW9yZVBhcnRzUGFydFR5cGUsXG4gICAgICAgIFplcm9Pck1vcmVQYXJ0c1BhcnRUeXBlIH0gPSBwYXJ0VHlwZXM7XG5cbmZ1bmN0aW9uIGlzUGFydFJlY3Vyc2l2ZShwYXJ0KSB7XG4gIGNvbnN0IHJlY3Vyc2l2ZVJ1bGVOYW1lcyA9IHJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0KHBhcnQpLFxuICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXNMZW5ndGggPSByZWN1cnNpdmVSdWxlTmFtZXMubGVuZ3RoLFxuICAgICAgICBwYXJ0UmVjdXJzaXZlID0gKHJlY3Vyc2l2ZVJ1bGVOYW1lc0xlbmd0aCA+IDApO1xuXG4gIHJldHVybiBwYXJ0UmVjdXJzaXZlO1xufVxuXG5mdW5jdGlvbiBpc1BhcnRMZWZ0UmVjdXJzaXZlKHBhcnQpIHtcbiAgY29uc3QgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lRnJvbVBhcnQocGFydCksXG4gICAgICAgIHBhcnRMZWZ0UmVjdXJzaXZlID0gKGxlZnRSZWN1cnNpdmVSdWxlTmFtZSAhPT0gbnVsbCk7XG5cbiAgcmV0dXJuIHBhcnRMZWZ0UmVjdXJzaXZlO1xufVxuXG5mdW5jdGlvbiByZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCByZWN1cnNpdmVSdWxlTmFtZXMgPSBbXSkge1xuICBsZXQgcGFydFJlY3Vyc2l2ZSA9IGZhbHNlO1xuXG4gIGNvbnN0IHBhcnROb25UZXJtaW5hbFBhcnQgPSBwYXJ0LmlzTm9uVGVybWluYWxQYXJ0KCk7XG5cbiAgaWYgKHBhcnROb25UZXJtaW5hbFBhcnQpIHtcbiAgICBjb25zdCB0eXBlID0gcGFydC5nZXRUeXBlKCk7XG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgUnVsZU5hbWVQYXJ0VHlwZSA6IHtcbiAgICAgICAgICBjb25zdCBydWxlTmFtZVBhcnQgPSBwYXJ0LCAgLy8vXG4gICAgICAgICAgICAgICAgcnVsZU5hbWUgPSBydWxlTmFtZVBhcnQuZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXNJbmNsdWRlc1J1bGVOYW1lID0gcmVjdXJzaXZlUnVsZU5hbWVzLmluY2x1ZGVzKHJ1bGVOYW1lKTtcblxuICAgICAgICAgIGlmICghcmVjdXJzaXZlUnVsZU5hbWVzSW5jbHVkZXNSdWxlTmFtZSkge1xuICAgICAgICAgICAgY29uc3QgcmVjdXJzaXZlUnVsZU5hbWUgPSBydWxlTmFtZTsgLy8vXG5cbiAgICAgICAgICAgIHJlY3Vyc2l2ZVJ1bGVOYW1lcy5wdXNoKHJlY3Vyc2l2ZVJ1bGVOYW1lKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgT3B0aW9uYWxQYXJ0UGFydFR5cGUgOiB7XG4gICAgICAgICAgY29uc3Qgb3B0aW9uYWxQYXJ0UGFydCA9IHBhcnQ7ICAvLy9cblxuICAgICAgICAgIHBhcnQgPSBvcHRpb25hbFBhcnRQYXJ0LmdldFBhcnQoKTtcblxuICAgICAgICAgIHJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0KHBhcnQsIHJlY3Vyc2l2ZVJ1bGVOYW1lcyk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgT25lT3JNb3JlUGFydHNQYXJ0VHlwZSA6IHtcbiAgICAgICAgICBjb25zdCBvbmVPck1vcmVQYXJ0c1BhcnQgPSBwYXJ0OyAgLy8vXG5cbiAgICAgICAgICBwYXJ0ID0gb25lT3JNb3JlUGFydHNQYXJ0LmdldFBhcnQoKTtcblxuICAgICAgICAgIHJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0KHBhcnQsIHJlY3Vyc2l2ZVJ1bGVOYW1lcyk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgWmVyb09yTW9yZVBhcnRzUGFydFR5cGUgOiB7XG4gICAgICAgICAgY29uc3QgemVyb09yTW9yZVBhcnRzUGFydCA9IHBhcnQ7IC8vL1xuXG4gICAgICAgICAgcGFydCA9IHplcm9Pck1vcmVQYXJ0c1BhcnQuZ2V0UGFydCgpOyAgLy8vXG5cbiAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCByZWN1cnNpdmVSdWxlTmFtZXMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIEdyb3VwT2ZQYXJ0c1BhcnRUeXBlIDoge1xuICAgICAgICBjb25zdCBncm91cE9mUGFydHNQYXJ0ID0gcGFydCwgIC8vL1xuICAgICAgICAgICAgICBwYXJ0cyA9IGdyb3VwT2ZQYXJ0c1BhcnQuZ2V0UGFydHMoKTtcblxuICAgICAgICAgIHBhcnRSZWN1cnNpdmUgPSBwYXJ0cy5zb21lKChwYXJ0KSA9PiB7XG4gICAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCByZWN1cnNpdmVSdWxlTmFtZXMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIENob2ljZU9mUGFydHNQYXJ0VHlwZSA6IHtcbiAgICAgICAgICBjb25zdCBjaG9pY2VPZlBhcnRzUGFydCA9IHBhcnQsIC8vL1xuICAgICAgICAgICAgICAgIHBhcnRzID0gY2hvaWNlT2ZQYXJ0c1BhcnQuZ2V0UGFydHMoKTtcblxuICAgICAgICAgIHBhcnRSZWN1cnNpdmUgPSBwYXJ0cy5zb21lKChwYXJ0KSA9PiB7XG4gICAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCByZWN1cnNpdmVSdWxlTmFtZXMpO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBwYXJ0UmVjdXJzaXZlO1xufVxuXG5mdW5jdGlvbiBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVGcm9tUGFydChwYXJ0KSB7XG4gIGxldCBsZWZ0UmVjdXJzaXZlUnVsZU5hbWUgPSBudWxsO1xuXG4gIGNvbnN0IHBhcnROb25UZXJtaW5hbFBhcnQgPSBwYXJ0LmlzTm9uVGVybWluYWxQYXJ0KCk7XG5cbiAgaWYgKHBhcnROb25UZXJtaW5hbFBhcnQpIHtcbiAgICBjb25zdCB0eXBlID0gcGFydC5nZXRUeXBlKCk7XG5cbiAgICBzd2l0Y2ggKHR5cGUpIHtcbiAgICAgIGNhc2UgUnVsZU5hbWVQYXJ0VHlwZSA6IHtcbiAgICAgICAgICBjb25zdCBydWxlTmFtZVBhcnQgPSBwYXJ0LCAgLy8vXG4gICAgICAgICAgICAgICAgcnVsZU5hbWUgPSBydWxlTmFtZVBhcnQuZ2V0UnVsZU5hbWUoKTtcblxuICAgICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlTmFtZSA9IHJ1bGVOYW1lOyAvLy9cbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBPcHRpb25hbFBhcnRQYXJ0VHlwZSA6IHtcbiAgICAgICAgICBjb25zdCBvcHRpb25hbFBhcnRQYXJ0ID0gcGFydDsgLy8vXG5cbiAgICAgICAgICBwYXJ0ID0gb3B0aW9uYWxQYXJ0UGFydC5nZXRQYXJ0KCk7XG5cbiAgICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZU5hbWUgPSBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVGcm9tUGFydChwYXJ0KTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBPbmVPck1vcmVQYXJ0c1BhcnRUeXBlIDoge1xuICAgICAgICAgIGNvbnN0IG9uZU9yTW9yZVBhcnRzUGFydCA9IHBhcnQ7ICAvLy9cblxuICAgICAgICAgIHBhcnQgPSBvbmVPck1vcmVQYXJ0c1BhcnQuZ2V0UGFydCgpO1xuXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lRnJvbVBhcnQocGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgWmVyb09yTW9yZVBhcnRzUGFydFR5cGUgOiB7XG4gICAgICAgICAgY29uc3QgemVyb09yTW9yZVBhcnRzUGFydCA9IHBhcnQ7IC8vL1xuXG4gICAgICAgICAgcGFydCA9IHplcm9Pck1vcmVQYXJ0c1BhcnQuZ2V0UGFydCgpO1xuXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lRnJvbVBhcnQocGFydCk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG5cbiAgICAgIGNhc2UgR3JvdXBPZlBhcnRzUGFydFR5cGUgOiB7XG4gICAgICAgICAgY29uc3QgZ3JvdXBPZlBhcnRzUGFydCA9IHBhcnQsICAvLy9cbiAgICAgICAgICAgICAgICBwYXJ0cyA9IGdyb3VwT2ZQYXJ0c1BhcnQuZ2V0UGFydHMoKSxcbiAgICAgICAgICAgICAgICBmaXJzdFBhcnQgPSBmaXJzdChwYXJ0cyk7XG5cbiAgICAgICAgICBwYXJ0ID0gZmlyc3RQYXJ0OyAvLy9cblxuICAgICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlTmFtZSA9IGxlZnRSZWN1cnNpdmVSdWxlTmFtZUZyb21QYXJ0KHBhcnQpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIENob2ljZU9mUGFydHNQYXJ0VHlwZSA6IHtcbiAgICAgICAgICBjb25zdCBjaG9pY2VPZlBhcnRzUGFydCA9IHBhcnQsIC8vL1xuICAgICAgICAgICAgICAgIHBhcnRzID0gY2hvaWNlT2ZQYXJ0c1BhcnQuZ2V0UGFydHMoKTtcblxuICAgICAgICAgIHBhcnRzLnNvbWUoKHBhcnQpID0+IHtcbiAgICAgICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlTmFtZSA9IGxlZnRSZWN1cnNpdmVSdWxlTmFtZUZyb21QYXJ0KHBhcnQpO1xuXG4gICAgICAgICAgICBpZiAobGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lICE9PSBudWxsKSB7XG4gICAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiBsZWZ0UmVjdXJzaXZlUnVsZU5hbWU7XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBpc1BhcnRSZWN1cnNpdmUsXG4gIGlzUGFydExlZnRSZWN1cnNpdmUsXG4gIHJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0LFxuICBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVGcm9tUGFydFxufTtcbiJdfQ==