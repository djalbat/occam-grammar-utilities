'use strict';

var parsers = require('occam-parsers');

var arrayUtilities = require('../utilities/array');

var first = arrayUtilities.first;
var partTypes = parsers.partTypes,
    RuleNamePartType = partTypes.RuleNamePartType,
    OptionalPartPartType = partTypes.OptionalPartPartType,
    GroupOfPartsPartType = partTypes.GroupOfPartsPartType,
    ChoiceOfPartsPartType = partTypes.ChoiceOfPartsPartType,
    OneOrMorePartsPartType = partTypes.OneOrMorePartsPartType,
    ZeroOrMorePartsPartType = partTypes.ZeroOrMorePartsPartType;


function recursiveRuleNamesFromPart(part, recursiveRuleNames) {
  var partNonTerminalPart = part.isNonTerminalPart();

  if (partNonTerminalPart) {
    var type = part.getType();

    switch (type) {
      case RuleNamePartType:
        {
          var ruleNamePart = part,
              ///
          ruleName = ruleNamePart.getRuleName(),
              recursiveRuleNamesIncludesRuleName = recursiveRuleNames.includes(ruleName);

          if (!recursiveRuleNamesIncludesRuleName) {
            var recursiveRuleName = ruleName; ///

            recursiveRuleNames.push(recursiveRuleName);
          }
        }
        break;

      case OptionalPartPartType:
        {
          var optionalPartPart = part; ///

          part = optionalPartPart.getPart();

          recursiveRuleNamesFromPart(part, recursiveRuleNames);
        }
        break;

      case OneOrMorePartsPartType:
        {
          var oneOrMorePartsPart = part; ///

          part = oneOrMorePartsPart.getPart();

          recursiveRuleNamesFromPart(part, recursiveRuleNames);
        }
        break;

      case ZeroOrMorePartsPartType:
        {
          var zeroOrMorePartsPart = part; ///

          part = zeroOrMorePartsPart.getPart(); ///

          recursiveRuleNamesFromPart(part, recursiveRuleNames);
        }
        break;

      case GroupOfPartsPartType:
        {
          var groupOfPartsPart = part,
              ///
          parts = groupOfPartsPart.getParts();

          parts.forEach(function (part) {
            return recursiveRuleNamesFromPart(part, recursiveRuleNames);
          });
        }
        break;

      case ChoiceOfPartsPartType:
        {
          var choiceOfPartsPart = part,
              ///
          _parts = choiceOfPartsPart.getParts();

          _parts.forEach(function (part) {
            return recursiveRuleNamesFromPart(part, recursiveRuleNames);
          });
        }
        break;
    }
  }
}

function leftRecursiveRuleNamesFromPart(part, leftRecursiveRuleNames) {
  var partNonTerminalPart = part.isNonTerminalPart();

  if (partNonTerminalPart) {
    var type = part.getType();

    switch (type) {
      case RuleNamePartType:
        {
          var ruleNamePart = part,
              ///
          ruleName = ruleNamePart.getRuleName(),
              leftRecursiveRuleNamesIncludesRuleName = leftRecursiveRuleNames.includes(ruleName);

          if (!leftRecursiveRuleNamesIncludesRuleName) {
            var leftRecursiveRuleName = ruleName; ///

            leftRecursiveRuleNames.push(leftRecursiveRuleName);
          }
        }
        break;

      case OptionalPartPartType:
        {
          var optionalPartPart = part; ///

          part = optionalPartPart.getPart();

          leftRecursiveRuleNamesFromPart(part, leftRecursiveRuleNames);
        }
        break;

      case OneOrMorePartsPartType:
        {
          var oneOrMorePartsPart = part; ///

          part = oneOrMorePartsPart.getPart();

          leftRecursiveRuleNamesFromPart(part, leftRecursiveRuleNames);
        }
        break;

      case ZeroOrMorePartsPartType:
        {
          var zeroOrMorePartsPart = part; ///

          part = zeroOrMorePartsPart.getPart();

          leftRecursiveRuleNamesFromPart(part, leftRecursiveRuleNames);
        }
        break;

      case GroupOfPartsPartType:
        {
          var groupOfPartsPart = part,
              ///
          parts = groupOfPartsPart.getParts(),
              firstPart = first(parts);

          part = firstPart; ///

          leftRecursiveRuleNamesFromPart(part, leftRecursiveRuleNames);
        }
        break;

      case ChoiceOfPartsPartType:
        {
          var choiceOfPartsPart = part,
              ///
          _parts2 = choiceOfPartsPart.getParts();

          _parts2.forEach(function (part) {
            return leftRecursiveRuleNamesFromPart(part, leftRecursiveRuleNames);
          });
        }
        break;
    }
  }
}

module.exports = {
  recursiveRuleNamesFromPart: recursiveRuleNamesFromPart,
  leftRecursiveRuleNamesFromPart: leftRecursiveRuleNamesFromPart
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcmVjdXJzaXZlUGFydC5qcyJdLCJuYW1lcyI6WyJwYXJzZXJzIiwicmVxdWlyZSIsImFycmF5VXRpbGl0aWVzIiwiZmlyc3QiLCJwYXJ0VHlwZXMiLCJSdWxlTmFtZVBhcnRUeXBlIiwiT3B0aW9uYWxQYXJ0UGFydFR5cGUiLCJHcm91cE9mUGFydHNQYXJ0VHlwZSIsIkNob2ljZU9mUGFydHNQYXJ0VHlwZSIsIk9uZU9yTW9yZVBhcnRzUGFydFR5cGUiLCJaZXJvT3JNb3JlUGFydHNQYXJ0VHlwZSIsInJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0IiwicGFydCIsInJlY3Vyc2l2ZVJ1bGVOYW1lcyIsInBhcnROb25UZXJtaW5hbFBhcnQiLCJpc05vblRlcm1pbmFsUGFydCIsInR5cGUiLCJnZXRUeXBlIiwicnVsZU5hbWVQYXJ0IiwicnVsZU5hbWUiLCJnZXRSdWxlTmFtZSIsInJlY3Vyc2l2ZVJ1bGVOYW1lc0luY2x1ZGVzUnVsZU5hbWUiLCJpbmNsdWRlcyIsInJlY3Vyc2l2ZVJ1bGVOYW1lIiwicHVzaCIsIm9wdGlvbmFsUGFydFBhcnQiLCJnZXRQYXJ0Iiwib25lT3JNb3JlUGFydHNQYXJ0IiwiemVyb09yTW9yZVBhcnRzUGFydCIsImdyb3VwT2ZQYXJ0c1BhcnQiLCJwYXJ0cyIsImdldFBhcnRzIiwiZm9yRWFjaCIsImNob2ljZU9mUGFydHNQYXJ0IiwibGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0IiwibGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyIsImxlZnRSZWN1cnNpdmVSdWxlTmFtZXNJbmNsdWRlc1J1bGVOYW1lIiwibGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lIiwiZmlyc3RQYXJ0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsVUFBVUMsUUFBUSxlQUFSLENBQWhCOztBQUVBLElBQU1DLGlCQUFpQkQsUUFBUSxvQkFBUixDQUF2Qjs7SUFFUUUsSyxHQUFVRCxj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QixJQUExQjtBQUFBLGNBQWdDO0FBQzFCa0Isb0JBQVFHLGtCQUFrQkYsUUFBbEIsRUFEZDs7QUFHQUQsa0JBQU1FLE9BQU4sQ0FBYyxVQUFDcEIsSUFBRDtBQUFBLG1CQUFVc0IsK0JBQStCdEIsSUFBL0IsRUFBcUN1QixzQkFBckMsQ0FBVjtBQUFBLFdBQWQ7QUFDRDtBQUNEO0FBMURKO0FBNEREO0FBQ0Y7O0FBRURJLE9BQU9DLE9BQVAsR0FBaUI7QUFDZjdCLHdEQURlO0FBRWZ1QjtBQUZlLENBQWpCIiwiZmlsZSI6InJlY3Vyc2l2ZVBhcnQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHBhcnNlcnMgPSByZXF1aXJlKCdvY2NhbS1wYXJzZXJzJyk7XG5cbmNvbnN0IGFycmF5VXRpbGl0aWVzID0gcmVxdWlyZSgnLi4vdXRpbGl0aWVzL2FycmF5Jyk7XG5cbmNvbnN0IHsgZmlyc3QgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5jb25zdCB7IHBhcnRUeXBlcyB9ID0gcGFyc2VycyxcbiAgICAgIHsgUnVsZU5hbWVQYXJ0VHlwZSxcbiAgICAgICAgT3B0aW9uYWxQYXJ0UGFydFR5cGUsXG4gICAgICAgIEdyb3VwT2ZQYXJ0c1BhcnRUeXBlLFxuICAgICAgICBDaG9pY2VPZlBhcnRzUGFydFR5cGUsXG4gICAgICAgIE9uZU9yTW9yZVBhcnRzUGFydFR5cGUsXG4gICAgICAgIFplcm9Pck1vcmVQYXJ0c1BhcnRUeXBlIH0gPSBwYXJ0VHlwZXM7XG5cbmZ1bmN0aW9uIHJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0KHBhcnQsIHJlY3Vyc2l2ZVJ1bGVOYW1lcykge1xuICBjb25zdCBwYXJ0Tm9uVGVybWluYWxQYXJ0ID0gcGFydC5pc05vblRlcm1pbmFsUGFydCgpO1xuXG4gIGlmIChwYXJ0Tm9uVGVybWluYWxQYXJ0KSB7XG4gICAgY29uc3QgdHlwZSA9IHBhcnQuZ2V0VHlwZSgpO1xuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFJ1bGVOYW1lUGFydFR5cGUgOiB7XG4gICAgICAgICAgY29uc3QgcnVsZU5hbWVQYXJ0ID0gcGFydCwgIC8vL1xuICAgICAgICAgICAgICAgIHJ1bGVOYW1lID0gcnVsZU5hbWVQYXJ0LmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICAgICAgcmVjdXJzaXZlUnVsZU5hbWVzSW5jbHVkZXNSdWxlTmFtZSA9IHJlY3Vyc2l2ZVJ1bGVOYW1lcy5pbmNsdWRlcyhydWxlTmFtZSk7XG5cbiAgICAgICAgICBpZiAoIXJlY3Vyc2l2ZVJ1bGVOYW1lc0luY2x1ZGVzUnVsZU5hbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlY3Vyc2l2ZVJ1bGVOYW1lID0gcnVsZU5hbWU7IC8vL1xuXG4gICAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXMucHVzaChyZWN1cnNpdmVSdWxlTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIE9wdGlvbmFsUGFydFBhcnRUeXBlIDoge1xuICAgICAgICAgIGNvbnN0IG9wdGlvbmFsUGFydFBhcnQgPSBwYXJ0OyAgLy8vXG5cbiAgICAgICAgICBwYXJ0ID0gb3B0aW9uYWxQYXJ0UGFydC5nZXRQYXJ0KCk7XG5cbiAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCByZWN1cnNpdmVSdWxlTmFtZXMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIE9uZU9yTW9yZVBhcnRzUGFydFR5cGUgOiB7XG4gICAgICAgICAgY29uc3Qgb25lT3JNb3JlUGFydHNQYXJ0ID0gcGFydDsgIC8vL1xuXG4gICAgICAgICAgcGFydCA9IG9uZU9yTW9yZVBhcnRzUGFydC5nZXRQYXJ0KCk7XG5cbiAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCByZWN1cnNpdmVSdWxlTmFtZXMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFplcm9Pck1vcmVQYXJ0c1BhcnRUeXBlIDoge1xuICAgICAgICAgIGNvbnN0IHplcm9Pck1vcmVQYXJ0c1BhcnQgPSBwYXJ0OyAvLy9cblxuICAgICAgICAgIHBhcnQgPSB6ZXJvT3JNb3JlUGFydHNQYXJ0LmdldFBhcnQoKTsgIC8vL1xuXG4gICAgICAgICAgcmVjdXJzaXZlUnVsZU5hbWVzRnJvbVBhcnQocGFydCwgcmVjdXJzaXZlUnVsZU5hbWVzKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBHcm91cE9mUGFydHNQYXJ0VHlwZSA6IHtcbiAgICAgICAgY29uc3QgZ3JvdXBPZlBhcnRzUGFydCA9IHBhcnQsICAvLy9cbiAgICAgICAgICAgICAgcGFydHMgPSBncm91cE9mUGFydHNQYXJ0LmdldFBhcnRzKCk7XG5cbiAgICAgICAgICBwYXJ0cy5mb3JFYWNoKChwYXJ0KSA9PiByZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCByZWN1cnNpdmVSdWxlTmFtZXMpKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBDaG9pY2VPZlBhcnRzUGFydFR5cGUgOiB7XG4gICAgICAgIGNvbnN0IGNob2ljZU9mUGFydHNQYXJ0ID0gcGFydCwgLy8vXG4gICAgICAgICAgICAgIHBhcnRzID0gY2hvaWNlT2ZQYXJ0c1BhcnQuZ2V0UGFydHMoKTtcblxuICAgICAgICAgIHBhcnRzLmZvckVhY2goKHBhcnQpID0+IHJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0KHBhcnQsIHJlY3Vyc2l2ZVJ1bGVOYW1lcykpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfVxufVxuXG5mdW5jdGlvbiBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzRnJvbVBhcnQocGFydCwgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcykge1xuICBjb25zdCBwYXJ0Tm9uVGVybWluYWxQYXJ0ID0gcGFydC5pc05vblRlcm1pbmFsUGFydCgpO1xuXG4gIGlmIChwYXJ0Tm9uVGVybWluYWxQYXJ0KSB7XG4gICAgY29uc3QgdHlwZSA9IHBhcnQuZ2V0VHlwZSgpO1xuXG4gICAgc3dpdGNoICh0eXBlKSB7XG4gICAgICBjYXNlIFJ1bGVOYW1lUGFydFR5cGUgOiB7XG4gICAgICAgICAgY29uc3QgcnVsZU5hbWVQYXJ0ID0gcGFydCwgIC8vL1xuICAgICAgICAgICAgICAgIHJ1bGVOYW1lID0gcnVsZU5hbWVQYXJ0LmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lc0luY2x1ZGVzUnVsZU5hbWUgPSBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzLmluY2x1ZGVzKHJ1bGVOYW1lKTtcblxuICAgICAgICAgIGlmICghbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lc0luY2x1ZGVzUnVsZU5hbWUpIHtcbiAgICAgICAgICAgIGNvbnN0IGxlZnRSZWN1cnNpdmVSdWxlTmFtZSA9IHJ1bGVOYW1lOyAvLy9cblxuICAgICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcy5wdXNoKGxlZnRSZWN1cnNpdmVSdWxlTmFtZSk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIE9wdGlvbmFsUGFydFBhcnRUeXBlIDoge1xuICAgICAgICAgIGNvbnN0IG9wdGlvbmFsUGFydFBhcnQgPSBwYXJ0OyAvLy9cblxuICAgICAgICAgIHBhcnQgPSBvcHRpb25hbFBhcnRQYXJ0LmdldFBhcnQoKTtcblxuICAgICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBPbmVPck1vcmVQYXJ0c1BhcnRUeXBlIDoge1xuICAgICAgICAgIGNvbnN0IG9uZU9yTW9yZVBhcnRzUGFydCA9IHBhcnQ7ICAvLy9cblxuICAgICAgICAgIHBhcnQgPSBvbmVPck1vcmVQYXJ0c1BhcnQuZ2V0UGFydCgpO1xuXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0KHBhcnQsIGxlZnRSZWN1cnNpdmVSdWxlTmFtZXMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIFplcm9Pck1vcmVQYXJ0c1BhcnRUeXBlIDoge1xuICAgICAgICAgIGNvbnN0IHplcm9Pck1vcmVQYXJ0c1BhcnQgPSBwYXJ0OyAvLy9cblxuICAgICAgICAgIHBhcnQgPSB6ZXJvT3JNb3JlUGFydHNQYXJ0LmdldFBhcnQoKTtcblxuICAgICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKTtcbiAgICAgICAgfVxuICAgICAgICBicmVhaztcblxuICAgICAgY2FzZSBHcm91cE9mUGFydHNQYXJ0VHlwZSA6IHtcbiAgICAgICAgICBjb25zdCBncm91cE9mUGFydHNQYXJ0ID0gcGFydCwgIC8vL1xuICAgICAgICAgICAgICAgIHBhcnRzID0gZ3JvdXBPZlBhcnRzUGFydC5nZXRQYXJ0cygpLFxuICAgICAgICAgICAgICAgIGZpcnN0UGFydCA9IGZpcnN0KHBhcnRzKTtcblxuICAgICAgICAgIHBhcnQgPSBmaXJzdFBhcnQ7IC8vL1xuXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0KHBhcnQsIGxlZnRSZWN1cnNpdmVSdWxlTmFtZXMpO1xuICAgICAgICB9XG4gICAgICAgIGJyZWFrO1xuXG4gICAgICBjYXNlIENob2ljZU9mUGFydHNQYXJ0VHlwZSA6IHtcbiAgICAgICAgICBjb25zdCBjaG9pY2VPZlBhcnRzUGFydCA9IHBhcnQsIC8vL1xuICAgICAgICAgICAgICAgIHBhcnRzID0gY2hvaWNlT2ZQYXJ0c1BhcnQuZ2V0UGFydHMoKTtcblxuICAgICAgICAgIHBhcnRzLmZvckVhY2goKHBhcnQpID0+IGxlZnRSZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydChwYXJ0LCBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKSk7XG4gICAgICAgIH1cbiAgICAgICAgYnJlYWs7XG4gICAgfVxuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICByZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydCxcbiAgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0XG59O1xuIl19