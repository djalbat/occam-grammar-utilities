'use strict';

var classUtilities = require('../utilities/class'),
    ruleNameUtilities = require('../utilities/ruleName');

var isInstanceOf = classUtilities.isInstanceOf,
    repeatedRuleNameFromRuleName = ruleNameUtilities.repeatedRuleNameFromRuleName,
    reducedRuleNameFromRuleName = ruleNameUtilities.reducedRuleNameFromRuleName;


function findRule(ruleName, rules) {
  var name = ruleName,
      ///
  rule = rules.find(function (rule) {
    var ruleName = rule.getName();

    if (ruleName === name) {
      return true;
    }
  }) || null; ///

  return rule;
}

function reducedRuleFromRule(rule, rules, ReducedRule) {
  var ruleName = rule.getName(),
      reducedRuleName = reducedRuleNameFromRuleName(ruleName);

  var reducedRule = findRule(reducedRuleName, rules);

  if (reducedRule === null) {
    reducedRule = ReducedRule.fromRule(rule);

    rules.push(reducedRule);
  }

  return reducedRule;
}

function repeatedRuleFromRule(rule, rules, RepeatedRule) {
  var ruleName = rule.getName(),
      repeatedRuleName = repeatedRuleNameFromRuleName(ruleName);

  var repeatedRule = findRule(repeatedRuleName, rules);

  if (repeatedRule === null) {
    repeatedRule = RepeatedRule.fromRule(rule);

    rules.push(repeatedRule);
  }

  return repeatedRule;
}

function rewrittenRuleFromRule(rule, rules, RewrittenRule) {
  var rewrittenRule = void 0;

  var ruleRewrittenRule = isInstanceOf(rule, RewrittenRule);

  if (ruleRewrittenRule) {
    rewrittenRule = rule; ///
  } else {
    rewrittenRule = RewrittenRule.fromRule(rule);

    var replacedRule = rule,
        ///
    replacementRule = rewrittenRule; ///

    replaceRule(replacedRule, replacementRule, rules);
  }

  return rewrittenRule;
}

module.exports = {
  findRule: findRule,
  reducedRuleFromRule: reducedRuleFromRule,
  repeatedRuleFromRule: repeatedRuleFromRule,
  rewrittenRuleFromRule: rewrittenRuleFromRule
};

function replaceRule(replacedRule, replacementRule, rules) {
  var index = rules.indexOf(replacedRule);

  if (index > -1) {
    var start = index,
        deleteCount = 1;

    rules.splice(start, deleteCount, replacementRule);
  }
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvcnVsZS5qcyJdLCJuYW1lcyI6WyJjbGFzc1V0aWxpdGllcyIsInJlcXVpcmUiLCJydWxlTmFtZVV0aWxpdGllcyIsImlzSW5zdGFuY2VPZiIsInJlcGVhdGVkUnVsZU5hbWVGcm9tUnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWVGcm9tUnVsZU5hbWUiLCJmaW5kUnVsZSIsInJ1bGVOYW1lIiwicnVsZXMiLCJuYW1lIiwicnVsZSIsImZpbmQiLCJnZXROYW1lIiwicmVkdWNlZFJ1bGVGcm9tUnVsZSIsIlJlZHVjZWRSdWxlIiwicmVkdWNlZFJ1bGVOYW1lIiwicmVkdWNlZFJ1bGUiLCJmcm9tUnVsZSIsInB1c2giLCJyZXBlYXRlZFJ1bGVGcm9tUnVsZSIsIlJlcGVhdGVkUnVsZSIsInJlcGVhdGVkUnVsZU5hbWUiLCJyZXBlYXRlZFJ1bGUiLCJyZXdyaXR0ZW5SdWxlRnJvbVJ1bGUiLCJSZXdyaXR0ZW5SdWxlIiwicmV3cml0dGVuUnVsZSIsInJ1bGVSZXdyaXR0ZW5SdWxlIiwicmVwbGFjZWRSdWxlIiwicmVwbGFjZW1lbnRSdWxlIiwicmVwbGFjZVJ1bGUiLCJtb2R1bGUiLCJleHBvcnRzIiwiaW5kZXgiLCJpbmRleE9mIiwic3RhcnQiLCJkZWxldGVDb3VudCIsInNwbGljZSJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUEsSUFBTUEsaUJBQWlCQyxRQUFRLG9CQUFSLENBQXZCO0FBQUEsSUFDTUMsb0JBQW9CRCxRQUFRLHVCQUFSLENBRDFCOztBQUdNLElBQUVFLFlBQUYsR0FBbUJILGNBQW5CLENBQUVHLFlBQUY7QUFBQSxJQUNFQyw0QkFERixHQUNnRUYsaUJBRGhFLENBQ0VFLDRCQURGO0FBQUEsSUFDZ0NDLDJCQURoQyxHQUNnRUgsaUJBRGhFLENBQ2dDRywyQkFEaEM7OztBQUdOLFNBQVNDLFFBQVQsQ0FBa0JDLFFBQWxCLEVBQTRCQyxLQUE1QixFQUFtQztBQUNqQyxNQUFNQyxPQUFPRixRQUFiO0FBQUEsTUFBd0I7QUFDbEJHLFNBQU9GLE1BQU1HLElBQU4sQ0FBVyxVQUFDRCxJQUFELEVBQVU7QUFDMUIsUUFBTUgsV0FBV0csS0FBS0UsT0FBTCxFQUFqQjs7QUFFQSxRQUFJTCxhQUFhRSxJQUFqQixFQUF1QjtBQUNyQixhQUFPLElBQVA7QUFDRDtBQUNGLEdBTk0sS0FNRCxJQVBaLENBRGlDLENBUWY7O0FBRWxCLFNBQU9DLElBQVA7QUFDRDs7QUFFRCxTQUFTRyxtQkFBVCxDQUE2QkgsSUFBN0IsRUFBbUNGLEtBQW5DLEVBQTBDTSxXQUExQyxFQUF1RDtBQUN0RCxNQUFNUCxXQUFXRyxLQUFLRSxPQUFMLEVBQWpCO0FBQUEsTUFDR0csa0JBQWtCViw0QkFBNEJFLFFBQTVCLENBRHJCOztBQUdBLE1BQUlTLGNBQWNWLFNBQVNTLGVBQVQsRUFBMEJQLEtBQTFCLENBQWxCOztBQUVBLE1BQUlRLGdCQUFnQixJQUFwQixFQUEwQjtBQUN2QkEsa0JBQWNGLFlBQVlHLFFBQVosQ0FBcUJQLElBQXJCLENBQWQ7O0FBRUFGLFVBQU1VLElBQU4sQ0FBV0YsV0FBWDtBQUNGOztBQUVELFNBQU9BLFdBQVA7QUFDQTs7QUFFRCxTQUFTRyxvQkFBVCxDQUE4QlQsSUFBOUIsRUFBb0NGLEtBQXBDLEVBQTJDWSxZQUEzQyxFQUF5RDtBQUN2RCxNQUFNYixXQUFXRyxLQUFLRSxPQUFMLEVBQWpCO0FBQUEsTUFDTVMsbUJBQW1CakIsNkJBQTZCRyxRQUE3QixDQUR6Qjs7QUFHQSxNQUFJZSxlQUFlaEIsU0FBU2UsZ0JBQVQsRUFBMkJiLEtBQTNCLENBQW5COztBQUVBLE1BQUljLGlCQUFpQixJQUFyQixFQUEyQjtBQUN6QkEsbUJBQWVGLGFBQWFILFFBQWIsQ0FBc0JQLElBQXRCLENBQWY7O0FBRUFGLFVBQU1VLElBQU4sQ0FBV0ksWUFBWDtBQUNEOztBQUVELFNBQU9BLFlBQVA7QUFDRDs7QUFFRCxTQUFTQyxxQkFBVCxDQUErQmIsSUFBL0IsRUFBcUNGLEtBQXJDLEVBQTRDZ0IsYUFBNUMsRUFBMkQ7QUFDekQsTUFBSUMsc0JBQUo7O0FBRUEsTUFBTUMsb0JBQW9CdkIsYUFBYU8sSUFBYixFQUFtQmMsYUFBbkIsQ0FBMUI7O0FBRUEsTUFBSUUsaUJBQUosRUFBdUI7QUFDckJELG9CQUFnQmYsSUFBaEIsQ0FEcUIsQ0FDQztBQUN2QixHQUZELE1BRU87QUFDTGUsb0JBQWdCRCxjQUFjUCxRQUFkLENBQXVCUCxJQUF2QixDQUFoQjs7QUFFQSxRQUFNaUIsZUFBZWpCLElBQXJCO0FBQUEsUUFBNEI7QUFDdEJrQixzQkFBa0JILGFBRHhCLENBSEssQ0FJbUM7O0FBRXhDSSxnQkFBWUYsWUFBWixFQUEwQkMsZUFBMUIsRUFBMkNwQixLQUEzQztBQUNEOztBQUVELFNBQU9pQixhQUFQO0FBQ0Q7O0FBRURLLE9BQU9DLE9BQVAsR0FBaUI7QUFDZnpCLG9CQURlO0FBRWhCTywwQ0FGZ0I7QUFHZk0sNENBSGU7QUFJZkk7QUFKZSxDQUFqQjs7QUFPQSxTQUFTTSxXQUFULENBQXFCRixZQUFyQixFQUFtQ0MsZUFBbkMsRUFBb0RwQixLQUFwRCxFQUEyRDtBQUN6RCxNQUFNd0IsUUFBUXhCLE1BQU15QixPQUFOLENBQWNOLFlBQWQsQ0FBZDs7QUFFQSxNQUFJSyxRQUFRLENBQUMsQ0FBYixFQUFnQjtBQUNkLFFBQU1FLFFBQVFGLEtBQWQ7QUFBQSxRQUNNRyxjQUFjLENBRHBCOztBQUdBM0IsVUFBTTRCLE1BQU4sQ0FBYUYsS0FBYixFQUFvQkMsV0FBcEIsRUFBaUNQLGVBQWpDO0FBQ0Q7QUFDRiIsImZpbGUiOiJydWxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBjbGFzc1V0aWxpdGllcyA9IHJlcXVpcmUoJy4uL3V0aWxpdGllcy9jbGFzcycpLFxuICAgICAgcnVsZU5hbWVVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvcnVsZU5hbWUnKTtcblxuY29uc3QgeyBpc0luc3RhbmNlT2YgfSA9IGNsYXNzVXRpbGl0aWVzLFxuICAgICAgeyByZXBlYXRlZFJ1bGVOYW1lRnJvbVJ1bGVOYW1lLCByZWR1Y2VkUnVsZU5hbWVGcm9tUnVsZU5hbWUgfSA9IHJ1bGVOYW1lVXRpbGl0aWVzO1xuXG5mdW5jdGlvbiBmaW5kUnVsZShydWxlTmFtZSwgcnVsZXMpIHtcbiAgY29uc3QgbmFtZSA9IHJ1bGVOYW1lLCAgLy8vXG4gICAgICAgIHJ1bGUgPSBydWxlcy5maW5kKChydWxlKSA9PiB7XG4gICAgICAgICAgY29uc3QgcnVsZU5hbWUgPSBydWxlLmdldE5hbWUoKTtcblxuICAgICAgICAgIGlmIChydWxlTmFtZSA9PT0gbmFtZSkge1xuICAgICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgICAgfVxuICAgICAgICB9KSB8fCBudWxsOyAvLy9cblxuICByZXR1cm4gcnVsZTtcbn1cblxuZnVuY3Rpb24gcmVkdWNlZFJ1bGVGcm9tUnVsZShydWxlLCBydWxlcywgUmVkdWNlZFJ1bGUpIHtcblx0Y29uc3QgcnVsZU5hbWUgPSBydWxlLmdldE5hbWUoKSxcblx0XHRcdFx0cmVkdWNlZFJ1bGVOYW1lID0gcmVkdWNlZFJ1bGVOYW1lRnJvbVJ1bGVOYW1lKHJ1bGVOYW1lKTtcblxuXHRsZXQgcmVkdWNlZFJ1bGUgPSBmaW5kUnVsZShyZWR1Y2VkUnVsZU5hbWUsIHJ1bGVzKTtcblxuXHRpZiAocmVkdWNlZFJ1bGUgPT09IG51bGwpIHtcbiAgICByZWR1Y2VkUnVsZSA9IFJlZHVjZWRSdWxlLmZyb21SdWxlKHJ1bGUpO1xuXG4gICAgcnVsZXMucHVzaChyZWR1Y2VkUnVsZSk7XG5cdH1cblxuXHRyZXR1cm4gcmVkdWNlZFJ1bGU7XG59XG5cbmZ1bmN0aW9uIHJlcGVhdGVkUnVsZUZyb21SdWxlKHJ1bGUsIHJ1bGVzLCBSZXBlYXRlZFJ1bGUpIHtcbiAgY29uc3QgcnVsZU5hbWUgPSBydWxlLmdldE5hbWUoKSxcbiAgICAgICAgcmVwZWF0ZWRSdWxlTmFtZSA9IHJlcGVhdGVkUnVsZU5hbWVGcm9tUnVsZU5hbWUocnVsZU5hbWUpO1xuXG4gIGxldCByZXBlYXRlZFJ1bGUgPSBmaW5kUnVsZShyZXBlYXRlZFJ1bGVOYW1lLCBydWxlcyk7XG5cbiAgaWYgKHJlcGVhdGVkUnVsZSA9PT0gbnVsbCkge1xuICAgIHJlcGVhdGVkUnVsZSA9IFJlcGVhdGVkUnVsZS5mcm9tUnVsZShydWxlKTtcblxuICAgIHJ1bGVzLnB1c2gocmVwZWF0ZWRSdWxlKTtcbiAgfVxuXG4gIHJldHVybiByZXBlYXRlZFJ1bGU7XG59XG5cbmZ1bmN0aW9uIHJld3JpdHRlblJ1bGVGcm9tUnVsZShydWxlLCBydWxlcywgUmV3cml0dGVuUnVsZSkge1xuICBsZXQgcmV3cml0dGVuUnVsZTtcblxuICBjb25zdCBydWxlUmV3cml0dGVuUnVsZSA9IGlzSW5zdGFuY2VPZihydWxlLCBSZXdyaXR0ZW5SdWxlKTtcblxuICBpZiAocnVsZVJld3JpdHRlblJ1bGUpIHtcbiAgICByZXdyaXR0ZW5SdWxlID0gcnVsZTsgLy8vXG4gIH0gZWxzZSB7XG4gICAgcmV3cml0dGVuUnVsZSA9IFJld3JpdHRlblJ1bGUuZnJvbVJ1bGUocnVsZSk7XG5cbiAgICBjb25zdCByZXBsYWNlZFJ1bGUgPSBydWxlLCAgLy8vXG4gICAgICAgICAgcmVwbGFjZW1lbnRSdWxlID0gcmV3cml0dGVuUnVsZTsgIC8vL1xuXG4gICAgcmVwbGFjZVJ1bGUocmVwbGFjZWRSdWxlLCByZXBsYWNlbWVudFJ1bGUsIHJ1bGVzKTtcbiAgfVxuXG4gIHJldHVybiByZXdyaXR0ZW5SdWxlO1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IHtcbiAgZmluZFJ1bGUsXG5cdHJlZHVjZWRSdWxlRnJvbVJ1bGUsXG4gIHJlcGVhdGVkUnVsZUZyb21SdWxlLFxuICByZXdyaXR0ZW5SdWxlRnJvbVJ1bGVcbn07XG5cbmZ1bmN0aW9uIHJlcGxhY2VSdWxlKHJlcGxhY2VkUnVsZSwgcmVwbGFjZW1lbnRSdWxlLCBydWxlcykge1xuICBjb25zdCBpbmRleCA9IHJ1bGVzLmluZGV4T2YocmVwbGFjZWRSdWxlKTtcblxuICBpZiAoaW5kZXggPiAtMSkge1xuICAgIGNvbnN0IHN0YXJ0ID0gaW5kZXgsXG4gICAgICAgICAgZGVsZXRlQ291bnQgPSAxO1xuXG4gICAgcnVsZXMuc3BsaWNlKHN0YXJ0LCBkZWxldGVDb3VudCwgcmVwbGFjZW1lbnRSdWxlKTtcbiAgfVxufVxuIl19