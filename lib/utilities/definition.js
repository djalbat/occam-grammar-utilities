'use strict';

var partUtilities = require('../utilities/part'),
    arrayUtilities = require('../utilities/array');

var first = arrayUtilities.first,
    recursiveRuleNamesFromPart = partUtilities.recursiveRuleNamesFromPart,
    leftRecursiveRuleNameFromPart = partUtilities.leftRecursiveRuleNameFromPart;


function isDefinitionRecursive(definition) {
  var recursiveRuleNames = recursiveRuleNamesFromDefinition(definition),
      recursiveRuleNamesLength = recursiveRuleNames.length,
      definitionRecursive = recursiveRuleNamesLength > 0;

  return definitionRecursive;
}

function isDefinitionLeftRecursive(definition) {
  var leftRecursiveRuleName = leftRecursiveRuleNameFromDefinition(definition),
      definitionLeftRecursive = leftRecursiveRuleName !== null;

  return definitionLeftRecursive;
}

function recursiveRuleNamesFromDefinition(definition) {
  var recursiveRuleNames = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : [];

  var parts = definition.getParts();

  parts.forEach(function (part) {
    recursiveRuleNamesFromPart(part, recursiveRuleNames);
  });

  return recursiveRuleNames;
}

function leftRecursiveRuleNameFromDefinition(definition) {
  var parts = definition.getParts(),
      firstPart = first(parts),
      part = firstPart,
      ///
  leftRecursiveRuleName = leftRecursiveRuleNameFromPart(part);

  return leftRecursiveRuleName;
}

function findIndirectlyLeftRecursiveDefinition(leftRecursiveDefinition, recursiveDefinitions) {
  var indirectlyLeftRecursiveDefinition = null;

  var leftRecursiveDefinitionsCycle = findLeftRecursiveDefinitionsCycle(leftRecursiveDefinition, recursiveDefinitions);

  if (leftRecursiveDefinitionsCycle !== null) {
    var firstLeftRecursiveDefinition = first(leftRecursiveDefinitionsCycle);

    indirectlyLeftRecursiveDefinition = firstLeftRecursiveDefinition; ///
  }

  return indirectlyLeftRecursiveDefinition;
}

module.exports = {
  isDefinitionRecursive: isDefinitionRecursive,
  isDefinitionLeftRecursive: isDefinitionLeftRecursive,
  recursiveRuleNamesFromDefinition: recursiveRuleNamesFromDefinition,
  leftRecursiveRuleNameFromDefinition: leftRecursiveRuleNameFromDefinition,
  findIndirectlyLeftRecursiveDefinition: findIndirectlyLeftRecursiveDefinition
};

function findRecursiveDefinitionsCycle(recursiveRuleName, recursiveDefinitions) {
  var recursiveDefinitionsCycle = null;

  recursiveDefinitions.some(function (recursiveDefinition, index) {
    var recursiveDefinitionRuleName = recursiveDefinition.getRuleName(),
        recursiveDefinitionRuleNameLeftRecursiveRuleName = recursiveDefinitionRuleName === recursiveRuleName;

    if (recursiveDefinitionRuleNameLeftRecursiveRuleName) {
      recursiveDefinitionsCycle = recursiveDefinitions.slice(index);

      return true;
    }
  });

  return recursiveDefinitionsCycle;
}

function findLeftRecursiveDefinitionsCycle(leftRecursiveDefinition, recursiveDefinitions) {
  var leftRecursiveDefinitionsCycle = null;

  var leftRecursiveRuleName = leftRecursiveDefinition.getLeftRecursiveRuleName(),
      recursiveRuleName = leftRecursiveRuleName,
      ///
  recursiveDefinitionsCycle = findRecursiveDefinitionsCycle(recursiveRuleName, recursiveDefinitions);

  if (recursiveDefinitionsCycle !== null) {
    var recursiveDefinitionsCycleLeftRecursive = isRecursiveDefinitionsCycleLeftRecursive(recursiveDefinitionsCycle);

    if (recursiveDefinitionsCycleLeftRecursive) {
      leftRecursiveDefinitionsCycle = recursiveDefinitionsCycle; ///
    }
  }

  return leftRecursiveDefinitionsCycle;
}

function isRecursiveDefinitionsCycleLeftRecursive(recursiveDefinitionsCycle) {
  var recursiveDefinitionsCycleLeftRecursive = recursiveDefinitionsCycle.every(function (recursiveDefinition) {
    var recursiveDefinitionLeftRecursive = recursiveDefinition.isLeftRecursive();

    if (recursiveDefinitionLeftRecursive) {
      return true;
    }
  });

  return recursiveDefinitionsCycleLeftRecursive;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL2VzNi91dGlsaXRpZXMvZGVmaW5pdGlvbi5qcyJdLCJuYW1lcyI6WyJwYXJ0VXRpbGl0aWVzIiwicmVxdWlyZSIsImFycmF5VXRpbGl0aWVzIiwiZmlyc3QiLCJyZWN1cnNpdmVSdWxlTmFtZXNGcm9tUGFydCIsImxlZnRSZWN1cnNpdmVSdWxlTmFtZUZyb21QYXJ0IiwiaXNEZWZpbml0aW9uUmVjdXJzaXZlIiwiZGVmaW5pdGlvbiIsInJlY3Vyc2l2ZVJ1bGVOYW1lcyIsInJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21EZWZpbml0aW9uIiwicmVjdXJzaXZlUnVsZU5hbWVzTGVuZ3RoIiwibGVuZ3RoIiwiZGVmaW5pdGlvblJlY3Vyc2l2ZSIsImlzRGVmaW5pdGlvbkxlZnRSZWN1cnNpdmUiLCJsZWZ0UmVjdXJzaXZlUnVsZU5hbWUiLCJsZWZ0UmVjdXJzaXZlUnVsZU5hbWVGcm9tRGVmaW5pdGlvbiIsImRlZmluaXRpb25MZWZ0UmVjdXJzaXZlIiwicGFydHMiLCJnZXRQYXJ0cyIsImZvckVhY2giLCJwYXJ0IiwiZmlyc3RQYXJ0IiwiZmluZEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNDeWNsZSIsImZpbmRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNDeWNsZSIsImZpcnN0TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJtb2R1bGUiLCJleHBvcnRzIiwiZmluZFJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGUiLCJyZWN1cnNpdmVSdWxlTmFtZSIsInJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGUiLCJzb21lIiwicmVjdXJzaXZlRGVmaW5pdGlvbiIsImluZGV4IiwicmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lIiwiZ2V0UnVsZU5hbWUiLCJyZWN1cnNpdmVEZWZpbml0aW9uUnVsZU5hbWVMZWZ0UmVjdXJzaXZlUnVsZU5hbWUiLCJzbGljZSIsImdldExlZnRSZWN1cnNpdmVSdWxlTmFtZSIsInJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGVMZWZ0UmVjdXJzaXZlIiwiaXNSZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlTGVmdFJlY3Vyc2l2ZSIsImV2ZXJ5IiwicmVjdXJzaXZlRGVmaW5pdGlvbkxlZnRSZWN1cnNpdmUiLCJpc0xlZnRSZWN1cnNpdmUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBLElBQU1BLGdCQUFnQkMsUUFBUSxtQkFBUixDQUF0QjtBQUFBLElBQ01DLGlCQUFpQkQsUUFBUSxvQkFBUixDQUR2Qjs7QUFHTSxJQUFFRSxLQUFGLEdBQVlELGNBQVosQ0FBRUMsS0FBRjtBQUFBLElBQ0VDLDBCQURGLEdBQ2dFSixhQURoRSxDQUNFSSwwQkFERjtBQUFBLElBQzhCQyw2QkFEOUIsR0FDZ0VMLGFBRGhFLENBQzhCSyw2QkFEOUI7OztBQUdOLFNBQVNDLHFCQUFULENBQStCQyxVQUEvQixFQUEyQztBQUN6QyxNQUFNQyxxQkFBcUJDLGlDQUFpQ0YsVUFBakMsQ0FBM0I7QUFBQSxNQUNNRywyQkFBMkJGLG1CQUFtQkcsTUFEcEQ7QUFBQSxNQUVNQyxzQkFBdUJGLDJCQUEyQixDQUZ4RDs7QUFJQSxTQUFPRSxtQkFBUDtBQUNEOztBQUVELFNBQVNDLHlCQUFULENBQW1DTixVQUFuQyxFQUErQztBQUM3QyxNQUFNTyx3QkFBd0JDLG9DQUFvQ1IsVUFBcEMsQ0FBOUI7QUFBQSxNQUNNUywwQkFBMkJGLDBCQUEwQixJQUQzRDs7QUFHQSxTQUFPRSx1QkFBUDtBQUNEOztBQUVELFNBQVNQLGdDQUFULENBQTBDRixVQUExQyxFQUErRTtBQUFBLE1BQXpCQyxrQkFBeUIsdUVBQUosRUFBSTs7QUFDN0UsTUFBTVMsUUFBUVYsV0FBV1csUUFBWCxFQUFkOztBQUVBRCxRQUFNRSxPQUFOLENBQWMsVUFBQ0MsSUFBRCxFQUFVO0FBQ3RCaEIsK0JBQTJCZ0IsSUFBM0IsRUFBaUNaLGtCQUFqQztBQUNELEdBRkQ7O0FBSUEsU0FBT0Esa0JBQVA7QUFDRDs7QUFFRCxTQUFTTyxtQ0FBVCxDQUE2Q1IsVUFBN0MsRUFBeUQ7QUFDdkQsTUFBTVUsUUFBUVYsV0FBV1csUUFBWCxFQUFkO0FBQUEsTUFDTUcsWUFBWWxCLE1BQU1jLEtBQU4sQ0FEbEI7QUFBQSxNQUVNRyxPQUFPQyxTQUZiO0FBQUEsTUFFd0I7QUFDbEJQLDBCQUF3QlQsOEJBQThCZSxJQUE5QixDQUg5Qjs7QUFLQSxTQUFPTixxQkFBUDtBQUNEOztBQUVELFNBQVNRLHFDQUFULENBQStDQyx1QkFBL0MsRUFBd0VDLG9CQUF4RSxFQUE4RjtBQUM1RixNQUFJQyxvQ0FBb0MsSUFBeEM7O0FBRUEsTUFBTUMsZ0NBQWdDQyxrQ0FBa0NKLHVCQUFsQyxFQUEyREMsb0JBQTNELENBQXRDOztBQUVBLE1BQUlFLGtDQUFrQyxJQUF0QyxFQUE0QztBQUMxQyxRQUFNRSwrQkFBK0J6QixNQUFNdUIsNkJBQU4sQ0FBckM7O0FBRUFELHdDQUFvQ0csNEJBQXBDLENBSDBDLENBR3lCO0FBQ3BFOztBQUVELFNBQU9ILGlDQUFQO0FBQ0Q7O0FBRURJLE9BQU9DLE9BQVAsR0FBaUI7QUFDZnhCLDhDQURlO0FBRWZPLHNEQUZlO0FBR2ZKLG9FQUhlO0FBSWZNLDBFQUplO0FBS2ZPO0FBTGUsQ0FBakI7O0FBUUEsU0FBU1MsNkJBQVQsQ0FBdUNDLGlCQUF2QyxFQUEwRFIsb0JBQTFELEVBQWdGO0FBQzlFLE1BQUlTLDRCQUE0QixJQUFoQzs7QUFFQVQsdUJBQXFCVSxJQUFyQixDQUEwQixVQUFDQyxtQkFBRCxFQUFzQkMsS0FBdEIsRUFBZ0M7QUFDeEQsUUFBTUMsOEJBQThCRixvQkFBb0JHLFdBQXBCLEVBQXBDO0FBQUEsUUFDTUMsbURBQW9ERixnQ0FBZ0NMLGlCQUQxRjs7QUFHQSxRQUFJTyxnREFBSixFQUFzRDtBQUNwRE4sa0NBQTRCVCxxQkFBcUJnQixLQUFyQixDQUEyQkosS0FBM0IsQ0FBNUI7O0FBRUEsYUFBTyxJQUFQO0FBQ0Q7QUFDRixHQVREOztBQVdBLFNBQU9ILHlCQUFQO0FBQ0Q7O0FBRUQsU0FBU04saUNBQVQsQ0FBMkNKLHVCQUEzQyxFQUFvRUMsb0JBQXBFLEVBQTBGO0FBQ3hGLE1BQUlFLGdDQUFnQyxJQUFwQzs7QUFFQSxNQUFNWix3QkFBd0JTLHdCQUF3QmtCLHdCQUF4QixFQUE5QjtBQUFBLE1BQ01ULG9CQUFvQmxCLHFCQUQxQjtBQUFBLE1BQ2tEO0FBQzVDbUIsOEJBQTRCRiw4QkFBOEJDLGlCQUE5QixFQUFpRFIsb0JBQWpELENBRmxDOztBQUlBLE1BQUlTLDhCQUE4QixJQUFsQyxFQUF3QztBQUN0QyxRQUFNUyx5Q0FBeUNDLHlDQUF5Q1YseUJBQXpDLENBQS9DOztBQUVBLFFBQUlTLHNDQUFKLEVBQTRDO0FBQzFDaEIsc0NBQWdDTyx5QkFBaEMsQ0FEMEMsQ0FDa0I7QUFDN0Q7QUFDRjs7QUFFRCxTQUFPUCw2QkFBUDtBQUNEOztBQUVELFNBQVNpQix3Q0FBVCxDQUFrRFYseUJBQWxELEVBQTZFO0FBQzNFLE1BQU1TLHlDQUF5Q1QsMEJBQTBCVyxLQUExQixDQUFnQyxVQUFDVCxtQkFBRCxFQUF5QjtBQUN0RyxRQUFNVSxtQ0FBbUNWLG9CQUFvQlcsZUFBcEIsRUFBekM7O0FBRUEsUUFBSUQsZ0NBQUosRUFBc0M7QUFDcEMsYUFBTyxJQUFQO0FBQ0Q7QUFDRixHQU44QyxDQUEvQzs7QUFRQSxTQUFPSCxzQ0FBUDtBQUNEIiwiZmlsZSI6ImRlZmluaXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHBhcnRVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvcGFydCcpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuLi91dGlsaXRpZXMvYXJyYXknKTtcblxuY29uc3QgeyBmaXJzdCB9ID0gYXJyYXlVdGlsaXRpZXMsXG4gICAgICB7IHJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0LCBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVGcm9tUGFydCB9ID0gcGFydFV0aWxpdGllcztcblxuZnVuY3Rpb24gaXNEZWZpbml0aW9uUmVjdXJzaXZlKGRlZmluaXRpb24pIHtcbiAgY29uc3QgcmVjdXJzaXZlUnVsZU5hbWVzID0gcmVjdXJzaXZlUnVsZU5hbWVzRnJvbURlZmluaXRpb24oZGVmaW5pdGlvbiksXG4gICAgICAgIHJlY3Vyc2l2ZVJ1bGVOYW1lc0xlbmd0aCA9IHJlY3Vyc2l2ZVJ1bGVOYW1lcy5sZW5ndGgsXG4gICAgICAgIGRlZmluaXRpb25SZWN1cnNpdmUgPSAocmVjdXJzaXZlUnVsZU5hbWVzTGVuZ3RoID4gMCk7XG5cbiAgcmV0dXJuIGRlZmluaXRpb25SZWN1cnNpdmVcbn1cblxuZnVuY3Rpb24gaXNEZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZShkZWZpbml0aW9uKSB7XG4gIGNvbnN0IGxlZnRSZWN1cnNpdmVSdWxlTmFtZSA9IGxlZnRSZWN1cnNpdmVSdWxlTmFtZUZyb21EZWZpbml0aW9uKGRlZmluaXRpb24pLFxuICAgICAgICBkZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZSA9IChsZWZ0UmVjdXJzaXZlUnVsZU5hbWUgIT09IG51bGwpO1xuXG4gIHJldHVybiBkZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZTtcbn1cblxuZnVuY3Rpb24gcmVjdXJzaXZlUnVsZU5hbWVzRnJvbURlZmluaXRpb24oZGVmaW5pdGlvbiwgcmVjdXJzaXZlUnVsZU5hbWVzID0gW10pIHtcbiAgY29uc3QgcGFydHMgPSBkZWZpbml0aW9uLmdldFBhcnRzKCk7XG5cbiAgcGFydHMuZm9yRWFjaCgocGFydCkgPT4ge1xuICAgIHJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21QYXJ0KHBhcnQsIHJlY3Vyc2l2ZVJ1bGVOYW1lcyk7XG4gIH0pO1xuXG4gIHJldHVybiByZWN1cnNpdmVSdWxlTmFtZXM7XG59XG5cbmZ1bmN0aW9uIGxlZnRSZWN1cnNpdmVSdWxlTmFtZUZyb21EZWZpbml0aW9uKGRlZmluaXRpb24pIHtcbiAgY29uc3QgcGFydHMgPSBkZWZpbml0aW9uLmdldFBhcnRzKCksXG4gICAgICAgIGZpcnN0UGFydCA9IGZpcnN0KHBhcnRzKSxcbiAgICAgICAgcGFydCA9IGZpcnN0UGFydCwgLy8vXG4gICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlTmFtZSA9IGxlZnRSZWN1cnNpdmVSdWxlTmFtZUZyb21QYXJ0KHBhcnQpO1xuXG4gIHJldHVybiBsZWZ0UmVjdXJzaXZlUnVsZU5hbWU7XG59XG5cbmZ1bmN0aW9uIGZpbmRJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24obGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGxldCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBudWxsO1xuXG4gIGNvbnN0IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlID0gZmluZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZWN1cnNpdmVEZWZpbml0aW9ucyk7XG5cbiAgaWYgKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlICE9PSBudWxsKSB7XG4gICAgY29uc3QgZmlyc3RMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlKTtcblxuICAgIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247ICAvLy9cbiAgfVxuXG4gIHJldHVybiBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG59XG5cbm1vZHVsZS5leHBvcnRzID0ge1xuICBpc0RlZmluaXRpb25SZWN1cnNpdmUsXG4gIGlzRGVmaW5pdGlvbkxlZnRSZWN1cnNpdmUsXG4gIHJlY3Vyc2l2ZVJ1bGVOYW1lc0Zyb21EZWZpbml0aW9uLFxuICBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVGcm9tRGVmaW5pdGlvbixcbiAgZmluZEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvblxufTtcblxuZnVuY3Rpb24gZmluZFJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGUocmVjdXJzaXZlUnVsZU5hbWUsIHJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGxldCByZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlID0gbnVsbDtcblxuICByZWN1cnNpdmVEZWZpbml0aW9ucy5zb21lKChyZWN1cnNpdmVEZWZpbml0aW9uLCBpbmRleCkgPT4ge1xuICAgIGNvbnN0IHJlY3Vyc2l2ZURlZmluaXRpb25SdWxlTmFtZSA9IHJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICByZWN1cnNpdmVEZWZpbml0aW9uUnVsZU5hbWVMZWZ0UmVjdXJzaXZlUnVsZU5hbWUgPSAocmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lID09PSByZWN1cnNpdmVSdWxlTmFtZSk7XG5cbiAgICBpZiAocmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lTGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKSB7XG4gICAgICByZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlID0gcmVjdXJzaXZlRGVmaW5pdGlvbnMuc2xpY2UoaW5kZXgpO1xuXG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH0pO1xuXG4gIHJldHVybiByZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlO1xufVxuXG5mdW5jdGlvbiBmaW5kTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGUobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGxldCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNDeWNsZSA9IG51bGw7XG5cbiAgY29uc3QgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKCksXG4gICAgICAgIHJlY3Vyc2l2ZVJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lLCAgLy8vXG4gICAgICAgIHJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGUgPSBmaW5kUmVjdXJzaXZlRGVmaW5pdGlvbnNDeWNsZShyZWN1cnNpdmVSdWxlTmFtZSwgcmVjdXJzaXZlRGVmaW5pdGlvbnMpO1xuXG4gIGlmIChyZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlICE9PSBudWxsKSB7XG4gICAgY29uc3QgcmVjdXJzaXZlRGVmaW5pdGlvbnNDeWNsZUxlZnRSZWN1cnNpdmUgPSBpc1JlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGVMZWZ0UmVjdXJzaXZlKHJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGUpO1xuXG4gICAgaWYgKHJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGVMZWZ0UmVjdXJzaXZlKSB7XG4gICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNDeWNsZSA9IHJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGU7ICAvLy9cbiAgICB9XG4gIH1cblxuICByZXR1cm4gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGU7XG59XG5cbmZ1bmN0aW9uIGlzUmVjdXJzaXZlRGVmaW5pdGlvbnNDeWNsZUxlZnRSZWN1cnNpdmUocmVjdXJzaXZlRGVmaW5pdGlvbnNDeWNsZSkge1xuICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9uc0N5Y2xlTGVmdFJlY3Vyc2l2ZSA9IHJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGUuZXZlcnkoKHJlY3Vyc2l2ZURlZmluaXRpb24pID0+IHtcbiAgICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZSA9IHJlY3Vyc2l2ZURlZmluaXRpb24uaXNMZWZ0UmVjdXJzaXZlKCk7XG5cbiAgICBpZiAocmVjdXJzaXZlRGVmaW5pdGlvbkxlZnRSZWN1cnNpdmUpIHtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIHJlY3Vyc2l2ZURlZmluaXRpb25zQ3ljbGVMZWZ0UmVjdXJzaXZlO1xufVxuIl19