"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
function _export(target, all) {
    for(var name in all)Object.defineProperty(target, name, {
        enumerable: true,
        get: all[name]
    });
}
_export(exports, {
    rewriteDirectlyRepeatedNodes: function() {
        return rewriteDirectlyRepeatedNodes;
    },
    rewriteIndirectlyRepeatedNodes: function() {
        return rewriteIndirectlyRepeatedNodes;
    },
    rewriteReducedNodes: function() {
        return rewriteReducedNodes;
    }
});
var _necessary = require("necessary");
var _occamparsers = require("occam-parsers");
var _reduced = /*#__PURE__*/ _interop_require_default(require("../node/reduced"));
var _leftRecursive = /*#__PURE__*/ _interop_require_default(require("../node/leftRecursive"));
var _directly = /*#__PURE__*/ _interop_require_default(require("../node/repeated/directly"));
var _indirectly = /*#__PURE__*/ _interop_require_default(require("../node/repeated/indirectly"));
var _ruleName = require("../utilities/ruleName");
function _instanceof(left, right) {
    if (right != null && typeof Symbol !== "undefined" && right[Symbol.hasInstance]) {
        return !!right[Symbol.hasInstance](left);
    } else {
        return left instanceof right;
    }
}
function _interop_require_default(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
var front = _necessary.arrayUtilities.front, first = _necessary.arrayUtilities.first, push = _necessary.arrayUtilities.push;
function rewriteReducedNodes(nonTerminalNode) {
    var childNodes = nonTerminalNode.getChildNodes();
    var firstChildNode = first(childNodes), firstChildNodeReducedNode = _instanceof(firstChildNode, _reduced.default);
    if (!firstChildNodeReducedNode) {
        return;
    }
    var replacementChildNodes;
    var parentNode = nonTerminalNode, reducedNode = firstChildNode, replacedChildNode = reducedNode, parentNodeRuleName = parentNode.getRuleName(), reducedNodeOpacity = reducedNode.getOpacity(), reducedNodeRuleName = reducedNode.getRuleName(), reducedNodePrecedence = reducedNode.getPrecedence(), reducedRuleName = reducedNodeRuleName, parentRuleName = parentNodeRuleName, precedence = reducedNodePrecedence, opacity = reducedNodeOpacity, ruleName = (0, _ruleName.ruleNameFromReducedRuleName)(reducedRuleName), removedChildNodes = reducedNode.removeChildNodes();
    if (ruleName === parentRuleName) {
        replacementChildNodes = removedChildNodes; ///
        parentNode.setPrecedence(precedence);
    } else {
        var childNodes1 = removedChildNodes, _$nonTerminalNode = _occamparsers.NonTerminalNode.fromRuleNameChildNodesAndOpacity(ruleName, childNodes1, opacity);
        _$nonTerminalNode.setPrecedence(_$nonTerminalNode);
        replacementChildNodes = [
            _$nonTerminalNode
        ];
    }
    parentNode.replaceChildNode(replacedChildNode, replacementChildNodes);
}
function rewriteDirectlyRepeatedNodes(nonTerminalNode) {
    var directlyRepeatedNodesReplaced;
    directlyRepeatedNodesReplaced = replaceDirectlyRepeatedNodes(nonTerminalNode);
    while(directlyRepeatedNodesReplaced){
        directlyRepeatedNodesReplaced = replaceDirectlyRepeatedNodes(nonTerminalNode);
    }
}
function rewriteIndirectlyRepeatedNodes(nonTerminalNode) {
    var parentNode = nonTerminalNode; ///
    var indirectlyRepeatedNodes = findIndirectlyRepeatedNodes(nonTerminalNode);
    indirectlyRepeatedNodes.forEach(function(indirectlyRepeatedNode) {
        var leftRecursiveNode = leftRecursiveNodeFromParentNodeAndIndirectlyRepeatedNode(parentNode, indirectlyRepeatedNode), childNodes = childNodesFromLeftRecursiveNodeNodeAndIndirectlyRepeatedNode(leftRecursiveNode, indirectlyRepeatedNode);
        adjustParentNodePrecedence(parentNode, indirectlyRepeatedNode);
        parentNode.setChildNodes(childNodes);
        parentNode = leftRecursiveNode; ///
    });
    return parentNode;
}
function findRepeatedNodes(nonTerminalNode, RepeatedNode) {
    var repeatedNodes = [];
    var lastIndex = null;
    var childNodes = nonTerminalNode.getChildNodes(), length = childNodes.length;
    for(var index = length - 1; index >= 0; index--){
        var childNode = childNodes[index], childNodeRepeatedNode = _instanceof(childNode, RepeatedNode);
        if (childNodeRepeatedNode) {
            lastIndex = index; ///
            break;
        }
    }
    if (lastIndex !== null) {
        for(var index1 = lastIndex; index1 >= 0; index1--){
            var childNode1 = childNodes[index1], childNodeRepeatedNode1 = _instanceof(childNode1, RepeatedNode);
            if (!childNodeRepeatedNode1) {
                break;
            }
            var repeatedNode = childNode1; ///
            repeatedNodes.unshift(repeatedNode);
        }
    }
    return repeatedNodes;
}
function findDirectlyRepeatedNodes(nonTerminalNode) {
    var directlyRepeatedNodes = findRepeatedNodes(nonTerminalNode, _directly.default);
    return directlyRepeatedNodes;
}
function findIndirectlyRepeatedNodes(nonTerminalNode) {
    var indirectlyRepeatedNodes = findRepeatedNodes(nonTerminalNode, _indirectly.default);
    indirectlyRepeatedNodes.reverse();
    return indirectlyRepeatedNodes;
}
function replaceDirectlyRepeatedNodes(nonTerminalNode) {
    var directlyRepeatedNodesReplaced = false;
    var directlyRepeatedNodes = findDirectlyRepeatedNodes(nonTerminalNode), directlyRepeatedNodesLength = directlyRepeatedNodes.length;
    if (directlyRepeatedNodesLength > 0) {
        var parentNode = nonTerminalNode, replacedChildNodes = directlyRepeatedNodes, replacementChildNodes = []; ///
        directlyRepeatedNodes.forEach(function(directlyRepeatedNode) {
            var directlyRepeatedNodesChildNodes = directlyRepeatedNode.getChildNodes();
            push(replacementChildNodes, directlyRepeatedNodesChildNodes);
        });
        parentNode.replaceChildNodes(replacedChildNodes, replacementChildNodes);
        directlyRepeatedNodesReplaced = true;
    }
    return directlyRepeatedNodesReplaced;
}
function adjustParentNodePrecedence(parentNode, indirectlyRepeatedNode) {
    var indirectlyRepeatedNodeRuleName = indirectlyRepeatedNode.getRuleName(), indirectlyRepeatedRuleName = indirectlyRepeatedNodeRuleName, parentNodeNodeRuleName = parentNode.getRuleName(), ruleName = (0, _ruleName.ruleNameFromIndirectlyRepeatedRuleName)(indirectlyRepeatedRuleName);
    if (parentNodeNodeRuleName === ruleName) {
        var precedence = indirectlyRepeatedNode.getPrecedence();
        parentNode.setPrecedence(precedence);
    }
}
function leftRecursiveNodeFromParentNodeAndIndirectlyRepeatedNode(parentNode, indirectlyRepeatedNode) {
    var childNodes;
    childNodes = parentNode.getChildNodes();
    var frontChildNodes = front(childNodes);
    childNodes = parentNode.removeChildNodes(frontChildNodes);
    var indirectlyRepeatedNodeRuleName = indirectlyRepeatedNode.getRuleName(), indirectlyRepeatedNodeOpacity = indirectlyRepeatedNode.getOpacity(), indirectlyRepeatedRuleName = indirectlyRepeatedNodeRuleName, leftRecursiveRuleName = (0, _ruleName.leftRecursiveRuleNameFromIndirectlyRepeatedRuleName)(indirectlyRepeatedRuleName), ruleName = leftRecursiveRuleName, opacity = indirectlyRepeatedNodeOpacity, leftRecursiveNode = _leftRecursive.default.fromRuleNameChildNodesAndOpacity(ruleName, childNodes, opacity);
    return leftRecursiveNode;
}
function childNodesFromLeftRecursiveNodeNodeAndIndirectlyRepeatedNode(leftRecursiveNode, indirectlyRepeatedNode) {
    var childNodes = [
        leftRecursiveNode
    ], indirectlyRepeatedNodeNullary = indirectlyRepeatedNode.isNullary();
    if (!indirectlyRepeatedNodeNullary) {
        var removedChildNodes = indirectlyRepeatedNode.removeChildNodes();
        push(childNodes, removedChildNodes);
    }
    return childNodes;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy91dGlsaXRpZXMvcmV3cml0ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IHsgYXJyYXlVdGlsaXRpZXMgfSBmcm9tIFwibmVjZXNzYXJ5XCI7XG5pbXBvcnQgeyBOb25UZXJtaW5hbE5vZGUgfSBmcm9tIFwib2NjYW0tcGFyc2Vyc1wiO1xuXG5pbXBvcnQgUmVkdWNlZE5vZGUgZnJvbSBcIi4uL25vZGUvcmVkdWNlZFwiO1xuaW1wb3J0IExlZnRSZWN1cnNpdmVOb2RlIGZyb20gXCIuLi9ub2RlL2xlZnRSZWN1cnNpdmVcIjtcbmltcG9ydCBEaXJlY3RseVJlcGVhdGVkTm9kZSBmcm9tIFwiLi4vbm9kZS9yZXBlYXRlZC9kaXJlY3RseVwiO1xuaW1wb3J0IEluZGlyZWN0bHlSZXBlYXRlZE5vZGUgZnJvbSBcIi4uL25vZGUvcmVwZWF0ZWQvaW5kaXJlY3RseVwiO1xuXG5pbXBvcnQgeyBydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUsIHJ1bGVOYW1lRnJvbUluZGlyZWN0bHlSZXBlYXRlZFJ1bGVOYW1lLCBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVGcm9tSW5kaXJlY3RseVJlcGVhdGVkUnVsZU5hbWUgfSBmcm9tIFwiLi4vdXRpbGl0aWVzL3J1bGVOYW1lXCI7XG5cbmNvbnN0IHsgZnJvbnQsIGZpcnN0LCBwdXNoIH0gPSBhcnJheVV0aWxpdGllcztcblxuZXhwb3J0IGZ1bmN0aW9uIHJld3JpdGVSZWR1Y2VkTm9kZXMobm9uVGVybWluYWxOb2RlKSB7XG4gIGxldCBjaGlsZE5vZGVzID0gbm9uVGVybWluYWxOb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICBjb25zdCBmaXJzdENoaWxkTm9kZSA9IGZpcnN0KGNoaWxkTm9kZXMpLFxuICAgICAgICBmaXJzdENoaWxkTm9kZVJlZHVjZWROb2RlID0gKGZpcnN0Q2hpbGROb2RlIGluc3RhbmNlb2YgUmVkdWNlZE5vZGUpO1xuXG4gIGlmICghZmlyc3RDaGlsZE5vZGVSZWR1Y2VkTm9kZSkge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGxldCByZXBsYWNlbWVudENoaWxkTm9kZXM7XG5cbiAgY29uc3QgcGFyZW50Tm9kZSA9IG5vblRlcm1pbmFsTm9kZSwgLy8vXG4gICAgICAgIHJlZHVjZWROb2RlID0gZmlyc3RDaGlsZE5vZGUsIC8vL1xuICAgICAgICByZXBsYWNlZENoaWxkTm9kZSA9IHJlZHVjZWROb2RlLCAvLy9cbiAgICAgICAgcGFyZW50Tm9kZVJ1bGVOYW1lID0gcGFyZW50Tm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICByZWR1Y2VkTm9kZU9wYWNpdHkgPSByZWR1Y2VkTm9kZS5nZXRPcGFjaXR5KCksXG4gICAgICAgIHJlZHVjZWROb2RlUnVsZU5hbWUgPSByZWR1Y2VkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICByZWR1Y2VkTm9kZVByZWNlZGVuY2UgPSByZWR1Y2VkTm9kZS5nZXRQcmVjZWRlbmNlKCksXG4gICAgICAgIHJlZHVjZWRSdWxlTmFtZSA9IHJlZHVjZWROb2RlUnVsZU5hbWUsICAvLy9cbiAgICAgICAgcGFyZW50UnVsZU5hbWUgPSBwYXJlbnROb2RlUnVsZU5hbWUsICAvLy9cbiAgICAgICAgcHJlY2VkZW5jZSA9IHJlZHVjZWROb2RlUHJlY2VkZW5jZSwgLy8vXG4gICAgICAgIG9wYWNpdHkgPSByZWR1Y2VkTm9kZU9wYWNpdHksIC8vL1xuICAgICAgICBydWxlTmFtZSA9IHJ1bGVOYW1lRnJvbVJlZHVjZWRSdWxlTmFtZShyZWR1Y2VkUnVsZU5hbWUpLFxuICAgICAgICByZW1vdmVkQ2hpbGROb2RlcyA9IHJlZHVjZWROb2RlLnJlbW92ZUNoaWxkTm9kZXMoKTtcblxuICBpZiAocnVsZU5hbWUgPT09IHBhcmVudFJ1bGVOYW1lKSB7XG4gICAgcmVwbGFjZW1lbnRDaGlsZE5vZGVzID0gcmVtb3ZlZENoaWxkTm9kZXM7ICAvLy9cblxuICAgIHBhcmVudE5vZGUuc2V0UHJlY2VkZW5jZShwcmVjZWRlbmNlKTtcbiAgfSBlbHNlIHtcbiAgICBjb25zdCBjaGlsZE5vZGVzID0gcmVtb3ZlZENoaWxkTm9kZXMsIC8vL1xuICAgICAgICAgIG5vblRlcm1pbmFsTm9kZSA9IE5vblRlcm1pbmFsTm9kZS5mcm9tUnVsZU5hbWVDaGlsZE5vZGVzQW5kT3BhY2l0eShydWxlTmFtZSwgY2hpbGROb2Rlcywgb3BhY2l0eSk7XG5cbiAgICBub25UZXJtaW5hbE5vZGUuc2V0UHJlY2VkZW5jZShub25UZXJtaW5hbE5vZGUpO1xuXG4gICAgcmVwbGFjZW1lbnRDaGlsZE5vZGVzID0gW1xuICAgICAgbm9uVGVybWluYWxOb2RlXG4gICAgXTtcbiAgfVxuXG4gIHBhcmVudE5vZGUucmVwbGFjZUNoaWxkTm9kZShyZXBsYWNlZENoaWxkTm9kZSwgcmVwbGFjZW1lbnRDaGlsZE5vZGVzKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJld3JpdGVEaXJlY3RseVJlcGVhdGVkTm9kZXMobm9uVGVybWluYWxOb2RlKSB7XG4gIGxldCBkaXJlY3RseVJlcGVhdGVkTm9kZXNSZXBsYWNlZDtcblxuICBkaXJlY3RseVJlcGVhdGVkTm9kZXNSZXBsYWNlZCA9IHJlcGxhY2VEaXJlY3RseVJlcGVhdGVkTm9kZXMobm9uVGVybWluYWxOb2RlKTtcblxuICB3aGlsZSAoZGlyZWN0bHlSZXBlYXRlZE5vZGVzUmVwbGFjZWQpIHtcbiAgICBkaXJlY3RseVJlcGVhdGVkTm9kZXNSZXBsYWNlZCA9IHJlcGxhY2VEaXJlY3RseVJlcGVhdGVkTm9kZXMobm9uVGVybWluYWxOb2RlKTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gcmV3cml0ZUluZGlyZWN0bHlSZXBlYXRlZE5vZGVzKG5vblRlcm1pbmFsTm9kZSkge1xuICBsZXQgcGFyZW50Tm9kZSA9IG5vblRlcm1pbmFsTm9kZTsgLy8vXG5cbiAgY29uc3QgaW5kaXJlY3RseVJlcGVhdGVkTm9kZXMgPSBmaW5kSW5kaXJlY3RseVJlcGVhdGVkTm9kZXMobm9uVGVybWluYWxOb2RlKTtcblxuICBpbmRpcmVjdGx5UmVwZWF0ZWROb2Rlcy5mb3JFYWNoKChpbmRpcmVjdGx5UmVwZWF0ZWROb2RlKSA9PiB7XG4gICAgY29uc3QgbGVmdFJlY3Vyc2l2ZU5vZGUgPSBsZWZ0UmVjdXJzaXZlTm9kZUZyb21QYXJlbnROb2RlQW5kSW5kaXJlY3RseVJlcGVhdGVkTm9kZShwYXJlbnROb2RlLCBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlKSxcbiAgICAgICAgICBjaGlsZE5vZGVzID0gY2hpbGROb2Rlc0Zyb21MZWZ0UmVjdXJzaXZlTm9kZU5vZGVBbmRJbmRpcmVjdGx5UmVwZWF0ZWROb2RlKGxlZnRSZWN1cnNpdmVOb2RlLCBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlKTtcblxuICAgIGFkanVzdFBhcmVudE5vZGVQcmVjZWRlbmNlKHBhcmVudE5vZGUsIGluZGlyZWN0bHlSZXBlYXRlZE5vZGUpO1xuXG4gICAgcGFyZW50Tm9kZS5zZXRDaGlsZE5vZGVzKGNoaWxkTm9kZXMpO1xuXG4gICAgcGFyZW50Tm9kZSA9IGxlZnRSZWN1cnNpdmVOb2RlOyAvLy9cbiAgfSk7XG5cbiAgcmV0dXJuIHBhcmVudE5vZGU7XG59XG5cbmZ1bmN0aW9uIGZpbmRSZXBlYXRlZE5vZGVzKG5vblRlcm1pbmFsTm9kZSwgUmVwZWF0ZWROb2RlKSB7XG4gIGNvbnN0IHJlcGVhdGVkTm9kZXMgPSBbXTtcblxuICBsZXQgbGFzdEluZGV4ID0gbnVsbDtcblxuICBjb25zdCBjaGlsZE5vZGVzID0gbm9uVGVybWluYWxOb2RlLmdldENoaWxkTm9kZXMoKSxcbiAgICAgICAgbGVuZ3RoID0gY2hpbGROb2Rlcy5sZW5ndGg7XG5cbiAgZm9yIChsZXQgaW5kZXggPSBsZW5ndGggLSAxOyBpbmRleCA+PSAwOyBpbmRleC0tKSB7XG4gICAgY29uc3QgY2hpbGROb2RlID0gY2hpbGROb2Rlc1tpbmRleF0sXG4gICAgICAgICAgY2hpbGROb2RlUmVwZWF0ZWROb2RlID0gKGNoaWxkTm9kZSBpbnN0YW5jZW9mIFJlcGVhdGVkTm9kZSk7XG5cbiAgICBpZiAoY2hpbGROb2RlUmVwZWF0ZWROb2RlKSB7XG4gICAgICBsYXN0SW5kZXggPSBpbmRleDsgIC8vL1xuXG4gICAgICBicmVhaztcbiAgICB9XG4gIH1cblxuICBpZiAobGFzdEluZGV4ICE9PSBudWxsKSB7XG4gICAgZm9yIChsZXQgaW5kZXggPSBsYXN0SW5kZXg7IGluZGV4ID49IDA7IGluZGV4LS0pIHtcbiAgICAgIGNvbnN0IGNoaWxkTm9kZSA9IGNoaWxkTm9kZXNbaW5kZXhdLFxuICAgICAgICAgICAgY2hpbGROb2RlUmVwZWF0ZWROb2RlID0gKGNoaWxkTm9kZSBpbnN0YW5jZW9mIFJlcGVhdGVkTm9kZSk7XG5cbiAgICAgIGlmICghY2hpbGROb2RlUmVwZWF0ZWROb2RlKSB7XG4gICAgICAgIGJyZWFrO1xuICAgICAgfVxuXG4gICAgICBjb25zdCByZXBlYXRlZE5vZGUgPSBjaGlsZE5vZGU7ICAvLy9cblxuICAgICAgcmVwZWF0ZWROb2Rlcy51bnNoaWZ0KHJlcGVhdGVkTm9kZSk7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlcGVhdGVkTm9kZXM7XG59XG5cbmZ1bmN0aW9uIGZpbmREaXJlY3RseVJlcGVhdGVkTm9kZXMobm9uVGVybWluYWxOb2RlKSB7XG4gIGNvbnN0IGRpcmVjdGx5UmVwZWF0ZWROb2RlcyA9IGZpbmRSZXBlYXRlZE5vZGVzKG5vblRlcm1pbmFsTm9kZSwgRGlyZWN0bHlSZXBlYXRlZE5vZGUpO1xuXG4gIHJldHVybiBkaXJlY3RseVJlcGVhdGVkTm9kZXM7XG59XG5cbmZ1bmN0aW9uIGZpbmRJbmRpcmVjdGx5UmVwZWF0ZWROb2Rlcyhub25UZXJtaW5hbE5vZGUpIHtcbiAgY29uc3QgaW5kaXJlY3RseVJlcGVhdGVkTm9kZXMgPSBmaW5kUmVwZWF0ZWROb2Rlcyhub25UZXJtaW5hbE5vZGUsIEluZGlyZWN0bHlSZXBlYXRlZE5vZGUpO1xuXG4gIGluZGlyZWN0bHlSZXBlYXRlZE5vZGVzLnJldmVyc2UoKTtcblxuICByZXR1cm4gaW5kaXJlY3RseVJlcGVhdGVkTm9kZXM7XG59XG5cbmZ1bmN0aW9uIHJlcGxhY2VEaXJlY3RseVJlcGVhdGVkTm9kZXMobm9uVGVybWluYWxOb2RlKSB7XG4gIGxldCBkaXJlY3RseVJlcGVhdGVkTm9kZXNSZXBsYWNlZCA9IGZhbHNlO1xuXG4gIGNvbnN0IGRpcmVjdGx5UmVwZWF0ZWROb2RlcyA9IGZpbmREaXJlY3RseVJlcGVhdGVkTm9kZXMobm9uVGVybWluYWxOb2RlKSxcbiAgICAgICAgZGlyZWN0bHlSZXBlYXRlZE5vZGVzTGVuZ3RoID0gZGlyZWN0bHlSZXBlYXRlZE5vZGVzLmxlbmd0aDtcblxuICBpZiAoZGlyZWN0bHlSZXBlYXRlZE5vZGVzTGVuZ3RoID4gMCkge1xuICAgIGNvbnN0IHBhcmVudE5vZGUgPSBub25UZXJtaW5hbE5vZGUsIC8vL1xuICAgICAgICAgIHJlcGxhY2VkQ2hpbGROb2RlcyA9IGRpcmVjdGx5UmVwZWF0ZWROb2RlcywgLy8vXG4gICAgICAgICAgcmVwbGFjZW1lbnRDaGlsZE5vZGVzID0gW107IC8vL1xuXG4gICAgZGlyZWN0bHlSZXBlYXRlZE5vZGVzLmZvckVhY2goKGRpcmVjdGx5UmVwZWF0ZWROb2RlKSA9PiB7XG4gICAgICBjb25zdCBkaXJlY3RseVJlcGVhdGVkTm9kZXNDaGlsZE5vZGVzID0gZGlyZWN0bHlSZXBlYXRlZE5vZGUuZ2V0Q2hpbGROb2RlcygpO1xuXG4gICAgICBwdXNoKHJlcGxhY2VtZW50Q2hpbGROb2RlcywgZGlyZWN0bHlSZXBlYXRlZE5vZGVzQ2hpbGROb2Rlcyk7XG4gICAgfSk7XG5cbiAgICBwYXJlbnROb2RlLnJlcGxhY2VDaGlsZE5vZGVzKHJlcGxhY2VkQ2hpbGROb2RlcywgcmVwbGFjZW1lbnRDaGlsZE5vZGVzKTtcblxuICAgIGRpcmVjdGx5UmVwZWF0ZWROb2Rlc1JlcGxhY2VkID0gdHJ1ZTtcbiAgfVxuXG4gIHJldHVybiBkaXJlY3RseVJlcGVhdGVkTm9kZXNSZXBsYWNlZDtcbn1cblxuZnVuY3Rpb24gYWRqdXN0UGFyZW50Tm9kZVByZWNlZGVuY2UocGFyZW50Tm9kZSwgaW5kaXJlY3RseVJlcGVhdGVkTm9kZSkge1xuICBjb25zdCBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlUnVsZU5hbWUgPSBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlLmdldFJ1bGVOYW1lKCksXG4gICAgICAgIGluZGlyZWN0bHlSZXBlYXRlZFJ1bGVOYW1lID0gaW5kaXJlY3RseVJlcGVhdGVkTm9kZVJ1bGVOYW1lLCAgLy8vXG4gICAgICAgIHBhcmVudE5vZGVOb2RlUnVsZU5hbWUgPSBwYXJlbnROb2RlLmdldFJ1bGVOYW1lKCksXG4gICAgICAgIHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tSW5kaXJlY3RseVJlcGVhdGVkUnVsZU5hbWUoaW5kaXJlY3RseVJlcGVhdGVkUnVsZU5hbWUpO1xuXG4gIGlmIChwYXJlbnROb2RlTm9kZVJ1bGVOYW1lID09PSBydWxlTmFtZSkge1xuICAgIGNvbnN0IHByZWNlZGVuY2UgPSBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlLmdldFByZWNlZGVuY2UoKTtcblxuICAgIHBhcmVudE5vZGUuc2V0UHJlY2VkZW5jZShwcmVjZWRlbmNlKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBsZWZ0UmVjdXJzaXZlTm9kZUZyb21QYXJlbnROb2RlQW5kSW5kaXJlY3RseVJlcGVhdGVkTm9kZShwYXJlbnROb2RlLCBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlKSB7XG4gIGxldCBjaGlsZE5vZGVzO1xuXG4gIGNoaWxkTm9kZXMgPSBwYXJlbnROb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICBjb25zdCBmcm9udENoaWxkTm9kZXMgPSBmcm9udChjaGlsZE5vZGVzKTtcblxuICBjaGlsZE5vZGVzID0gcGFyZW50Tm9kZS5yZW1vdmVDaGlsZE5vZGVzKGZyb250Q2hpbGROb2Rlcyk7XG5cbiAgY29uc3QgaW5kaXJlY3RseVJlcGVhdGVkTm9kZVJ1bGVOYW1lID0gaW5kaXJlY3RseVJlcGVhdGVkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlT3BhY2l0eSA9IGluZGlyZWN0bHlSZXBlYXRlZE5vZGUuZ2V0T3BhY2l0eSgpLFxuICAgICAgICBpbmRpcmVjdGx5UmVwZWF0ZWRSdWxlTmFtZSA9IGluZGlyZWN0bHlSZXBlYXRlZE5vZGVSdWxlTmFtZSwgIC8vL1xuICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZU5hbWUgPSBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVGcm9tSW5kaXJlY3RseVJlcGVhdGVkUnVsZU5hbWUoaW5kaXJlY3RseVJlcGVhdGVkUnVsZU5hbWUpLFxuICAgICAgICBydWxlTmFtZSA9IGxlZnRSZWN1cnNpdmVSdWxlTmFtZSwgLy8vXG4gICAgICAgIG9wYWNpdHkgPSBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlT3BhY2l0eSwgIC8vL1xuICAgICAgICBsZWZ0UmVjdXJzaXZlTm9kZSA9IExlZnRSZWN1cnNpdmVOb2RlLmZyb21SdWxlTmFtZUNoaWxkTm9kZXNBbmRPcGFjaXR5KHJ1bGVOYW1lLCBjaGlsZE5vZGVzLCBvcGFjaXR5KTtcblxuICByZXR1cm4gbGVmdFJlY3Vyc2l2ZU5vZGU7XG59XG5cbmZ1bmN0aW9uIGNoaWxkTm9kZXNGcm9tTGVmdFJlY3Vyc2l2ZU5vZGVOb2RlQW5kSW5kaXJlY3RseVJlcGVhdGVkTm9kZShsZWZ0UmVjdXJzaXZlTm9kZSwgaW5kaXJlY3RseVJlcGVhdGVkTm9kZSkge1xuICBjb25zdCBjaGlsZE5vZGVzID0gW1xuICAgICAgICAgIGxlZnRSZWN1cnNpdmVOb2RlXG4gICAgICAgIF0sXG4gICAgICAgIGluZGlyZWN0bHlSZXBlYXRlZE5vZGVOdWxsYXJ5ID0gaW5kaXJlY3RseVJlcGVhdGVkTm9kZS5pc051bGxhcnkoKTtcblxuICBpZiAoIWluZGlyZWN0bHlSZXBlYXRlZE5vZGVOdWxsYXJ5KSB7XG4gICAgY29uc3QgcmVtb3ZlZENoaWxkTm9kZXMgPSBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlLnJlbW92ZUNoaWxkTm9kZXMoKTtcblxuICAgIHB1c2goY2hpbGROb2RlcywgcmVtb3ZlZENoaWxkTm9kZXMpO1xuICB9XG5cbiAgcmV0dXJuIGNoaWxkTm9kZXM7XG59XG4iXSwibmFtZXMiOlsicmV3cml0ZURpcmVjdGx5UmVwZWF0ZWROb2RlcyIsInJld3JpdGVJbmRpcmVjdGx5UmVwZWF0ZWROb2RlcyIsInJld3JpdGVSZWR1Y2VkTm9kZXMiLCJmcm9udCIsImFycmF5VXRpbGl0aWVzIiwiZmlyc3QiLCJwdXNoIiwibm9uVGVybWluYWxOb2RlIiwiY2hpbGROb2RlcyIsImdldENoaWxkTm9kZXMiLCJmaXJzdENoaWxkTm9kZSIsImZpcnN0Q2hpbGROb2RlUmVkdWNlZE5vZGUiLCJSZWR1Y2VkTm9kZSIsInJlcGxhY2VtZW50Q2hpbGROb2RlcyIsInBhcmVudE5vZGUiLCJyZWR1Y2VkTm9kZSIsInJlcGxhY2VkQ2hpbGROb2RlIiwicGFyZW50Tm9kZVJ1bGVOYW1lIiwiZ2V0UnVsZU5hbWUiLCJyZWR1Y2VkTm9kZU9wYWNpdHkiLCJnZXRPcGFjaXR5IiwicmVkdWNlZE5vZGVSdWxlTmFtZSIsInJlZHVjZWROb2RlUHJlY2VkZW5jZSIsImdldFByZWNlZGVuY2UiLCJyZWR1Y2VkUnVsZU5hbWUiLCJwYXJlbnRSdWxlTmFtZSIsInByZWNlZGVuY2UiLCJvcGFjaXR5IiwicnVsZU5hbWUiLCJydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUiLCJyZW1vdmVkQ2hpbGROb2RlcyIsInJlbW92ZUNoaWxkTm9kZXMiLCJzZXRQcmVjZWRlbmNlIiwiTm9uVGVybWluYWxOb2RlIiwiZnJvbVJ1bGVOYW1lQ2hpbGROb2Rlc0FuZE9wYWNpdHkiLCJyZXBsYWNlQ2hpbGROb2RlIiwiZGlyZWN0bHlSZXBlYXRlZE5vZGVzUmVwbGFjZWQiLCJyZXBsYWNlRGlyZWN0bHlSZXBlYXRlZE5vZGVzIiwiaW5kaXJlY3RseVJlcGVhdGVkTm9kZXMiLCJmaW5kSW5kaXJlY3RseVJlcGVhdGVkTm9kZXMiLCJmb3JFYWNoIiwiaW5kaXJlY3RseVJlcGVhdGVkTm9kZSIsImxlZnRSZWN1cnNpdmVOb2RlIiwibGVmdFJlY3Vyc2l2ZU5vZGVGcm9tUGFyZW50Tm9kZUFuZEluZGlyZWN0bHlSZXBlYXRlZE5vZGUiLCJjaGlsZE5vZGVzRnJvbUxlZnRSZWN1cnNpdmVOb2RlTm9kZUFuZEluZGlyZWN0bHlSZXBlYXRlZE5vZGUiLCJhZGp1c3RQYXJlbnROb2RlUHJlY2VkZW5jZSIsInNldENoaWxkTm9kZXMiLCJmaW5kUmVwZWF0ZWROb2RlcyIsIlJlcGVhdGVkTm9kZSIsInJlcGVhdGVkTm9kZXMiLCJsYXN0SW5kZXgiLCJsZW5ndGgiLCJpbmRleCIsImNoaWxkTm9kZSIsImNoaWxkTm9kZVJlcGVhdGVkTm9kZSIsInJlcGVhdGVkTm9kZSIsInVuc2hpZnQiLCJmaW5kRGlyZWN0bHlSZXBlYXRlZE5vZGVzIiwiZGlyZWN0bHlSZXBlYXRlZE5vZGVzIiwiRGlyZWN0bHlSZXBlYXRlZE5vZGUiLCJJbmRpcmVjdGx5UmVwZWF0ZWROb2RlIiwicmV2ZXJzZSIsImRpcmVjdGx5UmVwZWF0ZWROb2Rlc0xlbmd0aCIsInJlcGxhY2VkQ2hpbGROb2RlcyIsImRpcmVjdGx5UmVwZWF0ZWROb2RlIiwiZGlyZWN0bHlSZXBlYXRlZE5vZGVzQ2hpbGROb2RlcyIsInJlcGxhY2VDaGlsZE5vZGVzIiwiaW5kaXJlY3RseVJlcGVhdGVkTm9kZVJ1bGVOYW1lIiwiaW5kaXJlY3RseVJlcGVhdGVkUnVsZU5hbWUiLCJwYXJlbnROb2RlTm9kZVJ1bGVOYW1lIiwicnVsZU5hbWVGcm9tSW5kaXJlY3RseVJlcGVhdGVkUnVsZU5hbWUiLCJmcm9udENoaWxkTm9kZXMiLCJpbmRpcmVjdGx5UmVwZWF0ZWROb2RlT3BhY2l0eSIsImxlZnRSZWN1cnNpdmVSdWxlTmFtZSIsImxlZnRSZWN1cnNpdmVSdWxlTmFtZUZyb21JbmRpcmVjdGx5UmVwZWF0ZWRSdWxlTmFtZSIsIkxlZnRSZWN1cnNpdmVOb2RlIiwiaW5kaXJlY3RseVJlcGVhdGVkTm9kZU51bGxhcnkiLCJpc051bGxhcnkiXSwibWFwcGluZ3MiOiJBQUFBOzs7Ozs7Ozs7OztJQTBEZ0JBLDRCQUE0QjtlQUE1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