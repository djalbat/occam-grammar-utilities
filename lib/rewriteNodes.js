"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    enumerable: true,
    get: function() {
        return rewriteNodes;
    }
});
var _necessary = require("necessary");
var _occamParsers = require("occam-parsers");
var _directly = /*#__PURE__*/ _interopRequireDefault(require("./node/reduced/directly"));
var _directly1 = /*#__PURE__*/ _interopRequireDefault(require("./node/repeated/directly"));
var _indirectly = /*#__PURE__*/ _interopRequireDefault(require("./node/reduced/indirectly"));
var _indirectly1 = /*#__PURE__*/ _interopRequireDefault(require("./node/repeated/indirectly"));
var _ruleName = require("./utilities/ruleName");
function _arrayLikeToArray(arr, len) {
    if (len == null || len > arr.length) len = arr.length;
    for(var i = 0, arr2 = new Array(len); i < len; i++)arr2[i] = arr[i];
    return arr2;
}
function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) return _arrayLikeToArray(arr);
}
function _instanceof(left, right) {
    if (right != null && typeof Symbol !== "undefined" && right[Symbol.hasInstance]) {
        return !!right[Symbol.hasInstance](left);
    } else {
        return left instanceof right;
    }
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _iterableToArray(iter) {
    if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}
function _unsupportedIterableToArray(o, minLen) {
    if (!o) return;
    if (typeof o === "string") return _arrayLikeToArray(o, minLen);
    var n = Object.prototype.toString.call(o).slice(8, -1);
    if (n === "Object" && o.constructor) n = o.constructor.name;
    if (n === "Map" || n === "Set") return Array.from(n);
    if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}
var push = _necessary.arrayUtilities.push, last = _necessary.arrayUtilities.last, first = _necessary.arrayUtilities.first, front = _necessary.arrayUtilities.front, filter = _necessary.arrayUtilities.filter, forwardsSome = _necessary.arrayUtilities.forwardsSome;
function rewriteNodes(node) {
    rewriteRepeatedNodes(node);
    rewriteReducedNodes(node);
    removeEpsilonNodes(node);
}
function removeEpsilonNodes(node) {
    var nodeNonTerminalNode = node.isNonTerminalNode();
    if (nodeNonTerminalNode) {
        var nonTerminalNode = node, childNodes = nonTerminalNode.getChildNodes();
        filter(childNodes, function(childNode) {
            var childNodeEpsilonNode = _instanceof(childNode, _occamParsers.EpsilonNode);
            if (!childNodeEpsilonNode) {
                return true;
            }
        });
        childNodes.forEach(function(childNode) {
            var _$node = childNode; ///
            removeEpsilonNodes(_$node);
        });
    }
}
function rewriteReducedNodes(node) {
    var nodeNonTerminalNode = node.isNonTerminalNode();
    if (nodeNonTerminalNode) {
        var nonTerminalNode = node, childNodes = nonTerminalNode.getChildNodes(), nonTerminalNodeIndirectlyReducedNode = _instanceof(nonTerminalNode, _indirectly.default);
        if (nonTerminalNodeIndirectlyReducedNode) {
            var indirectlyReducedNode = nonTerminalNode, indirectlyReducedNodeRuleName = indirectlyReducedNode.getRuleName(), reducedRuleName = indirectlyReducedNodeRuleName, ruleName = (0, _ruleName.ruleNameFromReducedRuleName)(reducedRuleName);
            indirectlyReducedNode.setRuleName(ruleName);
        }
        var firstChildNode = first(childNodes), firstChildNodeDirectlyReducedNode = _instanceof(firstChildNode, _directly.default);
        if (firstChildNodeDirectlyReducedNode) {
            var _childNodes;
            var directlyReducedNode = firstChildNode, start = 0, deleteCount = 1, directlyReducedNodeChildNodes = directlyReducedNode.getChildNodes();
            (_childNodes = childNodes).splice.apply(_childNodes, [
                start,
                deleteCount
            ].concat(_toConsumableArray(directlyReducedNodeChildNodes)));
        }
        childNodes.forEach(function(childNode) {
            var _$node = childNode;
            rewriteReducedNodes(_$node);
        });
    }
}
function rewriteRepeatedNodes(node) {
    var nodeNonTerminalNode = node.isNonTerminalNode();
    if (nodeNonTerminalNode) {
        var nonTerminalNode = node, childNodes = nonTerminalNode.getChildNodes(), lastChildNode = last(childNodes), lastChildNodeDirectlyRepeatedNode = _instanceof(lastChildNode, _directly1.default), lastChildNodeIndirectlyRepeatedNode = _instanceof(lastChildNode, _indirectly1.default);
        if (lastChildNodeDirectlyRepeatedNode) {
            var _childNodes;
            var directlyRepeatedNode = lastChildNode, directlyRepeatedNodeRuleName = directlyRepeatedNode.getRuleName(), repeatedRuleName = directlyRepeatedNodeRuleName, ruleName = (0, _ruleName.ruleNameFromRepeatedRuleName)(repeatedRuleName), childNodesFront = front(childNodes), start = 0, deleteCount = Infinity, newNonTerminalNode = new _occamParsers.NonTerminalNode(ruleName, childNodesFront), directlyRepeatedNodeChildNodes = directlyRepeatedNode.getChildNodes();
            (_childNodes = childNodes).splice.apply(_childNodes, [
                start,
                deleteCount,
                newNonTerminalNode
            ].concat(_toConsumableArray(directlyRepeatedNodeChildNodes)));
        }
        if (lastChildNodeIndirectlyRepeatedNode) {
            var firstChildNode = first(childNodes), directlyReducedNode = firstChildNode, indirectlyRepeatedNode = lastChildNode, directlyReducedNodeRuleName = directlyReducedNode.getRuleName(), reducedRuleName = directlyReducedNodeRuleName, ruleName1 = (0, _ruleName.ruleNameFromReducedRuleName)(reducedRuleName), childNodesLength = childNodes.length, start1 = 0, deleteCount1 = childNodesLength - 1, newNonTerminalNodeChildNodes = childNodes.splice(start1, deleteCount1), indirectlyRepeatedNodeChildNodes = indirectlyRepeatedNode.getChildNodes(), newNonTerminalNode1 = new _occamParsers.NonTerminalNode(ruleName1, newNonTerminalNodeChildNodes);
            childNodes.pop();
            push(childNodes, [
                newNonTerminalNode1
            ].concat(_toConsumableArray(indirectlyRepeatedNodeChildNodes)));
        }
        forwardsSome(childNodes, function(childNode, index) {
            var childNodeIndirectlyRepeatedNode = _instanceof(childNode, _indirectly1.default);
            if (childNodeIndirectlyRepeatedNode) {
                var indirectlyRepeatedNode = childNode, indirectlyRepeatedNodeChildNodes = indirectlyRepeatedNode.getChildNodes(), indirectlyRepeatedNodeRuleName = indirectlyRepeatedNode.getRuleName(), repeatedRuleName = indirectlyRepeatedNodeRuleName, ruleName = (0, _ruleName.ruleNameFromRepeatedRuleName)(repeatedRuleName), start = 0, deleteCount = index, leadingChildNodes = childNodes.splice(start, deleteCount), newNonTerminalNodeChildNodes = _toConsumableArray(leadingChildNodes).concat(_toConsumableArray(indirectlyRepeatedNodeChildNodes)), newNonTerminalNode = new _occamParsers.NonTerminalNode(ruleName, newNonTerminalNodeChildNodes);
                childNodes.shift();
                childNodes.unshift(newNonTerminalNode);
                return true;
            }
        });
        childNodes.forEach(function(childNode) {
            var _$node = childNode; ///
            rewriteRepeatedNodes(_$node);
        });
    }
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZXdyaXRlTm9kZXMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuaW1wb3J0IHsgRXBzaWxvbk5vZGUsIE5vblRlcm1pbmFsTm9kZSB9IGZyb20gXCJvY2NhbS1wYXJzZXJzXCI7XG5cbmltcG9ydCBEaXJlY3RseVJlZHVjZWROb2RlIGZyb20gXCIuL25vZGUvcmVkdWNlZC9kaXJlY3RseVwiO1xuaW1wb3J0IERpcmVjdGx5UmVwZWF0ZWROb2RlIGZyb20gXCIuL25vZGUvcmVwZWF0ZWQvZGlyZWN0bHlcIjtcbmltcG9ydCBJbmRpcmVjdGx5UmVkdWNlZE5vZGUgZnJvbSBcIi4vbm9kZS9yZWR1Y2VkL2luZGlyZWN0bHlcIjtcbmltcG9ydCBJbmRpcmVjdGx5UmVwZWF0ZWROb2RlIGZyb20gXCIuL25vZGUvcmVwZWF0ZWQvaW5kaXJlY3RseVwiO1xuXG5pbXBvcnQgeyBydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUsIHJ1bGVOYW1lRnJvbVJlcGVhdGVkUnVsZU5hbWUgfSBmcm9tIFwiLi91dGlsaXRpZXMvcnVsZU5hbWVcIjtcblxuY29uc3QgeyBwdXNoLCBsYXN0LCBmaXJzdCwgZnJvbnQsIGZpbHRlciwgZm9yd2FyZHNTb21lIH0gPSBhcnJheVV0aWxpdGllcztcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmV3cml0ZU5vZGVzKG5vZGUpIHtcbiAgcmV3cml0ZVJlcGVhdGVkTm9kZXMobm9kZSk7XG5cbiAgcmV3cml0ZVJlZHVjZWROb2Rlcyhub2RlKTtcblxuICByZW1vdmVFcHNpbG9uTm9kZXMobm9kZSk7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUVwc2lsb25Ob2Rlcyhub2RlKSB7XG4gIGNvbnN0IG5vZGVOb25UZXJtaW5hbE5vZGUgPSBub2RlLmlzTm9uVGVybWluYWxOb2RlKCk7XG5cbiAgaWYgKG5vZGVOb25UZXJtaW5hbE5vZGUpIHtcbiAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBub2RlLCAvLy9cbiAgICAgICAgICBjaGlsZE5vZGVzID0gbm9uVGVybWluYWxOb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICAgIGZpbHRlcihjaGlsZE5vZGVzLCAoY2hpbGROb2RlKSA9PiB7XG4gICAgICBjb25zdCBjaGlsZE5vZGVFcHNpbG9uTm9kZSA9IChjaGlsZE5vZGUgaW5zdGFuY2VvZiBFcHNpbG9uTm9kZSk7XG5cbiAgICAgIGlmICghY2hpbGROb2RlRXBzaWxvbk5vZGUpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjaGlsZE5vZGVzLmZvckVhY2goKGNoaWxkTm9kZSkgPT4ge1xuICAgICAgY29uc3Qgbm9kZSA9IGNoaWxkTm9kZTsgLy8vXG5cbiAgICAgIHJlbW92ZUVwc2lsb25Ob2Rlcyhub2RlKTtcbiAgICB9KTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZXdyaXRlUmVkdWNlZE5vZGVzKG5vZGUpIHtcbiAgY29uc3Qgbm9kZU5vblRlcm1pbmFsTm9kZSA9IG5vZGUuaXNOb25UZXJtaW5hbE5vZGUoKTtcblxuICBpZiAobm9kZU5vblRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IG5vblRlcm1pbmFsTm9kZSA9IG5vZGUsIC8vL1xuICAgICAgICAgIGNoaWxkTm9kZXMgPSBub25UZXJtaW5hbE5vZGUuZ2V0Q2hpbGROb2RlcygpLFxuICAgICAgICAgIG5vblRlcm1pbmFsTm9kZUluZGlyZWN0bHlSZWR1Y2VkTm9kZSA9IChub25UZXJtaW5hbE5vZGUgaW5zdGFuY2VvZiBJbmRpcmVjdGx5UmVkdWNlZE5vZGUpO1xuXG4gICAgaWYgKG5vblRlcm1pbmFsTm9kZUluZGlyZWN0bHlSZWR1Y2VkTm9kZSkge1xuICAgICAgY29uc3QgaW5kaXJlY3RseVJlZHVjZWROb2RlID0gbm9uVGVybWluYWxOb2RlLCAgLy8vXG4gICAgICAgICAgICBpbmRpcmVjdGx5UmVkdWNlZE5vZGVSdWxlTmFtZSA9IGluZGlyZWN0bHlSZWR1Y2VkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lID0gaW5kaXJlY3RseVJlZHVjZWROb2RlUnVsZU5hbWUsICAvLy9cbiAgICAgICAgICAgIHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lKHJlZHVjZWRSdWxlTmFtZSk7XG5cbiAgICAgIGluZGlyZWN0bHlSZWR1Y2VkTm9kZS5zZXRSdWxlTmFtZShydWxlTmFtZSk7XG4gICAgfVxuXG4gICAgY29uc3QgZmlyc3RDaGlsZE5vZGUgPSBmaXJzdChjaGlsZE5vZGVzKSxcbiAgICAgICAgICBmaXJzdENoaWxkTm9kZURpcmVjdGx5UmVkdWNlZE5vZGUgPSAoZmlyc3RDaGlsZE5vZGUgaW5zdGFuY2VvZiBEaXJlY3RseVJlZHVjZWROb2RlKTtcblxuICAgIGlmIChmaXJzdENoaWxkTm9kZURpcmVjdGx5UmVkdWNlZE5vZGUpIHtcbiAgICAgIGNvbnN0IGRpcmVjdGx5UmVkdWNlZE5vZGUgPSBmaXJzdENoaWxkTm9kZSwgIC8vL1xuICAgICAgICAgICAgc3RhcnQgPSAwLFxuICAgICAgICAgICAgZGVsZXRlQ291bnQgPSAxLFxuICAgICAgICAgICAgZGlyZWN0bHlSZWR1Y2VkTm9kZUNoaWxkTm9kZXMgPSBkaXJlY3RseVJlZHVjZWROb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICAgICAgY2hpbGROb2Rlcy5zcGxpY2Uoc3RhcnQsIGRlbGV0ZUNvdW50LCAuLi5kaXJlY3RseVJlZHVjZWROb2RlQ2hpbGROb2Rlcyk7XG4gICAgfVxuXG4gICAgY2hpbGROb2Rlcy5mb3JFYWNoKChjaGlsZE5vZGUpID0+IHtcbiAgICAgIGNvbnN0IG5vZGUgPSBjaGlsZE5vZGU7XG5cbiAgICAgIHJld3JpdGVSZWR1Y2VkTm9kZXMobm9kZSk7XG4gICAgfSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmV3cml0ZVJlcGVhdGVkTm9kZXMobm9kZSkge1xuICBjb25zdCBub2RlTm9uVGVybWluYWxOb2RlID0gbm9kZS5pc05vblRlcm1pbmFsTm9kZSgpO1xuXG4gIGlmIChub2RlTm9uVGVybWluYWxOb2RlKSB7XG4gICAgY29uc3Qgbm9uVGVybWluYWxOb2RlID0gbm9kZSwgLy8vXG4gICAgICAgICAgY2hpbGROb2RlcyA9IG5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCksXG4gICAgICAgICAgbGFzdENoaWxkTm9kZSA9IGxhc3QoY2hpbGROb2RlcyksXG4gICAgICAgICAgbGFzdENoaWxkTm9kZURpcmVjdGx5UmVwZWF0ZWROb2RlID0gKGxhc3RDaGlsZE5vZGUgaW5zdGFuY2VvZiBEaXJlY3RseVJlcGVhdGVkTm9kZSksXG4gICAgICAgICAgbGFzdENoaWxkTm9kZUluZGlyZWN0bHlSZXBlYXRlZE5vZGUgPSAobGFzdENoaWxkTm9kZSBpbnN0YW5jZW9mIEluZGlyZWN0bHlSZXBlYXRlZE5vZGUpO1xuXG4gICAgaWYgKGxhc3RDaGlsZE5vZGVEaXJlY3RseVJlcGVhdGVkTm9kZSkge1xuICAgICAgY29uc3QgZGlyZWN0bHlSZXBlYXRlZE5vZGUgPSBsYXN0Q2hpbGROb2RlLCAvLy9cbiAgICAgICAgICAgIGRpcmVjdGx5UmVwZWF0ZWROb2RlUnVsZU5hbWUgPSBkaXJlY3RseVJlcGVhdGVkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgcmVwZWF0ZWRSdWxlTmFtZSA9IGRpcmVjdGx5UmVwZWF0ZWROb2RlUnVsZU5hbWUsICAvLy9cbiAgICAgICAgICAgIHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tUmVwZWF0ZWRSdWxlTmFtZShyZXBlYXRlZFJ1bGVOYW1lKSxcbiAgICAgICAgICAgIGNoaWxkTm9kZXNGcm9udCA9IGZyb250KGNoaWxkTm9kZXMpLFxuICAgICAgICAgICAgc3RhcnQgPSAwLFxuICAgICAgICAgICAgZGVsZXRlQ291bnQgPSBJbmZpbml0eSxcbiAgICAgICAgICAgIG5ld05vblRlcm1pbmFsTm9kZSA9IG5ldyBOb25UZXJtaW5hbE5vZGUocnVsZU5hbWUsIGNoaWxkTm9kZXNGcm9udCksXG4gICAgICAgICAgICBkaXJlY3RseVJlcGVhdGVkTm9kZUNoaWxkTm9kZXMgPSBkaXJlY3RseVJlcGVhdGVkTm9kZS5nZXRDaGlsZE5vZGVzKCk7XG5cbiAgICAgIGNoaWxkTm9kZXMuc3BsaWNlKHN0YXJ0LCBkZWxldGVDb3VudCwgbmV3Tm9uVGVybWluYWxOb2RlLCAuLi5kaXJlY3RseVJlcGVhdGVkTm9kZUNoaWxkTm9kZXMpO1xuICAgIH1cblxuICAgIGlmIChsYXN0Q2hpbGROb2RlSW5kaXJlY3RseVJlcGVhdGVkTm9kZSkge1xuICAgICAgY29uc3QgZmlyc3RDaGlsZE5vZGUgPSBmaXJzdChjaGlsZE5vZGVzKSxcbiAgICAgICAgICAgIGRpcmVjdGx5UmVkdWNlZE5vZGUgPSBmaXJzdENoaWxkTm9kZSwgLy8vXG4gICAgICAgICAgICBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlID0gbGFzdENoaWxkTm9kZSwgLy8vXG4gICAgICAgICAgICBkaXJlY3RseVJlZHVjZWROb2RlUnVsZU5hbWUgPSBkaXJlY3RseVJlZHVjZWROb2RlLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICByZWR1Y2VkUnVsZU5hbWUgPSBkaXJlY3RseVJlZHVjZWROb2RlUnVsZU5hbWUsICAvLy9cbiAgICAgICAgICAgIHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lKHJlZHVjZWRSdWxlTmFtZSksXG4gICAgICAgICAgICBjaGlsZE5vZGVzTGVuZ3RoID0gY2hpbGROb2Rlcy5sZW5ndGgsXG4gICAgICAgICAgICBzdGFydCA9IDAsXG4gICAgICAgICAgICBkZWxldGVDb3VudCA9IGNoaWxkTm9kZXNMZW5ndGggLSAxLFxuICAgICAgICAgICAgbmV3Tm9uVGVybWluYWxOb2RlQ2hpbGROb2RlcyA9IGNoaWxkTm9kZXMuc3BsaWNlKHN0YXJ0LCBkZWxldGVDb3VudCksXG4gICAgICAgICAgICBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlQ2hpbGROb2RlcyA9IGluZGlyZWN0bHlSZXBlYXRlZE5vZGUuZ2V0Q2hpbGROb2RlcygpLFxuICAgICAgICAgICAgbmV3Tm9uVGVybWluYWxOb2RlID0gbmV3IE5vblRlcm1pbmFsTm9kZShydWxlTmFtZSwgbmV3Tm9uVGVybWluYWxOb2RlQ2hpbGROb2Rlcyk7XG5cbiAgICAgIGNoaWxkTm9kZXMucG9wKCk7XG5cbiAgICAgIHB1c2goY2hpbGROb2RlcywgW1xuICAgICAgICAgbmV3Tm9uVGVybWluYWxOb2RlLFxuICAgICAgICAuLi5pbmRpcmVjdGx5UmVwZWF0ZWROb2RlQ2hpbGROb2Rlc1xuICAgICAgXSk7XG4gICAgfVxuXG4gICAgZm9yd2FyZHNTb21lKGNoaWxkTm9kZXMsIChjaGlsZE5vZGUsIGluZGV4KSA9PiB7XG4gICAgICBjb25zdCBjaGlsZE5vZGVJbmRpcmVjdGx5UmVwZWF0ZWROb2RlID0gKGNoaWxkTm9kZSBpbnN0YW5jZW9mIEluZGlyZWN0bHlSZXBlYXRlZE5vZGUpO1xuXG4gICAgICBpZiAoY2hpbGROb2RlSW5kaXJlY3RseVJlcGVhdGVkTm9kZSkge1xuICAgICAgICBjb25zdCBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlID0gY2hpbGROb2RlLCAvLy9cbiAgICAgICAgICAgICAgaW5kaXJlY3RseVJlcGVhdGVkTm9kZUNoaWxkTm9kZXMgPSBpbmRpcmVjdGx5UmVwZWF0ZWROb2RlLmdldENoaWxkTm9kZXMoKSxcbiAgICAgICAgICAgICAgaW5kaXJlY3RseVJlcGVhdGVkTm9kZVJ1bGVOYW1lID0gaW5kaXJlY3RseVJlcGVhdGVkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgICByZXBlYXRlZFJ1bGVOYW1lID0gaW5kaXJlY3RseVJlcGVhdGVkTm9kZVJ1bGVOYW1lLCAgLy8vXG4gICAgICAgICAgICAgIHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tUmVwZWF0ZWRSdWxlTmFtZShyZXBlYXRlZFJ1bGVOYW1lKSxcbiAgICAgICAgICAgICAgc3RhcnQgPSAwLFxuICAgICAgICAgICAgICBkZWxldGVDb3VudCA9IGluZGV4LCAgLy8vXG4gICAgICAgICAgICAgIGxlYWRpbmdDaGlsZE5vZGVzID0gY2hpbGROb2Rlcy5zcGxpY2Uoc3RhcnQsIGRlbGV0ZUNvdW50KSxcbiAgICAgICAgICAgICAgbmV3Tm9uVGVybWluYWxOb2RlQ2hpbGROb2RlcyA9IFtcbiAgICAgICAgICAgICAgICAuLi5sZWFkaW5nQ2hpbGROb2RlcyxcbiAgICAgICAgICAgICAgICAuLi5pbmRpcmVjdGx5UmVwZWF0ZWROb2RlQ2hpbGROb2Rlc1xuICAgICAgICAgICAgICBdLFxuICAgICAgICAgICAgICBuZXdOb25UZXJtaW5hbE5vZGUgPSBuZXcgTm9uVGVybWluYWxOb2RlKHJ1bGVOYW1lLCBuZXdOb25UZXJtaW5hbE5vZGVDaGlsZE5vZGVzKTtcblxuICAgICAgICBjaGlsZE5vZGVzLnNoaWZ0KCk7XG5cbiAgICAgICAgY2hpbGROb2Rlcy51bnNoaWZ0KG5ld05vblRlcm1pbmFsTm9kZSk7XG5cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjaGlsZE5vZGVzLmZvckVhY2goKGNoaWxkTm9kZSkgPT4ge1xuICAgICAgY29uc3Qgbm9kZSA9IGNoaWxkTm9kZTsgLy8vXG5cbiAgICAgIHJld3JpdGVSZXBlYXRlZE5vZGVzKG5vZGUpO1xuICAgIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsicmV3cml0ZU5vZGVzIiwicHVzaCIsImFycmF5VXRpbGl0aWVzIiwibGFzdCIsImZpcnN0IiwiZnJvbnQiLCJmaWx0ZXIiLCJmb3J3YXJkc1NvbWUiLCJub2RlIiwicmV3cml0ZVJlcGVhdGVkTm9kZXMiLCJyZXdyaXRlUmVkdWNlZE5vZGVzIiwicmVtb3ZlRXBzaWxvbk5vZGVzIiwibm9kZU5vblRlcm1pbmFsTm9kZSIsImlzTm9uVGVybWluYWxOb2RlIiwibm9uVGVybWluYWxOb2RlIiwiY2hpbGROb2RlcyIsImdldENoaWxkTm9kZXMiLCJjaGlsZE5vZGUiLCJjaGlsZE5vZGVFcHNpbG9uTm9kZSIsIkVwc2lsb25Ob2RlIiwiZm9yRWFjaCIsIm5vblRlcm1pbmFsTm9kZUluZGlyZWN0bHlSZWR1Y2VkTm9kZSIsIkluZGlyZWN0bHlSZWR1Y2VkTm9kZSIsImluZGlyZWN0bHlSZWR1Y2VkTm9kZSIsImluZGlyZWN0bHlSZWR1Y2VkTm9kZVJ1bGVOYW1lIiwiZ2V0UnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWUiLCJydWxlTmFtZSIsInJ1bGVOYW1lRnJvbVJlZHVjZWRSdWxlTmFtZSIsInNldFJ1bGVOYW1lIiwiZmlyc3RDaGlsZE5vZGUiLCJmaXJzdENoaWxkTm9kZURpcmVjdGx5UmVkdWNlZE5vZGUiLCJEaXJlY3RseVJlZHVjZWROb2RlIiwiZGlyZWN0bHlSZWR1Y2VkTm9kZSIsInN0YXJ0IiwiZGVsZXRlQ291bnQiLCJkaXJlY3RseVJlZHVjZWROb2RlQ2hpbGROb2RlcyIsInNwbGljZSIsImxhc3RDaGlsZE5vZGUiLCJsYXN0Q2hpbGROb2RlRGlyZWN0bHlSZXBlYXRlZE5vZGUiLCJEaXJlY3RseVJlcGVhdGVkTm9kZSIsImxhc3RDaGlsZE5vZGVJbmRpcmVjdGx5UmVwZWF0ZWROb2RlIiwiSW5kaXJlY3RseVJlcGVhdGVkTm9kZSIsImRpcmVjdGx5UmVwZWF0ZWROb2RlIiwiZGlyZWN0bHlSZXBlYXRlZE5vZGVSdWxlTmFtZSIsInJlcGVhdGVkUnVsZU5hbWUiLCJydWxlTmFtZUZyb21SZXBlYXRlZFJ1bGVOYW1lIiwiY2hpbGROb2Rlc0Zyb250IiwiSW5maW5pdHkiLCJuZXdOb25UZXJtaW5hbE5vZGUiLCJOb25UZXJtaW5hbE5vZGUiLCJkaXJlY3RseVJlcGVhdGVkTm9kZUNoaWxkTm9kZXMiLCJpbmRpcmVjdGx5UmVwZWF0ZWROb2RlIiwiZGlyZWN0bHlSZWR1Y2VkTm9kZVJ1bGVOYW1lIiwiY2hpbGROb2Rlc0xlbmd0aCIsImxlbmd0aCIsIm5ld05vblRlcm1pbmFsTm9kZUNoaWxkTm9kZXMiLCJpbmRpcmVjdGx5UmVwZWF0ZWROb2RlQ2hpbGROb2RlcyIsInBvcCIsImluZGV4IiwiY2hpbGROb2RlSW5kaXJlY3RseVJlcGVhdGVkTm9kZSIsImluZGlyZWN0bHlSZXBlYXRlZE5vZGVSdWxlTmFtZSIsImxlYWRpbmdDaGlsZE5vZGVzIiwic2hpZnQiLCJ1bnNoaWZ0Il0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7K0JBY2IsU0FNQzs7O2VBTnVCQSxZQUFZOzs7eUJBWkwsV0FBVzs0QkFDRyxlQUFlOzZEQUU1Qix5QkFBeUI7OERBQ3hCLDBCQUEwQjsrREFDekIsMkJBQTJCO2dFQUMxQiw0QkFBNEI7d0JBRVcsc0JBQXNCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUVoRyxJQUFRQyxJQUFJLEdBQStDQyxVQUFjLGVBQUEsQ0FBakVELElBQUksRUFBRUUsSUFBSSxHQUF5Q0QsVUFBYyxlQUFBLENBQTNEQyxJQUFJLEVBQUVDLEtBQUssR0FBa0NGLFVBQWMsZUFBQSxDQUFyREUsS0FBSyxFQUFFQyxLQUFLLEdBQTJCSCxVQUFjLGVBQUEsQ0FBOUNHLEtBQUssRUFBRUMsTUFBTSxHQUFtQkosVUFBYyxlQUFBLENBQXZDSSxNQUFNLEVBQUVDLFlBQVksR0FBS0wsVUFBYyxlQUFBLENBQS9CSyxZQUFZLEFBQW9CO0FBRTNELFNBQVNQLFlBQVksQ0FBQ1EsSUFBSSxFQUFFO0lBQ3pDQyxvQkFBb0IsQ0FBQ0QsSUFBSSxDQUFDLENBQUM7SUFFM0JFLG1CQUFtQixDQUFDRixJQUFJLENBQUMsQ0FBQztJQUUxQkcsa0JBQWtCLENBQUNILElBQUksQ0FBQyxDQUFDO0NBQzFCO0FBRUQsU0FBU0csa0JBQWtCLENBQUNILElBQUksRUFBRTtJQUNoQyxJQUFNSSxtQkFBbUIsR0FBR0osSUFBSSxDQUFDSyxpQkFBaUIsRUFBRSxBQUFDO0lBRXJELElBQUlELG1CQUFtQixFQUFFO1FBQ3ZCLElBQU1FLGVBQWUsR0FBR04sSUFBSSxFQUN0Qk8sVUFBVSxHQUFHRCxlQUFlLENBQUNFLGFBQWEsRUFBRSxBQUFDO1FBRW5EVixNQUFNLENBQUNTLFVBQVUs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