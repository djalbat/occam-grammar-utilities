"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    get: function() {
        return eliminateIndirectLeftRecursion;
    },
    enumerable: true
});
var _necessary = require("necessary");
var _reduced = _interopRequireDefault(require("./rule/reduced"));
var _repeated = _interopRequireDefault(require("./rule/repeated"));
var _left = _interopRequireDefault(require("./definition/recursive/left"));
var _directly = _interopRequireDefault(require("./definition/recursive/left/directly"));
var _indirectly = _interopRequireDefault(require("./definition/recursive/left/indirectly"));
var _rules = require("./utilities/rules");
var _ruleNames = require("./utilities/ruleNames");
var _definitions = require("./utilities/definitions");
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
var last = _necessary.arrayUtilities.last, first = _necessary.arrayUtilities.first;
function eliminateIndirectLeftRecursion(leftRecursiveDefinitions, ruleMap) {
    var indirectlyLeftRecursiveRules = retrieveIndirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap);
    indirectlyLeftRecursiveRules.forEach(function(indirectlyLeftRecursiveRule) {
        var reducedRuleName = null, reducedLeftRecursiveDefinition = null;
        var reducedRule = _reduced.default.fromIndirectlyLeftRecursiveRule(indirectlyLeftRecursiveRule);
        if (reducedRule !== null) {
            var indirectlyLeftRecursiveRuleDefinitions = indirectlyLeftRecursiveRule.getDefinitions(), lastIndirectlyLeftRecursiveRuleDefinition = last(indirectlyLeftRecursiveRuleDefinitions);
            reducedLeftRecursiveDefinition = lastIndirectlyLeftRecursiveRuleDefinition; ///
            reducedRuleName = reducedRule.getName();
            ruleMap[reducedRuleName] = reducedRule;
        }
        var implicitlyLeftRecursiveRuleNames = retrieveImplicitlyLeftRecursiveRuleNames(indirectlyLeftRecursiveRule);
        implicitlyLeftRecursiveRuleNames.forEach(function(implicitlyLeftRecursiveRuleName, index) {
            var indirectlyLeftRecursiveDefinitions = retrieveIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, implicitlyLeftRecursiveRuleName), indirectlyLeftRecursiveDefinition = mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions);
            var repeatedRuleName = null;
            var repeatedRule = _repeated.default.fromIndirectlyLeftRecursiveDefinitionAndIndex(indirectlyLeftRecursiveDefinition, index);
            if (repeatedRule !== null) {
                repeatedRuleName = repeatedRule.getName();
                ruleMap[repeatedRuleName] = repeatedRule;
            }
        // const rewrittenIndirectlyLeftRecursiveDefinition = rewriteIndirectlyLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, repeatedRuleName),
        //       implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(),
        //       replacedDefinition = implicitlyLeftRecursiveDefinition, ///
        //       replacementDefinitions = rewriteImplicitlyLeftRecursiveDefinition(implicitlyLeftRecursiveDefinition, rewrittenIndirectlyLeftRecursiveDefinition, reducedLeftRecursiveDefinition),
        //       implicitlyLeftRecursiveRule = ruleMap[implicitlyLeftRecursiveRuleName];
        //
        // implicitlyLeftRecursiveRule.replaceDefinition(replacedDefinition, ...replacementDefinitions);
        //
        // const leftRecursiveDefinition = first(replacementDefinitions); ///
        //
        // leftRecursiveDefinitions.push(leftRecursiveDefinition);
        });
    });
}
function retrieveIndirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap) {
    var indirectlyLeftRecursiveRules = (0, _rules.retrieveLeftRecursiveRules)(leftRecursiveDefinitions, _indirectly.default, ruleMap);
    return indirectlyLeftRecursiveRules;
}
function mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions) {
    var indirectlyLeftRecursiveDefinition = (0, _definitions.mergeLeftRecursiveDefinitions)(indirectlyLeftRecursiveDefinitions, function(parts, ruleName) {
        var indirectlyLeftRecursiveDefinition;
        var firstIndirectlyLeftRecursiveDefinition = first(indirectlyLeftRecursiveDefinitions);
        indirectlyLeftRecursiveDefinition = firstIndirectlyLeftRecursiveDefinition; ///
        // const implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition();
        //
        // indirectlyLeftRecursiveDefinition = IndirectlyLeftRecursiveDefinition.fromPartsRuleNameAndImplicitlyLeftRecursiveDefinition(parts, ruleName, implicitlyLeftRecursiveDefinition);
        return indirectlyLeftRecursiveDefinition;
    });
    return indirectlyLeftRecursiveDefinition;
}
function retrieveImplicitlyLeftRecursiveRuleNames(indirectlyLeftRecursiveRule) {
    var callback = function callback(indirectlyLeftRecursiveDefinition) {
    // const implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(),
    //       ruleName = implicitlyLeftRecursiveDefinition.getRuleName();
    //
    // return ruleName;
    };
    var implicitlyLeftRecursiveRuleNames = (0, _ruleNames.retrieveLeftRecursiveRuleNames)(indirectlyLeftRecursiveRule, _indirectly.default, callback);
    return implicitlyLeftRecursiveRuleNames;
}
function rewriteIndirectlyLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, repeatedRuleName) {
    var directlyLeftRecursiveDefinition = _directly.default.fromIndirectlyLeftRecursiveDefinitionAndRepeatedRuleName(indirectlyLeftRecursiveDefinition, repeatedRuleName), rewrittenIndirectlyLeftRecursiveDefinition = directlyLeftRecursiveDefinition; ///
    return rewrittenIndirectlyLeftRecursiveDefinition;
}
// function rewriteImplicitlyLeftRecursiveDefinition(implicitlyLeftRecursiveDefinition, rewrittenIndirectlyLeftRecursiveDefinition, reducedLeftRecursiveDefinition) {
//   const replacementDefinitions = [];
//
//   const definition = rewrittenIndirectlyLeftRecursiveDefinition, ///
//         directlyLeftRecursiveDefinition = DirectlyLeftRecursiveDefinition.fromImplicitlyLeftRecursiveDefinitionAndDefinition(implicitlyLeftRecursiveDefinition, definition);
//
//   replacementDefinitions.push(directlyLeftRecursiveDefinition);
//
//   if (reducedLeftRecursiveDefinition !== null) {
//     const definition = reducedLeftRecursiveDefinition,  ///
//           leftRecursiveDefinition = LeftRecursiveDefinition.fromImplicitlyLeftRecursiveDefinitionAndDefinition(implicitlyLeftRecursiveDefinition, definition);
//
//     replacementDefinitions.push(leftRecursiveDefinition);
//   }
//
//   return replacementDefinitions;
// }
function retrieveIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, implicitlyLeftRecursiveRuleName) {
    var callback = function callback(indirectlyLeftRecursiveDefinition) {
    // const implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(),
    //       ruleName = implicitlyLeftRecursiveDefinition.getRuleName();
    //
    // if (ruleName === implicitlyLeftRecursiveRuleName) {
    //   return true;
    // }
    };
    var indirectlyLeftRecursiveDefinitions = (0, _definitions.retrieveLeftRecursiveDefinitions)(indirectlyLeftRecursiveRule, _indirectly.default, callback);
    return indirectlyLeftRecursiveDefinitions;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5pbXBvcnQgUmVkdWNlZFJ1bGUgZnJvbSBcIi4vcnVsZS9yZWR1Y2VkXCI7XG5pbXBvcnQgUmVwZWF0ZWRSdWxlIGZyb20gXCIuL3J1bGUvcmVwZWF0ZWRcIjtcbmltcG9ydCBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0XCI7XG5pbXBvcnQgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0L2RpcmVjdGx5XCI7XG5pbXBvcnQgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIGZyb20gXCIuL2RlZmluaXRpb24vcmVjdXJzaXZlL2xlZnQvaW5kaXJlY3RseVwiO1xuXG5pbXBvcnQgeyByZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyB9IGZyb20gXCIuL3V0aWxpdGllcy9ydWxlc1wiO1xuaW1wb3J0IHsgcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIH0gZnJvbSBcIi4vdXRpbGl0aWVzL3J1bGVOYW1lc1wiO1xuaW1wb3J0IHsgbWVyZ2VMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIH0gZnJvbSBcIi4vdXRpbGl0aWVzL2RlZmluaXRpb25zXCI7XG5cbmNvbnN0IHsgbGFzdCwgZmlyc3QgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBlbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24obGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKSB7XG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMgPSByZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKTtcblxuICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzLmZvckVhY2goKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSkgPT4ge1xuICAgIGxldCByZWR1Y2VkUnVsZU5hbWUgPSBudWxsLFxuICAgICAgICByZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBudWxsO1xuXG4gICAgY29uc3QgcmVkdWNlZFJ1bGUgPSBSZWR1Y2VkUnVsZS5mcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSk7XG5cbiAgICBpZiAocmVkdWNlZFJ1bGUgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURlZmluaXRpb25zID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLmdldERlZmluaXRpb25zKCksXG4gICAgICAgICAgICBsYXN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbiA9IGxhc3QoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbnMpO1xuXG4gICAgICByZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBsYXN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbjsgLy8vXG5cbiAgICAgIHJlZHVjZWRSdWxlTmFtZSA9IHJlZHVjZWRSdWxlLmdldE5hbWUoKTtcblxuICAgICAgcnVsZU1hcFtyZWR1Y2VkUnVsZU5hbWVdID0gcmVkdWNlZFJ1bGU7XG4gICAgfVxuXG4gICAgY29uc3QgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMgPSByZXRyaWV2ZUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSk7XG5cbiAgICBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcy5mb3JFYWNoKChpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IHJldHJpZXZlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWUpLFxuICAgICAgICAgICAgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gbWVyZ2VJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpO1xuXG4gICAgICBsZXQgcmVwZWF0ZWRSdWxlTmFtZSA9IG51bGw7XG5cbiAgICAgIGNvbnN0IHJlcGVhdGVkUnVsZSA9IFJlcGVhdGVkUnVsZS5mcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kSW5kZXgoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBpbmRleCk7XG5cbiAgICAgIGlmIChyZXBlYXRlZFJ1bGUgIT09IG51bGwpIHtcbiAgICAgICAgcmVwZWF0ZWRSdWxlTmFtZSA9IHJlcGVhdGVkUnVsZS5nZXROYW1lKCk7XG5cbiAgICAgICAgcnVsZU1hcFtyZXBlYXRlZFJ1bGVOYW1lXSA9IHJlcGVhdGVkUnVsZTtcbiAgICAgIH1cblxuICAgICAgLy8gY29uc3QgcmV3cml0dGVuSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gcmV3cml0ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJlcGVhdGVkUnVsZU5hbWUpLFxuICAgICAgLy8gICAgICAgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldEltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbigpLFxuICAgICAgLy8gICAgICAgcmVwbGFjZWREZWZpbml0aW9uID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCAvLy9cbiAgICAgIC8vICAgICAgIHJlcGxhY2VtZW50RGVmaW5pdGlvbnMgPSByZXdyaXRlSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcmV3cml0dGVuSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pLFxuICAgICAgLy8gICAgICAgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlID0gcnVsZU1hcFtpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lXTtcbiAgICAgIC8vXG4gICAgICAvLyBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUucmVwbGFjZURlZmluaXRpb24ocmVwbGFjZWREZWZpbml0aW9uLCAuLi5yZXBsYWNlbWVudERlZmluaXRpb25zKTtcbiAgICAgIC8vXG4gICAgICAvLyBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KHJlcGxhY2VtZW50RGVmaW5pdGlvbnMpOyAvLy9cbiAgICAgIC8vXG4gICAgICAvLyBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMucHVzaChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKSB7XG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMgPSByZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcnVsZU1hcCk7XG5cbiAgcmV0dXJuIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXM7XG59XG5cbmZ1bmN0aW9uIG1lcmdlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IG1lcmdlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIChwYXJ0cywgcnVsZU5hbWUpID0+IHtcbiAgICBsZXQgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uO1xuXG4gICAgY29uc3QgZmlyc3RJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBmaXJzdChpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKTtcblxuICAgIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uOyAvLy9cblxuICAgIC8vIGNvbnN0IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oKTtcbiAgICAvL1xuICAgIC8vIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUGFydHNSdWxlTmFtZUFuZEltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihwYXJ0cywgcnVsZU5hbWUsIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG5cbiAgICByZXR1cm4gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uO1xuICB9KTtcblxuICByZXR1cm4gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uO1xufVxuXG5mdW5jdGlvbiByZXRyaWV2ZUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSkge1xuICBjb25zdCBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyA9IHJldHJpZXZlTGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgY2FsbGJhY2spO1xuXG4gIGZ1bmN0aW9uIGNhbGxiYWNrKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikge1xuICAgIC8vIGNvbnN0IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oKSxcbiAgICAvLyAgICAgICBydWxlTmFtZSA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRSdWxlTmFtZSgpO1xuICAgIC8vXG4gICAgLy8gcmV0dXJuIHJ1bGVOYW1lO1xuICB9XG5cbiAgcmV0dXJuIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzO1xufVxuXG5mdW5jdGlvbiByZXdyaXRlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcmVwZWF0ZWRSdWxlTmFtZSkge1xuICBjb25zdCBkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kUmVwZWF0ZWRSdWxlTmFtZShpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJlcGVhdGVkUnVsZU5hbWUpLFxuICAgICAgICByZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uOyAvLy9cblxuICByZXR1cm4gcmV3cml0dGVuSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uO1xufVxuXG4vLyBmdW5jdGlvbiByZXdyaXRlSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcmV3cml0dGVuSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pIHtcbi8vICAgY29uc3QgcmVwbGFjZW1lbnREZWZpbml0aW9ucyA9IFtdO1xuLy9cbi8vICAgY29uc3QgZGVmaW5pdGlvbiA9IHJld3JpdHRlbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4vLyAgICAgICAgIGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbmREZWZpbml0aW9uKGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgZGVmaW5pdGlvbik7XG4vL1xuLy8gICByZXBsYWNlbWVudERlZmluaXRpb25zLnB1c2goZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG4vL1xuLy8gICBpZiAocmVkdWNlZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uICE9PSBudWxsKSB7XG4vLyAgICAgY29uc3QgZGVmaW5pdGlvbiA9IHJlZHVjZWRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgIC8vL1xuLy8gICAgICAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkFuZERlZmluaXRpb24oaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBkZWZpbml0aW9uKTtcbi8vXG4vLyAgICAgcmVwbGFjZW1lbnREZWZpbml0aW9ucy5wdXNoKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcbi8vICAgfVxuLy9cbi8vICAgcmV0dXJuIHJlcGxhY2VtZW50RGVmaW5pdGlvbnM7XG4vLyB9XG5cbmZ1bmN0aW9uIHJldHJpZXZlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWUpIHtcbiAgY29uc3QgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IHJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSwgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBjYWxsYmFjayk7XG5cbiAgZnVuY3Rpb24gY2FsbGJhY2soaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSB7XG4gICAgLy8gY29uc3QgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldEltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbigpLFxuICAgIC8vICAgICAgIHJ1bGVOYW1lID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCk7XG4gICAgLy9cbiAgICAvLyBpZiAocnVsZU5hbWUgPT09IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWUpIHtcbiAgICAvLyAgIHJldHVybiB0cnVlO1xuICAgIC8vIH1cbiAgfVxuXG4gIHJldHVybiBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zO1xufVxuIl0sIm5hbWVzIjpbImVsaW1pbmF0ZUluZGlyZWN0TGVmdFJlY3Vyc2lvbiIsImxhc3QiLCJhcnJheVV0aWxpdGllcyIsImZpcnN0IiwibGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwicnVsZU1hcCIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMiLCJyZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMiLCJmb3JFYWNoIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlIiwicmVkdWNlZFJ1bGVOYW1lIiwicmVkdWNlZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmVkdWNlZFJ1bGUiLCJSZWR1Y2VkUnVsZSIsImZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEZWZpbml0aW9ucyIsImdldERlZmluaXRpb25zIiwibGFzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURlZmluaXRpb24iLCJnZXROYW1lIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMiLCJyZXRyaWV2ZUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZSIsImluZGV4IiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJldHJpZXZlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIm1lcmdlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJlcGVhdGVkUnVsZU5hbWUiLCJyZXBlYXRlZFJ1bGUiLCJSZXBlYXRlZFJ1bGUiLCJmcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kSW5kZXgiLCJyZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyIsIkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIm1lcmdlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwicGFydHMiLCJydWxlTmFtZSIsImZpcnN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiY2FsbGJhY2siLCJyZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMiLCJyZXdyaXRlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIkRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kUmVwZWF0ZWRSdWxlTmFtZSIsInJld3JpdHRlbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsInJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7OztlQWdCV0EsOEJBQThCOzs7O3lCQWR2QixXQUFXOzhDQUVsQixnQkFBZ0I7K0NBQ2YsaUJBQWlCOzJDQUNOLDZCQUE2QjsrQ0FDckIsc0NBQXNDO2lEQUNwQyx3Q0FBd0M7cUJBRTNDLG1CQUFtQjt5QkFDZix1QkFBdUI7MkJBQ1UseUJBQXlCOzs7Ozs7QUFFekcsSUFBUUMsSUFBSSxHQUFZQyxVQUFjLGVBQUEsQ0FBOUJELElBQUksRUFBRUUsS0FBSyxHQUFLRCxVQUFjLGVBQUEsQ0FBeEJDLEtBQUssQUFBb0I7QUFFeEIsU0FBU0gsOEJBQThCLENBQUNJLHdCQUF3QixFQUFFQyxPQUFPLEVBQUU7SUFDeEYsSUFBTUMsNEJBQTRCLEdBQUdDLG9DQUFvQyxDQUFDSCx3QkFBd0IsRUFBRUMsT0FBTyxDQUFDLEFBQUM7SUFFN0dDLDRCQUE0QixDQUFDRSxPQUFPLENBQUMsU0FBQ0MsMkJBQTJCLEVBQUs7UUFDcEUsSUFBSUMsZUFBZSxHQUFHLElBQUksRUFDdEJDLDhCQUE4QixHQUFHLElBQUks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