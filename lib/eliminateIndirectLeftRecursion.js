"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    get: function() {
        return eliminateIndirectLeftRecursion;
    },
    enumerable: true
});
var _necessary = require("necessary");
var _reduced = _interopRequireDefault(require("./rule/reduced"));
var _repeated = _interopRequireDefault(require("./rule/repeated"));
var _left = _interopRequireDefault(require("./definition/recursive/left"));
var _directly = _interopRequireDefault(require("./definition/recursive/left/directly"));
var _indirectly = _interopRequireDefault(require("./definition/recursive/left/indirectly"));
var _rules = require("./utilities/rules");
var _ruleNames = require("./utilities/ruleNames");
var _definitions = require("./utilities/definitions");
function _arrayLikeToArray(arr, len) {
    if (len == null || len > arr.length) len = arr.length;
    for(var i = 0, arr2 = new Array(len); i < len; i++)arr2[i] = arr[i];
    return arr2;
}
function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) return _arrayLikeToArray(arr);
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _iterableToArray(iter) {
    if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}
function _unsupportedIterableToArray(o, minLen) {
    if (!o) return;
    if (typeof o === "string") return _arrayLikeToArray(o, minLen);
    var n = Object.prototype.toString.call(o).slice(8, -1);
    if (n === "Object" && o.constructor) n = o.constructor.name;
    if (n === "Map" || n === "Set") return Array.from(n);
    if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}
var first = _necessary.arrayUtilities.first, last = _necessary.arrayUtilities.last;
function eliminateIndirectLeftRecursion(leftRecursiveDefinitions, ruleMap) {
    var indirectlyLeftRecursiveRules = retrieveIndirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap);
    indirectlyLeftRecursiveRules.forEach(function(indirectlyLeftRecursiveRule) {
        rewriteIndirectlyLeftRecursiveRule(indirectlyLeftRecursiveRule, ruleMap);
    });
}
function rewriteIndirectlyLeftRecursiveRule(indirectlyLeftRecursiveRule, ruleMap) {
    var reducedLeftRecursiveDefinition = reduceIndirectlyLeftRecursiveRule(indirectlyLeftRecursiveRule, ruleMap), leftRecursiveRuleNames = (0, _ruleNames.retrieveLeftRecursiveRuleNames)(indirectlyLeftRecursiveRule, _indirectly.default, function(indirectlyLeftRecursiveDefinition) {
        var leftRecursiveRuleNames = indirectlyLeftRecursiveDefinition.getLeftRecursiveRuleNames(), firstLeftRecursiveRuleName = first(leftRecursiveRuleNames), leftRecursiveRuleName = firstLeftRecursiveRuleName; ///
        return leftRecursiveRuleName;
    });
    leftRecursiveRuleNames.forEach(function(leftRecursiveRuleName, index) {
        var _rule;
        var indirectlyLeftRecursiveDefinitions = retrieveIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, leftRecursiveRuleName);
        var indirectlyLeftRecursiveDefinition = mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions);
        var repeatedRuleName = null;
        var repeatedRule = _repeated.default.fromIndirectlyLeftRecursiveDefinitionAndIndex(indirectlyLeftRecursiveDefinition, index);
        if (repeatedRule !== null) {
            repeatedRuleName = repeatedRule.getName();
            ruleMap[repeatedRuleName] = repeatedRule;
        }
        var leftRecursiveDefinition;
        var leftRecursiveDefinitions = indirectlyLeftRecursiveDefinition.getLeftRecursiveDefinitions(), lastLeftRecursiveDefinition = last(leftRecursiveDefinitions);
        leftRecursiveDefinition = lastLeftRecursiveDefinition; ///
        indirectlyLeftRecursiveDefinition = _indirectly.default.fromIndirectlyLeftRecursiveDefinitionAndRepeatedRuleName(indirectlyLeftRecursiveDefinition, repeatedRuleName);
        var ruleName = leftRecursiveDefinition.getRuleName(), replacedDefinition = leftRecursiveDefinition, replacementDefinitions = rewriteIndirectlyLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, reducedLeftRecursiveDefinition, leftRecursiveDefinition), rule = ruleMap[ruleName];
        (_rule = rule).replaceDefinition.apply(_rule, [
            replacedDefinition
        ].concat(_toConsumableArray(replacementDefinitions)));
    });
}
function reduceIndirectlyLeftRecursiveRule(indirectlyLeftRecursiveRule, ruleMap) {
    var reducedLeftRecursiveDefinition = null;
    var reducedRule = _reduced.default.fromIndirectlyLeftRecursiveRule(indirectlyLeftRecursiveRule);
    if (reducedRule !== null) {
        var indirectlyLeftRecursiveRuleDefinitions = indirectlyLeftRecursiveRule.getDefinitions(), lastIndirectlyLeftRecursiveRuleDefinition = last(indirectlyLeftRecursiveRuleDefinitions);
        reducedLeftRecursiveDefinition = lastIndirectlyLeftRecursiveRuleDefinition; ///
        var reducedRuleName = reducedRule.getName();
        ruleMap[reducedRuleName] = reducedRule;
    }
    return reducedLeftRecursiveDefinition;
}
function retrieveIndirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap) {
    var indirectlyLeftRecursiveRules = (0, _rules.retrieveLeftRecursiveRules)(leftRecursiveDefinitions, _indirectly.default, ruleMap);
    return indirectlyLeftRecursiveRules;
}
function mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions) {
    var indirectlyLeftRecursiveDefinition = (0, _definitions.mergeLeftRecursiveDefinitions)(indirectlyLeftRecursiveDefinitions, function(parts, ruleName) {
        var indirectlyLeftRecursiveDefinition;
        var firstIndirectlyLeftRecursiveDefinition = first(indirectlyLeftRecursiveDefinitions);
        indirectlyLeftRecursiveDefinition = firstIndirectlyLeftRecursiveDefinition; ///
        var leftRecursiveDefinitions = indirectlyLeftRecursiveDefinition.getLeftRecursiveDefinitions();
        indirectlyLeftRecursiveDefinition = _indirectly.default.fromPartsRuleNameAndLeftRecursiveDefinitions(parts, ruleName, leftRecursiveDefinitions);
        return indirectlyLeftRecursiveDefinition;
    });
    return indirectlyLeftRecursiveDefinition;
}
function rewriteIndirectlyLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, reducedLeftRecursiveDefinition, leftRecursiveDefinition) {
    var replacementDefinitions = [];
    indirectlyLeftRecursiveDefinition = _indirectly.default.fromIndirectlyLeftRecursiveDefinitionAndLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, leftRecursiveDefinition); ///
    replacementDefinitions.push(indirectlyLeftRecursiveDefinition);
    if (reducedLeftRecursiveDefinition !== null) {
        leftRecursiveDefinition = _left.default.fromReducedLeftRecursiveDefinitionAndLeftRecursiveDefinition(reducedLeftRecursiveDefinition, leftRecursiveDefinition); ///
        replacementDefinitions.push(leftRecursiveDefinition);
    }
    return replacementDefinitions;
}
function retrieveIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, leftRecursiveRuleName) {
    var indirectlyLeftRecursiveDefinitions = (0, _definitions.retrieveLeftRecursiveDefinitions)(indirectlyLeftRecursiveRule, _indirectly.default, function(indirectlyLeftRecursiveDefinition) {
        var leftRecursiveRuleNames = indirectlyLeftRecursiveDefinition.getLeftRecursiveRuleNames(), firstLeftRecursiveRuleName = first(leftRecursiveRuleNames), ruleName = firstLeftRecursiveRuleName; ///
        if (ruleName === leftRecursiveRuleName) {
            return true;
        }
    });
    return indirectlyLeftRecursiveDefinitions;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5pbXBvcnQgUmVkdWNlZFJ1bGUgZnJvbSBcIi4vcnVsZS9yZWR1Y2VkXCI7XG5pbXBvcnQgUmVwZWF0ZWRSdWxlIGZyb20gXCIuL3J1bGUvcmVwZWF0ZWRcIjtcbmltcG9ydCBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0XCI7XG5pbXBvcnQgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0L2RpcmVjdGx5XCI7XG5pbXBvcnQgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIGZyb20gXCIuL2RlZmluaXRpb24vcmVjdXJzaXZlL2xlZnQvaW5kaXJlY3RseVwiO1xuXG5pbXBvcnQgeyByZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyB9IGZyb20gXCIuL3V0aWxpdGllcy9ydWxlc1wiO1xuaW1wb3J0IHsgcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIH0gZnJvbSBcIi4vdXRpbGl0aWVzL3J1bGVOYW1lc1wiO1xuaW1wb3J0IHsgbWVyZ2VMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIH0gZnJvbSBcIi4vdXRpbGl0aWVzL2RlZmluaXRpb25zXCI7XG5cbmNvbnN0IHsgZmlyc3QsIGxhc3QgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBlbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24obGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKSB7XG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMgPSByZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKTtcblxuICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzLmZvckVhY2goKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSkgPT4ge1xuICAgIHJld3JpdGVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLCBydWxlTWFwKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJld3JpdGVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLCBydWxlTWFwKSB7XG4gIGNvbnN0IHJlZHVjZWRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IHJlZHVjZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZShpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIHJ1bGVNYXApLFxuICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzID0gcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSwgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCAoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSA9PiB7XG4gICAgICAgICAgY29uc3QgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKCksXG4gICAgICAgICAgICAgICAgZmlyc3RMZWZ0UmVjdXJzaXZlUnVsZU5hbWUgPSBmaXJzdChsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKSxcbiAgICAgICAgICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZU5hbWUgPSBmaXJzdExlZnRSZWN1cnNpdmVSdWxlTmFtZTsgLy8vXG5cbiAgICAgICAgICByZXR1cm4gbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lO1xuICAgICAgICB9KTtcblxuICBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzLmZvckVhY2goKGxlZnRSZWN1cnNpdmVSdWxlTmFtZSwgaW5kZXgpID0+IHtcbiAgICBjb25zdCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zID0gcmV0cmlldmVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSwgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKTtcblxuICAgIGxldCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBtZXJnZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyk7XG5cbiAgICBsZXQgcmVwZWF0ZWRSdWxlTmFtZSA9IG51bGw7XG5cbiAgICBjb25zdCByZXBlYXRlZFJ1bGUgPSBSZXBlYXRlZFJ1bGUuZnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkFuZEluZGV4KGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgaW5kZXgpO1xuXG4gICAgaWYgKHJlcGVhdGVkUnVsZSAhPT0gbnVsbCkge1xuICAgICAgcmVwZWF0ZWRSdWxlTmFtZSA9IHJlcGVhdGVkUnVsZS5nZXROYW1lKCk7XG5cbiAgICAgIHJ1bGVNYXBbcmVwZWF0ZWRSdWxlTmFtZV0gPSByZXBlYXRlZFJ1bGU7XG4gICAgfVxuXG4gICAgbGV0IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uO1xuXG4gICAgY29uc3QgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldExlZnRSZWN1cnNpdmVEZWZpbml0aW9ucygpLFxuICAgICAgICAgIGxhc3RMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGxhc3QobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKTtcblxuICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gbGFzdExlZnRSZWN1cnNpdmVEZWZpbml0aW9uOyAgLy8vXG5cbiAgICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkFuZFJlcGVhdGVkUnVsZU5hbWUoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZXBlYXRlZFJ1bGVOYW1lKTtcblxuICAgIGNvbnN0IHJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICByZXBsYWNlZERlZmluaXRpb24gPSBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgICAgcmVwbGFjZW1lbnREZWZpbml0aW9ucyA9IHJld3JpdGVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSxcbiAgICAgICAgICBydWxlID0gcnVsZU1hcFtydWxlTmFtZV07XG5cbiAgICBydWxlLnJlcGxhY2VEZWZpbml0aW9uKHJlcGxhY2VkRGVmaW5pdGlvbiwgLi4ucmVwbGFjZW1lbnREZWZpbml0aW9ucyk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZWR1Y2VJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLCBydWxlTWFwKSB7XG4gIGxldCByZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBudWxsO1xuXG4gIGNvbnN0IHJlZHVjZWRSdWxlID0gUmVkdWNlZFJ1bGUuZnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZShpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUpO1xuXG4gIGlmIChyZWR1Y2VkUnVsZSAhPT0gbnVsbCkge1xuICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURlZmluaXRpb25zID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLmdldERlZmluaXRpb25zKCksXG4gICAgICAgICAgbGFzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURlZmluaXRpb24gPSBsYXN0KGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURlZmluaXRpb25zKTtcblxuICAgIHJlZHVjZWRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGxhc3RJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEZWZpbml0aW9uOyAvLy9cblxuICAgIGNvbnN0IHJlZHVjZWRSdWxlTmFtZSA9IHJlZHVjZWRSdWxlLmdldE5hbWUoKTtcblxuICAgIHJ1bGVNYXBbcmVkdWNlZFJ1bGVOYW1lXSA9IHJlZHVjZWRSdWxlO1xuICB9XG5cbiAgcmV0dXJuIHJlZHVjZWRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjtcbn1cblxuZnVuY3Rpb24gcmV0cmlldmVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCkge1xuICBjb25zdCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzID0gcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJ1bGVNYXApO1xuXG4gIHJldHVybiBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzO1xufVxuXG5mdW5jdGlvbiBtZXJnZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucykge1xuICBjb25zdCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBtZXJnZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCAocGFydHMsIHJ1bGVOYW1lKSA9PiB7XG4gICAgbGV0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjtcblxuICAgIGNvbnN0IGZpcnN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gZmlyc3QoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyk7XG5cbiAgICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjsgLy8vXG5cbiAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKCk7XG5cbiAgICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbVBhcnRzUnVsZU5hbWVBbmRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMocGFydHMsIHJ1bGVOYW1lLCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpO1xuXG4gICAgcmV0dXJuIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjtcbiAgfSk7XG5cbiAgcmV0dXJuIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjtcbn1cblxuZnVuY3Rpb24gcmV3cml0ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJlZHVjZWRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pIHtcbiAgY29uc3QgcmVwbGFjZW1lbnREZWZpbml0aW9ucyA9IFtdO1xuXG4gIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7ICAvLy9cblxuICByZXBsYWNlbWVudERlZmluaXRpb25zLnB1c2goaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcblxuICBpZiAocmVkdWNlZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uICE9PSBudWxsKSB7XG4gICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUmVkdWNlZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24ocmVkdWNlZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7ICAvLy9cblxuICAgIHJlcGxhY2VtZW50RGVmaW5pdGlvbnMucHVzaChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG4gIH1cblxuICByZXR1cm4gcmVwbGFjZW1lbnREZWZpbml0aW9ucztcbn1cblxuZnVuY3Rpb24gcmV0cmlldmVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSwgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKSB7XG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSByZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4ge1xuICAgIGNvbnN0IGxlZnRSZWN1cnNpdmVSdWxlTmFtZXMgPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcygpLFxuICAgICAgICAgIGZpcnN0TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lID0gZmlyc3QobGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyksXG4gICAgICAgICAgcnVsZU5hbWUgPSBmaXJzdExlZnRSZWN1cnNpdmVSdWxlTmFtZTsgLy8vXG5cbiAgICBpZiAocnVsZU5hbWUgPT09IGxlZnRSZWN1cnNpdmVSdWxlTmFtZSkge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucztcbn1cbiJdLCJuYW1lcyI6WyJlbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24iLCJmaXJzdCIsImFycmF5VXRpbGl0aWVzIiwibGFzdCIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJ1bGVNYXAiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzIiwicmV0cmlldmVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzIiwiZm9yRWFjaCIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSIsInJld3JpdGVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJyZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJyZWR1Y2VJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIiwicmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIiwiSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZ2V0TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyIsImZpcnN0TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lIiwibGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lIiwiaW5kZXgiLCJydWxlIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJldHJpZXZlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsIm1lcmdlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJlcGVhdGVkUnVsZU5hbWUiLCJyZXBlYXRlZFJ1bGUiLCJSZXBlYXRlZFJ1bGUiLCJmcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kSW5kZXgiLCJnZXROYW1lIiwibGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJnZXRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJsYXN0TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kUmVwZWF0ZWRSdWxlTmFtZSIsInJ1bGVOYW1lIiwiZ2V0UnVsZU5hbWUiLCJyZXBsYWNlZERlZmluaXRpb24iLCJyZXBsYWNlbWVudERlZmluaXRpb25zIiwicmV3cml0ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsInJlcGxhY2VEZWZpbml0aW9uIiwicmVkdWNlZFJ1bGUiLCJSZWR1Y2VkUnVsZSIsImZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEZWZpbml0aW9ucyIsImdldERlZmluaXRpb25zIiwibGFzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURlZmluaXRpb24iLCJyZWR1Y2VkUnVsZU5hbWUiLCJyZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyIsIm1lcmdlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwicGFydHMiLCJmaXJzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImZyb21QYXJ0c1J1bGVOYW1lQW5kTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiZnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkFuZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicHVzaCIsIkxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZnJvbVJlZHVjZWRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkFuZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7Ozs7O2VBZ0JXQSw4QkFBOEI7Ozs7eUJBZHZCLFdBQVc7OENBRWxCLGdCQUFnQjsrQ0FDZixpQkFBaUI7MkNBQ04sNkJBQTZCOytDQUNyQixzQ0FBc0M7aURBQ3BDLHdDQUF3QztxQkFFM0MsbUJBQW1CO3lCQUNmLHVCQUF1QjsyQkFDVSx5QkFBeUI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFFekcsSUFBUUMsS0FBSyxHQUFXQyxVQUFjLGVBQUEsQ0FBOUJELEtBQUssRUFBRUUsSUFBSSxHQUFLRCxVQUFjLGVBQUEsQ0FBdkJDLElBQUksQUFBb0I7QUFFeEIsU0FBU0gsOEJBQThCLENBQUNJLHdCQUF3QixFQUFFQyxPQUFPLEVBQUU7SUFDeEYsSUFBTUMsNEJBQTRCLEdBQUdDLG9DQUFvQyxDQUFDSCx3QkFBd0IsRUFBRUMsT0FBTyxDQUFDLEFBQUM7SUFFN0dDLDRCQUE0QixDQUFDRSxPQUFPLENBQUMsU0FBQ0MsMkJBQTJCLEVBQUs7UUFDcEVDLGtDQUFrQyxDQUFDRCwyQkFBMkIsRUFBRUosT0FBTyxDQUFDLENBQUM7S0FDMUUsQ0FBQyxDQUFDO0NBQ0o7QUFFRCxTQUFTSyxrQ0FBa0MsQ0FBQ0QsMkJBQTJCLEVBQUVKLE9BQU8sRUFBRTtJQUNoRixJQUFNTSw4QkFBOEIsR0FBR0MsaUNBQWlDLENBQUNILDJCQUEyQixFQUFFSixPQUFPLENBQUMsRUFDeEdRLHNCQUFzQixHQUFHQyxJQUFBQSxVQUE4QiwrQkFBQSxFQUFDTCwyQkFBMkIsRUFBRU0sV0FBaUMsUUFBQSxFQUFFLFNBQUNDLGlDQUFpQyxFQUFLO1FBQzdKLElBQU1ILHNCQUFzQixHQUFHRyxpQ0FBaUMsQ0FBQ0MseUJBQXlC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