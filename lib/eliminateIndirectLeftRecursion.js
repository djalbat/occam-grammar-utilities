"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = eliminateIndirectLeftRecursion;
var _necessary = require("necessary");
var _reduced = _interopRequireDefault(require("./rule/reduced"));
var _repeated = _interopRequireDefault(require("./rule/repeated"));
var _left = _interopRequireDefault(require("./definition/recursive/left"));
var _directly = _interopRequireDefault(require("./definition/recursive/left/directly"));
var _indirectly = _interopRequireDefault(require("./definition/recursive/left/indirectly"));
var _rules = require("./utilities/rules");
var _ruleNames = require("./utilities/ruleNames");
var _definitions = require("./utilities/definitions");
function eliminateIndirectLeftRecursion(leftRecursiveDefinitions, ruleMap) {
    var indirectlyLeftRecursiveRules = retrieveIndirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap);
    indirectlyLeftRecursiveRules.forEach(function(indirectlyLeftRecursiveRule) {
        var reducedRule = _reduced.default.fromIndirectlyLeftRecursiveRule(indirectlyLeftRecursiveRule), reducedRuleName = reducedRule.getName();
        ruleMap[reducedRuleName] = reducedRule;
        var implicitlyLeftRecursiveRuleNames = retrieveImplicitlyLeftRecursiveRuleNames(indirectlyLeftRecursiveRule), indirectlyLeftRecursiveRuleDefinitions = indirectlyLeftRecursiveRule.getDefinitions(), lastIndirectlyLeftRecursiveRuleDefinition = last(indirectlyLeftRecursiveRuleDefinitions);
        implicitlyLeftRecursiveRuleNames.forEach(function(implicitlyLeftRecursiveRuleName, index) {
            var _implicitlyLeftRecursiveRule;
            var indirectlyLeftRecursiveDefinitions = retrieveIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, implicitlyLeftRecursiveRuleName), indirectlyLeftRecursiveDefinition = mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions);
            var repeatedRule = _repeated.default.fromIndirectlyLeftRecursiveDefinitionAndIndex(indirectlyLeftRecursiveDefinition, index), repeatedRuleName = repeatedRule.getName();
            ruleMap[repeatedRuleName] = repeatedRule;
            var rewrittenIndirectlyLeftRecursiveDefinition = rewriteIndirectlyLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, repeatedRuleName), implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(), replacedDefinition = implicitlyLeftRecursiveDefinition, replacementDefinitions = rewriteImplicitlyLeftRecursiveDefinition(implicitlyLeftRecursiveDefinition, rewrittenIndirectlyLeftRecursiveDefinition, lastIndirectlyLeftRecursiveRuleDefinition), implicitlyLeftRecursiveRule = ruleMap[implicitlyLeftRecursiveRuleName];
            (_implicitlyLeftRecursiveRule = implicitlyLeftRecursiveRule).replaceDefinition.apply(_implicitlyLeftRecursiveRule, [
                replacedDefinition
            ].concat(_toConsumableArray(replacementDefinitions)));
            var leftRecursiveDefinition = first(replacementDefinitions); ///
            leftRecursiveDefinitions.push(leftRecursiveDefinition);
        });
    });
}
function _arrayLikeToArray(arr, len) {
    if (len == null || len > arr.length) len = arr.length;
    for(var i = 0, arr2 = new Array(len); i < len; i++)arr2[i] = arr[i];
    return arr2;
}
function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) return _arrayLikeToArray(arr);
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _iterableToArray(iter) {
    if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}
function _unsupportedIterableToArray(o, minLen) {
    if (!o) return;
    if (typeof o === "string") return _arrayLikeToArray(o, minLen);
    var n = Object.prototype.toString.call(o).slice(8, -1);
    if (n === "Object" && o.constructor) n = o.constructor.name;
    if (n === "Map" || n === "Set") return Array.from(n);
    if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}
var last = _necessary.arrayUtilities.last, first = _necessary.arrayUtilities.first;
function retrieveIndirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap) {
    var indirectlyLeftRecursiveRules = (0, _rules).retrieveLeftRecursiveRules(leftRecursiveDefinitions, _indirectly.default, ruleMap);
    return indirectlyLeftRecursiveRules;
}
function mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions) {
    var indirectlyLeftRecursiveDefinition = (0, _definitions).mergeLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions, _indirectly.default);
    return indirectlyLeftRecursiveDefinition;
}
function retrieveImplicitlyLeftRecursiveRuleNames(indirectlyLeftRecursiveRule) {
    var callback = function callback(indirectlyLeftRecursiveDefinition) {
        var implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(), ruleName = implicitlyLeftRecursiveDefinition.getRuleName();
        return ruleName;
    };
    var implicitlyLeftRecursiveRuleNames = (0, _ruleNames).retrieveLeftRecursiveRuleNames(indirectlyLeftRecursiveRule, _indirectly.default, callback);
    return implicitlyLeftRecursiveRuleNames;
}
function rewriteIndirectlyLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, repeatedRuleName) {
    var directlyLeftRecursiveDefinition = _directly.default.fromIndirectlyLeftRecursiveDefinitionAndRepeatedRuleName(indirectlyLeftRecursiveDefinition, repeatedRuleName), rewrittenIndirectlyLeftRecursiveDefinition = directlyLeftRecursiveDefinition; ///
    return rewrittenIndirectlyLeftRecursiveDefinition;
}
function rewriteImplicitlyLeftRecursiveDefinition(implicitlyLeftRecursiveDefinition, rewrittenIndirectlyLeftRecursiveDefinition, lastIndirectlyLeftRecursiveRuleDefinition) {
    var definition;
    definition = rewrittenIndirectlyLeftRecursiveDefinition; ///
    var directlyLeftRecursiveDefinition = _directly.default.fromImplicitlyLeftRecursiveDefinitionAndDefinition(implicitlyLeftRecursiveDefinition, definition);
    definition = lastIndirectlyLeftRecursiveRuleDefinition; ///
    var leftRecursiveDefinition = _left.default.fromImplicitlyLeftRecursiveDefinitionAndDefinition(implicitlyLeftRecursiveDefinition, definition);
    var replacementDefinitions = [
        directlyLeftRecursiveDefinition,
        leftRecursiveDefinition
    ];
    return replacementDefinitions;
}
function retrieveIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, implicitlyLeftRecursiveRuleName) {
    var callback = function callback(indirectlyLeftRecursiveDefinition) {
        var implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(), ruleName = implicitlyLeftRecursiveDefinition.getRuleName();
        if (ruleName === implicitlyLeftRecursiveRuleName) {
            return true;
        }
    };
    var indirectlyLeftRecursiveDefinitions = (0, _definitions).retrieveLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, _indirectly.default, callback);
    return indirectlyLeftRecursiveDefinitions;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5pbXBvcnQgUmVkdWNlZFJ1bGUgZnJvbSBcIi4vcnVsZS9yZWR1Y2VkXCI7XG5pbXBvcnQgUmVwZWF0ZWRSdWxlIGZyb20gXCIuL3J1bGUvcmVwZWF0ZWRcIjtcbmltcG9ydCBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0XCI7XG5pbXBvcnQgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0L2RpcmVjdGx5XCI7XG5pbXBvcnQgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIGZyb20gXCIuL2RlZmluaXRpb24vcmVjdXJzaXZlL2xlZnQvaW5kaXJlY3RseVwiO1xuXG5pbXBvcnQgeyByZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyB9IGZyb20gXCIuL3V0aWxpdGllcy9ydWxlc1wiO1xuaW1wb3J0IHsgcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIH0gZnJvbSBcIi4vdXRpbGl0aWVzL3J1bGVOYW1lc1wiO1xuaW1wb3J0IHsgbWVyZ2VMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIH0gZnJvbSBcIi4vdXRpbGl0aWVzL2RlZmluaXRpb25zXCI7XG5cbmNvbnN0IHsgbGFzdCwgZmlyc3QgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBlbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24obGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKSB7XG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMgPSByZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKTtcblxuICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzLmZvckVhY2goKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSkgPT4ge1xuICAgIGNvbnN0IHJlZHVjZWRSdWxlID0gUmVkdWNlZFJ1bGUuZnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZShpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUpLFxuICAgICAgICAgIHJlZHVjZWRSdWxlTmFtZSA9IHJlZHVjZWRSdWxlLmdldE5hbWUoKTtcblxuICAgIHJ1bGVNYXBbcmVkdWNlZFJ1bGVOYW1lXSA9IHJlZHVjZWRSdWxlO1xuXG4gICAgY29uc3QgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMgPSByZXRyaWV2ZUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSksXG4gICAgICAgICAgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbnMgPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUuZ2V0RGVmaW5pdGlvbnMoKSxcbiAgICAgICAgICBsYXN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbiA9IGxhc3QoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbnMpO1xuXG4gICAgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMuZm9yRWFjaCgoaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZSwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSByZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLCBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKSxcbiAgICAgICAgICAgIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IG1lcmdlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKTtcblxuICAgICAgY29uc3QgcmVwZWF0ZWRSdWxlID0gUmVwZWF0ZWRSdWxlLmZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbmRJbmRleChpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIGluZGV4KSxcbiAgICAgICAgICAgIHJlcGVhdGVkUnVsZU5hbWUgPSByZXBlYXRlZFJ1bGUuZ2V0TmFtZSgpO1xuXG4gICAgICBydWxlTWFwW3JlcGVhdGVkUnVsZU5hbWVdID0gcmVwZWF0ZWRSdWxlO1xuXG4gICAgICBjb25zdCByZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSByZXdyaXRlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcmVwZWF0ZWRSdWxlTmFtZSksXG4gICAgICAgICAgICBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0SW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKCksXG4gICAgICAgICAgICByZXBsYWNlZERlZmluaXRpb24gPSBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIC8vL1xuICAgICAgICAgICAgcmVwbGFjZW1lbnREZWZpbml0aW9ucyA9IHJld3JpdGVJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIGxhc3RJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEZWZpbml0aW9uKSxcbiAgICAgICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZSA9IHJ1bGVNYXBbaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZV07XG5cbiAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZS5yZXBsYWNlRGVmaW5pdGlvbihyZXBsYWNlZERlZmluaXRpb24sIC4uLnJlcGxhY2VtZW50RGVmaW5pdGlvbnMpO1xuXG4gICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KHJlcGxhY2VtZW50RGVmaW5pdGlvbnMpOyAvLy9cblxuICAgICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLnB1c2gobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmV0cmlldmVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCkge1xuICBjb25zdCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzID0gcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJ1bGVNYXApO1xuXG4gIHJldHVybiBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzO1xufVxuXG5mdW5jdGlvbiBtZXJnZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucykge1xuICBjb25zdCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBtZXJnZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pO1xuXG4gIHJldHVybiBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlSW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlKSB7XG4gIGNvbnN0IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzID0gcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSwgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBjYWxsYmFjayk7XG5cbiAgZnVuY3Rpb24gY2FsbGJhY2soaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSB7XG4gICAgY29uc3QgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldEltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbigpLFxuICAgICAgICAgIHJ1bGVOYW1lID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCk7XG5cbiAgICByZXR1cm4gcnVsZU5hbWU7XG4gIH1cblxuICByZXR1cm4gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXM7XG59XG5cbmZ1bmN0aW9uIHJld3JpdGVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZXBlYXRlZFJ1bGVOYW1lKSB7XG4gIGNvbnN0IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbmRSZXBlYXRlZFJ1bGVOYW1lKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcmVwZWF0ZWRSdWxlTmFtZSksXG4gICAgICAgIHJld3JpdHRlbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247IC8vL1xuXG4gIHJldHVybiByZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG59XG5cbmZ1bmN0aW9uIHJld3JpdGVJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIGxhc3RJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEZWZpbml0aW9uKSB7XG4gIGxldCBkZWZpbml0aW9uO1xuXG4gIGRlZmluaXRpb24gPSByZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247IC8vL1xuXG4gIGNvbnN0IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbmREZWZpbml0aW9uKGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgZGVmaW5pdGlvbik7XG5cbiAgZGVmaW5pdGlvbiA9IGxhc3RJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEZWZpbml0aW9uOyAgLy8vXG5cbiAgY29uc3QgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kRGVmaW5pdGlvbihpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIGRlZmluaXRpb24pO1xuXG4gIGNvbnN0IHJlcGxhY2VtZW50RGVmaW5pdGlvbnMgPSBbXG4gICAgICAgICAgZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbixcbiAgICAgICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvblxuICAgICAgICBdO1xuXG4gIHJldHVybiByZXBsYWNlbWVudERlZmluaXRpb25zO1xufVxuXG5mdW5jdGlvbiByZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLCBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKSB7XG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSByZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgY2FsbGJhY2spO1xuXG4gIGZ1bmN0aW9uIGNhbGxiYWNrKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikge1xuICAgIGNvbnN0IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oKSxcbiAgICAgICAgICBydWxlTmFtZSA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRSdWxlTmFtZSgpO1xuXG4gICAgaWYgKHJ1bGVOYW1lID09PSBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucztcbn1cbiJdLCJuYW1lcyI6WyJlbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24iLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJydWxlTWFwIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlcyIsInJldHJpZXZlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlcyIsImZvckVhY2giLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJyZWR1Y2VkUnVsZSIsIlJlZHVjZWRSdWxlIiwiZnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSIsInJlZHVjZWRSdWxlTmFtZSIsImdldE5hbWUiLCJpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyIsInJldHJpZXZlSW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEZWZpbml0aW9ucyIsImdldERlZmluaXRpb25zIiwibGFzdEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURlZmluaXRpb24iLCJsYXN0IiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZSIsImluZGV4IiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJldHJpZXZlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIm1lcmdlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJlcGVhdGVkUnVsZSIsIlJlcGVhdGVkUnVsZSIsImZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbmRJbmRleCIsInJlcGVhdGVkUnVsZU5hbWUiLCJyZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJyZXdyaXRlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZ2V0SW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmVwbGFjZWREZWZpbml0aW9uIiwicmVwbGFjZW1lbnREZWZpbml0aW9ucyIsInJld3JpdGVJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJyZXBsYWNlRGVmaW5pdGlvbiIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZmlyc3QiLCJwdXNoIiwiYXJyYXlVdGlsaXRpZXMiLCJyZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyIsIkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIm1lcmdlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiY2FsbGJhY2siLCJydWxlTmFtZSIsImdldFJ1bGVOYW1lIiwicmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIiwiZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIkRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kUmVwZWF0ZWRSdWxlTmFtZSIsImRlZmluaXRpb24iLCJmcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kRGVmaW5pdGlvbiIsIkxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7OztrQkFnQldBLDhCQUE4QjtBQWR2QixJQUFBLFVBQVcsV0FBWCxXQUFXLENBQUE7QUFFbEIsSUFBQSxRQUFnQixrQ0FBaEIsZ0JBQWdCLEVBQUE7QUFDZixJQUFBLFNBQWlCLGtDQUFqQixpQkFBaUIsRUFBQTtBQUNOLElBQUEsS0FBNkIsa0NBQTdCLDZCQUE2QixFQUFBO0FBQ3JCLElBQUEsU0FBc0Msa0NBQXRDLHNDQUFzQyxFQUFBO0FBQ3BDLElBQUEsV0FBd0Msa0NBQXhDLHdDQUF3QyxFQUFBO0FBRTNDLElBQUEsTUFBbUIsV0FBbkIsbUJBQW1CLENBQUE7QUFDZixJQUFBLFVBQXVCLFdBQXZCLHVCQUF1QixDQUFBO0FBQ1UsSUFBQSxZQUF5QixXQUF6Qix5QkFBeUIsQ0FBQTtBQUkxRixTQUFTQSw4QkFBOEIsQ0FB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