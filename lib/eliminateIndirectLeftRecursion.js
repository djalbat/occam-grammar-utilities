"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = eliminateIndirectLeftRecursion;
var _necessary = require("necessary");
var _reduced = _interopRequireDefault(require("./rule/reduced"));
var _repeated = _interopRequireDefault(require("./rule/repeated"));
var _left = _interopRequireDefault(require("./definition/recursive/left"));
var _directly = _interopRequireDefault(require("./definition/recursive/left/directly"));
var _indirectly = _interopRequireDefault(require("./definition/recursive/left/indirectly"));
var _rules = require("./utilities/rules");
var _ruleNames = require("./utilities/ruleNames");
var _definitions = require("./utilities/definitions");
function eliminateIndirectLeftRecursion(leftRecursiveDefinitions, ruleMap) {
    var indirectlyLeftRecursiveRules = retrieveIndirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap);
    indirectlyLeftRecursiveRules.forEach(function(indirectlyLeftRecursiveRule) {
        var reducedRuleName = null, reducedLeftRecursiveDefinition = null;
        var reducedRule = _reduced.default.fromIndirectlyLeftRecursiveRule(indirectlyLeftRecursiveRule), implicitlyLeftRecursiveRuleNames = retrieveImplicitlyLeftRecursiveRuleNames(indirectlyLeftRecursiveRule);
        if (reducedRule !== null) {
            var indirectlyLeftRecursiveRuleDefinitions = indirectlyLeftRecursiveRule.getDefinitions(), lastIndirectlyLeftRecursiveRuleDefinition = last(indirectlyLeftRecursiveRuleDefinitions);
            reducedLeftRecursiveDefinition = lastIndirectlyLeftRecursiveRuleDefinition; ///
            reducedRuleName = reducedRule.getName();
            ruleMap[reducedRuleName] = reducedRule;
        }
        implicitlyLeftRecursiveRuleNames.forEach(function(implicitlyLeftRecursiveRuleName, index) {
            var _implicitlyLeftRecursiveRule;
            var indirectlyLeftRecursiveDefinitions = retrieveIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, implicitlyLeftRecursiveRuleName), indirectlyLeftRecursiveDefinition = mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions);
            var repeatedRuleName = null;
            var repeatedRule = _repeated.default.fromIndirectlyLeftRecursiveDefinitionAndIndex(indirectlyLeftRecursiveDefinition, index);
            if (repeatedRule !== null) {
                repeatedRuleName = repeatedRule.getName();
                ruleMap[repeatedRuleName] = repeatedRule;
            }
            var rewrittenIndirectlyLeftRecursiveDefinition = rewriteIndirectlyLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, repeatedRuleName), implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(), replacedDefinition = implicitlyLeftRecursiveDefinition, replacementDefinitions = rewriteImplicitlyLeftRecursiveDefinition(implicitlyLeftRecursiveDefinition, rewrittenIndirectlyLeftRecursiveDefinition, reducedLeftRecursiveDefinition), implicitlyLeftRecursiveRule = ruleMap[implicitlyLeftRecursiveRuleName];
            (_implicitlyLeftRecursiveRule = implicitlyLeftRecursiveRule).replaceDefinition.apply(_implicitlyLeftRecursiveRule, [
                replacedDefinition
            ].concat(_toConsumableArray(replacementDefinitions)));
            var leftRecursiveDefinition = first(replacementDefinitions); ///
            leftRecursiveDefinitions.push(leftRecursiveDefinition);
        });
    });
}
function _arrayLikeToArray(arr, len) {
    if (len == null || len > arr.length) len = arr.length;
    for(var i = 0, arr2 = new Array(len); i < len; i++)arr2[i] = arr[i];
    return arr2;
}
function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) return _arrayLikeToArray(arr);
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _iterableToArray(iter) {
    if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}
function _unsupportedIterableToArray(o, minLen) {
    if (!o) return;
    if (typeof o === "string") return _arrayLikeToArray(o, minLen);
    var n = Object.prototype.toString.call(o).slice(8, -1);
    if (n === "Object" && o.constructor) n = o.constructor.name;
    if (n === "Map" || n === "Set") return Array.from(n);
    if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}
var last = _necessary.arrayUtilities.last, first = _necessary.arrayUtilities.first;
function retrieveIndirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap) {
    var indirectlyLeftRecursiveRules = (0, _rules).retrieveLeftRecursiveRules(leftRecursiveDefinitions, _indirectly.default, ruleMap);
    return indirectlyLeftRecursiveRules;
}
function mergeIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions) {
    var indirectlyLeftRecursiveDefinition = (0, _definitions).mergeLeftRecursiveDefinitions(indirectlyLeftRecursiveDefinitions, _indirectly.default);
    return indirectlyLeftRecursiveDefinition;
}
function retrieveImplicitlyLeftRecursiveRuleNames(indirectlyLeftRecursiveRule) {
    var callback = function callback(indirectlyLeftRecursiveDefinition) {
        var implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(), ruleName = implicitlyLeftRecursiveDefinition.getRuleName();
        return ruleName;
    };
    var implicitlyLeftRecursiveRuleNames = (0, _ruleNames).retrieveLeftRecursiveRuleNames(indirectlyLeftRecursiveRule, _indirectly.default, callback);
    return implicitlyLeftRecursiveRuleNames;
}
function rewriteIndirectlyLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, repeatedRuleName) {
    var directlyLeftRecursiveDefinition = _directly.default.fromIndirectlyLeftRecursiveDefinitionAndRepeatedRuleName(indirectlyLeftRecursiveDefinition, repeatedRuleName), rewrittenIndirectlyLeftRecursiveDefinition = directlyLeftRecursiveDefinition; ///
    return rewrittenIndirectlyLeftRecursiveDefinition;
}
function rewriteImplicitlyLeftRecursiveDefinition(implicitlyLeftRecursiveDefinition, rewrittenIndirectlyLeftRecursiveDefinition, reducedLeftRecursiveDefinition) {
    var replacementDefinitions = [];
    var definition = rewrittenIndirectlyLeftRecursiveDefinition, directlyLeftRecursiveDefinition = _directly.default.fromImplicitlyLeftRecursiveDefinitionAndDefinition(implicitlyLeftRecursiveDefinition, definition);
    replacementDefinitions.push(directlyLeftRecursiveDefinition);
    if (reducedLeftRecursiveDefinition !== null) {
        var definition1 = reducedLeftRecursiveDefinition, leftRecursiveDefinition = _left.default.fromImplicitlyLeftRecursiveDefinitionAndDefinition(implicitlyLeftRecursiveDefinition, definition1);
        replacementDefinitions.push(leftRecursiveDefinition);
    }
    return replacementDefinitions;
}
function retrieveIndirectlyLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, implicitlyLeftRecursiveRuleName) {
    var callback = function callback(indirectlyLeftRecursiveDefinition) {
        var implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(), ruleName = implicitlyLeftRecursiveDefinition.getRuleName();
        if (ruleName === implicitlyLeftRecursiveRuleName) {
            return true;
        }
    };
    var indirectlyLeftRecursiveDefinitions = (0, _definitions).retrieveLeftRecursiveDefinitions(indirectlyLeftRecursiveRule, _indirectly.default, callback);
    return indirectlyLeftRecursiveDefinitions;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24uanMiXSwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCB7IGFycmF5VXRpbGl0aWVzIH0gZnJvbSBcIm5lY2Vzc2FyeVwiO1xuXG5pbXBvcnQgUmVkdWNlZFJ1bGUgZnJvbSBcIi4vcnVsZS9yZWR1Y2VkXCI7XG5pbXBvcnQgUmVwZWF0ZWRSdWxlIGZyb20gXCIuL3J1bGUvcmVwZWF0ZWRcIjtcbmltcG9ydCBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0XCI7XG5pbXBvcnQgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0L2RpcmVjdGx5XCI7XG5pbXBvcnQgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIGZyb20gXCIuL2RlZmluaXRpb24vcmVjdXJzaXZlL2xlZnQvaW5kaXJlY3RseVwiO1xuXG5pbXBvcnQgeyByZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyB9IGZyb20gXCIuL3V0aWxpdGllcy9ydWxlc1wiO1xuaW1wb3J0IHsgcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIH0gZnJvbSBcIi4vdXRpbGl0aWVzL3J1bGVOYW1lc1wiO1xuaW1wb3J0IHsgbWVyZ2VMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIH0gZnJvbSBcIi4vdXRpbGl0aWVzL2RlZmluaXRpb25zXCI7XG5cbmNvbnN0IHsgbGFzdCwgZmlyc3QgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBlbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24obGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKSB7XG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMgPSByZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKTtcblxuICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzLmZvckVhY2goKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSkgPT4ge1xuICAgIGxldCByZWR1Y2VkUnVsZU5hbWUgPSBudWxsLFxuICAgICAgICByZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBudWxsO1xuXG4gICAgY29uc3QgcmVkdWNlZFJ1bGUgPSBSZWR1Y2VkUnVsZS5mcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSksXG4gICAgICAgICAgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMgPSByZXRyaWV2ZUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSk7XG5cbiAgICBpZiAocmVkdWNlZFJ1bGUgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURlZmluaXRpb25zID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLmdldERlZmluaXRpb25zKCksXG4gICAgICAgICAgICBsYXN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbiA9IGxhc3QoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbnMpO1xuXG4gICAgICByZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBsYXN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbjsgLy8vXG5cbiAgICAgIHJlZHVjZWRSdWxlTmFtZSA9IHJlZHVjZWRSdWxlLmdldE5hbWUoKTtcblxuICAgICAgcnVsZU1hcFtyZWR1Y2VkUnVsZU5hbWVdID0gcmVkdWNlZFJ1bGU7XG4gICAgfVxuXG4gICAgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMuZm9yRWFjaCgoaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZSwgaW5kZXgpID0+IHtcbiAgICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSByZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLCBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKSxcbiAgICAgICAgICAgIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IG1lcmdlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKTtcblxuICAgICAgbGV0IHJlcGVhdGVkUnVsZU5hbWUgPSBudWxsO1xuXG4gICAgICBjb25zdCByZXBlYXRlZFJ1bGUgPSBSZXBlYXRlZFJ1bGUuZnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkFuZEluZGV4KGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgaW5kZXgpO1xuXG4gICAgICBpZiAocmVwZWF0ZWRSdWxlICE9PSBudWxsKSB7XG4gICAgICAgIHJlcGVhdGVkUnVsZU5hbWUgPSByZXBlYXRlZFJ1bGUuZ2V0TmFtZSgpO1xuXG4gICAgICAgIHJ1bGVNYXBbcmVwZWF0ZWRSdWxlTmFtZV0gPSByZXBlYXRlZFJ1bGU7XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IHJld3JpdHRlbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IHJld3JpdGVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZXBlYXRlZFJ1bGVOYW1lKSxcbiAgICAgICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oKSxcbiAgICAgICAgICAgIHJlcGxhY2VkRGVmaW5pdGlvbiA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgICAgICByZXBsYWNlbWVudERlZmluaXRpb25zID0gcmV3cml0ZUltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJld3JpdHRlbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcmVkdWNlZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSxcbiAgICAgICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZSA9IHJ1bGVNYXBbaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZV07XG5cbiAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZS5yZXBsYWNlRGVmaW5pdGlvbihyZXBsYWNlZERlZmluaXRpb24sIC4uLnJlcGxhY2VtZW50RGVmaW5pdGlvbnMpO1xuXG4gICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KHJlcGxhY2VtZW50RGVmaW5pdGlvbnMpOyAvLy9cblxuICAgICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLnB1c2gobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pO1xuICAgIH0pO1xuICB9KTtcbn1cblxuZnVuY3Rpb24gcmV0cmlldmVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCkge1xuICBjb25zdCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzID0gcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJ1bGVNYXApO1xuXG4gIHJldHVybiBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzO1xufVxuXG5mdW5jdGlvbiBtZXJnZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucykge1xuICBjb25zdCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBtZXJnZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pO1xuXG4gIHJldHVybiBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlSW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlKSB7XG4gIGNvbnN0IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzID0gcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSwgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBjYWxsYmFjayk7XG5cbiAgZnVuY3Rpb24gY2FsbGJhY2soaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSB7XG4gICAgY29uc3QgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldEltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbigpLFxuICAgICAgICAgIHJ1bGVOYW1lID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCk7XG5cbiAgICByZXR1cm4gcnVsZU5hbWU7XG4gIH1cblxuICByZXR1cm4gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZXM7XG59XG5cbmZ1bmN0aW9uIHJld3JpdGVJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZXBlYXRlZFJ1bGVOYW1lKSB7XG4gIGNvbnN0IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbmRSZXBlYXRlZFJ1bGVOYW1lKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcmVwZWF0ZWRSdWxlTmFtZSksXG4gICAgICAgIHJld3JpdHRlbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247IC8vL1xuXG4gIHJldHVybiByZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247XG59XG5cbmZ1bmN0aW9uIHJld3JpdGVJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCByZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJlZHVjZWRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikge1xuICBjb25zdCByZXBsYWNlbWVudERlZmluaXRpb25zID0gW107XG5cbiAgY29uc3QgZGVmaW5pdGlvbiA9IHJld3JpdHRlbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgIGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21JbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25BbmREZWZpbml0aW9uKGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgZGVmaW5pdGlvbik7XG5cbiAgcmVwbGFjZW1lbnREZWZpbml0aW9ucy5wdXNoKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pO1xuXG4gIGlmIChyZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gIT09IG51bGwpIHtcbiAgICBjb25zdCBkZWZpbml0aW9uID0gcmVkdWNlZExlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCAgLy8vXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kRGVmaW5pdGlvbihpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIGRlZmluaXRpb24pO1xuXG4gICAgcmVwbGFjZW1lbnREZWZpbml0aW9ucy5wdXNoKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcbiAgfVxuXG4gIHJldHVybiByZXBsYWNlbWVudERlZmluaXRpb25zO1xufVxuXG5mdW5jdGlvbiByZXRyaWV2ZUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlLCBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKSB7XG4gIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSByZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgY2FsbGJhY2spO1xuXG4gIGZ1bmN0aW9uIGNhbGxiYWNrKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikge1xuICAgIGNvbnN0IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oKSxcbiAgICAgICAgICBydWxlTmFtZSA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRSdWxlTmFtZSgpO1xuXG4gICAgaWYgKHJ1bGVOYW1lID09PSBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucztcbn1cbiJdLCJuYW1lcyI6WyJlbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24iLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJydWxlTWFwIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlcyIsInJldHJpZXZlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlcyIsImZvckVhY2giLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJyZWR1Y2VkUnVsZU5hbWUiLCJyZWR1Y2VkTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJyZWR1Y2VkUnVsZSIsIlJlZHVjZWRSdWxlIiwiZnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSIsImltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIiwicmV0cmlldmVJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURlZmluaXRpb25zIiwiZ2V0RGVmaW5pdGlvbnMiLCJsYXN0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGVmaW5pdGlvbiIsImxhc3QiLCJnZXROYW1lIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlTmFtZSIsImluZGV4IiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJldHJpZXZlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIm1lcmdlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJlcGVhdGVkUnVsZU5hbWUiLCJyZXBlYXRlZFJ1bGUiLCJSZXBlYXRlZFJ1bGUiLCJmcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kSW5kZXgiLCJyZXdyaXR0ZW5JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJyZXdyaXRlSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZ2V0SW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmVwbGFjZWREZWZpbml0aW9uIiwicmVwbGFjZW1lbnREZWZpbml0aW9ucyIsInJld3JpdGVJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJyZXBsYWNlRGVmaW5pdGlvbiIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZmlyc3QiLCJwdXNoIiwiYXJyYXlVdGlsaXRpZXMiLCJyZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyIsIkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIm1lcmdlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiY2FsbGJhY2siLCJydWxlTmFtZSIsImdldFJ1bGVOYW1lIiwicmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVzIiwiZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIkRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kUmVwZWF0ZWRSdWxlTmFtZSIsImRlZmluaXRpb24iLCJmcm9tSW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uQW5kRGVmaW5pdGlvbiIsIkxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlv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