"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
Object.defineProperty(exports, "default", {
    get: function() {
        return eliminateDirectLeftRecursion;
    },
    enumerable: true
});
var _necessary = require("necessary");
var _reduced = _interopRequireDefault(require("./rule/reduced"));
var _recursive = _interopRequireDefault(require("./definition/recursive"));
var _directly = _interopRequireDefault(require("./definition/recursive/left/directly"));
var _rules = require("./utilities/rules");
var _definitions = require("./utilities/definitions");
function _instanceof(left, right) {
    if (right != null && typeof Symbol !== "undefined" && right[Symbol.hasInstance]) {
        return !!right[Symbol.hasInstance](left);
    } else {
        return left instanceof right;
    }
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
var first = _necessary.arrayUtilities.first, tail = _necessary.arrayUtilities.tail;
function eliminateDirectLeftRecursion(leftRecursiveDefinitions, ruleMap) {
    var directlyLeftRecursiveRules = retrieveDirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap);
    directlyLeftRecursiveRules.forEach(function(directlyLeftRecursiveRule) {
        var rule = directlyLeftRecursiveRule, reducedRule = _reduced.default.fromDirectlyLeftRecursiveRule(directlyLeftRecursiveRule), reducedRuleName = reducedRule.getName();
        ruleMap[reducedRuleName] = reducedRule;
        var definitions = rule.getDefinitions();
        var directlyLeftRecursiveDefinitions = retrieveDirectlyLeftRecursiveDefinitions(definitions), directlyLeftRecursiveDefinition = mergeDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions), replacementDefinition = rewriteDirectlyLeftRecursiveDefinition(directlyLeftRecursiveDefinition), firstDirectlyLeftRecursiveDefinitions = first(directlyLeftRecursiveDefinitions), directlyLeftRecursiveDefinitionsTail = tail(directlyLeftRecursiveDefinitions), replacedDefinition = firstDirectlyLeftRecursiveDefinitions; ///
        definitions = directlyLeftRecursiveDefinitionsTail; ///
        rule.removeDefinitions(definitions);
        rule.replaceDefinition(replacedDefinition, replacementDefinition);
    });
}
function retrieveDirectlyLeftRecursiveRules(leftRecursiveDefinitions, ruleMap) {
    var directlyLeftRecursiveRules = (0, _rules.retrieveLeftRecursiveRules)(leftRecursiveDefinitions, _directly.default, ruleMap);
    return directlyLeftRecursiveRules;
}
function mergeDirectlyLeftRecursiveDefinitions(directlyLeftRecursiveDefinitions) {
    var directlyLeftRecursiveDefinition = (0, _definitions.mergeLeftRecursiveDefinitions)(directlyLeftRecursiveDefinitions, function(parts, ruleName) {
        var directlyLeftRecursiveDefinition = _directly.default.fromPartsAndRuleName(parts, ruleName);
        return directlyLeftRecursiveDefinition;
    });
    return directlyLeftRecursiveDefinition;
}
function rewriteDirectlyLeftRecursiveDefinition(directlyLeftRecursiveDefinition) {
    var recursiveDefinition = _recursive.default.fromDirectlyLeftRecursiveDefinition(directlyLeftRecursiveDefinition), replacementDefinition = recursiveDefinition; ///
    return replacementDefinition;
}
function retrieveDirectlyLeftRecursiveDefinitions(definitions) {
    var directlyLeftRecursiveDefinitions = definitions.filter(function(definition) {
        var definitionDirectlyLeftRecursiveDefinition = _instanceof(definition, _directly.default);
        if (definitionDirectlyLeftRecursiveDefinition) {
            return true;
        }
    });
    return directlyLeftRecursiveDefinitions;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGltaW5hdGVEaXJlY3RMZWZ0UmVjdXJzaW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgeyBhcnJheVV0aWxpdGllcyB9IGZyb20gXCJuZWNlc3NhcnlcIjtcblxuaW1wb3J0IFJlZHVjZWRSdWxlIGZyb20gXCIuL3J1bGUvcmVkdWNlZFwiO1xuaW1wb3J0IFJlY3Vyc2l2ZURlZmluaXRpb24gZnJvbSBcIi4vZGVmaW5pdGlvbi9yZWN1cnNpdmVcIjtcbmltcG9ydCBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIGZyb20gXCIuL2RlZmluaXRpb24vcmVjdXJzaXZlL2xlZnQvZGlyZWN0bHlcIjtcblxuaW1wb3J0IHsgcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZXMgfSBmcm9tIFwiLi91dGlsaXRpZXMvcnVsZXNcIjtcbmltcG9ydCB7IG1lcmdlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIH0gZnJvbSBcIi4vdXRpbGl0aWVzL2RlZmluaXRpb25zXCI7XG5cbmNvbnN0IHsgZmlyc3QsIHRhaWwgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBlbGltaW5hdGVEaXJlY3RMZWZ0UmVjdXJzaW9uKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCkge1xuICBjb25zdCBkaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlcyA9IHJldHJpZXZlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKTtcblxuICBkaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlcy5mb3JFYWNoKChkaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlKSA9PiB7XG4gICAgY29uc3QgcnVsZSA9IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUsIC8vL1xuICAgICAgICAgIHJlZHVjZWRSdWxlID0gUmVkdWNlZFJ1bGUuZnJvbURpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUoZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSksXG4gICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lID0gcmVkdWNlZFJ1bGUuZ2V0TmFtZSgpO1xuXG4gICAgcnVsZU1hcFtyZWR1Y2VkUnVsZU5hbWVdID0gcmVkdWNlZFJ1bGU7XG5cbiAgICBsZXQgZGVmaW5pdGlvbnMgPSBydWxlLmdldERlZmluaXRpb25zKCk7XG5cbiAgICBjb25zdCBkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IHJldHJpZXZlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoZGVmaW5pdGlvbnMpLFxuICAgICAgICAgIGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBtZXJnZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSxcbiAgICAgICAgICByZXBsYWNlbWVudERlZmluaXRpb24gPSByZXdyaXRlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSxcbiAgICAgICAgICBmaXJzdERpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zID0gZmlyc3QoZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpLFxuICAgICAgICAgIGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zVGFpbCA9IHRhaWwoZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpLFxuICAgICAgICAgIHJlcGxhY2VkRGVmaW5pdGlvbiA9IGZpcnN0RGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnM7IC8vL1xuXG4gICAgZGVmaW5pdGlvbnMgPSBkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uc1RhaWw7IC8vL1xuXG4gICAgcnVsZS5yZW1vdmVEZWZpbml0aW9ucyhkZWZpbml0aW9ucyk7XG5cbiAgICBydWxlLnJlcGxhY2VEZWZpbml0aW9uKHJlcGxhY2VkRGVmaW5pdGlvbiwgcmVwbGFjZW1lbnREZWZpbml0aW9uKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKSB7XG4gIGNvbnN0IGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVzID0gcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBydWxlTWFwKTtcblxuICByZXR1cm4gZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXM7XG59XG5cbmZ1bmN0aW9uIG1lcmdlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpIHtcbiAgY29uc3QgZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IG1lcmdlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCAocGFydHMsIHJ1bGVOYW1lKSA9PiB7XG4gICAgY29uc3QgZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IERpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbVBhcnRzQW5kUnVsZU5hbWUocGFydHMsIHJ1bGVOYW1lKTtcblxuICAgIHJldHVybiBkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uO1xuICB9KTtcblxuICByZXR1cm4gZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjtcbn1cblxuZnVuY3Rpb24gcmV3cml0ZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikge1xuICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9uID0gUmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSxcbiAgICAgICAgcmVwbGFjZW1lbnREZWZpbml0aW9uID0gcmVjdXJzaXZlRGVmaW5pdGlvbjsgIC8vL1xuXG4gIHJldHVybiByZXBsYWNlbWVudERlZmluaXRpb247XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoZGVmaW5pdGlvbnMpIHtcbiAgY29uc3QgZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBkZWZpbml0aW9ucy5maWx0ZXIoKGRlZmluaXRpb24pID0+IHtcbiAgICAgICAgICBjb25zdCBkZWZpbml0aW9uRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IChkZWZpbml0aW9uIGluc3RhbmNlb2YgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG5cbiAgICAgICAgICBpZiAoZGVmaW5pdGlvbkRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pIHtcbiAgICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICAgIH1cbiAgICAgICAgfSk7XG5cbiAgcmV0dXJuIGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zO1xufVxuIl0sIm5hbWVzIjpbImVsaW1pbmF0ZURpcmVjdExlZnRSZWN1cnNpb24iLCJmaXJzdCIsImFycmF5VXRpbGl0aWVzIiwidGFpbCIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJ1bGVNYXAiLCJkaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlcyIsInJldHJpZXZlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZXMiLCJmb3JFYWNoIiwiZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSIsInJ1bGUiLCJyZWR1Y2VkUnVsZSIsIlJlZHVjZWRSdWxlIiwiZnJvbURpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJyZWR1Y2VkUnVsZU5hbWUiLCJnZXROYW1lIiwiZGVmaW5pdGlvbnMiLCJnZXREZWZpbml0aW9ucyIsImRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwicmV0cmlldmVEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsImRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJtZXJnZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwicmVwbGFjZW1lbnREZWZpbml0aW9uIiwicmV3cml0ZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmaXJzdERpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnNUYWlsIiwicmVwbGFjZWREZWZpbml0aW9uIiwicmVtb3ZlRGVmaW5pdGlvbnMiLCJyZXBsYWNlRGVmaW5pdGlvbiIsInJldHJpZXZlTGVmdFJlY3Vyc2l2ZVJ1bGVzIiwiRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIm1lcmdlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwicGFydHMiLCJydWxlTmFtZSIsImZyb21QYXJ0c0FuZFJ1bGVOYW1lIiwicmVjdXJzaXZlRGVmaW5pdGlvbiIsIlJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImZpbHRlciIsImRlZmluaXRpb24iLCJkZWZpbml0aW9uRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7Ozs7ZUFhV0EsNEJBQTRCOzs7O3lCQVhyQixXQUFXOzhDQUVsQixnQkFBZ0I7Z0RBQ1Isd0JBQXdCOytDQUNaLHNDQUFzQztxQkFFdkMsbUJBQW1COzJCQUNoQix5QkFBeUI7Ozs7Ozs7Ozs7Ozs7QUFFdkUsSUFBUUMsS0FBSyxHQUFXQyxVQUFjLGVBQUEsQ0FBOUJELEtBQUssRUFBRUUsSUFBSSxHQUFLRCxVQUFjLGVBQUEsQ0FBdkJDLElBQUksQUFBb0I7QUFFeEIsU0FBU0gsNEJBQTRCLENBQUNJLHdCQUF3QixFQUFFQyxPQUFPLEVBQUU7SUFDdEYsSUFBTUMsMEJBQTBCLEdBQUdDLGtDQUFrQyxDQUFDSCx3QkFBd0IsRUFBRUMsT0FBTyxDQUFDLEFBQUM7SUFFekdDLDBCQUEwQixDQUFDRSxPQUFPLENBQUMsU0FBQ0MseUJBQXlCLEVBQUs7UUFDaEUsSUFBTUMsSUFBSSxHQUFHRCx5QkFBeUIsRUFDaENFLFdBQVcsR0FBR0MsUUFBVyxRQUFBLENBQUNDLDZCQUE2QixDQUFDSix5QkFBeUIsQ0FBQyxFQUNsRkssZUFBZSxHQUFHSCxXQUFXLENBQUNJLE9BQU8sRUFBRSxBQUFDO1FBRTlDVixPQUFPLENBQUNTLGVBQWUsQ0FBQyxHQUFHSCxXQUFXLENBQUM7UUFFdkMsSUFBSUssV0FBVyxHQUFHTixJQUFJLENBQUNPLGNBQWMsRUFBRSxBQUFDO1FBRXhDLElBQU1DLGdDQUFnQyxHQUFHQyx3Q0FBd0MsQ0FBQ0gsV0FBVyxDQUFDLEVBQ3hGSSwrQkFBK0IsR0FBR0MscUNBQXFDLENBQUNILGdDQUFnQyxDQUFDLEVBQ3pHSSxxQkFBcUIsR0FBR0Msc0NBQXNDLENBQUNILCtCQUErQixDQUFDLEVBQy9GSSxxQ0FBcUMsR0FBR3ZCLEtBQUssQ0FBQ2lCLGdDQUFnQyxDQUFDLEVBQy9FTyxvQ0FBb0MsR0FBR3RCLElBQUksQ0FBQ2UsZ0NBQWdDLENBQUMsRUFDN0VRLGtCQUFrQixHQUFHRixxQ0FBcUMsQUFBQyxFQUFDLEdBQUc7UUFFckVSLFdBQVcsR0FBR1Msb0NBQW9DLENBQUMsQ0FBQyxHQUFHO1FBRXZEZixJQUFJLENBQUNpQixpQkFBaUIsQ0FBQ1gsV0FBVyxDQUFDLENBQUM7UUFFcENOLElBQUksQ0FBQ2tCLGlCQUFpQixDQUFDRixrQkFBa0IsRUFBRUoscUJBQXFCLENBQUMsQ0FBQztLQUNuRSxDQUFDLENBQUM7Q0FDSjtBQUVELFNBQVNmLGtDQUFrQyxDQUFDSCx3QkFBd0IsRUFBRUMsT0FBTyxFQUFFO0lBQzdFLElBQU1DLDBCQUEwQixHQUFHdUIsSUFBQUEsTUFBMEIsMkJBQUEsRUFBQ3pCLHdCQUF3QixFQUFFMEIsU0FBK0IsUUFBQSxFQUFFekIsT0FBTyxDQUFDLEFBQUM7SUFFbEksT0FBT0MsMEJBQTBCLENBQUM7Q0FDbkM7QUFFRCxTQUFTZSxxQ0FBcUMsQ0FBQ0gsZ0NBQWdDLEVBQUU7SUFDL0UsSUFBTUUsK0JBQStCLEdBQUdXLElBQUFBLFlBQTZCLDhCQUFBLEVBQUNiLGdDQUFnQyxFQUFFLFNBQUNjLEtBQUssRUFBRUMsUUFBUSxFQUFLO1FBQzNILElBQU1iLCtCQUErQixHQUFHVSxTQUErQixRQUFBLENBQUNJLG9CQUFvQixDQUFDRixLQUFLLEVBQUVDLFFBQVEsQ0FBQyxBQUFDO1FBRTlHLE9BQU9iLCtCQUErQixDQUFDO0tBQ3hDLENBQUMsQUFBQztJQUVILE9BQU9BLCtCQUErQixDQUFDO0NBQ3hDO0FBRUQsU0FBU0csc0NBQXNDLENBQUNILCtCQUErQixFQUFFO0lBQy9FLElBQU1lLG1CQUFtQixHQUFHQyxVQUFtQixRQUFBLENBQUNDLG1DQUFtQyxDQUFDakIsK0JBQStCLENBQUMsRUFDOUdFLHFCQUFxQixHQUFHYSxtQkFBbUIsQUFBQyxFQUFFLEdBQUc7SUFFdkQsT0FBT2IscUJBQXFCLENBQUM7Q0FDOUI7QUFFRCxTQUFTSCx3Q0FBd0MsQ0FBQ0gsV0FBVyxFQUFFO0lBQzdELElBQU1FLGdDQUFnQyxHQUFHRixXQUFXLENBQUNzQixNQUFNLENBQUMsU0FBQ0MsVUFBVSxFQUFLO1FBQ3BFLElBQU1DLHlDQUF5QyxHQUFJRCxBQUFVLFdBQVlULENBQXRCUyxVQUFVLEVBQVlULFNBQStCLFFBQUEsQ0FBQSxBQUFDLEFBQUM7UUFFMUcsSUFBSVUseUNBQXlDLEVBQUU7WUFDN0MsT0FBTyxJQUFJLENBQUM7U0FDYjtLQUNGLENBQUMsQUFBQztJQUVULE9BQU90QixnQ0FBZ0MsQ0FBQztDQUN6QyJ9