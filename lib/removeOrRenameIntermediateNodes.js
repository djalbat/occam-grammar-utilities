"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = removeOrRenameIntermediateNodes;
var _reduced = _interopRequireDefault(require("./node/reduced"));
var _repeated = _interopRequireDefault(require("./node/repeated"));
var _ruleName = require("./utilities/ruleName");
function removeOrRenameIntermediateNodes(node) {
    removeOrRenameReducedNodes(node);
    renameRepeatedNodes(node);
}
function _instanceof(left, right) {
    if (right != null && typeof Symbol !== "undefined" && right[Symbol.hasInstance]) {
        return !!right[Symbol.hasInstance](left);
    } else {
        return left instanceof right;
    }
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function renameRepeatedNodes(node) {
    var nodeNonTerminalNode = node.isNonTerminalNode();
    if (nodeNonTerminalNode) {
        var nonTerminalNode = node, childNodes = nonTerminalNode.getChildNodes();
        childNodes.forEach(function(childNode) {
            var childNodeRepeatedNode = _instanceof(childNode, _repeated.default);
            if (childNodeRepeatedNode) {
                var repeatedNode = childNode, repeatedNodeRuleName = repeatedNode.getRuleName(), repeatedRuleName = repeatedNodeRuleName, ruleName = (0, _ruleName).ruleNameFromRepeatedRuleName(repeatedRuleName);
                childNode.setRuleName(ruleName);
            }
            renameRepeatedNodes(childNode);
        });
    }
}
function removeOrRenameReducedNodes(node) {
    var nodeNonTerminalNode = node.isNonTerminalNode();
    if (nodeNonTerminalNode) {
        var nonTerminalNode = node, ruleName = nonTerminalNode.getRuleName();
        var childNodes = nonTerminalNode.getChildNodes();
        childNodes = removeOrRenameReducedChildNodes(childNodes, ruleName);
        nonTerminalNode.setChildNodes(childNodes);
    }
}
function removeOrRenameReducedChildNodes(childNodes, ruleName) {
    var childNodesLength = childNodes.length;
    childNodes = childNodes.reduce(function(childNodes, childNode) {
        var childNodeReducedNode = _instanceof(childNode, _reduced.default);
        if (childNodeReducedNode) {
            var reducedNode = childNode, reducedNodeRuleName = reducedNode.getRuleName(), reducedRuleName = reducedNodeRuleName, reducedRuleNameMatchesRuleName = (0, _ruleName).doesReducedRuleNameMatchRuleName(reducedRuleName, ruleName);
            if (reducedRuleNameMatchesRuleName) {
                if (childNodesLength > 1) {
                    var _$ruleName = (0, _ruleName).ruleNameFromReducedRuleName(reducedRuleName);
                    childNode.setRuleName(_$ruleName);
                    removeOrRenameReducedNodes(childNode);
                    childNodes.push(childNode);
                } else {
                    var childNodeChildNodes = childNode.getChildNodes();
                    childNodeChildNodes = removeOrRenameReducedChildNodes(childNodeChildNodes);
                    childNodes = childNodes.concat(childNodeChildNodes);
                }
            } else {
                var _$ruleName1 = (0, _ruleName).ruleNameFromReducedRuleName(reducedRuleName);
                childNode.setRuleName(_$ruleName1);
                removeOrRenameReducedNodes(childNode);
                childNodes.push(childNode);
            }
        } else {
            removeOrRenameReducedNodes(childNode);
            childNodes.push(childNode);
        }
        return childNodes;
    }, []);
    return childNodes;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZW1vdmVPclJlbmFtZUludGVybWVkaWF0ZU5vZGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgUmVkdWNlZE5vZGUgZnJvbSBcIi4vbm9kZS9yZWR1Y2VkXCI7XG5pbXBvcnQgUmVwZWF0ZWROb2RlIGZyb20gXCIuL25vZGUvcmVwZWF0ZWRcIjtcblxuaW1wb3J0IHsgcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lLCBydWxlTmFtZUZyb21SZXBlYXRlZFJ1bGVOYW1lLCBkb2VzUmVkdWNlZFJ1bGVOYW1lTWF0Y2hSdWxlTmFtZSB9IGZyb20gXCIuL3V0aWxpdGllcy9ydWxlTmFtZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiByZW1vdmVPclJlbmFtZUludGVybWVkaWF0ZU5vZGVzKG5vZGUpIHtcbiAgcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMobm9kZSk7XG5cbiAgcmVuYW1lUmVwZWF0ZWROb2Rlcyhub2RlKTtcbn1cblxuZnVuY3Rpb24gcmVuYW1lUmVwZWF0ZWROb2Rlcyhub2RlKSB7XG4gIGNvbnN0IG5vZGVOb25UZXJtaW5hbE5vZGUgPSBub2RlLmlzTm9uVGVybWluYWxOb2RlKCk7XG5cbiAgaWYgKG5vZGVOb25UZXJtaW5hbE5vZGUpIHtcbiAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBub2RlLFxuICAgICAgICAgIGNoaWxkTm9kZXMgPSBub25UZXJtaW5hbE5vZGUuZ2V0Q2hpbGROb2RlcygpO1xuXG4gICAgY2hpbGROb2Rlcy5mb3JFYWNoKChjaGlsZE5vZGUpID0+IHtcbiAgICAgIGNvbnN0IGNoaWxkTm9kZVJlcGVhdGVkTm9kZSA9IChjaGlsZE5vZGUgaW5zdGFuY2VvZiBSZXBlYXRlZE5vZGUpO1xuXG4gICAgICBpZiAoY2hpbGROb2RlUmVwZWF0ZWROb2RlKSB7XG4gICAgICAgIGNvbnN0IHJlcGVhdGVkTm9kZSA9IGNoaWxkTm9kZSwgLy8vXG4gICAgICAgICAgICAgIHJlcGVhdGVkTm9kZVJ1bGVOYW1lID0gcmVwZWF0ZWROb2RlLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICAgIHJlcGVhdGVkUnVsZU5hbWUgPSByZXBlYXRlZE5vZGVSdWxlTmFtZSwgIC8vL1xuICAgICAgICAgICAgICBydWxlTmFtZSA9IHJ1bGVOYW1lRnJvbVJlcGVhdGVkUnVsZU5hbWUocmVwZWF0ZWRSdWxlTmFtZSk7XG5cbiAgICAgICAgY2hpbGROb2RlLnNldFJ1bGVOYW1lKHJ1bGVOYW1lKTtcbiAgICAgIH1cblxuICAgICAgcmVuYW1lUmVwZWF0ZWROb2RlcyhjaGlsZE5vZGUpO1xuICAgIH0pXG4gIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMobm9kZSkge1xuICBjb25zdCBub2RlTm9uVGVybWluYWxOb2RlID0gbm9kZS5pc05vblRlcm1pbmFsTm9kZSgpO1xuXG4gIGlmIChub2RlTm9uVGVybWluYWxOb2RlKSB7XG4gICAgY29uc3Qgbm9uVGVybWluYWxOb2RlID0gbm9kZSwgLy8vXG4gICAgICAgICAgcnVsZU5hbWUgPSBub25UZXJtaW5hbE5vZGUuZ2V0UnVsZU5hbWUoKTtcblxuICAgIGxldCBjaGlsZE5vZGVzID0gbm9uVGVybWluYWxOb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICAgIGNoaWxkTm9kZXMgPSByZW1vdmVPclJlbmFtZVJlZHVjZWRDaGlsZE5vZGVzKGNoaWxkTm9kZXMsIHJ1bGVOYW1lKTtcblxuICAgIG5vblRlcm1pbmFsTm9kZS5zZXRDaGlsZE5vZGVzKGNoaWxkTm9kZXMpXG4gIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkQ2hpbGROb2RlcyhjaGlsZE5vZGVzLCBydWxlTmFtZSkge1xuICBjb25zdCBjaGlsZE5vZGVzTGVuZ3RoID0gY2hpbGROb2Rlcy5sZW5ndGg7XG5cbiAgY2hpbGROb2RlcyA9IGNoaWxkTm9kZXMucmVkdWNlKChjaGlsZE5vZGVzLCBjaGlsZE5vZGUpID0+IHtcbiAgICBjb25zdCBjaGlsZE5vZGVSZWR1Y2VkTm9kZSA9IChjaGlsZE5vZGUgaW5zdGFuY2VvZiBSZWR1Y2VkTm9kZSk7XG5cbiAgICBpZiAoY2hpbGROb2RlUmVkdWNlZE5vZGUpIHtcbiAgICAgIGNvbnN0IHJlZHVjZWROb2RlID0gY2hpbGROb2RlLCAvLy9cbiAgICAgICAgICAgIHJlZHVjZWROb2RlUnVsZU5hbWUgPSByZWR1Y2VkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lID0gcmVkdWNlZE5vZGVSdWxlTmFtZSwgIC8vL1xuICAgICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lTWF0Y2hlc1J1bGVOYW1lID0gZG9lc1JlZHVjZWRSdWxlTmFtZU1hdGNoUnVsZU5hbWUocmVkdWNlZFJ1bGVOYW1lLCBydWxlTmFtZSk7XG5cbiAgICAgIGlmIChyZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUpIHtcbiAgICAgICAgaWYgKGNoaWxkTm9kZXNMZW5ndGggPiAxKSB7XG4gICAgICAgICAgY29uc3QgcnVsZU5hbWUgPSBydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUocmVkdWNlZFJ1bGVOYW1lKTtcblxuICAgICAgICAgIGNoaWxkTm9kZS5zZXRSdWxlTmFtZShydWxlTmFtZSk7XG5cbiAgICAgICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICAgICAgY2hpbGROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGV0IGNoaWxkTm9kZUNoaWxkTm9kZXMgPSBjaGlsZE5vZGUuZ2V0Q2hpbGROb2RlcygpO1xuXG4gICAgICAgICAgY2hpbGROb2RlQ2hpbGROb2RlcyA9IHJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG5cbiAgICAgICAgICBjaGlsZE5vZGVzID0gY2hpbGROb2Rlcy5jb25jYXQoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lKHJlZHVjZWRSdWxlTmFtZSk7XG5cbiAgICAgICAgY2hpbGROb2RlLnNldFJ1bGVOYW1lKHJ1bGVOYW1lKTtcblxuICAgICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICAgIGNoaWxkTm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICBjaGlsZE5vZGVzLnB1c2goY2hpbGROb2RlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2hpbGROb2RlcztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBjaGlsZE5vZGVzO1xufVxuIl0sIm5hbWVzIjpbInJlbW92ZU9yUmVuYW1lSW50ZXJtZWRpYXRlTm9kZXMiLCJub2RlIiwicmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMiLCJyZW5hbWVSZXBlYXRlZE5vZGVzIiwibm9kZU5vblRlcm1pbmFsTm9kZSIsImlzTm9uVGVybWluYWxOb2RlIiwibm9uVGVybWluYWxOb2RlIiwiY2hpbGROb2RlcyIsImdldENoaWxkTm9kZXMiLCJmb3JFYWNoIiwiY2hpbGROb2RlIiwiY2hpbGROb2RlUmVwZWF0ZWROb2RlIiwiUmVwZWF0ZWROb2RlIiwicmVwZWF0ZWROb2RlIiwicmVwZWF0ZWROb2RlUnVsZU5hbWUiLCJnZXRSdWxlTmFtZSIsInJlcGVhdGVkUnVsZU5hbWUiLCJydWxlTmFtZSIsInJ1bGVOYW1lRnJvbVJlcGVhdGVkUnVsZU5hbWUiLCJzZXRSdWxlTmFtZSIsInJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMiLCJzZXRDaGlsZE5vZGVzIiwiY2hpbGROb2Rlc0xlbmd0aCIsImxlbmd0aCIsInJlZHVjZSIsImNoaWxkTm9kZVJlZHVjZWROb2RlIiwiUmVkdWNlZE5vZGUiLCJyZWR1Y2VkTm9kZSIsInJlZHVjZWROb2RlUnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUiLCJkb2VzUmVkdWNlZFJ1bGVOYW1lTWF0Y2hSdWxlTmFtZSIsInJ1bGVOYW1lRnJvbVJlZHVjZWRSdWxlTmFtZSIsInB1c2giLCJjaGlsZE5vZGVDaGlsZE5vZGVzIiwiY29uY2F0Il0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7a0JBT1dBLCtCQUErQjtBQUwvQixJQUFBLFFBQWdCLGtDQUFoQixnQkFBZ0IsRUFBQTtBQUNmLElBQUEsU0FBaUIsa0NBQWpCLGlCQUFpQixFQUFBO0FBRWtFLElBQUEsU0FBc0IsV0FBdEIsc0JBQXNCLENBQUE7QUFFbkgsU0FBU0EsK0JBQStCLENBQUNDLElBQUksRUFBRTtJQUM1REMsMEJBQTBCLENBQUNELElBQUksQ0FBQyxDQUFDO0lBRWpDRSxtQkFBbUIsQ0FBQ0YsSUFBSSxDQUFDLENBQUM7Q0FDM0I7Ozs7Ozs7Ozs7Ozs7QUFFRCxTQUFTRSxtQkFBbUIsQ0FBQ0YsSUFBSSxFQUFFO0lBQ2pDLElBQU1HLG1CQUFtQixHQUFHSCxJQUFJLENBQUNJLGlCQUFpQixFQUFFLEFBQUM7SUFFckQsSUFBSUQsbUJBQW1CLEVBQUU7UUFDdkIsSUFBTUUsZUFBZSxHQUFHTCxJQUFJLEVBQ3RCTSxVQUFVLEdBQUdELGVBQWUsQ0FBQ0UsYUFBYSxFQUFFLEFBQUM7UUFFbkRELFVBQVUsQ0FBQ0UsT0FBTyxDQUFDLFNBQUNDLFNBQVMsRUFBSztZQUNoQyxJQUFNQyxxQkFBcUIsR0FBSUQsQUFBUyxXQUFZRSxDQUFyQkYsU0FBUyxFQUFZRSxTQUFZLFFBQUEsQ0FBQSxBQUFDLEFBQUM7WUFFbEUsSUFBSUQscUJBQXFCLEVBQUU7Z0JBQ3pCLElBQU1FLFlBQVksR0FBR0gsU0FBUyxFQUN4Qkksb0JBQW9CLEdBQUdELFlBQVksQ0FBQ0UsV0FBVyxFQUFFLEVBQ2pEQyxnQkFB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