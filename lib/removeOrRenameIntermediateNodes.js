"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = removeOrRenameIntermediateNodes;
var _reduced = _interopRequireDefault(require("./node/reduced"));
var _repeated = _interopRequireDefault(require("./node/repeated"));
var _class = require("./utilities/class");
var _ruleName = require("./utilities/ruleName");
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function removeOrRenameIntermediateNodes(node) {
    removeOrRenameReducedNodes(node);
    removeRepeatedNodes(node);
}
function removeRepeatedNodes(node) {
    var nodeNonTerminalNode = node.isNonTerminalNode();
    if (nodeNonTerminalNode) {
        var nonTerminalNode = node; ///
        var childNodes = nonTerminalNode.getChildNodes();
        childNodes = removeRepeatedChildNodes(childNodes);
        nonTerminalNode.setChildNodes(childNodes);
    }
}
function removeRepeatedChildNodes(childNodes) {
    childNodes = childNodes.reduce(function(childNodes, childNode) {
        var childNodeRepeatedNode = (0, _class).isInstanceOf(childNode, _repeated.default);
        if (childNodeRepeatedNode) {
            var childNodeChildNodes = childNode.getChildNodes();
            childNodeChildNodes = removeRepeatedChildNodes(childNodeChildNodes);
            childNodes = childNodes.concat(childNodeChildNodes);
        } else {
            removeRepeatedNodes(childNode);
            childNodes.push(childNode);
        }
        return childNodes;
    }, []);
    return childNodes;
}
function removeOrRenameReducedNodes(node) {
    var nodeNonTerminalNode = node.isNonTerminalNode();
    if (nodeNonTerminalNode) {
        var nonTerminalNode = node, ruleName = nonTerminalNode.getRuleName();
        var childNodes = nonTerminalNode.getChildNodes();
        childNodes = removeOrRenameReducedChildNodes(childNodes, ruleName);
        nonTerminalNode.setChildNodes(childNodes);
    }
}
function removeOrRenameReducedChildNodes(childNodes, ruleName) {
    var childNodesLength = childNodes.length;
    childNodes = childNodes.reduce(function(childNodes, childNode) {
        var childNodeReducedNode = (0, _class).isInstanceOf(childNode, _reduced.default);
        if (childNodeReducedNode) {
            var reducedNode = childNode, reducedNodeRuleName = reducedNode.getRuleName(), reducedRuleName = reducedNodeRuleName, reducedRuleNameMatchesRuleName = (0, _ruleName).checkReducedRuleNameMatchesRuleName(reducedRuleName, ruleName);
            if (reducedRuleNameMatchesRuleName) {
                if (childNodesLength > 1) {
                    var ruleName = (0, _ruleName).ruleNameFromReducedRuleName(reducedRuleName);
                    childNode.setRuleName(ruleName);
                    removeOrRenameReducedNodes(childNode);
                    childNodes.push(childNode);
                } else {
                    var childNodeChildNodes = childNode.getChildNodes();
                    childNodeChildNodes = removeOrRenameReducedChildNodes(childNodeChildNodes);
                    childNodes = childNodes.concat(childNodeChildNodes);
                }
            } else {
                var ruleName = (0, _ruleName).ruleNameFromReducedRuleName(reducedRuleName);
                childNode.setRuleName(ruleName);
                removeOrRenameReducedNodes(childNode);
                childNodes.push(childNode);
            }
        } else {
            removeOrRenameReducedNodes(childNode);
            childNodes.push(childNode);
        }
        return childNodes;
    }, []);
    return childNodes;
}

//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZW1vdmVPclJlbmFtZUludGVybWVkaWF0ZU5vZGVzLmpzIl0sIm5hbWVzIjpbIlJlZHVjZWROb2RlIiwiUmVwZWF0ZWROb2RlIiwiaXNJbnN0YW5jZU9mIiwicnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lIiwiY2hlY2tSZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUiLCJyZW1vdmVPclJlbmFtZUludGVybWVkaWF0ZU5vZGVzIiwibm9kZSIsInJlbW92ZU9yUmVuYW1lUmVkdWNlZE5vZGVzIiwicmVtb3ZlUmVwZWF0ZWROb2RlcyIsIm5vZGVOb25UZXJtaW5hbE5vZGUiLCJpc05vblRlcm1pbmFsTm9kZSIsIm5vblRlcm1pbmFsTm9kZSIsImNoaWxkTm9kZXMiLCJnZXRDaGlsZE5vZGVzIiwicmVtb3ZlUmVwZWF0ZWRDaGlsZE5vZGVzIiwic2V0Q2hpbGROb2RlcyIsInJlZHVjZSIsImNoaWxkTm9kZSIsImNoaWxkTm9kZVJlcGVhdGVkTm9kZSIsImNoaWxkTm9kZUNoaWxkTm9kZXMiLCJjb25jYXQiLCJwdXNoIiwicnVsZU5hbWUiLCJnZXRSdWxlTmFtZSIsInJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMiLCJjaGlsZE5vZGVzTGVuZ3RoIiwibGVuZ3RoIiwiY2hpbGROb2RlUmVkdWNlZE5vZGUiLCJyZWR1Y2VkTm9kZSIsInJlZHVjZWROb2RlUnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUiLCJzZXRSdWxlTmFtZSJdLCJtYXBwaW5ncyI6IkNBQUEsVUFBWTs7OztrQkFRWSwrQkFBK0I7QUFOL0IsR0FBZ0IsQ0FBaEIsUUFBZ0I7QUFDZixHQUFpQixDQUFqQixTQUFpQjtBQUViLEdBQW1CLENBQW5CLE1BQW1CO0FBQ2lDLEdBQXNCLENBQXRCLFNBQXNCOzs7Ozs7U0FFL0UsK0JBQStCLENBQUMsSUFBSSxFQUFFLENBQUM7SUFDN0QsMEJBQTBCLENBQUMsSUFB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QUFHLCtCQUErQixDQUFDLG1CQUFtQjtvQkFFekUsVUFBVSxHQUFHLFVBQVUsQ0FBQyxNQUFNLENBQUMsbUJBQW1CO2dCQUNwRCxDQUFDO1lBQ0gsQ0FBQyxNQUFNLENBQUM7Z0JBQ04sR0FBSyxDQUFDLFFBQVEsT0F4RjJELFNBQXNCLDhCQXdGbEQsZUFBZTtnQkFFNUQsU0FBUyxDQUFDLFdBQVcsQ0FBQyxRQUFRO2dCQUU5QiwwQkFBMEIsQ0FBQyxTQUFTO2dCQUVwQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVM7WUFDM0IsQ0FBQztRQUNILENBQUMsTUFBTSxDQUFDO1lBQ04sMEJBQTBCLENBQUMsU0FBUztZQUVwQyxVQUFVLENBQUMsSUFBSSxDQUFDLFNBQVM7UUFDM0IsQ0FBQztRQUVELE1BQU0sQ0FBQyxVQUFVO0lBQ25CLENBQUMsRUFBRSxDQUFDLENBQUM7SUFFTCxNQUFNLENBQUMsVUFBVTtBQUNuQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbmltcG9ydCBSZWR1Y2VkTm9kZSBmcm9tIFwiLi9ub2RlL3JlZHVjZWRcIjtcbmltcG9ydCBSZXBlYXRlZE5vZGUgZnJvbSBcIi4vbm9kZS9yZXBlYXRlZFwiO1xuXG5pbXBvcnQgeyBpc0luc3RhbmNlT2YgfSBmcm9tIFwiLi91dGlsaXRpZXMvY2xhc3NcIjtcbmltcG9ydCB7IHJ1bGVOYW1lRnJvbVJlZHVjZWRSdWxlTmFtZSwgY2hlY2tSZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUgfSBmcm9tIFwiLi91dGlsaXRpZXMvcnVsZU5hbWVcIjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gcmVtb3ZlT3JSZW5hbWVJbnRlcm1lZGlhdGVOb2Rlcyhub2RlKSB7XG4gIHJlbW92ZU9yUmVuYW1lUmVkdWNlZE5vZGVzKG5vZGUpO1xuXG4gIHJlbW92ZVJlcGVhdGVkTm9kZXMobm9kZSk7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZVJlcGVhdGVkTm9kZXMobm9kZSkge1xuICBjb25zdCBub2RlTm9uVGVybWluYWxOb2RlID0gbm9kZS5pc05vblRlcm1pbmFsTm9kZSgpO1xuXG4gIGlmIChub2RlTm9uVGVybWluYWxOb2RlKSB7XG4gICAgY29uc3Qgbm9uVGVybWluYWxOb2RlID0gbm9kZTsgLy8vXG5cbiAgICBsZXQgY2hpbGROb2RlcyA9IG5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCk7XG5cbiAgICBjaGlsZE5vZGVzID0gcmVtb3ZlUmVwZWF0ZWRDaGlsZE5vZGVzKGNoaWxkTm9kZXMpO1xuXG4gICAgbm9uVGVybWluYWxOb2RlLnNldENoaWxkTm9kZXMoY2hpbGROb2RlcylcbiAgfVxufVxuXG5mdW5jdGlvbiByZW1vdmVSZXBlYXRlZENoaWxkTm9kZXMoY2hpbGROb2Rlcykge1xuICBjaGlsZE5vZGVzID0gY2hpbGROb2Rlcy5yZWR1Y2UoKGNoaWxkTm9kZXMsIGNoaWxkTm9kZSkgPT4ge1xuICAgIGNvbnN0IGNoaWxkTm9kZVJlcGVhdGVkTm9kZSA9IGlzSW5zdGFuY2VPZihjaGlsZE5vZGUsIFJlcGVhdGVkTm9kZSk7XG5cbiAgICBpZiAoY2hpbGROb2RlUmVwZWF0ZWROb2RlKSB7XG4gICAgICBsZXQgY2hpbGROb2RlQ2hpbGROb2RlcyA9IGNoaWxkTm9kZS5nZXRDaGlsZE5vZGVzKCk7XG5cbiAgICAgIGNoaWxkTm9kZUNoaWxkTm9kZXMgPSByZW1vdmVSZXBlYXRlZENoaWxkTm9kZXMoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG5cbiAgICAgIGNoaWxkTm9kZXMgPSBjaGlsZE5vZGVzLmNvbmNhdChjaGlsZE5vZGVDaGlsZE5vZGVzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmVtb3ZlUmVwZWF0ZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICBjaGlsZE5vZGVzLnB1c2goY2hpbGROb2RlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2hpbGROb2RlcztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBjaGlsZE5vZGVzO1xufVxuXG5mdW5jdGlvbiByZW1vdmVPclJlbmFtZVJlZHVjZWROb2Rlcyhub2RlKSB7XG4gIGNvbnN0IG5vZGVOb25UZXJtaW5hbE5vZGUgPSBub2RlLmlzTm9uVGVybWluYWxOb2RlKCk7XG5cbiAgaWYgKG5vZGVOb25UZXJtaW5hbE5vZGUpIHtcbiAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBub2RlLCAvLy9cbiAgICAgICAgICBydWxlTmFtZSA9IG5vblRlcm1pbmFsTm9kZS5nZXRSdWxlTmFtZSgpO1xuXG4gICAgbGV0IGNoaWxkTm9kZXMgPSBub25UZXJtaW5hbE5vZGUuZ2V0Q2hpbGROb2RlcygpO1xuXG4gICAgY2hpbGROb2RlcyA9IHJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMoY2hpbGROb2RlcywgcnVsZU5hbWUpO1xuXG4gICAgbm9uVGVybWluYWxOb2RlLnNldENoaWxkTm9kZXMoY2hpbGROb2RlcylcbiAgfVxufVxuXG5mdW5jdGlvbiByZW1vdmVPclJlbmFtZVJlZHVjZWRDaGlsZE5vZGVzKGNoaWxkTm9kZXMsIHJ1bGVOYW1lKSB7XG4gIGNvbnN0IGNoaWxkTm9kZXNMZW5ndGggPSBjaGlsZE5vZGVzLmxlbmd0aDtcblxuICBjaGlsZE5vZGVzID0gY2hpbGROb2Rlcy5yZWR1Y2UoKGNoaWxkTm9kZXMsIGNoaWxkTm9kZSkgPT4ge1xuICAgIGNvbnN0IGNoaWxkTm9kZVJlZHVjZWROb2RlID0gaXNJbnN0YW5jZU9mKGNoaWxkTm9kZSwgUmVkdWNlZE5vZGUpO1xuXG4gICAgaWYgKGNoaWxkTm9kZVJlZHVjZWROb2RlKSB7XG4gICAgICBjb25zdCByZWR1Y2VkTm9kZSA9IGNoaWxkTm9kZSwgLy8vXG4gICAgICAgICAgICByZWR1Y2VkTm9kZVJ1bGVOYW1lID0gcmVkdWNlZE5vZGUuZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICAgIHJlZHVjZWRSdWxlTmFtZSA9IHJlZHVjZWROb2RlUnVsZU5hbWUsICAvLy9cbiAgICAgICAgICAgIHJlZHVjZWRSdWxlTmFtZU1hdGNoZXNSdWxlTmFtZSA9IGNoZWNrUmVkdWNlZFJ1bGVOYW1lTWF0Y2hlc1J1bGVOYW1lKHJlZHVjZWRSdWxlTmFtZSwgcnVsZU5hbWUpO1xuXG4gICAgICBpZiAocmVkdWNlZFJ1bGVOYW1lTWF0Y2hlc1J1bGVOYW1lKSB7XG4gICAgICAgIGlmIChjaGlsZE5vZGVzTGVuZ3RoID4gMSkge1xuICAgICAgICAgIGNvbnN0IHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lKHJlZHVjZWRSdWxlTmFtZSk7XG5cbiAgICAgICAgICBjaGlsZE5vZGUuc2V0UnVsZU5hbWUocnVsZU5hbWUpO1xuXG4gICAgICAgICAgcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMoY2hpbGROb2RlKTtcblxuICAgICAgICAgIGNoaWxkTm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGxldCBjaGlsZE5vZGVDaGlsZE5vZGVzID0gY2hpbGROb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICAgICAgICAgIGNoaWxkTm9kZUNoaWxkTm9kZXMgPSByZW1vdmVPclJlbmFtZVJlZHVjZWRDaGlsZE5vZGVzKGNoaWxkTm9kZUNoaWxkTm9kZXMpO1xuXG4gICAgICAgICAgY2hpbGROb2RlcyA9IGNoaWxkTm9kZXMuY29uY2F0KGNoaWxkTm9kZUNoaWxkTm9kZXMpO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBydWxlTmFtZSA9IHJ1bGVOYW1lRnJvbVJlZHVjZWRSdWxlTmFtZShyZWR1Y2VkUnVsZU5hbWUpO1xuXG4gICAgICAgIGNoaWxkTm9kZS5zZXRSdWxlTmFtZShydWxlTmFtZSk7XG5cbiAgICAgICAgcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMoY2hpbGROb2RlKTtcblxuICAgICAgICBjaGlsZE5vZGVzLnB1c2goY2hpbGROb2RlKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMoY2hpbGROb2RlKTtcblxuICAgICAgY2hpbGROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNoaWxkTm9kZXM7XG4gIH0sIFtdKTtcblxuICByZXR1cm4gY2hpbGROb2Rlcztcbn1cbiJdfQ==