"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = removeOrRenameIntermediateNodes;
var _reduced = _interopRequireDefault(require("./node/reduced"));
var _repeated = _interopRequireDefault(require("./node/repeated"));
var _class = require("./utilities/class");
var _ruleName = require("./utilities/ruleName");
function removeOrRenameIntermediateNodes(node) {
    removeOrRenameReducedNodes(node);
    renameRepeatedNodes(node);
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function renameRepeatedNodes(node) {
    var nodeNonTerminalNode = node.isNonTerminalNode();
    if (nodeNonTerminalNode) {
        var nonTerminalNode = node, childNodes = nonTerminalNode.getChildNodes();
        childNodes.forEach(function(childNode) {
            var childNodeRepeatedNode = (0, _class).isInstanceOf(childNode, _repeated.default);
            if (childNodeRepeatedNode) {
                var repeatedNode = childNode, repeatedNodeRuleName = repeatedNode.getRuleName(), repeatedRuleName = repeatedNodeRuleName, ruleName = (0, _ruleName).ruleNameFromRepeatedRuleName(repeatedRuleName);
                childNode.setRuleName(ruleName);
            }
            renameRepeatedNodes(childNode);
        });
    }
}
function removeOrRenameReducedNodes(node) {
    var nodeNonTerminalNode = node.isNonTerminalNode();
    if (nodeNonTerminalNode) {
        var nonTerminalNode = node, ruleName = nonTerminalNode.getRuleName();
        var childNodes = nonTerminalNode.getChildNodes();
        childNodes = removeOrRenameReducedChildNodes(childNodes, ruleName);
        nonTerminalNode.setChildNodes(childNodes);
    }
}
function removeOrRenameReducedChildNodes(childNodes, ruleName) {
    var childNodesLength = childNodes.length;
    childNodes = childNodes.reduce(function(childNodes, childNode) {
        var childNodeReducedNode = (0, _class).isInstanceOf(childNode, _reduced.default);
        if (childNodeReducedNode) {
            var reducedNode = childNode, reducedNodeRuleName = reducedNode.getRuleName(), reducedRuleName = reducedNodeRuleName, reducedRuleNameMatchesRuleName = (0, _ruleName).doesReducedRuleNameMatchRuleName(reducedRuleName, ruleName);
            if (reducedRuleNameMatchesRuleName) {
                if (childNodesLength > 1) {
                    var _$ruleName = (0, _ruleName).ruleNameFromReducedRuleName(reducedRuleName);
                    childNode.setRuleName(_$ruleName);
                    removeOrRenameReducedNodes(childNode);
                    childNodes.push(childNode);
                } else {
                    var childNodeChildNodes = childNode.getChildNodes();
                    childNodeChildNodes = removeOrRenameReducedChildNodes(childNodeChildNodes);
                    childNodes = childNodes.concat(childNodeChildNodes);
                }
            } else {
                var _$ruleName1 = (0, _ruleName).ruleNameFromReducedRuleName(reducedRuleName);
                childNode.setRuleName(_$ruleName1);
                removeOrRenameReducedNodes(childNode);
                childNodes.push(childNode);
            }
        } else {
            removeOrRenameReducedNodes(childNode);
            childNodes.push(childNode);
        }
        return childNodes;
    }, []);
    return childNodes;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9yZW1vdmVPclJlbmFtZUludGVybWVkaWF0ZU5vZGVzLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgUmVkdWNlZE5vZGUgZnJvbSBcIi4vbm9kZS9yZWR1Y2VkXCI7XG5pbXBvcnQgUmVwZWF0ZWROb2RlIGZyb20gXCIuL25vZGUvcmVwZWF0ZWRcIjtcblxuaW1wb3J0IHsgaXNJbnN0YW5jZU9mIH0gZnJvbSBcIi4vdXRpbGl0aWVzL2NsYXNzXCI7XG5pbXBvcnQgeyBydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUsIHJ1bGVOYW1lRnJvbVJlcGVhdGVkUnVsZU5hbWUsIGRvZXNSZWR1Y2VkUnVsZU5hbWVNYXRjaFJ1bGVOYW1lIH0gZnJvbSBcIi4vdXRpbGl0aWVzL3J1bGVOYW1lXCI7XG5cbmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIHJlbW92ZU9yUmVuYW1lSW50ZXJtZWRpYXRlTm9kZXMobm9kZSkge1xuICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2Rlcyhub2RlKTtcblxuICByZW5hbWVSZXBlYXRlZE5vZGVzKG5vZGUpO1xufVxuXG5mdW5jdGlvbiByZW5hbWVSZXBlYXRlZE5vZGVzKG5vZGUpIHtcbiAgY29uc3Qgbm9kZU5vblRlcm1pbmFsTm9kZSA9IG5vZGUuaXNOb25UZXJtaW5hbE5vZGUoKTtcblxuICBpZiAobm9kZU5vblRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IG5vblRlcm1pbmFsTm9kZSA9IG5vZGUsXG4gICAgICAgICAgY2hpbGROb2RlcyA9IG5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCk7XG5cbiAgICBjaGlsZE5vZGVzLmZvckVhY2goKGNoaWxkTm9kZSkgPT4ge1xuICAgICAgY29uc3QgY2hpbGROb2RlUmVwZWF0ZWROb2RlID0gaXNJbnN0YW5jZU9mKGNoaWxkTm9kZSwgUmVwZWF0ZWROb2RlKTtcblxuICAgICAgaWYgKGNoaWxkTm9kZVJlcGVhdGVkTm9kZSkge1xuICAgICAgICBjb25zdCByZXBlYXRlZE5vZGUgPSBjaGlsZE5vZGUsIC8vL1xuICAgICAgICAgICAgICByZXBlYXRlZE5vZGVSdWxlTmFtZSA9IHJlcGVhdGVkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgICByZXBlYXRlZFJ1bGVOYW1lID0gcmVwZWF0ZWROb2RlUnVsZU5hbWUsICAvLy9cbiAgICAgICAgICAgICAgcnVsZU5hbWUgPSBydWxlTmFtZUZyb21SZXBlYXRlZFJ1bGVOYW1lKHJlcGVhdGVkUnVsZU5hbWUpO1xuXG4gICAgICAgIGNoaWxkTm9kZS5zZXRSdWxlTmFtZShydWxlTmFtZSk7XG4gICAgICB9XG5cbiAgICAgIHJlbmFtZVJlcGVhdGVkTm9kZXMoY2hpbGROb2RlKTtcbiAgICB9KVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZU9yUmVuYW1lUmVkdWNlZE5vZGVzKG5vZGUpIHtcbiAgY29uc3Qgbm9kZU5vblRlcm1pbmFsTm9kZSA9IG5vZGUuaXNOb25UZXJtaW5hbE5vZGUoKTtcblxuICBpZiAobm9kZU5vblRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IG5vblRlcm1pbmFsTm9kZSA9IG5vZGUsIC8vL1xuICAgICAgICAgIHJ1bGVOYW1lID0gbm9uVGVybWluYWxOb2RlLmdldFJ1bGVOYW1lKCk7XG5cbiAgICBsZXQgY2hpbGROb2RlcyA9IG5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCk7XG5cbiAgICBjaGlsZE5vZGVzID0gcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkQ2hpbGROb2RlcyhjaGlsZE5vZGVzLCBydWxlTmFtZSk7XG5cbiAgICBub25UZXJtaW5hbE5vZGUuc2V0Q2hpbGROb2RlcyhjaGlsZE5vZGVzKVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMoY2hpbGROb2RlcywgcnVsZU5hbWUpIHtcbiAgY29uc3QgY2hpbGROb2Rlc0xlbmd0aCA9IGNoaWxkTm9kZXMubGVuZ3RoO1xuXG4gIGNoaWxkTm9kZXMgPSBjaGlsZE5vZGVzLnJlZHVjZSgoY2hpbGROb2RlcywgY2hpbGROb2RlKSA9PiB7XG4gICAgY29uc3QgY2hpbGROb2RlUmVkdWNlZE5vZGUgPSBpc0luc3RhbmNlT2YoY2hpbGROb2RlLCBSZWR1Y2VkTm9kZSk7XG5cbiAgICBpZiAoY2hpbGROb2RlUmVkdWNlZE5vZGUpIHtcbiAgICAgIGNvbnN0IHJlZHVjZWROb2RlID0gY2hpbGROb2RlLCAvLy9cbiAgICAgICAgICAgIHJlZHVjZWROb2RlUnVsZU5hbWUgPSByZWR1Y2VkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lID0gcmVkdWNlZE5vZGVSdWxlTmFtZSwgIC8vL1xuICAgICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lTWF0Y2hlc1J1bGVOYW1lID0gZG9lc1JlZHVjZWRSdWxlTmFtZU1hdGNoUnVsZU5hbWUocmVkdWNlZFJ1bGVOYW1lLCBydWxlTmFtZSk7XG5cbiAgICAgIGlmIChyZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUpIHtcbiAgICAgICAgaWYgKGNoaWxkTm9kZXNMZW5ndGggPiAxKSB7XG4gICAgICAgICAgY29uc3QgcnVsZU5hbWUgPSBydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUocmVkdWNlZFJ1bGVOYW1lKTtcblxuICAgICAgICAgIGNoaWxkTm9kZS5zZXRSdWxlTmFtZShydWxlTmFtZSk7XG5cbiAgICAgICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICAgICAgY2hpbGROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGV0IGNoaWxkTm9kZUNoaWxkTm9kZXMgPSBjaGlsZE5vZGUuZ2V0Q2hpbGROb2RlcygpO1xuXG4gICAgICAgICAgY2hpbGROb2RlQ2hpbGROb2RlcyA9IHJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG5cbiAgICAgICAgICBjaGlsZE5vZGVzID0gY2hpbGROb2Rlcy5jb25jYXQoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lKHJlZHVjZWRSdWxlTmFtZSk7XG5cbiAgICAgICAgY2hpbGROb2RlLnNldFJ1bGVOYW1lKHJ1bGVOYW1lKTtcblxuICAgICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICAgIGNoaWxkTm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICBjaGlsZE5vZGVzLnB1c2goY2hpbGROb2RlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2hpbGROb2RlcztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBjaGlsZE5vZGVzO1xufVxuIl0sIm5hbWVzIjpbInJlbW92ZU9yUmVuYW1lSW50ZXJtZWRpYXRlTm9kZXMiLCJub2RlIiwicmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMiLCJyZW5hbWVSZXBlYXRlZE5vZGVzIiwibm9kZU5vblRlcm1pbmFsTm9kZSIsImlzTm9uVGVybWluYWxOb2RlIiwibm9uVGVybWluYWxOb2RlIiwiY2hpbGROb2RlcyIsImdldENoaWxkTm9kZXMiLCJmb3JFYWNoIiwiY2hpbGROb2RlIiwiY2hpbGROb2RlUmVwZWF0ZWROb2RlIiwiaXNJbnN0YW5jZU9mIiwiUmVwZWF0ZWROb2RlIiwicmVwZWF0ZWROb2RlIiwicmVwZWF0ZWROb2RlUnVsZU5hbWUiLCJnZXRSdWxlTmFtZSIsInJlcGVhdGVkUnVsZU5hbWUiLCJydWxlTmFtZSIsInJ1bGVOYW1lRnJvbVJlcGVhdGVkUnVsZU5hbWUiLCJzZXRSdWxlTmFtZSIsInJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMiLCJzZXRDaGlsZE5vZGVzIiwiY2hpbGROb2Rlc0xlbmd0aCIsImxlbmd0aCIsInJlZHVjZSIsImNoaWxkTm9kZVJlZHVjZWROb2RlIiwiUmVkdWNlZE5vZGUiLCJyZWR1Y2VkTm9kZSIsInJlZHVjZWROb2RlUnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUiLCJkb2VzUmVkdWNlZFJ1bGVOYW1lTWF0Y2hSdWxlTmFtZSIsInJ1bGVOYW1lRnJvbVJlZHVjZWRSdWxlTmFtZSIsInB1c2giLCJjaGlsZE5vZGVDaGlsZE5vZGVzIiwiY29uY2F0Il0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7a0JBUVdBLCtCQUErQjtBQU4vQixJQUFBLFFBQWdCLGtDQUFoQixnQkFBZ0IsRUFBQTtBQUNmLElBQUEsU0FBaUIsa0NBQWpCLGlCQUFpQixFQUFBO0FBRWIsSUFBQSxNQUFtQixXQUFuQixtQkFBbUIsQ0FBQTtBQUM0RCxJQUFBLFNBQXNCLFdBQXRCLHNCQUFzQixDQUFBO0FBRW5ILFNBQVNBLCtCQUErQixDQUFDQyxJQUFJLEVBQUU7SUFDNURDLDBCQUEwQixDQUFDRCxJQUFJLENBQUMsQ0FBQztJQUVqQ0UsbUJBQW1CLENBQUNGLElBQUksQ0FBQyxDQUFDO0NBQzNCOzs7Ozs7QUFFRCxTQUFTRSxtQkFBbUIsQ0FBQ0YsSUFBSSxFQUFFO0lBQ2pDLElBQU1HLG1CQUFtQixHQUFHSCxJQUFJLENBQUNJLGlCQUFpQixFQUFFLEFBQUM7SUFFckQsSUFBSUQsbUJBQW1CLEVBQUU7UUFDdkIsSUFBTUUsZUFBZSxHQUFHTCxJQUFJLEVBQ3RCTSxVQUFVLEdBQUdELGVBQWUsQ0FBQ0UsYUFBYSxFQUFFLEFBQUM7UUFFbkRELFVBQVUsQ0FBQ0UsT0FBTyxDQUFDLFNBQUNDLFNBQVMsRUFBSztZQUNoQyxJQUFNQyxxQkFBcUIsR0FBR0MsQ0FBQUEsR0FBQUEsTUFBWSxBQUF5QixDQUFBLGFBQXpCLENBQUNGLFNBQVMsRUFBRUcsU0FBWSxRQUFB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