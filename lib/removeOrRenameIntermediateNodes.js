"use strict";

var _reduced = _interopRequireDefault(require("./node/reduced"));

var _repeated = _interopRequireDefault(require("./node/repeated"));

var _class = require("./utilities/class");

var _ruleName3 = require("./utilities/ruleName");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function removeOrRenameIntermediateNodes(node) {
  removeOrRenameReducedNodes(node);
  removeRepeatedNodes(node);
}

module.exports = removeOrRenameIntermediateNodes;

function removeRepeatedNodes(node) {
  var nodeNonTerminalNode = node.isNonTerminalNode();

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node; ///

    var childNodes = nonTerminalNode.getChildNodes();
    childNodes = removeRepeatedChildNodes(childNodes);
    nonTerminalNode.setChildNodes(childNodes);
  }
}

function removeRepeatedChildNodes(childNodes) {
  childNodes = childNodes.reduce(function (childNodes, childNode) {
    var childNodeRepeatedNode = (0, _class.isInstanceOf)(childNode, _repeated["default"]);

    if (childNodeRepeatedNode) {
      var childNodeChildNodes = childNode.getChildNodes();
      childNodeChildNodes = removeRepeatedChildNodes(childNodeChildNodes);
      childNodes = childNodes.concat(childNodeChildNodes);
    } else {
      removeRepeatedNodes(childNode);
      childNodes.push(childNode);
    }

    return childNodes;
  }, []);
  return childNodes;
}

function removeOrRenameReducedNodes(node) {
  var nodeNonTerminalNode = node.isNonTerminalNode();

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node,
        ///
    ruleName = nonTerminalNode.getRuleName();
    var childNodes = nonTerminalNode.getChildNodes();
    childNodes = removeOrRenameReducedChildNodes(childNodes, ruleName);
    nonTerminalNode.setChildNodes(childNodes);
  }
}

function removeOrRenameReducedChildNodes(childNodes, ruleName) {
  var childNodesLength = childNodes.length;
  childNodes = childNodes.reduce(function (childNodes, childNode) {
    var childNodeReducedNode = (0, _class.isInstanceOf)(childNode, _reduced["default"]);

    if (childNodeReducedNode) {
      var reducedNode = childNode,
          ///
      reducedNodeRuleName = reducedNode.getRuleName(),
          reducedRuleName = reducedNodeRuleName,
          ///
      reducedRuleNameMatchesRuleName = (0, _ruleName3.checkReducedRuleNameMatchesRuleName)(reducedRuleName, ruleName);

      if (reducedRuleNameMatchesRuleName) {
        if (childNodesLength > 1) {
          var _ruleName = (0, _ruleName3.ruleNameFromReducedRuleName)(reducedRuleName);

          childNode.setRuleName(_ruleName);
          removeOrRenameReducedNodes(childNode);
          childNodes.push(childNode);
        } else {
          var childNodeChildNodes = childNode.getChildNodes();
          childNodeChildNodes = removeOrRenameReducedChildNodes(childNodeChildNodes);
          childNodes = childNodes.concat(childNodeChildNodes);
        }
      } else {
        var _ruleName2 = (0, _ruleName3.ruleNameFromReducedRuleName)(reducedRuleName);

        childNode.setRuleName(_ruleName2);
        removeOrRenameReducedNodes(childNode);
        childNodes.push(childNode);
      }
    } else {
      removeOrRenameReducedNodes(childNode);
      childNodes.push(childNode);
    }

    return childNodes;
  }, []);
  return childNodes;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlbW92ZU9yUmVuYW1lSW50ZXJtZWRpYXRlTm9kZXMuanMiXSwibmFtZXMiOlsicmVtb3ZlT3JSZW5hbWVJbnRlcm1lZGlhdGVOb2RlcyIsIm5vZGUiLCJyZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyIsInJlbW92ZVJlcGVhdGVkTm9kZXMiLCJtb2R1bGUiLCJleHBvcnRzIiwibm9kZU5vblRlcm1pbmFsTm9kZSIsImlzTm9uVGVybWluYWxOb2RlIiwibm9uVGVybWluYWxOb2RlIiwiY2hpbGROb2RlcyIsImdldENoaWxkTm9kZXMiLCJyZW1vdmVSZXBlYXRlZENoaWxkTm9kZXMiLCJzZXRDaGlsZE5vZGVzIiwicmVkdWNlIiwiY2hpbGROb2RlIiwiY2hpbGROb2RlUmVwZWF0ZWROb2RlIiwiUmVwZWF0ZWROb2RlIiwiY2hpbGROb2RlQ2hpbGROb2RlcyIsImNvbmNhdCIsInB1c2giLCJydWxlTmFtZSIsImdldFJ1bGVOYW1lIiwicmVtb3ZlT3JSZW5hbWVSZWR1Y2VkQ2hpbGROb2RlcyIsImNoaWxkTm9kZXNMZW5ndGgiLCJsZW5ndGgiLCJjaGlsZE5vZGVSZWR1Y2VkTm9kZSIsIlJlZHVjZWROb2RlIiwicmVkdWNlZE5vZGUiLCJyZWR1Y2VkTm9kZVJ1bGVOYW1lIiwicmVkdWNlZFJ1bGVOYW1lIiwicmVkdWNlZFJ1bGVOYW1lTWF0Y2hlc1J1bGVOYW1lIiwic2V0UnVsZU5hbWUiXSwibWFwcGluZ3MiOiJBQUFBOztBQUVBOztBQUNBOztBQUVBOztBQUNBOzs7O0FBRUEsU0FBU0EsK0JBQVQsQ0FBeUNDLElBQXpDLEVBQStDO0FBQzdDQyxFQUFBQSwwQkFBMEIsQ0FBQ0QsSUFBRCxDQUExQjtBQUVBRSxFQUFBQSxtQkFBbUIsQ0FBQ0YsSUFBRCxDQUFuQjtBQUNEOztBQUVERyxNQUFNLENBQUNDLE9BQVAsR0FBaUJMLCtCQUFqQjs7QUFFQSxTQUFTRyxtQkFBVCxDQUE2QkYsSUFBN0IsRUFBbUM7QUFDakMsTUFBTUssbUJBQW1CLEdBQUdMLElBQUks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QUExQjtBQUVBTyxVQUFBQSxtQkFBbUIsR0FBR0ssK0JBQStCLENBQUNMLG1CQUFELENBQXJEO0FBRUFSLFVBQUFBLFVBQVUsR0FBR0EsVUFBVSxDQUFDUyxNQUFYLENBQWtCRCxtQkFBbEIsQ0FBYjtBQUNEO0FBQ0YsT0FoQkQsTUFnQk87QUFDTCxZQUFNRyxVQUFRLEdBQUcsNENBQTRCUyxlQUE1QixDQUFqQjs7QUFFQWYsUUFBQUEsU0FBUyxDQUFDaUIsV0FBVixDQUFzQlgsVUFBdEI7QUFFQWxCLFFBQUFBLDBCQUEwQixDQUFDWSxTQUFELENBQTFCO0FBRUFMLFFBQUFBLFVBQVUsQ0FBQ1UsSUFBWCxDQUFnQkwsU0FBaEI7QUFDRDtBQUNGLEtBL0JELE1BK0JPO0FBQ0xaLE1BQUFBLDBCQUEwQixDQUFDWSxTQUFELENBQTFCO0FBRUFMLE1BQUFBLFVBQVUsQ0FBQ1UsSUFBWCxDQUFnQkwsU0FBaEI7QUFDRDs7QUFFRCxXQUFPTCxVQUFQO0FBQ0QsR0F6Q1ksRUF5Q1YsRUF6Q1UsQ0FBYjtBQTJDQSxTQUFPQSxVQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFJlZHVjZWROb2RlIGZyb20gXCIuL25vZGUvcmVkdWNlZFwiO1xuaW1wb3J0IFJlcGVhdGVkTm9kZSBmcm9tIFwiLi9ub2RlL3JlcGVhdGVkXCI7XG5cbmltcG9ydCB7IGlzSW5zdGFuY2VPZiB9IGZyb20gXCIuL3V0aWxpdGllcy9jbGFzc1wiO1xuaW1wb3J0IHsgcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lLCBjaGVja1JlZHVjZWRSdWxlTmFtZU1hdGNoZXNSdWxlTmFtZSB9IGZyb20gXCIuL3V0aWxpdGllcy9ydWxlTmFtZVwiO1xuXG5mdW5jdGlvbiByZW1vdmVPclJlbmFtZUludGVybWVkaWF0ZU5vZGVzKG5vZGUpIHtcbiAgcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMobm9kZSk7XG5cbiAgcmVtb3ZlUmVwZWF0ZWROb2Rlcyhub2RlKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSByZW1vdmVPclJlbmFtZUludGVybWVkaWF0ZU5vZGVzO1xuXG5mdW5jdGlvbiByZW1vdmVSZXBlYXRlZE5vZGVzKG5vZGUpIHtcbiAgY29uc3Qgbm9kZU5vblRlcm1pbmFsTm9kZSA9IG5vZGUuaXNOb25UZXJtaW5hbE5vZGUoKTtcblxuICBpZiAobm9kZU5vblRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IG5vblRlcm1pbmFsTm9kZSA9IG5vZGU7IC8vL1xuXG4gICAgbGV0IGNoaWxkTm9kZXMgPSBub25UZXJtaW5hbE5vZGUuZ2V0Q2hpbGROb2RlcygpO1xuXG4gICAgY2hpbGROb2RlcyA9IHJlbW92ZVJlcGVhdGVkQ2hpbGROb2RlcyhjaGlsZE5vZGVzKTtcblxuICAgIG5vblRlcm1pbmFsTm9kZS5zZXRDaGlsZE5vZGVzKGNoaWxkTm9kZXMpXG4gIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlUmVwZWF0ZWRDaGlsZE5vZGVzKGNoaWxkTm9kZXMpIHtcbiAgY2hpbGROb2RlcyA9IGNoaWxkTm9kZXMucmVkdWNlKChjaGlsZE5vZGVzLCBjaGlsZE5vZGUpID0+IHtcbiAgICBjb25zdCBjaGlsZE5vZGVSZXBlYXRlZE5vZGUgPSBpc0luc3RhbmNlT2YoY2hpbGROb2RlLCBSZXBlYXRlZE5vZGUpO1xuXG4gICAgaWYgKGNoaWxkTm9kZVJlcGVhdGVkTm9kZSkge1xuICAgICAgbGV0IGNoaWxkTm9kZUNoaWxkTm9kZXMgPSBjaGlsZE5vZGUuZ2V0Q2hpbGROb2RlcygpO1xuXG4gICAgICBjaGlsZE5vZGVDaGlsZE5vZGVzID0gcmVtb3ZlUmVwZWF0ZWRDaGlsZE5vZGVzKGNoaWxkTm9kZUNoaWxkTm9kZXMpO1xuXG4gICAgICBjaGlsZE5vZGVzID0gY2hpbGROb2Rlcy5jb25jYXQoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlbW92ZVJlcGVhdGVkTm9kZXMoY2hpbGROb2RlKTtcblxuICAgICAgY2hpbGROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgfVxuXG4gICAgcmV0dXJuIGNoaWxkTm9kZXM7XG4gIH0sIFtdKTtcblxuICByZXR1cm4gY2hpbGROb2Rlcztcbn1cblxuZnVuY3Rpb24gcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMobm9kZSkge1xuICBjb25zdCBub2RlTm9uVGVybWluYWxOb2RlID0gbm9kZS5pc05vblRlcm1pbmFsTm9kZSgpO1xuXG4gIGlmIChub2RlTm9uVGVybWluYWxOb2RlKSB7XG4gICAgY29uc3Qgbm9uVGVybWluYWxOb2RlID0gbm9kZSwgLy8vXG4gICAgICAgICAgcnVsZU5hbWUgPSBub25UZXJtaW5hbE5vZGUuZ2V0UnVsZU5hbWUoKTtcblxuICAgIGxldCBjaGlsZE5vZGVzID0gbm9uVGVybWluYWxOb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICAgIGNoaWxkTm9kZXMgPSByZW1vdmVPclJlbmFtZVJlZHVjZWRDaGlsZE5vZGVzKGNoaWxkTm9kZXMsIHJ1bGVOYW1lKTtcblxuICAgIG5vblRlcm1pbmFsTm9kZS5zZXRDaGlsZE5vZGVzKGNoaWxkTm9kZXMpXG4gIH1cbn1cblxuZnVuY3Rpb24gcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkQ2hpbGROb2RlcyhjaGlsZE5vZGVzLCBydWxlTmFtZSkge1xuICBjb25zdCBjaGlsZE5vZGVzTGVuZ3RoID0gY2hpbGROb2Rlcy5sZW5ndGg7XG5cbiAgY2hpbGROb2RlcyA9IGNoaWxkTm9kZXMucmVkdWNlKChjaGlsZE5vZGVzLCBjaGlsZE5vZGUpID0+IHtcbiAgICBjb25zdCBjaGlsZE5vZGVSZWR1Y2VkTm9kZSA9IGlzSW5zdGFuY2VPZihjaGlsZE5vZGUsIFJlZHVjZWROb2RlKTtcblxuICAgIGlmIChjaGlsZE5vZGVSZWR1Y2VkTm9kZSkge1xuICAgICAgY29uc3QgcmVkdWNlZE5vZGUgPSBjaGlsZE5vZGUsIC8vL1xuICAgICAgICAgICAgcmVkdWNlZE5vZGVSdWxlTmFtZSA9IHJlZHVjZWROb2RlLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICByZWR1Y2VkUnVsZU5hbWUgPSByZWR1Y2VkTm9kZVJ1bGVOYW1lLCAgLy8vXG4gICAgICAgICAgICByZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUgPSBjaGVja1JlZHVjZWRSdWxlTmFtZU1hdGNoZXNSdWxlTmFtZShyZWR1Y2VkUnVsZU5hbWUsIHJ1bGVOYW1lKTtcblxuICAgICAgaWYgKHJlZHVjZWRSdWxlTmFtZU1hdGNoZXNSdWxlTmFtZSkge1xuICAgICAgICBpZiAoY2hpbGROb2Rlc0xlbmd0aCA+IDEpIHtcbiAgICAgICAgICBjb25zdCBydWxlTmFtZSA9IHJ1bGVOYW1lRnJvbVJlZHVjZWRSdWxlTmFtZShyZWR1Y2VkUnVsZU5hbWUpO1xuXG4gICAgICAgICAgY2hpbGROb2RlLnNldFJ1bGVOYW1lKHJ1bGVOYW1lKTtcblxuICAgICAgICAgIHJlbW92ZU9yUmVuYW1lUmVkdWNlZE5vZGVzKGNoaWxkTm9kZSk7XG5cbiAgICAgICAgICBjaGlsZE5vZGVzLnB1c2goY2hpbGROb2RlKTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBsZXQgY2hpbGROb2RlQ2hpbGROb2RlcyA9IGNoaWxkTm9kZS5nZXRDaGlsZE5vZGVzKCk7XG5cbiAgICAgICAgICBjaGlsZE5vZGVDaGlsZE5vZGVzID0gcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkQ2hpbGROb2RlcyhjaGlsZE5vZGVDaGlsZE5vZGVzKTtcblxuICAgICAgICAgIGNoaWxkTm9kZXMgPSBjaGlsZE5vZGVzLmNvbmNhdChjaGlsZE5vZGVDaGlsZE5vZGVzKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgY29uc3QgcnVsZU5hbWUgPSBydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUocmVkdWNlZFJ1bGVOYW1lKTtcblxuICAgICAgICBjaGlsZE5vZGUuc2V0UnVsZU5hbWUocnVsZU5hbWUpO1xuXG4gICAgICAgIHJlbW92ZU9yUmVuYW1lUmVkdWNlZE5vZGVzKGNoaWxkTm9kZSk7XG5cbiAgICAgICAgY2hpbGROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHJlbW92ZU9yUmVuYW1lUmVkdWNlZE5vZGVzKGNoaWxkTm9kZSk7XG5cbiAgICAgIGNoaWxkTm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgIH1cblxuICAgIHJldHVybiBjaGlsZE5vZGVzO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIGNoaWxkTm9kZXM7XG59XG4iXX0=