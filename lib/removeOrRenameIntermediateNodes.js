'use strict';

var ReducedNode = require('./node/reduced'),
    RepeatedNode = require('./node/repeated'),
    classUtilities = require('./utilities/class'),
    ruleNameUtilities = require('./utilities/ruleName');

var isInstanceOf = classUtilities.isInstanceOf,
    ruleNameFromReducedRuleName = ruleNameUtilities.ruleNameFromReducedRuleName,
    checkReducedRuleNameMatchesRuleName = ruleNameUtilities.checkReducedRuleNameMatchesRuleName;

function removeOrRenameIntermediateNodes(node) {
  removeOrRenameReducedNodes(node);
  removeRepeatedNodes(node);
}

module.exports = removeOrRenameIntermediateNodes;

function removeRepeatedNodes(node) {
  var nodeNonTerminalNode = node.isNonTerminalNode();

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node; ///

    var childNodes = nonTerminalNode.getChildNodes();
    childNodes = removeRepeatedChildNodes(childNodes);
    nonTerminalNode.setChildNodes(childNodes);
  }
}

function removeRepeatedChildNodes(childNodes) {
  childNodes = childNodes.reduce(function (childNodes, childNode) {
    var childNodeRepeatedNode = isInstanceOf(childNode, RepeatedNode);

    if (childNodeRepeatedNode) {
      var childNodeChildNodes = childNode.getChildNodes();
      childNodeChildNodes = removeRepeatedChildNodes(childNodeChildNodes);
      childNodes = childNodes.concat(childNodeChildNodes);
    } else {
      removeRepeatedNodes(childNode);
      childNodes.push(childNode);
    }

    return childNodes;
  }, []);
  return childNodes;
}

function removeOrRenameReducedNodes(node) {
  var nodeNonTerminalNode = node.isNonTerminalNode();

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node,
        ///
    ruleName = nonTerminalNode.getRuleName();
    var childNodes = nonTerminalNode.getChildNodes();
    childNodes = removeOrRenameReducedChildNodes(childNodes, ruleName);
    nonTerminalNode.setChildNodes(childNodes);
  }
}

function removeOrRenameReducedChildNodes(childNodes, ruleName) {
  var childNodesLength = childNodes.length;
  childNodes = childNodes.reduce(function (childNodes, childNode) {
    var childNodeReducedNode = isInstanceOf(childNode, ReducedNode);

    if (childNodeReducedNode) {
      var reducedNode = childNode,
          ///
      reducedNodeRuleName = reducedNode.getRuleName(),
          reducedRuleName = reducedNodeRuleName,
          ///
      reducedRuleNameMatchesRuleName = checkReducedRuleNameMatchesRuleName(reducedRuleName, ruleName);

      if (reducedRuleNameMatchesRuleName) {
        if (childNodesLength > 1) {
          var _ruleName = ruleNameFromReducedRuleName(reducedRuleName);

          childNode.setRuleName(_ruleName);
          removeOrRenameReducedNodes(childNode);
          childNodes.push(childNode);
        } else {
          var childNodeChildNodes = childNode.getChildNodes();
          childNodeChildNodes = removeOrRenameReducedChildNodes(childNodeChildNodes);
          childNodes = childNodes.concat(childNodeChildNodes);
        }
      } else {
        var _ruleName2 = ruleNameFromReducedRuleName(reducedRuleName);

        childNode.setRuleName(_ruleName2);
        removeOrRenameReducedNodes(childNode);
        childNodes.push(childNode);
      }
    } else {
      removeOrRenameReducedNodes(childNode);
      childNodes.push(childNode);
    }

    return childNodes;
  }, []);
  return childNodes;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlbW92ZU9yUmVuYW1lSW50ZXJtZWRpYXRlTm9kZXMuanMiXSwibmFtZXMiOlsiUmVkdWNlZE5vZGUiLCJyZXF1aXJlIiwiUmVwZWF0ZWROb2RlIiwiY2xhc3NVdGlsaXRpZXMiLCJydWxlTmFtZVV0aWxpdGllcyIsImlzSW5zdGFuY2VPZiIsInJ1bGVOYW1lRnJvbVJlZHVjZWRSdWxlTmFtZSIsImNoZWNrUmVkdWNlZFJ1bGVOYW1lTWF0Y2hlc1J1bGVOYW1lIiwicmVtb3ZlT3JSZW5hbWVJbnRlcm1lZGlhdGVOb2RlcyIsIm5vZGUiLCJyZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyIsInJlbW92ZVJlcGVhdGVkTm9kZXMiLCJtb2R1bGUiLCJleHBvcnRzIiwibm9kZU5vblRlcm1pbmFsTm9kZSIsImlzTm9uVGVybWluYWxOb2RlIiwibm9uVGVybWluYWxOb2RlIiwiY2hpbGROb2RlcyIsImdldENoaWxkTm9kZXMiLCJyZW1vdmVSZXBlYXRlZENoaWxkTm9kZXMiLCJzZXRDaGlsZE5vZGVzIiwicmVkdWNlIiwiY2hpbGROb2RlIiwiY2hpbGROb2RlUmVwZWF0ZWROb2RlIiwiY2hpbGROb2RlQ2hpbGROb2RlcyIsImNvbmNhdCIsInB1c2giLCJydWxlTmFtZSIsImdldFJ1bGVOYW1lIiwicmVtb3ZlT3JSZW5hbWVSZWR1Y2VkQ2hpbGROb2RlcyIsImNoaWxkTm9kZXNMZW5ndGgiLCJsZW5ndGgiLCJjaGlsZE5vZGVSZWR1Y2VkTm9kZSIsInJlZHVjZWROb2RlIiwicmVkdWNlZE5vZGVSdWxlTmFtZSIsInJlZHVjZWRSdWxlTmFtZSIsInJlZHVjZWRSdWxlTmFtZU1hdGNoZXNSdWxlTmFtZSIsInNldFJ1bGVOYW1lIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxJQUFNQSxXQUFXLEdBQUdDLE9BQU8sQ0FBQyxnQkFBRCxDQUEzQjtBQUFBLElBQ01DLFlBQVksR0FBR0QsT0FBTyxDQUFDLGlCQUFELENBRDVCO0FBQUEsSUFFTUUsY0FBYyxHQUFHRixPQUFP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T0EsVUFBUDtBQUNEIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBSZWR1Y2VkTm9kZSA9IHJlcXVpcmUoJy4vbm9kZS9yZWR1Y2VkJyksXG4gICAgICBSZXBlYXRlZE5vZGUgPSByZXF1aXJlKCcuL25vZGUvcmVwZWF0ZWQnKSxcbiAgICAgIGNsYXNzVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvY2xhc3MnKSxcbiAgICAgIHJ1bGVOYW1lVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvcnVsZU5hbWUnKTtcblxuY29uc3QgeyBpc0luc3RhbmNlT2YgfSA9IGNsYXNzVXRpbGl0aWVzLFxuICAgICAgeyBydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUsIGNoZWNrUmVkdWNlZFJ1bGVOYW1lTWF0Y2hlc1J1bGVOYW1lIH0gPSBydWxlTmFtZVV0aWxpdGllcztcblxuZnVuY3Rpb24gcmVtb3ZlT3JSZW5hbWVJbnRlcm1lZGlhdGVOb2Rlcyhub2RlKSB7XG4gIHJlbW92ZU9yUmVuYW1lUmVkdWNlZE5vZGVzKG5vZGUpO1xuXG4gIHJlbW92ZVJlcGVhdGVkTm9kZXMobm9kZSk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gcmVtb3ZlT3JSZW5hbWVJbnRlcm1lZGlhdGVOb2RlcztcblxuZnVuY3Rpb24gcmVtb3ZlUmVwZWF0ZWROb2Rlcyhub2RlKSB7XG4gIGNvbnN0IG5vZGVOb25UZXJtaW5hbE5vZGUgPSBub2RlLmlzTm9uVGVybWluYWxOb2RlKCk7XG5cbiAgaWYgKG5vZGVOb25UZXJtaW5hbE5vZGUpIHtcbiAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBub2RlOyAvLy9cblxuICAgIGxldCBjaGlsZE5vZGVzID0gbm9uVGVybWluYWxOb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICAgIGNoaWxkTm9kZXMgPSByZW1vdmVSZXBlYXRlZENoaWxkTm9kZXMoY2hpbGROb2Rlcyk7XG5cbiAgICBub25UZXJtaW5hbE5vZGUuc2V0Q2hpbGROb2RlcyhjaGlsZE5vZGVzKVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZVJlcGVhdGVkQ2hpbGROb2RlcyhjaGlsZE5vZGVzKSB7XG4gIGNoaWxkTm9kZXMgPSBjaGlsZE5vZGVzLnJlZHVjZSgoY2hpbGROb2RlcywgY2hpbGROb2RlKSA9PiB7XG4gICAgY29uc3QgY2hpbGROb2RlUmVwZWF0ZWROb2RlID0gaXNJbnN0YW5jZU9mKGNoaWxkTm9kZSwgUmVwZWF0ZWROb2RlKTtcblxuICAgIGlmIChjaGlsZE5vZGVSZXBlYXRlZE5vZGUpIHtcbiAgICAgIGxldCBjaGlsZE5vZGVDaGlsZE5vZGVzID0gY2hpbGROb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICAgICAgY2hpbGROb2RlQ2hpbGROb2RlcyA9IHJlbW92ZVJlcGVhdGVkQ2hpbGROb2RlcyhjaGlsZE5vZGVDaGlsZE5vZGVzKTtcblxuICAgICAgY2hpbGROb2RlcyA9IGNoaWxkTm9kZXMuY29uY2F0KGNoaWxkTm9kZUNoaWxkTm9kZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZW1vdmVSZXBlYXRlZE5vZGVzKGNoaWxkTm9kZSk7XG5cbiAgICAgIGNoaWxkTm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgIH1cblxuICAgIHJldHVybiBjaGlsZE5vZGVzO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIGNoaWxkTm9kZXM7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZU9yUmVuYW1lUmVkdWNlZE5vZGVzKG5vZGUpIHtcbiAgY29uc3Qgbm9kZU5vblRlcm1pbmFsTm9kZSA9IG5vZGUuaXNOb25UZXJtaW5hbE5vZGUoKTtcblxuICBpZiAobm9kZU5vblRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IG5vblRlcm1pbmFsTm9kZSA9IG5vZGUsIC8vL1xuICAgICAgICAgIHJ1bGVOYW1lID0gbm9uVGVybWluYWxOb2RlLmdldFJ1bGVOYW1lKCk7XG5cbiAgICBsZXQgY2hpbGROb2RlcyA9IG5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCk7XG5cbiAgICBjaGlsZE5vZGVzID0gcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkQ2hpbGROb2RlcyhjaGlsZE5vZGVzLCBydWxlTmFtZSk7XG5cbiAgICBub25UZXJtaW5hbE5vZGUuc2V0Q2hpbGROb2RlcyhjaGlsZE5vZGVzKVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMoY2hpbGROb2RlcywgcnVsZU5hbWUpIHtcbiAgY29uc3QgY2hpbGROb2Rlc0xlbmd0aCA9IGNoaWxkTm9kZXMubGVuZ3RoO1xuXG4gIGNoaWxkTm9kZXMgPSBjaGlsZE5vZGVzLnJlZHVjZSgoY2hpbGROb2RlcywgY2hpbGROb2RlKSA9PiB7XG4gICAgY29uc3QgY2hpbGROb2RlUmVkdWNlZE5vZGUgPSBpc0luc3RhbmNlT2YoY2hpbGROb2RlLCBSZWR1Y2VkTm9kZSk7XG5cbiAgICBpZiAoY2hpbGROb2RlUmVkdWNlZE5vZGUpIHtcbiAgICAgIGNvbnN0IHJlZHVjZWROb2RlID0gY2hpbGROb2RlLCAvLy9cbiAgICAgICAgICAgIHJlZHVjZWROb2RlUnVsZU5hbWUgPSByZWR1Y2VkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lID0gcmVkdWNlZE5vZGVSdWxlTmFtZSwgIC8vL1xuICAgICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lTWF0Y2hlc1J1bGVOYW1lID0gY2hlY2tSZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUocmVkdWNlZFJ1bGVOYW1lLCBydWxlTmFtZSk7XG5cbiAgICAgIGlmIChyZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUpIHtcbiAgICAgICAgaWYgKGNoaWxkTm9kZXNMZW5ndGggPiAxKSB7XG4gICAgICAgICAgY29uc3QgcnVsZU5hbWUgPSBydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUocmVkdWNlZFJ1bGVOYW1lKTtcblxuICAgICAgICAgIGNoaWxkTm9kZS5zZXRSdWxlTmFtZShydWxlTmFtZSk7XG5cbiAgICAgICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICAgICAgY2hpbGROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGV0IGNoaWxkTm9kZUNoaWxkTm9kZXMgPSBjaGlsZE5vZGUuZ2V0Q2hpbGROb2RlcygpO1xuXG4gICAgICAgICAgY2hpbGROb2RlQ2hpbGROb2RlcyA9IHJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG5cbiAgICAgICAgICBjaGlsZE5vZGVzID0gY2hpbGROb2Rlcy5jb25jYXQoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lKHJlZHVjZWRSdWxlTmFtZSk7XG5cbiAgICAgICAgY2hpbGROb2RlLnNldFJ1bGVOYW1lKHJ1bGVOYW1lKTtcblxuICAgICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICAgIGNoaWxkTm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICBjaGlsZE5vZGVzLnB1c2goY2hpbGROb2RlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2hpbGROb2RlcztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBjaGlsZE5vZGVzO1xufVxuIl19