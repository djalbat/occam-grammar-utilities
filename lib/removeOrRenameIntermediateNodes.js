"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = removeOrRenameIntermediateNodes;

var _reduced = _interopRequireDefault(require("./node/reduced"));

var _repeated = _interopRequireDefault(require("./node/repeated"));

var _class = require("./utilities/class");

var _ruleName3 = require("./utilities/ruleName");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function removeOrRenameIntermediateNodes(node) {
  removeOrRenameReducedNodes(node);
  removeRepeatedNodes(node);
}

function removeRepeatedNodes(node) {
  var nodeNonTerminalNode = node.isNonTerminalNode();

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node; ///

    var childNodes = nonTerminalNode.getChildNodes();
    childNodes = removeRepeatedChildNodes(childNodes);
    nonTerminalNode.setChildNodes(childNodes);
  }
}

function removeRepeatedChildNodes(childNodes) {
  childNodes = childNodes.reduce(function (childNodes, childNode) {
    var childNodeRepeatedNode = (0, _class.isInstanceOf)(childNode, _repeated["default"]);

    if (childNodeRepeatedNode) {
      var childNodeChildNodes = childNode.getChildNodes();
      childNodeChildNodes = removeRepeatedChildNodes(childNodeChildNodes);
      childNodes = childNodes.concat(childNodeChildNodes);
    } else {
      removeRepeatedNodes(childNode);
      childNodes.push(childNode);
    }

    return childNodes;
  }, []);
  return childNodes;
}

function removeOrRenameReducedNodes(node) {
  var nodeNonTerminalNode = node.isNonTerminalNode();

  if (nodeNonTerminalNode) {
    var nonTerminalNode = node,
        ///
    ruleName = nonTerminalNode.getRuleName();
    var childNodes = nonTerminalNode.getChildNodes();
    childNodes = removeOrRenameReducedChildNodes(childNodes, ruleName);
    nonTerminalNode.setChildNodes(childNodes);
  }
}

function removeOrRenameReducedChildNodes(childNodes, ruleName) {
  var childNodesLength = childNodes.length;
  childNodes = childNodes.reduce(function (childNodes, childNode) {
    var childNodeReducedNode = (0, _class.isInstanceOf)(childNode, _reduced["default"]);

    if (childNodeReducedNode) {
      var reducedNode = childNode,
          ///
      reducedNodeRuleName = reducedNode.getRuleName(),
          reducedRuleName = reducedNodeRuleName,
          ///
      reducedRuleNameMatchesRuleName = (0, _ruleName3.checkReducedRuleNameMatchesRuleName)(reducedRuleName, ruleName);

      if (reducedRuleNameMatchesRuleName) {
        if (childNodesLength > 1) {
          var _ruleName = (0, _ruleName3.ruleNameFromReducedRuleName)(reducedRuleName);

          childNode.setRuleName(_ruleName);
          removeOrRenameReducedNodes(childNode);
          childNodes.push(childNode);
        } else {
          var childNodeChildNodes = childNode.getChildNodes();
          childNodeChildNodes = removeOrRenameReducedChildNodes(childNodeChildNodes);
          childNodes = childNodes.concat(childNodeChildNodes);
        }
      } else {
        var _ruleName2 = (0, _ruleName3.ruleNameFromReducedRuleName)(reducedRuleName);

        childNode.setRuleName(_ruleName2);
        removeOrRenameReducedNodes(childNode);
        childNodes.push(childNode);
      }
    } else {
      removeOrRenameReducedNodes(childNode);
      childNodes.push(childNode);
    }

    return childNodes;
  }, []);
  return childNodes;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlbW92ZU9yUmVuYW1lSW50ZXJtZWRpYXRlTm9kZXMuanMiXSwibmFtZXMiOlsicmVtb3ZlT3JSZW5hbWVJbnRlcm1lZGlhdGVOb2RlcyIsIm5vZGUiLCJyZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyIsInJlbW92ZVJlcGVhdGVkTm9kZXMiLCJub2RlTm9uVGVybWluYWxOb2RlIiwiaXNOb25UZXJtaW5hbE5vZGUiLCJub25UZXJtaW5hbE5vZGUiLCJjaGlsZE5vZGVzIiwiZ2V0Q2hpbGROb2RlcyIsInJlbW92ZVJlcGVhdGVkQ2hpbGROb2RlcyIsInNldENoaWxkTm9kZXMiLCJyZWR1Y2UiLCJjaGlsZE5vZGUiLCJjaGlsZE5vZGVSZXBlYXRlZE5vZGUiLCJSZXBlYXRlZE5vZGUiLCJjaGlsZE5vZGVDaGlsZE5vZGVzIiwiY29uY2F0IiwicHVzaCIsInJ1bGVOYW1lIiwiZ2V0UnVsZU5hbWUiLCJyZW1vdmVPclJlbmFtZVJlZHVjZWRDaGlsZE5vZGVzIiwiY2hpbGROb2Rlc0xlbmd0aCIsImxlbmd0aCIsImNoaWxkTm9kZVJlZHVjZWROb2RlIiwiUmVkdWNlZE5vZGUiLCJyZWR1Y2VkTm9kZSIsInJlZHVjZWROb2RlUnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWUiLCJyZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUiLCJzZXRSdWxlTmFtZSJdLCJtYXBwaW5ncyI6IkFBQUE7Ozs7Ozs7QUFFQTs7QUFDQTs7QUFFQTs7QUFDQTs7OztBQUVlLFNBQVNBLCtCQUFULENBQXlDQyxJQUF6QyxFQUErQztBQUM1REMsRUFBQUEsMEJBQTBCLENBQUNELElBQUQsQ0FBMUI7QUFFQUUsRUFBQUEsbUJBQW1CLENBQUNGLElBQUQsQ0FBbkI7QUFDRDs7QUFFRCxTQUFTRSxtQkFBVCxDQUE2QkYsSUFBN0IsRUFBbUM7QUFDakMsTUFBTUcsbUJBQW1CLEdBQUdILElBQUksQ0FBQ0ksaUJBQUwsRUFBNUI7O0FBRUEsTUFBSUQsbUJBQUosRUFBeUI7QUFDdkIsUUFB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QXJEO0FBRUFSLFVBQUFBLFVBQVUsR0FBR0EsVUFBVSxDQUFDUyxNQUFYLENBQWtCRCxtQkFBbEIsQ0FBYjtBQUNEO0FBQ0YsT0FoQkQsTUFnQk87QUFDTCxZQUFNRyxVQUFRLEdBQUcsNENBQTRCUyxlQUE1QixDQUFqQjs7QUFFQWYsUUFBQUEsU0FBUyxDQUFDaUIsV0FBVixDQUFzQlgsVUFBdEI7QUFFQWhCLFFBQUFBLDBCQUEwQixDQUFDVSxTQUFELENBQTFCO0FBRUFMLFFBQUFBLFVBQVUsQ0FBQ1UsSUFBWCxDQUFnQkwsU0FBaEI7QUFDRDtBQUNGLEtBL0JELE1BK0JPO0FBQ0xWLE1BQUFBLDBCQUEwQixDQUFDVSxTQUFELENBQTFCO0FBRUFMLE1BQUFBLFVBQVUsQ0FBQ1UsSUFBWCxDQUFnQkwsU0FBaEI7QUFDRDs7QUFFRCxXQUFPTCxVQUFQO0FBQ0QsR0F6Q1ksRUF5Q1YsRUF6Q1UsQ0FBYjtBQTJDQSxTQUFPQSxVQUFQO0FBQ0QiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxuaW1wb3J0IFJlZHVjZWROb2RlIGZyb20gXCIuL25vZGUvcmVkdWNlZFwiO1xuaW1wb3J0IFJlcGVhdGVkTm9kZSBmcm9tIFwiLi9ub2RlL3JlcGVhdGVkXCI7XG5cbmltcG9ydCB7IGlzSW5zdGFuY2VPZiB9IGZyb20gXCIuL3V0aWxpdGllcy9jbGFzc1wiO1xuaW1wb3J0IHsgcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lLCBjaGVja1JlZHVjZWRSdWxlTmFtZU1hdGNoZXNSdWxlTmFtZSB9IGZyb20gXCIuL3V0aWxpdGllcy9ydWxlTmFtZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiByZW1vdmVPclJlbmFtZUludGVybWVkaWF0ZU5vZGVzKG5vZGUpIHtcbiAgcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkTm9kZXMobm9kZSk7XG5cbiAgcmVtb3ZlUmVwZWF0ZWROb2Rlcyhub2RlKTtcbn1cblxuZnVuY3Rpb24gcmVtb3ZlUmVwZWF0ZWROb2Rlcyhub2RlKSB7XG4gIGNvbnN0IG5vZGVOb25UZXJtaW5hbE5vZGUgPSBub2RlLmlzTm9uVGVybWluYWxOb2RlKCk7XG5cbiAgaWYgKG5vZGVOb25UZXJtaW5hbE5vZGUpIHtcbiAgICBjb25zdCBub25UZXJtaW5hbE5vZGUgPSBub2RlOyAvLy9cblxuICAgIGxldCBjaGlsZE5vZGVzID0gbm9uVGVybWluYWxOb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICAgIGNoaWxkTm9kZXMgPSByZW1vdmVSZXBlYXRlZENoaWxkTm9kZXMoY2hpbGROb2Rlcyk7XG5cbiAgICBub25UZXJtaW5hbE5vZGUuc2V0Q2hpbGROb2RlcyhjaGlsZE5vZGVzKVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZVJlcGVhdGVkQ2hpbGROb2RlcyhjaGlsZE5vZGVzKSB7XG4gIGNoaWxkTm9kZXMgPSBjaGlsZE5vZGVzLnJlZHVjZSgoY2hpbGROb2RlcywgY2hpbGROb2RlKSA9PiB7XG4gICAgY29uc3QgY2hpbGROb2RlUmVwZWF0ZWROb2RlID0gaXNJbnN0YW5jZU9mKGNoaWxkTm9kZSwgUmVwZWF0ZWROb2RlKTtcblxuICAgIGlmIChjaGlsZE5vZGVSZXBlYXRlZE5vZGUpIHtcbiAgICAgIGxldCBjaGlsZE5vZGVDaGlsZE5vZGVzID0gY2hpbGROb2RlLmdldENoaWxkTm9kZXMoKTtcblxuICAgICAgY2hpbGROb2RlQ2hpbGROb2RlcyA9IHJlbW92ZVJlcGVhdGVkQ2hpbGROb2RlcyhjaGlsZE5vZGVDaGlsZE5vZGVzKTtcblxuICAgICAgY2hpbGROb2RlcyA9IGNoaWxkTm9kZXMuY29uY2F0KGNoaWxkTm9kZUNoaWxkTm9kZXMpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZW1vdmVSZXBlYXRlZE5vZGVzKGNoaWxkTm9kZSk7XG5cbiAgICAgIGNoaWxkTm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgIH1cblxuICAgIHJldHVybiBjaGlsZE5vZGVzO1xuICB9LCBbXSk7XG5cbiAgcmV0dXJuIGNoaWxkTm9kZXM7XG59XG5cbmZ1bmN0aW9uIHJlbW92ZU9yUmVuYW1lUmVkdWNlZE5vZGVzKG5vZGUpIHtcbiAgY29uc3Qgbm9kZU5vblRlcm1pbmFsTm9kZSA9IG5vZGUuaXNOb25UZXJtaW5hbE5vZGUoKTtcblxuICBpZiAobm9kZU5vblRlcm1pbmFsTm9kZSkge1xuICAgIGNvbnN0IG5vblRlcm1pbmFsTm9kZSA9IG5vZGUsIC8vL1xuICAgICAgICAgIHJ1bGVOYW1lID0gbm9uVGVybWluYWxOb2RlLmdldFJ1bGVOYW1lKCk7XG5cbiAgICBsZXQgY2hpbGROb2RlcyA9IG5vblRlcm1pbmFsTm9kZS5nZXRDaGlsZE5vZGVzKCk7XG5cbiAgICBjaGlsZE5vZGVzID0gcmVtb3ZlT3JSZW5hbWVSZWR1Y2VkQ2hpbGROb2RlcyhjaGlsZE5vZGVzLCBydWxlTmFtZSk7XG5cbiAgICBub25UZXJtaW5hbE5vZGUuc2V0Q2hpbGROb2RlcyhjaGlsZE5vZGVzKVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMoY2hpbGROb2RlcywgcnVsZU5hbWUpIHtcbiAgY29uc3QgY2hpbGROb2Rlc0xlbmd0aCA9IGNoaWxkTm9kZXMubGVuZ3RoO1xuXG4gIGNoaWxkTm9kZXMgPSBjaGlsZE5vZGVzLnJlZHVjZSgoY2hpbGROb2RlcywgY2hpbGROb2RlKSA9PiB7XG4gICAgY29uc3QgY2hpbGROb2RlUmVkdWNlZE5vZGUgPSBpc0luc3RhbmNlT2YoY2hpbGROb2RlLCBSZWR1Y2VkTm9kZSk7XG5cbiAgICBpZiAoY2hpbGROb2RlUmVkdWNlZE5vZGUpIHtcbiAgICAgIGNvbnN0IHJlZHVjZWROb2RlID0gY2hpbGROb2RlLCAvLy9cbiAgICAgICAgICAgIHJlZHVjZWROb2RlUnVsZU5hbWUgPSByZWR1Y2VkTm9kZS5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lID0gcmVkdWNlZE5vZGVSdWxlTmFtZSwgIC8vL1xuICAgICAgICAgICAgcmVkdWNlZFJ1bGVOYW1lTWF0Y2hlc1J1bGVOYW1lID0gY2hlY2tSZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUocmVkdWNlZFJ1bGVOYW1lLCBydWxlTmFtZSk7XG5cbiAgICAgIGlmIChyZWR1Y2VkUnVsZU5hbWVNYXRjaGVzUnVsZU5hbWUpIHtcbiAgICAgICAgaWYgKGNoaWxkTm9kZXNMZW5ndGggPiAxKSB7XG4gICAgICAgICAgY29uc3QgcnVsZU5hbWUgPSBydWxlTmFtZUZyb21SZWR1Y2VkUnVsZU5hbWUocmVkdWNlZFJ1bGVOYW1lKTtcblxuICAgICAgICAgIGNoaWxkTm9kZS5zZXRSdWxlTmFtZShydWxlTmFtZSk7XG5cbiAgICAgICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICAgICAgY2hpbGROb2Rlcy5wdXNoKGNoaWxkTm9kZSk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgbGV0IGNoaWxkTm9kZUNoaWxkTm9kZXMgPSBjaGlsZE5vZGUuZ2V0Q2hpbGROb2RlcygpO1xuXG4gICAgICAgICAgY2hpbGROb2RlQ2hpbGROb2RlcyA9IHJlbW92ZU9yUmVuYW1lUmVkdWNlZENoaWxkTm9kZXMoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG5cbiAgICAgICAgICBjaGlsZE5vZGVzID0gY2hpbGROb2Rlcy5jb25jYXQoY2hpbGROb2RlQ2hpbGROb2Rlcyk7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHJ1bGVOYW1lID0gcnVsZU5hbWVGcm9tUmVkdWNlZFJ1bGVOYW1lKHJlZHVjZWRSdWxlTmFtZSk7XG5cbiAgICAgICAgY2hpbGROb2RlLnNldFJ1bGVOYW1lKHJ1bGVOYW1lKTtcblxuICAgICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICAgIGNoaWxkTm9kZXMucHVzaChjaGlsZE5vZGUpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICByZW1vdmVPclJlbmFtZVJlZHVjZWROb2RlcyhjaGlsZE5vZGUpO1xuXG4gICAgICBjaGlsZE5vZGVzLnB1c2goY2hpbGROb2RlKTtcbiAgICB9XG5cbiAgICByZXR1cm4gY2hpbGROb2RlcztcbiAgfSwgW10pO1xuXG4gIHJldHVybiBjaGlsZE5vZGVzO1xufVxuIl19