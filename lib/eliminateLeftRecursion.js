"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = eliminateLeftRecursion;
var _reduced = _interopRequireDefault(require("./rule/reduced"));
var _rewritten = _interopRequireDefault(require("./rule/rewritten"));
var _recursive = _interopRequireDefault(require("./definition/recursive"));
var _left = _interopRequireDefault(require("./definition/recursive/left"));
var _directly = _interopRequireDefault(require("./definition/recursive/left/directly"));
var _indirectly = _interopRequireDefault(require("./definition/recursive/left/indirectly"));
var _class = require("./utilities/class");
var _rule = require("./utilities/rule");
function eliminateLeftRecursion(startRule, ruleMap) {
    var rule = startRule, reducedRules = [], rewrittenRules = [], leftRecursiveRules = [], recursiveDefinitions = [], leftRecursiveDefinitions = [];
    retrieveLeftRecursiveDefinitions(rule, recursiveDefinitions, leftRecursiveDefinitions, ruleMap);
    eliminateIndirectLeftRecursion(leftRecursiveDefinitions, ruleMap);
    // retrieveLeftRecursiveRules(leftRecursiveRules, leftRecursiveDefinitions, ruleMap);
    //
    // reduceLeftRecursiveRules(leftRecursiveRules, reducedRules, ruleMap);
    //
    // rewriteLeftRecursiveRules(leftRecursiveRules, rewrittenRules, ruleMap);
    ///
    eliminateDirectLeftRecursion(rewrittenRules, ruleMap);
    var startRuleName = startRule.getName();
    startRule = ruleMap[startRuleName]; ///
    return startRule;
}
function _arrayLikeToArray(arr, len) {
    if (len == null || len > arr.length) len = arr.length;
    for(var i = 0, arr2 = new Array(len); i < len; i++)arr2[i] = arr[i];
    return arr2;
}
function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) return _arrayLikeToArray(arr);
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _iterableToArray(iter) {
    if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}
function _unsupportedIterableToArray(o, minLen) {
    if (!o) return;
    if (typeof o === "string") return _arrayLikeToArray(o, minLen);
    var n = Object.prototype.toString.call(o).slice(8, -1);
    if (n === "Object" && o.constructor) n = o.constructor.name;
    if (n === "Map" || n === "Set") return Array.from(n);
    if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}
function reduceLeftRecursiveRules(leftRecursiveRules, reducedRules, ruleMap) {
    leftRecursiveRules.forEach(function(leftRecursiveRule) {
        var rule = leftRecursiveRule, reducedRule = _reduced.default.fromRule(rule);
        if (reducedRule !== null) {
            var reducedRuleName = reducedRule.getName();
            ruleMap[reducedRuleName] = reducedRule;
            reducedRules.push(reducedRule);
        }
    });
}
function rewriteLeftRecursiveRules(leftRecursiveRules, rewrittenRules, ruleMap) {
    leftRecursiveRules.forEach(function(leftRecursiveRule) {
        var rule = leftRecursiveRule, ruleName = rule.getName(), rewrittenRule = _rewritten.default.fromRule(rule);
        delete ruleMap[ruleName];
        var rewrittenRuleName = ruleName; ///
        ruleMap[rewrittenRuleName] = rewrittenRule;
        rewrittenRules.push(rewrittenRule);
    });
}
function retrieveLeftRecursiveRules(leftRecursiveRules, leftRecursiveDefinitions, ruleMap) {
    leftRecursiveDefinitions.forEach(function(leftRecursiveDefinition) {
        var ruleName = leftRecursiveDefinition.getRuleName(), rule = ruleMap[ruleName], leftRecursiveRulesIncludesRule = leftRecursiveRules.includes(rule);
        if (!leftRecursiveRulesIncludesRule) {
            var leftRecursiveRule = rule; ///
            leftRecursiveRules.push(leftRecursiveRule);
        }
    // const leftRecursiveDefinitionIndirectlyLeftRecursiveDefinition = isInstanceOf(leftRecursiveDefinition, IndirectlyLeftRecursiveDefinition);
    //
    // if (leftRecursiveDefinitionIndirectlyLeftRecursiveDefinition) {
    //   const indirectlyLeftRecursiveDefinition = leftRecursiveDefinition,  ///
    //         implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(),
    //         ruleName = implicitlyLeftRecursiveDefinition.getRuleName(),
    //         rule = ruleMap[ruleName],
    //         leftRecursiveRulesIncludesRule = leftRecursiveRules.includes(rule);
    //
    //     if (!leftRecursiveRulesIncludesRule) {
    //       const leftRecursiveRule = rule; ///
    //
    //       leftRecursiveRules.push(leftRecursiveRule);
    //     }
    // }
    });
}
function eliminateDirectLeftRecursion(rewrittenRules, ruleMap) {
    rewrittenRules.forEach(function(rewrittenRule) {
        return rewrittenRule.rewrite(ruleMap);
    });
}
function eliminateIndirectLeftRecursion(leftRecursiveDefinitions, ruleMap) {
    var indirectlyLeftRecursiveDefinitions = leftRecursiveDefinitions.filter(function(leftRecursiveDefinition) {
        var leftRecursiveDefinitionIndirectlyLeftRecursiveDefinition = (0, _class).isInstanceOf(leftRecursiveDefinition, _indirectly.default);
        if (leftRecursiveDefinitionIndirectlyLeftRecursiveDefinition) {
            return true;
        }
    });
    indirectlyLeftRecursiveDefinitions.forEach(function(indirectlyLeftRecursiveDefinition) {
        var implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(), indirectlyLeftRecursiveRule = (0, _rule).ruleFromLeftRecursiveDefinition(indirectlyLeftRecursiveDefinition, ruleMap), implicitlyLeftRecursiveRule = (0, _rule).ruleFromLeftRecursiveDefinition(implicitlyLeftRecursiveDefinition, ruleMap), indirectlyLeftRecursiveRuleDirectlyLeftRecursive = (0, _rule).isRuleDirectlyLeftRecursive(indirectlyLeftRecursiveRule), implicitlyLeftRecursiveRuleDirectlyLeftRecursive = (0, _rule).isRuleDirectlyLeftRecursive(implicitlyLeftRecursiveRule);
        if (indirectlyLeftRecursiveRuleDirectlyLeftRecursive && implicitlyLeftRecursiveRuleDirectlyLeftRecursive) {
            var indirectlyLeftRecursiveDefinitionString = indirectlyLeftRecursiveDefinition.asString(), implicitlyLeftRecursiveDefinitionString = implicitlyLeftRecursiveDefinition.asString();
            throw new Error("The rules containing the '".concat(indirectlyLeftRecursiveDefinitionString, "' indirectly left recursive and ").concat(implicitlyLeftRecursiveDefinitionString, " implicitly left recursive definitions are both additionally directly recursive and therefore cannot be rewritten."));
        }
        var rule;
        var leftRecursiveDefinition = indirectlyLeftRecursiveRuleDirectlyLeftRecursive ? implicitlyLeftRecursiveDefinition : indirectlyLeftRecursiveDefinition, directlyLeftRecursiveRule = indirectlyLeftRecursiveRuleDirectlyLeftRecursive ? indirectlyLeftRecursiveRule : implicitlyLeftRecursiveRule, nonDirectlyLeftRecursiveRule = indirectlyLeftRecursiveRuleDirectlyLeftRecursive ? implicitlyLeftRecursiveRule : indirectlyLeftRecursiveRule, leftRecursiveDefinitionRuleName = leftRecursiveDefinition.getRuleName(), leftRecursiveRuleName = leftRecursiveDefinitionRuleName, definition = leftRecursiveDefinition;
        rule = nonDirectlyLeftRecursiveRule; ///
        var reducedRule = _reduced.default.fromRule(rule);
        if (reducedRule === null) {
            debugger;
        }
        var reducedRuleName = reducedRule.getName();
        ruleMap[reducedRuleName] = reducedRule;
        (0, _rule).substituteDefinition(rule, definition, leftRecursiveRuleName);
    });
}
function retrieveLeftRecursiveDefinition(rule, definition, recursiveDefinitions, leftRecursiveDefinitions, ruleMap) {
    var recursiveDefinition;
    var ruleName = rule.getName(), definitionRecursiveDefinition = (0, _class).isInstanceOf(definition, _recursive.default);
    if (definitionRecursiveDefinition) {
        recursiveDefinition = definition; ///
    } else {
        var leftRecursiveDefinition = _indirectly.default.fromRuleNameDefinitionAndRecursiveDefinitions(ruleName, definition, recursiveDefinitions) || _directly.default.fromRuleNameAndDefinition(ruleName, definition) || _left.default.fromRuleNameAndDefinition(ruleName, definition);
        if (leftRecursiveDefinition !== null) {
            leftRecursiveDefinitions.push(leftRecursiveDefinition);
            recursiveDefinition = leftRecursiveDefinition; ///
        } else {
            recursiveDefinition = _recursive.default.fromRuleNameAndDefinition(ruleName, definition);
        }
        if (recursiveDefinition !== null) {
            var replacedDefinition = definition, replacementDefinition = recursiveDefinition; ///
            rule.replaceDefinition(replacedDefinition, replacementDefinition);
            var recursiveDefinitionIndirectlyLeftRecursiveDefinition = (0, _class).isInstanceOf(recursiveDefinition, _indirectly.default);
            if (recursiveDefinitionIndirectlyLeftRecursiveDefinition) {
                var indirectlyLeftRecursiveDefinition = recursiveDefinition, implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(), leftRecursiveDefinition1 = implicitlyLeftRecursiveDefinition.getLeftRecursiveDefinition(), ruleName1 = implicitlyLeftRecursiveDefinition.getRuleName(), replacedDefinition1 = leftRecursiveDefinition1, replacementDefinition1 = implicitlyLeftRecursiveDefinition; ///
                rule = ruleMap[ruleName1];
                rule.replaceDefinition(replacedDefinition1, replacementDefinition1);
            }
        }
    }
    return recursiveDefinition;
}
function retrieveLeftRecursiveDefinitions(rule, recursiveDefinitions, leftRecursiveDefinitions, ruleMap) {
    var definitions = rule.getDefinitions();
    definitions.forEach(function(definition) {
        var recursiveDefinition = retrieveLeftRecursiveDefinition(rule, definition, recursiveDefinitions, leftRecursiveDefinitions, ruleMap);
        if (recursiveDefinition !== null) {
            var previousRecursiveDefinitions = _toConsumableArray(recursiveDefinitions).concat([
                recursiveDefinition
            ]), previousRecursiveRuleNames = previousRecursiveDefinitions.map(function(previousRecursiveDefinition) {
                var previousRecursiveDefinitionRuleName = previousRecursiveDefinition.getRuleName(), previousRecursiveRuleName = previousRecursiveDefinitionRuleName; ///
                return previousRecursiveRuleName;
            }), recursiveRuleNames = recursiveDefinition.getRecursiveRuleNames();
            recursiveRuleNames.forEach(function(recursiveRuleName) {
                var previousRecursiveRuleNamesIncludesRecursiveRuleName = previousRecursiveRuleNames.includes(recursiveRuleName);
                if (!previousRecursiveRuleNamesIncludesRecursiveRuleName) {
                    var ruleName = recursiveRuleName, _$rule = ruleMap[ruleName] || null; ///
                    if (_$rule !== null) {
                        var _$recursiveDefinitions = previousRecursiveDefinitions; ///
                        retrieveLeftRecursiveDefinitions(_$rule, _$recursiveDefinitions, leftRecursiveDefinitions, ruleMap);
                    }
                }
            });
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGltaW5hdGVMZWZ0UmVjdXJzaW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgUmVkdWNlZFJ1bGUgZnJvbSBcIi4vcnVsZS9yZWR1Y2VkXCI7XG5pbXBvcnQgUmV3cml0dGVuUnVsZSBmcm9tIFwiLi9ydWxlL3Jld3JpdHRlblwiO1xuaW1wb3J0IFJlY3Vyc2l2ZURlZmluaXRpb24gZnJvbSBcIi4vZGVmaW5pdGlvbi9yZWN1cnNpdmVcIjtcbmltcG9ydCBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0XCI7XG5pbXBvcnQgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0L2RpcmVjdGx5XCI7XG5pbXBvcnQgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIGZyb20gXCIuL2RlZmluaXRpb24vcmVjdXJzaXZlL2xlZnQvaW5kaXJlY3RseVwiO1xuXG5pbXBvcnQgeyBpc0luc3RhbmNlT2YgfSBmcm9tIFwiLi91dGlsaXRpZXMvY2xhc3NcIjtcbmltcG9ydCB7IHN1YnN0aXR1dGVEZWZpbml0aW9uLCBpc1J1bGVEaXJlY3RseUxlZnRSZWN1cnNpdmUsIHJ1bGVGcm9tTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gfSBmcm9tIFwiLi91dGlsaXRpZXMvcnVsZVwiO1xuXG5leHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBlbGltaW5hdGVMZWZ0UmVjdXJzaW9uKHN0YXJ0UnVsZSwgcnVsZU1hcCkge1xuICBjb25zdCBydWxlID0gc3RhcnRSdWxlLCAvLy9cbiAgICAgICAgcmVkdWNlZFJ1bGVzID0gW10sXG4gICAgICAgIHJld3JpdHRlblJ1bGVzID0gW10sXG4gICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlcyA9IFtdLFxuICAgICAgICByZWN1cnNpdmVEZWZpbml0aW9ucyA9IFtdLFxuICAgICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBbXTtcblxuICByZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhydWxlLCByZWN1cnNpdmVEZWZpbml0aW9ucywgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKTtcblxuICBlbGltaW5hdGVJbmRpcmVjdExlZnRSZWN1cnNpb24obGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKTtcblxuICAvLyByZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlUnVsZXMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCk7XG4gIC8vXG4gIC8vIHJlZHVjZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlUnVsZXMsIHJlZHVjZWRSdWxlcywgcnVsZU1hcCk7XG4gIC8vXG4gIC8vIHJld3JpdGVMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZVJ1bGVzLCByZXdyaXR0ZW5SdWxlcywgcnVsZU1hcCk7XG5cbiAgLy8vXG5cbiAgZWxpbWluYXRlRGlyZWN0TGVmdFJlY3Vyc2lvbihyZXdyaXR0ZW5SdWxlcywgcnVsZU1hcCk7XG5cbiAgY29uc3Qgc3RhcnRSdWxlTmFtZSA9IHN0YXJ0UnVsZS5nZXROYW1lKCk7XG5cbiAgc3RhcnRSdWxlID0gcnVsZU1hcFtzdGFydFJ1bGVOYW1lXTsgLy8vXG5cbiAgcmV0dXJuIHN0YXJ0UnVsZTtcbn1cblxuZnVuY3Rpb24gcmVkdWNlTGVmdFJlY3Vyc2l2ZVJ1bGVzKGxlZnRSZWN1cnNpdmVSdWxlcywgcmVkdWNlZFJ1bGVzLCBydWxlTWFwKSB7XG4gIGxlZnRSZWN1cnNpdmVSdWxlcy5mb3JFYWNoKChsZWZ0UmVjdXJzaXZlUnVsZSkgPT4ge1xuICAgIGNvbnN0IHJ1bGUgPSBsZWZ0UmVjdXJzaXZlUnVsZSwgLy8vXG4gICAgICAgICAgcmVkdWNlZFJ1bGUgPSBSZWR1Y2VkUnVsZS5mcm9tUnVsZShydWxlKTtcblxuICAgIGlmIChyZWR1Y2VkUnVsZSAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgcmVkdWNlZFJ1bGVOYW1lID0gcmVkdWNlZFJ1bGUuZ2V0TmFtZSgpO1xuXG4gICAgICBydWxlTWFwW3JlZHVjZWRSdWxlTmFtZV0gPSByZWR1Y2VkUnVsZTtcblxuICAgICAgcmVkdWNlZFJ1bGVzLnB1c2gocmVkdWNlZFJ1bGUpO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJld3JpdGVMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZVJ1bGVzLCByZXdyaXR0ZW5SdWxlcywgcnVsZU1hcCkge1xuICBsZWZ0UmVjdXJzaXZlUnVsZXMuZm9yRWFjaCgobGVmdFJlY3Vyc2l2ZVJ1bGUpID0+IHtcbiAgICBjb25zdCBydWxlID0gbGVmdFJlY3Vyc2l2ZVJ1bGUsIC8vL1xuICAgICAgICAgIHJ1bGVOYW1lID0gcnVsZS5nZXROYW1lKCksXG4gICAgICAgICAgcmV3cml0dGVuUnVsZSA9IFJld3JpdHRlblJ1bGUuZnJvbVJ1bGUocnVsZSk7XG5cbiAgICBkZWxldGUgcnVsZU1hcFtydWxlTmFtZV07XG5cbiAgICBjb25zdCByZXdyaXR0ZW5SdWxlTmFtZSA9IHJ1bGVOYW1lOyAvLy9cblxuICAgIHJ1bGVNYXBbcmV3cml0dGVuUnVsZU5hbWVdID0gcmV3cml0dGVuUnVsZTtcblxuICAgIHJld3JpdHRlblJ1bGVzLnB1c2gocmV3cml0dGVuUnVsZSk7XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlUnVsZXMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCkge1xuICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMuZm9yRWFjaCgobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pID0+IHtcbiAgICBjb25zdCBydWxlTmFtZSA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgcnVsZSA9IHJ1bGVNYXBbcnVsZU5hbWVdLFxuICAgICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlc0luY2x1ZGVzUnVsZSA9IGxlZnRSZWN1cnNpdmVSdWxlcy5pbmNsdWRlcyhydWxlKTtcblxuICAgIGlmICghbGVmdFJlY3Vyc2l2ZVJ1bGVzSW5jbHVkZXNSdWxlKSB7XG4gICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlUnVsZSA9IHJ1bGU7IC8vL1xuXG4gICAgICBsZWZ0UmVjdXJzaXZlUnVsZXMucHVzaChsZWZ0UmVjdXJzaXZlUnVsZSk7XG4gICAgfVxuXG4gICAgLy8gY29uc3QgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBpc0luc3RhbmNlT2YobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG4gICAgLy9cbiAgICAvLyBpZiAobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pIHtcbiAgICAvLyAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCAgLy8vXG4gICAgLy8gICAgICAgICBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0SW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKCksXG4gICAgLy8gICAgICAgICBydWxlTmFtZSA9IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRSdWxlTmFtZSgpLFxuICAgIC8vICAgICAgICAgcnVsZSA9IHJ1bGVNYXBbcnVsZU5hbWVdLFxuICAgIC8vICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVzSW5jbHVkZXNSdWxlID0gbGVmdFJlY3Vyc2l2ZVJ1bGVzLmluY2x1ZGVzKHJ1bGUpO1xuICAgIC8vXG4gICAgLy8gICAgIGlmICghbGVmdFJlY3Vyc2l2ZVJ1bGVzSW5jbHVkZXNSdWxlKSB7XG4gICAgLy8gICAgICAgY29uc3QgbGVmdFJlY3Vyc2l2ZVJ1bGUgPSBydWxlOyAvLy9cbiAgICAvL1xuICAgIC8vICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlcy5wdXNoKGxlZnRSZWN1cnNpdmVSdWxlKTtcbiAgICAvLyAgICAgfVxuICAgIC8vIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIGVsaW1pbmF0ZURpcmVjdExlZnRSZWN1cnNpb24ocmV3cml0dGVuUnVsZXMsIHJ1bGVNYXApIHtcbiAgcmV3cml0dGVuUnVsZXMuZm9yRWFjaCgocmV3cml0dGVuUnVsZSkgPT4gcmV3cml0dGVuUnVsZS5yZXdyaXRlKHJ1bGVNYXApKTtcbn1cblxuZnVuY3Rpb24gZWxpbWluYXRlSW5kaXJlY3RMZWZ0UmVjdXJzaW9uKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCkge1xuICBjb25zdCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLmZpbHRlcigobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pID0+IHtcbiAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGlzSW5zdGFuY2VPZihsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcblxuICAgIGlmIChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KTtcblxuICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLmZvckVhY2goKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4ge1xuICAgIGNvbnN0IGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oKSxcbiAgICAgICAgICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUgPSBydWxlRnJvbUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcnVsZU1hcCksXG4gICAgICAgICAgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlID0gcnVsZUZyb21MZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJ1bGVNYXApLFxuICAgICAgICAgIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZSA9IGlzUnVsZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZShpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUpLFxuICAgICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZSA9IGlzUnVsZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZShpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUpO1xuXG4gICAgaWYgKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZURpcmVjdGx5TGVmdFJlY3Vyc2l2ZSAmJiBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEaXJlY3RseUxlZnRSZWN1cnNpdmUpIHtcbiAgICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvblN0cmluZyA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5hc1N0cmluZygpLFxuICAgICAgICAgICAgaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uU3RyaW5nID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmFzU3RyaW5nKCk7XG5cbiAgICAgIHRocm93IG5ldyBFcnJvcihgVGhlIHJ1bGVzIGNvbnRhaW5pbmcgdGhlICcke2luZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvblN0cmluZ30nIGluZGlyZWN0bHkgbGVmdCByZWN1cnNpdmUgYW5kICR7aW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uU3RyaW5nfSBpbXBsaWNpdGx5IGxlZnQgcmVjdXJzaXZlIGRlZmluaXRpb25zIGFyZSBib3RoIGFkZGl0aW9uYWxseSBkaXJlY3RseSByZWN1cnNpdmUgYW5kIHRoZXJlZm9yZSBjYW5ub3QgYmUgcmV3cml0dGVuLmApO1xuICAgIH1cblxuICAgIGxldCBydWxlO1xuXG4gICAgY29uc3QgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEaXJlY3RseUxlZnRSZWN1cnNpdmUgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gOiAvLy9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sICAvLy9cbiAgICAgICAgICBkaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlID9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUgOiAvLy9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZSwgIC8vL1xuICAgICAgICAgIG5vbkRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUgPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVEaXJlY3RseUxlZnRSZWN1cnNpdmUgP1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlUnVsZSA6ICAvLy9cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSwgLy8vXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25SdWxlTmFtZSA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25SdWxlTmFtZSwgIC8vL1xuICAgICAgICAgIGRlZmluaXRpb24gPSBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjtcblxuICAgIHJ1bGUgPSBub25EaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlOyAgLy8vXG5cbiAgICBjb25zdCByZWR1Y2VkUnVsZSA9IFJlZHVjZWRSdWxlLmZyb21SdWxlKHJ1bGUpO1xuXG4gICAgaWYgKHJlZHVjZWRSdWxlID09PSBudWxsKSB7XG4gICAgICBkZWJ1Z2dlclxuICAgIH1cblxuICAgIGNvbnN0IHJlZHVjZWRSdWxlTmFtZSA9IHJlZHVjZWRSdWxlLmdldE5hbWUoKTtcblxuICAgIHJ1bGVNYXBbcmVkdWNlZFJ1bGVOYW1lXSA9IHJlZHVjZWRSdWxlO1xuXG4gICAgc3Vic3RpdHV0ZURlZmluaXRpb24ocnVsZSwgZGVmaW5pdGlvbiwgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24ocnVsZSwgZGVmaW5pdGlvbiwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCkge1xuICBsZXQgcmVjdXJzaXZlRGVmaW5pdGlvbjtcblxuICBjb25zdCBydWxlTmFtZSA9IHJ1bGUuZ2V0TmFtZSgpLFxuICAgICAgICBkZWZpbml0aW9uUmVjdXJzaXZlRGVmaW5pdGlvbiA9IGlzSW5zdGFuY2VPZihkZWZpbml0aW9uLCBSZWN1cnNpdmVEZWZpbml0aW9uKTtcblxuICBpZiAoZGVmaW5pdGlvblJlY3Vyc2l2ZURlZmluaXRpb24pIHtcbiAgICByZWN1cnNpdmVEZWZpbml0aW9uID0gZGVmaW5pdGlvbjsgLy8vXG4gIH0gZWxzZSB7XG4gICAgY29uc3QgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbVJ1bGVOYW1lRGVmaW5pdGlvbkFuZFJlY3Vyc2l2ZURlZmluaXRpb25zKHJ1bGVOYW1lLCBkZWZpbml0aW9uLCByZWN1cnNpdmVEZWZpbml0aW9ucykgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIERpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbVJ1bGVOYW1lQW5kRGVmaW5pdGlvbihydWxlTmFtZSwgZGVmaW5pdGlvbikgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIExlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21SdWxlTmFtZUFuZERlZmluaXRpb24ocnVsZU5hbWUsIGRlZmluaXRpb24pO1xuXG4gICAgaWYgKGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uICE9PSBudWxsKSB7XG4gICAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMucHVzaChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG5cbiAgICAgIHJlY3Vyc2l2ZURlZmluaXRpb24gPSBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjsgIC8vL1xuICAgIH0gZWxzZSB7XG4gICAgICByZWN1cnNpdmVEZWZpbml0aW9uID0gUmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVBbmREZWZpbml0aW9uKHJ1bGVOYW1lLCBkZWZpbml0aW9uKTtcbiAgICB9XG5cbiAgICBpZiAocmVjdXJzaXZlRGVmaW5pdGlvbiAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgcmVwbGFjZWREZWZpbml0aW9uID0gZGVmaW5pdGlvbiwgLy8vXG4gICAgICAgICAgICByZXBsYWNlbWVudERlZmluaXRpb24gPSByZWN1cnNpdmVEZWZpbml0aW9uOyAgLy8vXG5cbiAgICAgIHJ1bGUucmVwbGFjZURlZmluaXRpb24ocmVwbGFjZWREZWZpbml0aW9uLCByZXBsYWNlbWVudERlZmluaXRpb24pO1xuXG4gICAgICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9uSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gaXNJbnN0YW5jZU9mKHJlY3Vyc2l2ZURlZmluaXRpb24sIEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG5cbiAgICAgIGlmIChyZWN1cnNpdmVEZWZpbml0aW9uSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSB7XG4gICAgICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IHJlY3Vyc2l2ZURlZmluaXRpb24sIC8vL1xuICAgICAgICAgICAgICBpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0SW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKCksXG4gICAgICAgICAgICAgIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldExlZnRSZWN1cnNpdmVEZWZpbml0aW9uKCksXG4gICAgICAgICAgICAgIHJ1bGVOYW1lID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICAgIHJlcGxhY2VkRGVmaW5pdGlvbiA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCAvLy9cbiAgICAgICAgICAgICAgcmVwbGFjZW1lbnREZWZpbml0aW9uID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uOyAgLy8vXG5cbiAgICAgICAgcnVsZSA9IHJ1bGVNYXBbcnVsZU5hbWVdO1xuXG4gICAgICAgIHJ1bGUucmVwbGFjZURlZmluaXRpb24ocmVwbGFjZWREZWZpbml0aW9uLCByZXBsYWNlbWVudERlZmluaXRpb24pO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZWN1cnNpdmVEZWZpbml0aW9uO1xufVxuXG5mdW5jdGlvbiByZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhydWxlLCByZWN1cnNpdmVEZWZpbml0aW9ucywgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKSB7XG4gIGNvbnN0IGRlZmluaXRpb25zID0gcnVsZS5nZXREZWZpbml0aW9ucygpO1xuXG4gIGRlZmluaXRpb25zLmZvckVhY2goKGRlZmluaXRpb24pID0+IHtcbiAgICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9uID0gcmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihydWxlLCBkZWZpbml0aW9uLCByZWN1cnNpdmVEZWZpbml0aW9ucywgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKTtcblxuICAgIGlmIChyZWN1cnNpdmVEZWZpbml0aW9uICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb25zID0gWyAuLi5yZWN1cnNpdmVEZWZpbml0aW9ucywgcmVjdXJzaXZlRGVmaW5pdGlvbiBdLFxuICAgICAgICAgICAgcHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXMgPSBwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb25zLm1hcCgocHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9uKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lID0gcHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzUmVjdXJzaXZlUnVsZU5hbWUgPSBwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb25SdWxlTmFtZTsgIC8vL1xuXG4gICAgICAgICAgICAgIHJldHVybiBwcmV2aW91c1JlY3Vyc2l2ZVJ1bGVOYW1lO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXMgPSByZWN1cnNpdmVEZWZpbml0aW9uLmdldFJlY3Vyc2l2ZVJ1bGVOYW1lcygpO1xuXG4gICAgICByZWN1cnNpdmVSdWxlTmFtZXMuZm9yRWFjaCgocmVjdXJzaXZlUnVsZU5hbWUpID0+IHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXNJbmNsdWRlc1JlY3Vyc2l2ZVJ1bGVOYW1lID0gcHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXMuaW5jbHVkZXMocmVjdXJzaXZlUnVsZU5hbWUpO1xuXG4gICAgICAgIGlmICghcHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXNJbmNsdWRlc1JlY3Vyc2l2ZVJ1bGVOYW1lKSB7XG4gICAgICAgICAgY29uc3QgcnVsZU5hbWUgPSByZWN1cnNpdmVSdWxlTmFtZSwgIC8vL1xuICAgICAgICAgICAgICAgIHJ1bGUgPSBydWxlTWFwW3J1bGVOYW1lXSB8fCBudWxsOyAvLy9cblxuICAgICAgICAgIGlmIChydWxlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9ucyA9IHByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvbnM7ICAvLy9cblxuICAgICAgICAgICAgcmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMocnVsZSwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufVxuXG4iXSwibmFtZXMiOlsiZWxpbWluYXRlTGVmdFJlY3Vyc2lvbiIsInN0YXJ0UnVsZSIsInJ1bGVNYXAiLCJydWxlIiwicmVkdWNlZFJ1bGVzIiwicmV3cml0dGVuUnVsZXMiLCJsZWZ0UmVjdXJzaXZlUnVsZXMiLCJyZWN1cnNpdmVEZWZpbml0aW9ucyIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiZWxpbWluYXRlSW5kaXJlY3RMZWZ0UmVjdXJzaW9uIiwiZWxpbWluYXRlRGlyZWN0TGVmdFJlY3Vyc2lvbiIsInN0YXJ0UnVsZU5hbWUiLCJnZXROYW1lIiwicmVkdWNlTGVmdFJlY3Vyc2l2ZVJ1bGVzIiwiZm9yRWFjaCIsImxlZnRSZWN1cnNpdmVSdWxlIiwicmVkdWNlZFJ1bGUiLCJSZWR1Y2VkUnVsZSIsImZyb21SdWxlIiwicmVkdWNlZFJ1bGVOYW1lIiwicHVzaCIsInJld3JpdGVMZWZ0UmVjdXJzaXZlUnVsZXMiLCJydWxlTmFtZSIsInJld3JpdHRlblJ1bGUiLCJSZXdyaXR0ZW5SdWxlIiwicmV3cml0dGVuUnVsZU5hbWUiLCJyZXRyaWV2ZUxlZnRSZWN1cnNpdmVSdWxlcyIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZ2V0UnVsZU5hbWUiLCJsZWZ0UmVjdXJzaXZlUnVsZXNJbmNsdWRlc1J1bGUiLCJpbmNsdWRlcyIsInJld3JpdGUiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiZmlsdGVyIiwibGVmdFJlY3Vyc2l2ZURlZmluaXRpb25JbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJpc0luc3RhbmNlT2YiLCJJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJnZXRJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJydWxlRnJvbUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlIiwiaXNSdWxlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVSdWxlRGlyZWN0bHlMZWZ0UmVjdXJzaXZlIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uU3RyaW5nIiwiYXNTdHJpbmciLCJpbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25TdHJpbmciLCJFcnJvciIsImRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJub25EaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlIiwibGVmdFJlY3Vyc2l2ZURlZmluaXRpb25SdWxlTmFtZSIsImxlZnRSZWN1cnNpdmVSdWxlTmFtZSIsImRlZmluaXRpb24iLCJzdWJzdGl0dXRlRGVmaW5pdGlvbiIsInJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJyZWN1cnNpdmVEZWZpbml0aW9uIiwiZGVmaW5pdGlvblJlY3Vyc2l2ZURlZmluaXRpb24iLCJSZWN1cnNpdmVEZWZpbml0aW9uIiwiZnJvbVJ1bGVOYW1lRGVmaW5pdGlvbkFuZFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImZyb21SdWxlTmFtZUFuZERlZmluaXRpb24iLCJMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsInJlcGxhY2VkRGVmaW5pdGlvbiIsInJlcGxhY2VtZW50RGVmaW5pdGlvbiIsInJlcGxhY2VEZWZpbml0aW9uIiwicmVjdXJzaXZlRGVmaW5pdGlvbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImdldExlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZGVmaW5pdGlvbnMiLCJnZXREZWZpbml0aW9ucyIsInByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJwcmV2aW91c1JlY3Vyc2l2ZVJ1bGVOYW1lcyIsIm1hcCIsInByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvbiIsInByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lIiwicHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZSIsInJlY3Vyc2l2ZVJ1bGVOYW1lcyIsImdldFJlY3Vyc2l2ZVJ1bGVOYW1lcyIsInJlY3Vyc2l2ZVJ1bGVOYW1lIiwicHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXNJbmNsdWRlc1JlY3Vyc2l2ZVJ1bGVOYW1lIl0sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7Ozs7a0JBWVdBLHNCQUFzQjtBQVZ0QixJQUFBLFFBQWdCLGtDQUFoQixnQkFBZ0IsRUFBQTtBQUNkLElBQUEsVUFBa0Isa0NBQWxCLGtCQUFrQixFQUFBO0FBQ1osSUFBQSxVQUF3QixrQ0FBeEIsd0JBQXdCLEVBQUE7QUFDcEIsSUFBQSxLQUE2QixrQ0FBN0IsNkJBQTZCLEVBQUE7QUFDckIsSUFBQSxTQUFzQyxrQ0FBdEMsc0NBQXNDLEVBQUE7QUFDcEMsSUFBQSxXQUF3QyxrQ0FBeEMsd0NBQXdDLEVBQUE7QUFFekQsSUFBQSxNQUFtQixXQUFuQixtQkFBbUIsQ0FBQTtBQUNtRCxJQUFBLEtBQWtCLFdBQWxCLGtCQUFrQixDQUFBO0FBRXRHLFNBQVNBLHNCQUFzQixDQUFDQyxTQUFTLEVBQUVDLE9BQU8sRUFBRTtJQUNqRSxJQUFNQyxJQUFJLEdBQUdGLFNBQVMsRUFDaEJHLFlBQVksR0FBRyxFQUFFLEVBQ2pCQyxjQUFjLEdBQUcsRUFBRSxFQUNuQkMsa0JBQWtCLEdBQUcsRUFBRSxFQUN2QkMsb0JBQW9CLEdBQUcsRUFBRSxFQUN6QkMsd0JBQXdCLEdBQUcsRUFBRSxBQUFDO0lBRXBDQyxnQ0FBZ0MsQ0FBQ04sSUFBSSxFQUFFSSxvQkFBb0IsRUFBRUMsd0JBQXdCLEVBQUVOLE9BQU8sQ0FBQyxDQUFDO0lBRWhHUSw4QkFBOEIsQ0FBQ0Ysd0JBQXdCLEVBQUVOLE9BQU8sQ0FBQyxDQUFDO0lBRWxFLHFGQUFxRjtJQUNyRixFQUFFO0lBQ0YsdUVBQXVFO0lBQ3ZFLEVBQUU7SUFDRiwwRUFBMEU7SUFFMUUsR0FBRztJQUVIUyw0QkFBNEIsQ0FBQ04sY0FBYyxFQUFFSCxPQUFPLENBQUMsQ0FBQztJQUV0RCxJQUFNVSxhQUFhLEdBQUdYLFNBQVMsQ0FBQ1ksT0FBTyxFQUFFLEFBQUM7SUFFMUNaLFNBQVMsR0FBR0MsT0FBTyxDQUFDVSxhQUFhLENBQUMsQ0FBQyxDQUFDLEdBQUc7SUFFdkMsT0FBT1gsU0FBUyxDQUFDO0NBQ2xCOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBRUQsU0FBU2Esd0JBQXdCLENBQUNSLGtCQUFrQixFQUFFRixZQUFZLEVBQUVGLE9BQU8sRUFBRTtJQUMzRUksa0JBQWtCLENBQUNTLE9BQU8sQ0FBQyxTQUFDQyxpQkFBaUIsRUFBSztRQUNoRCxJQUFNYixJQUFJLEdBQUdhLGlCQUFpQixFQUN4QkMsV0FBVyxHQUFHQyxRQUFXLFFBQUEsQ0FBQ0MsUUFBUSxDQUFDaEIsSUFBSSxDQUFDLEFBQUM7UUFFL0MsSUFBSWMsV0FBVyxLQUFLLElBQUksRUFBRTtZQUN4QixJQUFNRyxlQUFlLEdBQUdILFdBQVcsQ0FBQ0osT0FBTyxFQUFFLEFBQUM7WUFFOUNYLE9BQU8sQ0FBQ2tCLGVBQWUsQ0FBQyxHQUFHSCxXQUFXLENBQUM7WUFFdkNiLFlBQVksQ0FBQ2lCLElBQUksQ0FBQ0osV0FBVyxDQUFDLENBQUM7U0FDaEM7S0FDRixDQUFDLENBQUM7Q0FDSjtBQUVELFNBQVNLLHlCQUF5QixDQUFDaEIsa0JBQWtCLEVBQUVELGNBQWMsRUFBRUgsT0FBTyxFQUFFO0lBQzlFSSxrQkFBa0IsQ0FBQ1MsT0FBTyxDQUFDLFNBQUNDLGlCQUFpQixFQUFLO1FBQ2hELElBQU1iLElBQUksR0FBR2EsaUJBQWlCLEVBQ3hCTyxRQUFRLEdBQUdwQixJQUFJLENBQUNVLE9BQU8sRUFBRSxFQUN6QlcsYUFBYSxHQUFHQyxVQUFhLFFBQUEsQ0FBQ04sUUFBUSxDQUFDaEIsSUFBSSxDQUFDLEFBQUM7UUFFbkQsT0FBT0QsT0FBTyxDQUFDcUIsUUFBUSxDQUFDLENBQUM7UUFFekIsSUFBTUcsaUJBQWlCLEdBQUdILFFBQVEsQUFBQyxFQUFDLEdBQUc7UUFFdkNyQixPQUFPLENBQUN3QixpQkFBaUIsQ0FBQyxHQUFHRixhQUFhLENBQUM7UUFFM0NuQixjQUFjLENBQUNnQixJQUFJLENBQUNHLGFBQWEsQ0FBQyxDQUFDO0tBQ3BDLENBQUMsQ0FBQztDQUNKO0FBRUQsU0FBU0csMEJBQTBCLENBQUNyQixrQkFBa0IsRUFBRUUsd0JBQXdCLEVBQUVOLE9BQU8sRUFBRTtJQUN6Rk0sd0JBQXdCLENBQUNPLE9BQU8sQ0FBQyxTQUFDYSx1QkFBdUIsRUFBSztRQUM1RCxJQUFNTCxRQUFRLEdBQUdLLHVCQUF1QixDQUFDQyxXQUFXLEVBQUUsRUFDaEQxQixJQUFJLEdBQUdELE9BQU8sQ0FBQ3FCLFFBQVEsQ0FBQyxFQUN4Qk8sOEJBQThCLEdBQUd4QixrQkFBa0IsQ0FBQ3lCLFFBQVEsQ0FBQzVCLElBQUksQ0FBQyxBQUFDO1FBRXpFLElBQUksQ0FBQzJCLDhCQUE4QixFQUFFO1lBQ25DLElBQU1kLGlCQUFpQixHQUFHYixJQUFJLEFBQUMsRUFBQyxHQUFHO1lBRW5DRyxrQkFBa0IsQ0FBQ2UsSUFBSSxDQUFDTCxpQkFBaUIsQ0FBQyxDQUFDO1NBQzVDO0lBRUQsNklBQTZJO0lBQzdJLEVBQUU7SUFDRixrRUFBa0U7SUFDbEUsNEVBQTRFO0lBQzVFLHdIQUF3SDtJQUN4SCxzRUFBc0U7SUFDdEUsb0NBQW9DO0lBQ3BDLDhFQUE4RTtJQUM5RSxFQUFFO0lBQ0YsNkNBQTZDO0lBQzdDLDRDQUE0QztJQUM1QyxFQUFFO0lBQ0Ysb0RBQW9EO0lBQ3BELFFBQVE7SUFDUixJQUFJO0tBQ0wsQ0FBQyxDQUFDO0NBQ0o7QUFFRCxTQUFTTCw0QkFBNEIsQ0FBQ04sY0FBYyxFQUFFSCxPQUFPLEVBQUU7SUFDN0RHLGNBQWMsQ0FBQ1UsT0FBTyxDQUFDLFNBQUNTLGFBQWE7ZUFBS0EsYUFBYSxDQUFDUSxPQUFPLENBQUM5QixPQUFPLENBQUM7S0FBQSxDQUFDLENBQUM7Q0FDM0U7QUFFRCxTQUFTUSw4QkFBOEIsQ0FBQ0Ysd0JBQXdCLEVBQUVOLE9BQU8sRUFBRTtJQUN6RSxJQUFNK0Isa0NBQWtDLEdBQUd6Qix3QkFBd0IsQ0FBQzBCLE1BQU0sQ0FBQyxTQUFDTix1QkFBdUIsRUFBSztRQUN0RyxJQUFNTyx3REFBd0QsR0FBR0MsQ0FBQUEsR0FBQUEsTUFBWSxBQUE0RCxDQUFBLGFBQTVELENBQUNSLHVCQUF1QixFQUFFUyxXQUFpQyxRQUFBLENBQUMsQUFBQztRQUUxSSxJQUFJRix3REFBd0QsRUFBRTtZQUM1RCxPQUFPLElBQUksQ0FBQztTQUNiO0tBQ0YsQ0FBQyxBQUFDO0lBRUhGLGtDQUFrQyxDQUFDbEIsT0FBTyxDQUFDLFNBQUN1QixpQ0FBaUMsRUFBSztRQUNoRixJQUFNQyxpQ0FBaUMsR0FBR0QsaUNBQWlDLENBQUNFLG9DQUFvQyxFQUFFLEVBQzVHQywyQkFBMkIsR0FBR0MsQ0FBQUEsR0FBQUEsS0FBK0IsQUFBNEMsQ0FBQSxnQ0FBNUMsQ0FBQ0osaUNBQWlDLEVBQUVwQyxPQUFPLENBQUMsRUFDekd5QywyQkFBMkIsR0FBR0QsQ0FBQUEsR0FBQUEsS0FBK0IsQUFBNEMsQ0FBQSxnQ0FBNUMsQ0FBQ0gsaUNBQWlDLEVBQUVyQyxPQUFPLENBQUMsRUFDekcwQyxnREFBZ0QsR0FBR0MsQ0FBQUEsR0FBQUEsS0FBMkIsQUFBNkIsQ0FBQSw0QkFBN0IsQ0FBQ0osMkJBQTJCLENBQUMsRUFDM0dLLGdEQUFnRCxHQUFHRCxDQUFBQSxHQUFBQSxLQUEyQixBQUE2QixDQUFBLDRCQUE3QixDQUFDRiwyQkFBMkIsQ0FBQyxBQUFDO1FBRWxILElBQUlDLGdEQUFnRCxJQUFJRSxnREFBZ0QsRUFBRTtZQUN4RyxJQUFNQyx1Q0FBdUMsR0FBR1QsaUNBQWlDLENBQUNVLFFBQVEsRUFBRSxFQUN0RkMsdUNBQXVDLEdBQUdWLGlDQUFpQyxDQUFDUyxRQUFRLEVBQUUsQUFBQztZQUU3RixNQUFNLElBQUlFLEtBQUssQ0FBQyxBQUFDLDRCQUEwQixDQUE0RUQsTUFBdUMsQ0FBakhGLHVDQUF1QyxFQUFDLGtDQUFnQyxDQUEwQyxDQUFBLE1BQWtILENBQTFKRSx1Q0FBdUMsRUFBQyxvSEFBa0gsQ0FBQyxDQUFDLENBQUM7U0FDclI7UUFFRCxJQUFJOUMsSUFBSSxBQUFDO1FBRVQsSUFBTXlCLHVCQUF1QixHQUFHZ0IsZ0RBQWdELEdBQzlDTCxpQ0FBaUMsR0FDL0JELGlDQUFpQyxFQUMvRGEseUJBQXlCLEdBQUdQLGdEQUFnRCxHQUM5Q0gsMkJBQTJCLEdBQ3pCRSwyQkFBMkIsRUFDM0RTLDRCQUE0QixHQUFHUixnREFBZ0QsR0FDOUNELDJCQUEyQixHQUN6QkYsMkJBQTJCLEVBQzlEWSwrQkFBK0IsR0FBR3pCLHVCQUF1QixDQUFDQyxXQUFXLEVBQUUsRUFDdkV5QixxQkFBcUIsR0FBR0QsK0JBQStCLEVBQ3ZERSxVQUFVLEdBQUczQix1QkFBdUIsQUFBQztRQUUzQ3pCLElBQUksR0FBR2lELDRCQUE0QixDQUFDLENBQUUsR0FBRztRQUV6QyxJQUFNbkMsV0FBVyxHQUFHQyxRQUFXLFFBQUEsQ0FBQ0MsUUFBUSxDQUFDaEIsSUFBSSxDQUFDLEFBQUM7UUFFL0MsSUFBSWMsV0FBVyxLQUFLLElBQUksRUFBRTtZQUN4QixRQUFRO1NBQ1Q7UUFFRCxJQUFNRyxlQUFlLEdBQUdILFdBQVcsQ0FBQ0osT0FBTyxFQUFFLEFBQUM7UUFFOUNYLE9BQU8sQ0FBQ2tCLGVBQWUsQ0FBQyxHQUFHSCxXQUFXLENBQUM7UUFFdkN1QyxDQUFBQSxHQUFBQSxLQUFvQixBQUF5QyxDQUFBLHFCQUF6QyxDQUFDckQsSUFBSSxFQUFFb0QsVUFBVSxFQUFFRCxxQkFBcUIsQ0FBQyxDQUFDO0tBQy9ELENBQUMsQ0FBQztDQUNKO0FBRUQsU0FBU0csK0JBQStCLENBQUN0RCxJQUFJLEVBQUVvRCxVQUFVLEVBQUVoRCxvQkFBb0IsRUFBRUMsd0JBQXdCLEVBQUVOLE9BQU8sRUFBRTtJQUNsSCxJQUFJd0QsbUJBQW1CLEFBQUM7SUFFeEIsSUFBTW5DLFFBQVEsR0FBR3BCLElBQUksQ0FBQ1UsT0FBTyxFQUFFLEVBQ3pCOEMsNkJBQTZCLEdBQUd2QixDQUFBQSxHQUFBQSxNQUFZLEFBQWlDLENBQUEsYUFBakMsQ0FBQ21CLFVBQVUsRUFBRUssVUFBbUIsUUFBQSxDQUFDLEFBQUM7SUFFcEYsSUFBSUQsNkJBQTZCLEVBQUU7UUFDakNELG1CQUFtQixHQUFHSCxVQUFVLENBQUMsQ0FBQyxHQUFHO0tBQ3RDLE1BQU07UUFDTCxJQUFNM0IsdUJBQXVCLEdBQUdTLFdBQWlDLFFBQUEsQ0FBQ3dCLDZDQUE2QyxDQUFDdEMsUUFBUSxFQUFFZ0MsVUFBVSxFQUFFaEQsb0JBQW9CLENBQUMsSUFDM0h1RCxTQUErQixRQUFBLENBQUNDLHlCQUF5QixDQUFDeEMsUUFBUSxFQUFFZ0MsVUFBVSxDQUFDLElBQy9FUyxLQUF1QixRQUFBLENBQUNELHlCQUF5QixDQUFDeEMsUUFBUSxFQUFFZ0MsVUFBVSxDQUFDLEFBQUM7UUFFeEcsSUFBSTNCLHVCQUF1QixLQUFLLElBQUksRUFBRTtZQUNwQ3BCLHdCQUF3QixDQUFDYSxJQUFJLENBQUNPLHVCQUF1QixDQUFDLENBQUM7WUFFdkQ4QixtQkFBbUIsR0FBRzlCLHVCQUF1QixDQUFDLENBQUUsR0FBRztTQUNwRCxNQUFNO1lBQ0w4QixtQkFBbUIsR0FBR0UsVUFBbUIsUUFBQSxDQUFDRyx5QkFBeUIsQ0FBQ3hDLFFBQVEsRUFBRWdDLFVBQVUsQ0FBQyxDQUFDO1NBQzNGO1FBRUQsSUFBSUcsbUJBQW1CLEtBQUssSUFBSSxFQUFFO1lBQ2hDLElBQU1PLGtCQUFrQixHQUFHVixVQUFVLEVBQy9CVyxxQkFBcUIsR0FBR1IsbUJBQW1CLEFBQUMsRUFBRSxHQUFHO1lBRXZEdkQsSUFBSSxDQUFDZ0UsaUJBQWlCLENBQUNGLGtCQUFrQixFQUFFQyxxQkFBcUIsQ0FBQyxDQUFDO1lBRWxFLElBQU1FLG9EQUFvRCxHQUFHaEMsQ0FBQUEsR0FBQUEsTUFBWSxBQUF3RCxDQUFBLGFBQXhELENBQUNzQixtQkFBbUIsRUFBRXJCLFdBQWlDLFFBQUEsQ0FBQyxBQUFDO1lBRWxJLElBQUkrQixvREFBb0QsRUFBRTtnQkFDeEQsSUFBTTlCLGlDQUFpQyxHQUFHb0IsbUJBQW1CLEVBQ3ZEbkIsaUNBQWlDLEdBQUdELGlDQUFpQyxDQUFDRSxvQ0FBb0MsRUFBRSxFQUM1R1osd0JBQXVCLEdBQUdXLGlDQUFpQyxDQUFDOEIsMEJBQTBCLEVBQUUsRUFDeEY5QyxTQUFRLEdBQUdnQixpQ0FBaUMsQ0FBQ1YsV0FBVyxFQUFFLEVBQzFEb0MsbUJBQWtCLEdBQUdyQyx3QkFBdUIsRUFDNUNzQyxzQkFBcUIsR0FBRzNCLGlDQUFpQyxBQUFDLEVBQUUsR0FBRztnQkFFckVwQyxJQUFJLEdBQUdELE9BQU8sQ0FBQ3FCLFNBQVEsQ0FBQyxDQUFDO2dCQUV6QnBCLElBQUksQ0FBQ2dFLGlCQUFpQixDQUFDRixtQkFBa0IsRUFBRUMsc0JBQXFCLENBQUMsQ0FBQzthQUNuRTtTQUNGO0tBQ0Y7SUFFRCxPQUFPUixtQkFBbUIsQ0FBQztDQUM1QjtBQUVELFNBQVNqRCxnQ0FBZ0MsQ0FBQ04sSUFBSSxFQUFFSSxvQkFBb0IsRUFBRUMsd0JBQXdCLEVBQUVOLE9BQU8sRUFBRTtJQUN2RyxJQUFNb0UsV0FBVyxHQUFHbkUsSUFBSSxDQUFDb0UsY0FBYyxFQUFFLEFBQUM7SUFFMUNELFdBQVcsQ0FBQ3ZELE9BQU8sQ0FBQyxTQUFDd0MsVUFBVSxFQUFLO1FBQ2xDLElBQU1HLG1CQUFtQixHQUFHRCwrQkFBK0IsQ0FBQ3RELElBQUksRUFBRW9ELFVBQVUsRUFBRWhELG9CQUFvQixFQUFFQyx3QkFBd0IsRUFBRU4sT0FBTyxDQUFDLEFBQUM7UUFFdkksSUFBSXdELG1CQUFtQixLQUFLLElBQUksRUFBRTtZQUNoQyxJQUFNYyw0QkFBNEIsR0FBRyxBQUFFLG1CQUFHakUsb0JBQW9CLENBQXBCQSxRQUFMO2dCQUEyQm1ELG1CQUFtQjthQUFFLENBQUEsRUFDL0VlLDBCQUEwQixHQUFHRCw0QkFBNEIsQ0FBQ0UsR0FBRyxDQUFDLFNBQUNDLDJCQUEyQixFQUFLO2dCQUM3RixJQUFNQyxtQ0FBbUMsR0FBR0QsMkJBQTJCLENBQUM5QyxXQUFXLEVBQUUsRUFDL0VnRCx5QkFBeUIsR0FBR0QsbUNBQW1DLEFBQUMsRUFBRSxHQUFHO2dCQUUzRSxPQUFPQyx5QkFBeUIsQ0FBQzthQUNsQyxDQUFDLEVBQ0ZDLGtCQUFrQixHQUFHcEIsbUJBQW1CLENBQUNxQixxQkFBcUIsRUFBRSxBQUFDO1lBRXZFRCxrQkFBa0IsQ0FBQy9ELE9BQU8sQ0FBQyxTQUFDaUUsaUJBQWlCLEVBQUs7Z0JBQ2hELElBQU1DLG1EQUFtRCxHQUFHUiwwQkFBMEIsQ0FBQzFDLFFBQVEsQ0FBQ2lELGlCQUFpQixDQUFDLEFBQUM7Z0JBRW5ILElBQUksQ0FBQ0MsbURBQW1ELEVBQUU7b0JBQ3hELElBQU0xRCxRQUFRLEdBQUd5RCxpQkFBaUIsRUFDNUI3RSxNQUFJLEdBQUdELE9BQU8sQ0FBQ3FCLFFBQVEsQ0FBQyxJQUFJLElBQUksQUFBQyxFQUFDLEdBQUc7b0JBRTNDLElBQUlwQixNQUFJLEtBQUssSUFBSSxFQUFFO3dCQUNqQixJQUFNSSxzQkFBb0IsR0FBR2lFLDRCQUE0QixBQUFDLEVBQUUsR0FBRzt3QkFFL0QvRCxnQ0FBZ0MsQ0FBQ04sTUFBSSxFQUFFSSxzQkFBb0IsRUFBRUMsd0JBQXdCLEVBQUVOLE9BQU8sQ0FBQyxDQUFDO3FCQUNqRztpQkFDRjthQUNGLENBQUMsQ0FBQztTQUNKO0tBQ0YsQ0FBQyxDQUFDO0NBQ0oifQ==