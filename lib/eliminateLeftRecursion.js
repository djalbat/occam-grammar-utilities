"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = eliminateLeftRecursion;
var _reduced = _interopRequireDefault(require("./rule/reduced"));
var _rewritten = _interopRequireDefault(require("./rule/rewritten"));
var _recursive = _interopRequireDefault(require("./definition/recursive"));
var _left = _interopRequireDefault(require("./definition/recursive/left"));
var _directly = _interopRequireDefault(require("./definition/recursive/left/directly"));
var _indirectly = _interopRequireDefault(require("./definition/recursive/left/indirectly"));
var _class = require("./utilities/class");
function eliminateLeftRecursion(startRule, ruleMap) {
    var rule = startRule, reducedRules = [], rewrittenRules = [], leftRecursiveRules = [], recursiveDefinitions = [], leftRecursiveDefinitions = [];
    retrieveLeftRecursiveDefinitions(rule, recursiveDefinitions, leftRecursiveDefinitions, ruleMap);
    retrieveLeftRecursiveRules(leftRecursiveRules, leftRecursiveDefinitions, ruleMap);
    reduceLeftRecursiveRules(leftRecursiveRules, reducedRules, ruleMap);
    rewriteLeftRecursiveRules(leftRecursiveRules, rewrittenRules, leftRecursiveDefinitions, ruleMap);
    ///
    eliminateDirectLeftRecursion(rewrittenRules, ruleMap);
    var startRuleName = startRule.getName();
    startRule = ruleMap[startRuleName]; ///
    return startRule;
}
function _arrayLikeToArray(arr, len) {
    if (len == null || len > arr.length) len = arr.length;
    for(var i = 0, arr2 = new Array(len); i < len; i++)arr2[i] = arr[i];
    return arr2;
}
function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) return _arrayLikeToArray(arr);
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _iterableToArray(iter) {
    if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}
function _unsupportedIterableToArray(o, minLen) {
    if (!o) return;
    if (typeof o === "string") return _arrayLikeToArray(o, minLen);
    var n = Object.prototype.toString.call(o).slice(8, -1);
    if (n === "Object" && o.constructor) n = o.constructor.name;
    if (n === "Map" || n === "Set") return Array.from(n);
    if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}
function reduceLeftRecursiveRules(leftRecursiveRules, reducedRules, ruleMap) {
    leftRecursiveRules.forEach(function(leftRecursiveRule) {
        var rule = leftRecursiveRule, reducedRule = _reduced.default.fromRule(rule);
        if (reducedRule !== null) {
            var reducedRuleName = reducedRule.getName();
            ruleMap[reducedRuleName] = reducedRule;
            reducedRules.push(reducedRule);
        }
    });
}
function rewriteLeftRecursiveRules(leftRecursiveRules, rewrittenRules, leftRecursiveDefinitions, ruleMap) {
    leftRecursiveRules.forEach(function(leftRecursiveRule) {
        var rule = leftRecursiveRule, ruleName = rule.getName(), rewrittenRule = _rewritten.default.fromRuleAndLeftRecursiveDefinitions(rule, leftRecursiveDefinitions);
        delete ruleMap[ruleName];
        var rewrittenRuleName = ruleName; ///
        ruleMap[rewrittenRuleName] = rewrittenRule;
        rewrittenRules.push(rewrittenRule);
    });
}
function retrieveLeftRecursiveRules(leftRecursiveRules, leftRecursiveDefinitions, ruleMap) {
    leftRecursiveDefinitions.forEach(function(leftRecursiveDefinition) {
        var ruleName = leftRecursiveDefinition.getRuleName(), rule = ruleMap[ruleName], leftRecursiveRulesIncludesRule = leftRecursiveRules.includes(rule);
        if (!leftRecursiveRulesIncludesRule) {
            var leftRecursiveRule = rule; ///
            leftRecursiveRules.push(leftRecursiveRule);
        }
        var leftRecursiveDefinitionIndirectlyLeftRecursiveDefinition = (0, _class).isInstanceOf(leftRecursiveDefinition, _indirectly.default);
        if (leftRecursiveDefinitionIndirectlyLeftRecursiveDefinition) {
            var indirectlyLeftRecursiveDefinition = leftRecursiveDefinition, implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(), ruleName1 = implicitlyLeftRecursiveDefinition.getRuleName(), rule1 = ruleMap[ruleName1], leftRecursiveRulesIncludesRule1 = leftRecursiveRules.includes(rule1);
            if (!leftRecursiveRulesIncludesRule1) {
                var leftRecursiveRule1 = rule1; ///
                leftRecursiveRules.push(leftRecursiveRule1);
            }
        }
    });
}
function eliminateDirectLeftRecursion(rewrittenRules, ruleMap) {
    rewrittenRules.forEach(function(rewrittenRule) {
        return rewrittenRule.rewrite(ruleMap);
    });
}
function retrieveLeftRecursiveDefinition(ruleName, definition, recursiveDefinitions, leftRecursiveDefinitions) {
    var leftRecursiveDefinitionMatchesDefinition1 = leftRecursiveDefinitions.some(function(leftRecursiveDefinition) {
        var leftRecursiveDefinitionMatchesDefinition = leftRecursiveDefinition.match(definition);
        if (leftRecursiveDefinitionMatchesDefinition) {
            return true;
        }
    });
    if (leftRecursiveDefinitionMatchesDefinition1) {
        return;
    }
    var leftRecursiveDefinition1 = _directly.default.fromRuleNameAndDefinition(ruleName, definition) || _indirectly.default.fromRuleNameDefinitionAndRecursiveDefinitions(ruleName, definition, recursiveDefinitions);
    if (leftRecursiveDefinition1 !== null) {
        leftRecursiveDefinitions.push(leftRecursiveDefinition1);
    }
}
function retrieveLeftRecursiveDefinitions(rule, recursiveDefinitions, leftRecursiveDefinitions, ruleMap) {
    var ruleName2 = rule.getName(), definitions = rule.getDefinitions();
    definitions.forEach(function(definition) {
        retrieveLeftRecursiveDefinition(ruleName2, definition, recursiveDefinitions, leftRecursiveDefinitions);
        var recursiveDefinition = _left.default.fromRuleNameAndDefinition(ruleName2, definition) || _recursive.default.fromRuleNameAndDefinition(ruleName2, definition);
        if (recursiveDefinition !== null) {
            var previousRecursiveDefinitions = _toConsumableArray(recursiveDefinitions).concat([
                recursiveDefinition
            ]), previousRecursiveRuleNames = previousRecursiveDefinitions.map(function(previousRecursiveDefinition) {
                var previousRecursiveDefinitionRuleName = previousRecursiveDefinition.getRuleName(), previousRecursiveRuleName = previousRecursiveDefinitionRuleName; ///
                return previousRecursiveRuleName;
            }), recursiveRuleNames = recursiveDefinition.getRecursiveRuleNames();
            recursiveRuleNames.forEach(function(recursiveRuleName) {
                var previousRecursiveRuleNamesIncludesRecursiveRuleName = previousRecursiveRuleNames.includes(recursiveRuleName);
                if (!previousRecursiveRuleNamesIncludesRecursiveRuleName) {
                    var ruleName = recursiveRuleName, _$rule = ruleMap[ruleName] || null; ///
                    if (_$rule !== null) {
                        var _$recursiveDefinitions = previousRecursiveDefinitions; ///
                        retrieveLeftRecursiveDefinitions(_$rule, _$recursiveDefinitions, leftRecursiveDefinitions, ruleMap);
                    }
                }
            });
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGltaW5hdGVMZWZ0UmVjdXJzaW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgUmVkdWNlZFJ1bGUgZnJvbSBcIi4vcnVsZS9yZWR1Y2VkXCI7XG5pbXBvcnQgUmV3cml0dGVuUnVsZSBmcm9tIFwiLi9ydWxlL3Jld3JpdHRlblwiO1xuaW1wb3J0IFJlY3Vyc2l2ZURlZmluaXRpb24gZnJvbSBcIi4vZGVmaW5pdGlvbi9yZWN1cnNpdmVcIjtcbmltcG9ydCBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0XCI7XG5pbXBvcnQgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0L2RpcmVjdGx5XCI7XG5pbXBvcnQgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIGZyb20gXCIuL2RlZmluaXRpb24vcmVjdXJzaXZlL2xlZnQvaW5kaXJlY3RseVwiO1xuXG5pbXBvcnQgeyBpc0luc3RhbmNlT2YgfSBmcm9tIFwiLi91dGlsaXRpZXMvY2xhc3NcIjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZWxpbWluYXRlTGVmdFJlY3Vyc2lvbihzdGFydFJ1bGUsIHJ1bGVNYXApIHtcbiAgY29uc3QgcnVsZSA9IHN0YXJ0UnVsZSwgLy8vXG4gICAgICAgIHJlZHVjZWRSdWxlcyA9IFtdLFxuICAgICAgICByZXdyaXR0ZW5SdWxlcyA9IFtdLFxuICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZXMgPSBbXSxcbiAgICAgICAgcmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBbXSxcbiAgICAgICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zID0gW107XG5cbiAgcmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMocnVsZSwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCk7XG5cbiAgcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZVJ1bGVzLCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJ1bGVNYXApO1xuXG4gIHJlZHVjZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlUnVsZXMsIHJlZHVjZWRSdWxlcywgcnVsZU1hcCk7XG5cbiAgcmV3cml0ZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlUnVsZXMsIHJld3JpdHRlblJ1bGVzLCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJ1bGVNYXApO1xuXG4gIC8vL1xuXG4gIGVsaW1pbmF0ZURpcmVjdExlZnRSZWN1cnNpb24ocmV3cml0dGVuUnVsZXMsIHJ1bGVNYXApO1xuXG4gIGNvbnN0IHN0YXJ0UnVsZU5hbWUgPSBzdGFydFJ1bGUuZ2V0TmFtZSgpO1xuXG4gIHN0YXJ0UnVsZSA9IHJ1bGVNYXBbc3RhcnRSdWxlTmFtZV07IC8vL1xuXG4gIHJldHVybiBzdGFydFJ1bGU7XG59XG5cbmZ1bmN0aW9uIHJlZHVjZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlUnVsZXMsIHJlZHVjZWRSdWxlcywgcnVsZU1hcCkge1xuICBsZWZ0UmVjdXJzaXZlUnVsZXMuZm9yRWFjaCgobGVmdFJlY3Vyc2l2ZVJ1bGUpID0+IHtcbiAgICBjb25zdCBydWxlID0gbGVmdFJlY3Vyc2l2ZVJ1bGUsIC8vL1xuICAgICAgICAgIHJlZHVjZWRSdWxlID0gUmVkdWNlZFJ1bGUuZnJvbVJ1bGUocnVsZSk7XG5cbiAgICBpZiAocmVkdWNlZFJ1bGUgIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IHJlZHVjZWRSdWxlTmFtZSA9IHJlZHVjZWRSdWxlLmdldE5hbWUoKTtcblxuICAgICAgcnVsZU1hcFtyZWR1Y2VkUnVsZU5hbWVdID0gcmVkdWNlZFJ1bGU7XG5cbiAgICAgIHJlZHVjZWRSdWxlcy5wdXNoKHJlZHVjZWRSdWxlKTtcbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZXdyaXRlTGVmdFJlY3Vyc2l2ZVJ1bGVzKGxlZnRSZWN1cnNpdmVSdWxlcywgcmV3cml0dGVuUnVsZXMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCkge1xuICBsZWZ0UmVjdXJzaXZlUnVsZXMuZm9yRWFjaCgobGVmdFJlY3Vyc2l2ZVJ1bGUpID0+IHtcbiAgICBjb25zdCBydWxlID0gbGVmdFJlY3Vyc2l2ZVJ1bGUsIC8vL1xuICAgICAgICAgIHJ1bGVOYW1lID0gcnVsZS5nZXROYW1lKCksXG4gICAgICAgICAgcmV3cml0dGVuUnVsZSA9IFJld3JpdHRlblJ1bGUuZnJvbVJ1bGVBbmRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMocnVsZSwgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKTtcblxuICAgIGRlbGV0ZSBydWxlTWFwW3J1bGVOYW1lXTtcblxuICAgIGNvbnN0IHJld3JpdHRlblJ1bGVOYW1lID0gcnVsZU5hbWU7IC8vL1xuXG4gICAgcnVsZU1hcFtyZXdyaXR0ZW5SdWxlTmFtZV0gPSByZXdyaXR0ZW5SdWxlO1xuXG4gICAgcmV3cml0dGVuUnVsZXMucHVzaChyZXdyaXR0ZW5SdWxlKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlTGVmdFJlY3Vyc2l2ZVJ1bGVzKGxlZnRSZWN1cnNpdmVSdWxlcywgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKSB7XG4gIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5mb3JFYWNoKChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4ge1xuICAgIGNvbnN0IHJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICBydWxlID0gcnVsZU1hcFtydWxlTmFtZV0sXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVzSW5jbHVkZXNSdWxlID0gbGVmdFJlY3Vyc2l2ZVJ1bGVzLmluY2x1ZGVzKHJ1bGUpO1xuXG4gICAgaWYgKCFsZWZ0UmVjdXJzaXZlUnVsZXNJbmNsdWRlc1J1bGUpIHtcbiAgICAgIGNvbnN0IGxlZnRSZWN1cnNpdmVSdWxlID0gcnVsZTsgLy8vXG5cbiAgICAgIGxlZnRSZWN1cnNpdmVSdWxlcy5wdXNoKGxlZnRSZWN1cnNpdmVSdWxlKTtcbiAgICB9XG5cbiAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGlzSW5zdGFuY2VPZihsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcblxuICAgIGlmIChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikge1xuICAgICAgY29uc3QgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sICAvLy9cbiAgICAgICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oKSxcbiAgICAgICAgICAgIHJ1bGVOYW1lID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICBydWxlID0gcnVsZU1hcFtydWxlTmFtZV0sXG4gICAgICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZXNJbmNsdWRlc1J1bGUgPSBsZWZ0UmVjdXJzaXZlUnVsZXMuaW5jbHVkZXMocnVsZSk7XG5cbiAgICAgICAgaWYgKCFsZWZ0UmVjdXJzaXZlUnVsZXNJbmNsdWRlc1J1bGUpIHtcbiAgICAgICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlUnVsZSA9IHJ1bGU7IC8vL1xuXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVzLnB1c2gobGVmdFJlY3Vyc2l2ZVJ1bGUpO1xuICAgICAgICB9XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gZWxpbWluYXRlRGlyZWN0TGVmdFJlY3Vyc2lvbihyZXdyaXR0ZW5SdWxlcywgcnVsZU1hcCkge1xuICByZXdyaXR0ZW5SdWxlcy5mb3JFYWNoKChyZXdyaXR0ZW5SdWxlKSA9PiByZXdyaXR0ZW5SdWxlLnJld3JpdGUocnVsZU1hcCkpO1xufVxuXG5mdW5jdGlvbiByZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKHJ1bGVOYW1lLCBkZWZpbml0aW9uLCByZWN1cnNpdmVEZWZpbml0aW9ucywgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGNvbnN0IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uTWF0Y2hlc0RlZmluaXRpb24gPSBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMuc29tZSgobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pID0+IHtcbiAgICBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbk1hdGNoZXNEZWZpbml0aW9uID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24ubWF0Y2goZGVmaW5pdGlvbik7XG5cbiAgICBpZiAobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25NYXRjaGVzRGVmaW5pdGlvbikge1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9KTtcblxuICBpZiAobGVmdFJlY3Vyc2l2ZURlZmluaXRpb25NYXRjaGVzRGVmaW5pdGlvbikge1xuICAgIHJldHVybjtcbiAgfVxuXG4gIGNvbnN0IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVBbmREZWZpbml0aW9uKHJ1bGVOYW1lLCBkZWZpbml0aW9uKSB8fFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVEZWZpbml0aW9uQW5kUmVjdXJzaXZlRGVmaW5pdGlvbnMocnVsZU5hbWUsIGRlZmluaXRpb24sIHJlY3Vyc2l2ZURlZmluaXRpb25zKTtcblxuICBpZiAobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gIT09IG51bGwpIHtcbiAgICBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMucHVzaChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG4gIH1cbn1cblxuZnVuY3Rpb24gcmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMocnVsZSwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCkge1xuICBjb25zdCBydWxlTmFtZSA9IHJ1bGUuZ2V0TmFtZSgpLFxuICAgICAgICBkZWZpbml0aW9ucyA9IHJ1bGUuZ2V0RGVmaW5pdGlvbnMoKTtcblxuICBkZWZpbml0aW9ucy5mb3JFYWNoKChkZWZpbml0aW9uKSA9PiB7XG4gICAgcmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihydWxlTmFtZSwgZGVmaW5pdGlvbiwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyk7XG5cbiAgICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9uID0gTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbVJ1bGVOYW1lQW5kRGVmaW5pdGlvbihydWxlTmFtZSwgZGVmaW5pdGlvbikgfHxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgUmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVBbmREZWZpbml0aW9uKHJ1bGVOYW1lLCBkZWZpbml0aW9uKTtcblxuICAgIGlmIChyZWN1cnNpdmVEZWZpbml0aW9uICE9PSBudWxsKSB7XG4gICAgICBjb25zdCBwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb25zID0gWyAuLi5yZWN1cnNpdmVEZWZpbml0aW9ucywgcmVjdXJzaXZlRGVmaW5pdGlvbiBdLFxuICAgICAgICAgICAgcHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXMgPSBwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb25zLm1hcCgocHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9uKSA9PiB7XG4gICAgICAgICAgICAgIGNvbnN0IHByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lID0gcHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICAgICAgICAgIHByZXZpb3VzUmVjdXJzaXZlUnVsZU5hbWUgPSBwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb25SdWxlTmFtZTsgIC8vL1xuXG4gICAgICAgICAgICAgIHJldHVybiBwcmV2aW91c1JlY3Vyc2l2ZVJ1bGVOYW1lO1xuICAgICAgICAgICAgfSksXG4gICAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXMgPSByZWN1cnNpdmVEZWZpbml0aW9uLmdldFJlY3Vyc2l2ZVJ1bGVOYW1lcygpO1xuXG4gICAgICByZWN1cnNpdmVSdWxlTmFtZXMuZm9yRWFjaCgocmVjdXJzaXZlUnVsZU5hbWUpID0+IHtcbiAgICAgICAgY29uc3QgcHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXNJbmNsdWRlc1JlY3Vyc2l2ZVJ1bGVOYW1lID0gcHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXMuaW5jbHVkZXMocmVjdXJzaXZlUnVsZU5hbWUpO1xuXG4gICAgICAgIGlmICghcHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXNJbmNsdWRlc1JlY3Vyc2l2ZVJ1bGVOYW1lKSB7XG4gICAgICAgICAgY29uc3QgcnVsZU5hbWUgPSByZWN1cnNpdmVSdWxlTmFtZSwgIC8vL1xuICAgICAgICAgICAgICAgIHJ1bGUgPSBydWxlTWFwW3J1bGVOYW1lXSB8fCBudWxsOyAvLy9cblxuICAgICAgICAgIGlmIChydWxlICE9PSBudWxsKSB7XG4gICAgICAgICAgICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9ucyA9IHByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvbnM7ICAvLy9cblxuICAgICAgICAgICAgcmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMocnVsZSwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9XG4gIH0pO1xufVxuIl0sIm5hbWVzIjpbImVsaW1pbmF0ZUxlZnRSZWN1cnNpb24iLCJzdGFydFJ1bGUiLCJydWxlTWFwIiwicnVsZSIsInJlZHVjZWRSdWxlcyIsInJld3JpdHRlblJ1bGVzIiwibGVmdFJlY3Vyc2l2ZVJ1bGVzIiwicmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJyZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJldHJpZXZlTGVmdFJlY3Vyc2l2ZVJ1bGVzIiwicmVkdWNlTGVmdFJlY3Vyc2l2ZVJ1bGVzIiwicmV3cml0ZUxlZnRSZWN1cnNpdmVSdWxlcyIsImVsaW1pbmF0ZURpcmVjdExlZnRSZWN1cnNpb24iLCJzdGFydFJ1bGVOYW1lIiwiZ2V0TmFtZSIsImZvckVhY2giLCJsZWZ0UmVjdXJzaXZlUnVsZSIsInJlZHVjZWRSdWxlIiwiUmVkdWNlZFJ1bGUiLCJmcm9tUnVsZSIsInJlZHVjZWRSdWxlTmFtZSIsInB1c2giLCJydWxlTmFtZSIsInJld3JpdHRlblJ1bGUiLCJSZXdyaXR0ZW5SdWxlIiwiZnJvbVJ1bGVBbmRMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJyZXdyaXR0ZW5SdWxlTmFtZSIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZ2V0UnVsZU5hbWUiLCJsZWZ0UmVjdXJzaXZlUnVsZXNJbmNsdWRlc1J1bGUiLCJpbmNsdWRlcyIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiaXNJbnN0YW5jZU9mIiwiSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZ2V0SW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmV3cml0ZSIsInJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJkZWZpbml0aW9uIiwibGVmdFJlY3Vyc2l2ZURlZmluaXRpb25NYXRjaGVzRGVmaW5pdGlvbiIsInNvbWUiLCJtYXRjaCIsIkRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tUnVsZU5hbWVBbmREZWZpbml0aW9uIiwiZnJvbVJ1bGVOYW1lRGVmaW5pdGlvbkFuZFJlY3Vyc2l2ZURlZmluaXRpb25zIiwiZGVmaW5pdGlvbnMiLCJnZXREZWZpbml0aW9ucyIsInJlY3Vyc2l2ZURlZmluaXRpb24iLCJMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIlJlY3Vyc2l2ZURlZmluaXRpb24iLCJwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb25zIiwicHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZXMiLCJtYXAiLCJwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb24iLCJwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb25SdWxlTmFtZSIsInByZXZpb3VzUmVjdXJzaXZlUnVsZU5hbWUiLCJyZWN1cnNpdmVSdWxlTmFtZXMiLCJnZXRSZWN1cnNpdmVSdWxlTmFtZXMiLCJyZWN1cnNpdmVSdWxlTmFtZSIsInByZXZpb3VzUmVjdXJzaXZlUnVsZU5hbWVzSW5jbHVkZXNSZWN1cnNpdmVSdWxlTmFtZSJdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDOzs7O2tCQVdXQSxzQkFBc0I7QUFUdEIsSUFBQSxRQUFnQixrQ0FBaEIsZ0JBQWdCLEVBQUE7QUFDZCxJQUFBLFVBQWtCLGtDQUFsQixrQkFBa0IsRUFBQTtBQUNaLElBQUEsVUFBd0Isa0NBQXhCLHdCQUF3QixFQUFBO0FBQ3BCLElBQUEsS0FBNkIsa0NBQTdCLDZCQUE2QixFQUFBO0FBQ3JCLElBQUEsU0FBc0Msa0NB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