'use strict';

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var ruleUtilities = require('./utilities/rule'),
    arrayUtilities = require('./utilities/array'),
    ruleNameUtilities = require('./utilities/ruleName'),
    RuleNameDefinition = require('./definition/ruleName'),
    RightRecursiveRule = require('./rule/rightRecursive'),
    RecursiveDefinition = require('./definition/recursive'),
    NonLeftRecursiveRule = require('./rule/nonLeftRecursive'),
    RightRecursiveDefinition = require('./definition/rightRecursive'),
    recursiveDefinitionUtilities = require('./utilities/recursiveDefinition'),
    NonLeftRecursiveRuleNameDefinition = require('./definition/nonLeftRecursiveRuleName'),
    NonLeftRecursiveAndRightRecursiveRuleNamesDefinition = require('./definition/nonLeftRecursiveAndRightRecursiveRuleNames');

var findRule = ruleUtilities.findRule,
    first = arrayUtilities.first,
    forEachWithRemove = arrayUtilities.forEachWithRemove,
    findIndirectlyLeftRecursiveDefinition = recursiveDefinitionUtilities.findIndirectlyLeftRecursiveDefinition,
    rightRecursiveRuleNameFromRuleName = ruleNameUtilities.rightRecursiveRuleNameFromRuleName,
    nonLeftRecursiveRuleNameFromRuleName = ruleNameUtilities.nonLeftRecursiveRuleNameFromRuleName;


function eliminateLeftRecursion(rules) {
  var firstRule = first(rules),
      rule = firstRule,
      ///
  recursiveDefinitions = [],
      immediatelyLeftRecursiveDefinitions = [];

  removeImmediatelyLeftRecursiveDefinitions(rule, recursiveDefinitions, immediatelyLeftRecursiveDefinitions, rules);

  rewriteLeftRecursiveDefinitions(immediatelyLeftRecursiveDefinitions, rules);

  var ruleNames = immediatelyLeftRecursiveDefinitions.map(function (immediatelyLeftRecursiveDefinition) {
    return immediatelyLeftRecursiveDefinition.getRuleName();
  }),
      ruleNamesLength = ruleNames.length;

  if (ruleNamesLength > 0) {
    var ruleNamesString = ruleNames.reduce(function (ruleNamesString, ruleName) {
      ruleNamesString = ruleNamesString !== '' ? ruleNamesString + ', \'' + ruleName + '\'' : '\'' + ruleName + '\'';

      return ruleNamesString;
    }, '');

    throw new Error('Left recursion cannot be eliminated from the folliowing rule or rules: ' + ruleNamesString + '.');
  }
}

module.exports = eliminateLeftRecursion;

function removeStrictlyLeftRecursiveDefinition(recursiveDefinition, immediatelyLeftRecursiveDefinitions) {
  var recursiveDefinitionStrictlyLeftRecursive = recursiveDefinition.isStrictlyLeftRecursive();

  if (recursiveDefinitionStrictlyLeftRecursive) {
    var strictlyLeftRecursiveDefinition = recursiveDefinition,
        ///
    immediatelyLeftRecursiveDefinition = strictlyLeftRecursiveDefinition; ///

    immediatelyLeftRecursiveDefinitions.push(immediatelyLeftRecursiveDefinition);

    return true;
  }
}

function removeImmediatelyLeftRecursiveDefinition(recursiveDefinition, recursiveDefinitions, immediatelyLeftRecursiveDefinitions) {
  var recursiveDefinitionLeftRecursive = recursiveDefinition.isLeftRecursive();

  if (recursiveDefinitionLeftRecursive) {
    var leftRecursiveDefinition = recursiveDefinition,
        ///
    indirectlyLeftRecursiveDefinition = findIndirectlyLeftRecursiveDefinition(leftRecursiveDefinition, recursiveDefinitions);

    if (indirectlyLeftRecursiveDefinition !== null) {
      var immediatelyLeftRecursiveDefinition = leftRecursiveDefinition; ///

      immediatelyLeftRecursiveDefinitions.push(immediatelyLeftRecursiveDefinition);

      return true;
    }
  }
}

function removeImmediatelyLeftRecursiveDefinitions(rule, recursiveDefinitions, immediatelyLeftRecursiveDefinitions, rules) {
  var ruleName = rule.getName(),
      definitions = rule.getDefinitions();

  forEachWithRemove(definitions, function (definition) {
    var recursiveDefinition = RecursiveDefinition.fromDefinitionAndRuleName(definition, ruleName);

    if (recursiveDefinition !== null) {
      var remove = removeStrictlyLeftRecursiveDefinition(recursiveDefinition, immediatelyLeftRecursiveDefinitions) || removeImmediatelyLeftRecursiveDefinition(recursiveDefinition, recursiveDefinitions, immediatelyLeftRecursiveDefinitions);

      if (remove) {
        return true;
      }

      recursiveDefinitions = [].concat(_toConsumableArray(recursiveDefinitions), [recursiveDefinition]);

      var recursiveRuleNames = recursiveDefinition.getRecursiveRuleNames(),
          recursiveDefinitionRuleNames = recursiveDefinitions.map(function (recursiveDefinition) {
        return recursiveDefinition.getRuleName();
      });

      recursiveRuleNames.forEach(function (recursiveRuleName) {
        var recursiveDefinitionRuleNamesIncludesRecursiveRuleName = recursiveDefinitionRuleNames.includes(recursiveRuleName);

        if (!recursiveDefinitionRuleNamesIncludesRecursiveRuleName) {
          var _ruleName = recursiveRuleName,
              ///
          _rule = findRule(_ruleName, rules);

          if (_rule !== null) {
            removeImmediatelyLeftRecursiveDefinitions(_rule, recursiveDefinitions, immediatelyLeftRecursiveDefinitions, rules);
          }
        }
      });
    }
  });
}

function rewriteLeftRecursiveDefinitions(immediatelyLeftRecursiveDefinitions, rules) {
  forEachWithRemove(immediatelyLeftRecursiveDefinitions, function (immediatelyLeftRecursiveDefinition) {
    var rewritable = immediatelyLeftRecursiveDefinition.isRewritable();

    if (rewritable) {
      var remove = rewriteStrictlyLeftRecursiveDefinition(immediatelyLeftRecursiveDefinition, rules);

      if (remove) {
        return true;
      }
    }
  });
}

function rewriteStrictlyLeftRecursiveDefinition(immediatelyLeftRecursiveDefinition, rules) {
  var strictlyLeftRecursive = immediatelyLeftRecursiveDefinition.isStrictlyLeftRecursive();

  if (strictlyLeftRecursive) {
    var _ruleName2 = immediatelyLeftRecursiveDefinition.getRuleName(),
        rightRecursiveRuleName = rightRecursiveRuleNameFromRuleName(_ruleName2),
        nonLeftRecursiveRuleName = nonLeftRecursiveRuleNameFromRuleName(_ruleName2);

    var nonLeftRecursiveRule = findRule(nonLeftRecursiveRuleName, rules);

    if (nonLeftRecursiveRule === null) {
      var definitions = void 0;

      var rule = findRule(_ruleName2, rules);

      definitions = rule.getDefinitions();

      nonLeftRecursiveRule = NonLeftRecursiveRule.fromNonLeftRecursiveRuleNameAndDefinitions(nonLeftRecursiveRuleName, definitions);

      rules.push(nonLeftRecursiveRule);

      var lookAhead = immediatelyLeftRecursiveDefinition.isLookAhead(),
          leftRecursiveRuleName = _ruleName2,
          ///
      nonLeftRecursiveRuleNameDefinition = NonLeftRecursiveRuleNameDefinition.fromRuleName(_ruleName2),
          nonLeftRecursiveAndRightRecursiveRuleNamesDefinition = NonLeftRecursiveAndRightRecursiveRuleNamesDefinition.fromRuleNameLeftRecursiveRuleNameAndLookAhead(_ruleName2, leftRecursiveRuleName, lookAhead);

      definitions = [nonLeftRecursiveAndRightRecursiveRuleNamesDefinition, nonLeftRecursiveRuleNameDefinition];

      rule.setDefinitions(definitions);
    } else {
      var _rule2 = findRule(_ruleName2, rules),
          _definitions = _rule2.getDefinitions(),
          firstDefinition = first(_definitions),
          immediatelyLeftRecursiveDefinitionLookAhead = immediatelyLeftRecursiveDefinition.isLookAhead(),
          _nonLeftRecursiveAndRightRecursiveRuleNamesDefinition = firstDefinition,
          ///
      nonLeftRecursiveAndRightRecursiveRuleNamesDefinitionLookAhead = _nonLeftRecursiveAndRightRecursiveRuleNamesDefinition.isLookAhead();

      if (immediatelyLeftRecursiveDefinitionLookAhead !== nonLeftRecursiveAndRightRecursiveRuleNamesDefinitionLookAhead) {
        return false;
      }
    }

    var rightRecursiveRule = findRule(rightRecursiveRuleName, rules);

    if (rightRecursiveRule === null) {
      rightRecursiveRule = RightRecursiveRule.fromRightRecursiveRuleName(rightRecursiveRuleName);

      rules.push(rightRecursiveRule);
    }

    var rightRecursiveDefinition = RightRecursiveDefinition.fromImmediatelyLeftRecursiveDefinition(immediatelyLeftRecursiveDefinition);

    rightRecursiveRule.addRightRecursiveDefinition(rightRecursiveDefinition);

    return true;
  }
}

function rewriteImmediatelyAndIndirectlyLeftRecursiveDefinitions(immediatelyLeftRecursiveDefinitions, rules) {
  var remove = false;

  var ruleRewritable = immediatelyLeftRecursiveDefinitions.every(function (immediatelyLeftRecursiveDefinition) {
    return immediatelyLeftRecursiveDefinition.isRewritable();
  });

  if (ruleRewritable) {
    var ruleNonStrictlyLeftRecursive = !immediatelyLeftRecursiveDefinitions.some(function (immediatelyLeftRecursiveDefinition) {
      return immediatelyLeftRecursiveDefinition.isStrictlyLeftRecursive();
    });

    if (ruleNonStrictlyLeftRecursive) {
      var lookAheads = immediatelyLeftRecursiveDefinitions.map(function (immediatelyLeftRecursiveDefinition) {
        return immediatelyLeftRecursiveDefinition.isLookAhead();
      }),
          lookAheadsEqual = areElementsEqual(lookAheads),
          leftRecursiveRuleNames = immediatelyLeftRecursiveDefinitions.map(function (immediatelyLeftRecursiveDefinition) {
        return immediatelyLeftRecursiveDefinition.getLeftRecursiveRuleName();
      }),
          leftRecursiveRuleNamesEqual = areElementsEqual(leftRecursiveRuleNames);

      if (lookAheadsEqual && leftRecursiveRuleNamesEqual) {
        var rule = void 0,
            definitions = void 0,
            nonLeftRecursiveRule = void 0,
            nonLeftRecursiveRuleNameDefinition = void 0;

        rule = findRule(ruleName, rules);

        var immediatelyLeftRecursiveRule = rule; ///

        nonLeftRecursiveRule = NonLeftRecursiveRule.fromImmediatelyLeftRecursiveRule(immediatelyLeftRecursiveRule);

        var rightRecursiveRule = RightRecursiveRule.fromRuleNameAndImmediatelyLeftRecursiveRecursiveDefinitions(ruleName, immediatelyLeftRecursiveDefinitions);

        rules.push(nonLeftRecursiveRule);

        rules.push(rightRecursiveRule);

        var firstLookAhead = first(lookAheads),
            firstLeftRecursiveRuleName = first(leftRecursiveRuleNames),
            lookAhead = firstLookAhead,
            ///
        leftRecursiveRuleName = firstLeftRecursiveRuleName; ///

        nonLeftRecursiveRuleNameDefinition = NonLeftRecursiveRuleNameDefinition.fromRuleName(ruleName);

        var nonLeftRecursiveAndRightRecursiveRuleNamesDefinition = NonLeftRecursiveAndRightRecursiveRuleNamesDefinition.fromRuleNameLeftRecursiveRuleNameAndLookAhead(ruleName, leftRecursiveRuleName, lookAhead);

        definitions = [nonLeftRecursiveAndRightRecursiveRuleNamesDefinition, nonLeftRecursiveRuleNameDefinition];

        immediatelyLeftRecursiveRule.setDefinitions(definitions);

        var indirectlyLeftRecursiveRuleName = leftRecursiveRuleName,
            ///
        indirectlyLeftRecursiveRule = indirectlyLeftRecursiveRuleName(indirectlyLeftRecursiveRuleName, rules),
            firstImmediatelyLeftRecursiveDefinition = first(immediatelyLeftRecursiveDefinitions),
            immediatelyLeftRecursiveDefinition = firstImmediatelyLeftRecursiveDefinition,
            ///
        indirectlyLeftRecursiveDefinition = immediatelyLeftRecursiveDefinition.getIndirectlyLeftRecursiveDefinition();

        nonLeftRecursiveRule = NonLeftRecursiveRule.fromIndirectlyLeftRecursiveRuleAndIndirectlyLeftRecursiveDefinition(indirectlyLeftRecursiveRule, indirectlyLeftRecursiveDefinition);

        var ruleNameDefinition = RuleNameDefinition.fromRuleName(ruleName);

        nonLeftRecursiveRuleNameDefinition = NonLeftRecursiveRuleNameDefinition.fromLeftRecursiveRuleName(leftRecursiveRuleName);

        definitions = [ruleNameDefinition, nonLeftRecursiveRuleNameDefinition];

        indirectlyLeftRecursiveRule.setDefinitions(definitions);

        rules.push(nonLeftRecursiveRule);

        remove = true;
      }
    }
  }

  return remove;
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9lbGltaW5hdGVMZWZ0UmVjdXJzaW9uLmpzIl0sIm5hbWVzIjpbInJ1bGVVdGlsaXRpZXMiLCJyZXF1aXJlIiwiYXJyYXlVdGlsaXRpZXMiLCJydWxlTmFtZVV0aWxpdGllcyIsIlJ1bGVOYW1lRGVmaW5pdGlvbiIsIlJpZ2h0UmVjdXJzaXZlUnVsZSIsIlJlY3Vyc2l2ZURlZmluaXRpb24iLCJOb25MZWZ0UmVjdXJzaXZlUnVsZSIsIlJpZ2h0UmVjdXJzaXZlRGVmaW5pdGlvbiIsInJlY3Vyc2l2ZURlZmluaXRpb25VdGlsaXRpZXMiLCJOb25MZWZ0UmVjdXJzaXZlUnVsZU5hbWVEZWZpbml0aW9uIiwiTm9uTGVmdFJlY3Vyc2l2ZUFuZFJpZ2h0UmVjdXJzaXZlUnVsZU5hbWVzRGVmaW5pdGlvbiIsImZpbmRSdWxlIiwiZmlyc3QiLCJmb3JFYWNoV2l0aFJlbW92ZSIsImZpbmRJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJyaWdodFJlY3Vyc2l2ZVJ1bGVOYW1lRnJvbVJ1bGVOYW1lIiwibm9uTGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lRnJvbVJ1bGVOYW1lIiwiZWxpbWluYXRlTGVmdFJlY3Vyc2lvbiIsInJ1bGVzIiwiZmlyc3RSdWxlIiwicnVsZSIsInJlY3Vyc2l2ZURlZmluaXRpb25zIiwiaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJyZW1vdmVJbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJld3JpdGVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJydWxlTmFtZXMiLCJtYXAiLCJpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZ2V0UnVsZU5hbWUiLCJydWxlTmFtZXNMZW5ndGgiLCJsZW5ndGgiLCJydWxlTmFtZXNTdHJpbmciLCJyZWR1Y2UiLCJydWxlTmFtZSIsIkVycm9yIiwibW9kdWxlIiwiZXhwb3J0cyIsInJlbW92ZVN0cmljdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJyZWN1cnNpdmVEZWZpbml0aW9uIiwicmVjdXJzaXZlRGVmaW5pdGlvblN0cmljdGx5TGVmdFJlY3Vyc2l2ZSIsImlzU3RyaWN0bHlMZWZ0UmVjdXJzaXZlIiwic3RyaWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsInB1c2giLCJyZW1vdmVJbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmVjdXJzaXZlRGVmaW5pdGlvbkxlZnRSZWN1cnNpdmUiLCJpc0xlZnRSZWN1cnNpdmUiLCJsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImdldE5hbWUiLCJkZWZpbml0aW9ucyIsImdldERlZmluaXRpb25zIiwiZGVmaW5pdGlvbiIsImZyb21EZWZpbml0aW9uQW5kUnVsZU5hbWUiLCJyZW1vdmUiLCJyZWN1cnNpdmVSdWxlTmFtZXMiLCJnZXRSZWN1cnNpdmVSdWxlTmFtZXMiLCJyZWN1cnNpdmVEZWZpbml0aW9uUnVsZU5hbWVzIiwiZm9yRWFjaCIsInJlY3Vyc2l2ZVJ1bGVOYW1lIiwicmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lc0luY2x1ZGVzUmVjdXJzaXZlUnVsZU5hbWUiLCJpbmNsdWRlcyIsInJld3JpdGFibGUiLCJpc1Jld3JpdGFibGUiLCJyZXdyaXRlU3RyaWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsInN0cmljdGx5TGVmdFJlY3Vyc2l2ZSIsInJpZ2h0UmVjdXJzaXZlUnVsZU5hbWUiLCJub25MZWZ0UmVjdXJzaXZlUnVsZU5hbWUiLCJub25MZWZ0UmVjdXJzaXZlUnVsZSIsImZyb21Ob25MZWZ0UmVjdXJzaXZlUnVsZU5hbWVBbmREZWZpbml0aW9ucyIsImxvb2tBaGVhZCIsImlzTG9va0FoZWFkIiwibGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lIiwibm9uTGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lRGVmaW5pdGlvbiIsImZyb21SdWxlTmFtZSIsIm5vbkxlZnRSZWN1cnNpdmVBbmRSaWdodFJlY3Vyc2l2ZVJ1bGVOYW1lc0RlZmluaXRpb24iLCJmcm9tUnVsZU5hbWVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVBbmRMb29rQWhlYWQiLCJzZXREZWZpbml0aW9ucyIsImZpcnN0RGVmaW5pdGlvbiIsImltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25Mb29rQWhlYWQiLCJub25MZWZ0UmVjdXJzaXZlQW5kUmlnaHRSZWN1cnNpdmVSdWxlTmFtZXNEZWZpbml0aW9uTG9va0FoZWFkIiwicmlnaHRSZWN1cnNpdmVSdWxlIiwiZnJvbVJpZ2h0UmVjdXJzaXZlUnVsZU5hbWUiLCJyaWdodFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tSW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImFkZFJpZ2h0UmVjdXJzaXZlRGVmaW5pdGlvbiIsInJld3JpdGVJbW1lZGlhdGVseUFuZEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJydWxlUmV3cml0YWJsZSIsImV2ZXJ5IiwicnVsZU5vblN0cmljdGx5TGVmdFJlY3Vyc2l2ZSIsInNvbWUiLCJsb29rQWhlYWRzIiwibG9va0FoZWFkc0VxdWFsIiwiYXJlRWxlbWVudHNFcXVhbCIsImxlZnRSZWN1cnNpdmVSdWxlTmFtZXMiLCJnZXRMZWZ0UmVjdXJzaXZlUnVsZU5hbWUiLCJsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzRXF1YWwiLCJpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVSdWxlIiwiZnJvbUltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZVJ1bGUiLCJmcm9tUnVsZU5hbWVBbmRJbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVSZWN1cnNpdmVEZWZpbml0aW9ucyIsImZpcnN0TG9va0FoZWFkIiwiZmlyc3RMZWZ0UmVjdXJzaXZlUnVsZU5hbWUiLCJpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlIiwiZmlyc3RJbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZ2V0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZnJvbUluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZUFuZEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsInJ1bGVOYW1lRGVmaW5pdGlvbiIsImZyb21MZWZ0UmVjdXJzaXZlUnVsZU5hbWUiXSwibWFwcGluZ3MiOiJBQUFBOzs7O0FBRUEsSUFBTUEsZ0JBQWdCQyxRQUFRLGtCQUFSLENBQXRCO0FBQUEsSUFDTUMsaUJBQWlCRCxRQUFRLG1CQUFSLENBRHZCO0FBQUEsSUFFTUUsb0JBQW9CRixRQUFRLHNCQUFSLENBRjFCO0FBQUEsSUFHTUcscUJBQXFCSCxRQUFRLHVCQUFSLENBSDNCO0FBQUEsSUFJTUkscUJBQXFCSixRQUFRLHVCQUFSLENBSjNCO0FBQUEsSUFLTUssc0JBQXNCTCxRQUFRLHdCQUFSLENBTDVCO0FBQUEsSUFNTU0sdUJBQXVCTixRQUFRLHlCQUFSLENBTjdCO0FBQUEsSUFPTU8sMkJBQTJCUCxRQUFRLDZCQUFSLENBUGpDO0FBQUEsSUFRTVEsK0JBQStCUixRQUFRLGlDQUFSLENBUnJDO0FBQUEsSUFTTVMscUNBQXFDVCxRQUFRLHVDQUFSLENBVDNDO0FBQUEsSUFVTVUsdURBQXVEVixRQUFRLHlEQUFSLENBVjdEOztBQVlNLElBQUVXLFFBQUYsR0FBZVosYUFBZixDQUFFWSxRQUFGO0FBQUEsSUFDRUMsS0FERixHQUMrQlgsY0FEL0IsQ0FDRVcsS0FERjtBQUFBLElBQ1NDLGlCQURULEdBQytCWixjQUQvQixDQUNTWSxpQkFEVDtBQUFBLElBRUVDLHFDQUZGLEdBRTRDTiw0QkFGNUMsQ0FFRU0scUNBRkY7QUFBQSxJQUdFQyxrQ0FIRixHQUcrRWIsaUJBSC9FLENBR0VhLGtDQUhGO0FBQUEsSUFHc0NDLG9DQUh0QyxHQUcrRWQsaUJBSC9FLENBR3NDYyxvQ0FIdEM7OztBQUtOLFNBQVNDLHNCQUFULENBQWdDQyxLQUFoQyxFQUF1QztBQUNyQyxNQUFNQyxZQUFZUCxN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Q0FBMEMzRixNQUFNVSxtQ0FBTixDQUZoRDtBQUFBLFlBR01LLHFDQUFxQzRFLHVDQUgzQztBQUFBLFlBR29GO0FBQzlFeEQsNENBQW9DcEIsbUNBQW1DNkUsb0NBQW5DLEVBSjFDOztBQU1BckMsK0JBQXVCN0QscUJBQXFCbUcsbUVBQXJCLENBQXlGSCwyQkFBekYsRUFBc0h2RCxpQ0FBdEgsQ0FBdkI7O0FBRUEsWUFBTTJELHFCQUFxQnZHLG1CQUFtQnNFLFlBQW5CLENBQWdDeEMsUUFBaEMsQ0FBM0I7O0FBRUF1Qyw2Q0FBcUMvRCxtQ0FBbUNrRyx5QkFBbkMsQ0FBNkRwQyxxQkFBN0QsQ0FBckM7O0FBRUF0QixzQkFBYyxDQUNaeUQsa0JBRFksRUFFWmxDLGtDQUZZLENBQWQ7O0FBS0E4QixvQ0FBNEIxQixjQUE1QixDQUEyQzNCLFdBQTNDOztBQUVBL0IsY0FBTXdCLElBQU4sQ0FBV3lCLG9CQUFYOztBQUVBZCxpQkFBUyxJQUFUO0FBQ0Q7QUFDRjtBQUNGOztBQUVELFNBQU9BLE1BQVA7QUFDRCIsImZpbGUiOiJlbGltaW5hdGVMZWZ0UmVjdXJzaW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5jb25zdCBydWxlVXRpbGl0aWVzID0gcmVxdWlyZSgnLi91dGlsaXRpZXMvcnVsZScpLFxuICAgICAgYXJyYXlVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9hcnJheScpLFxuICAgICAgcnVsZU5hbWVVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9ydWxlTmFtZScpLFxuICAgICAgUnVsZU5hbWVEZWZpbml0aW9uID0gcmVxdWlyZSgnLi9kZWZpbml0aW9uL3J1bGVOYW1lJyksXG4gICAgICBSaWdodFJlY3Vyc2l2ZVJ1bGUgPSByZXF1aXJlKCcuL3J1bGUvcmlnaHRSZWN1cnNpdmUnKSxcbiAgICAgIFJlY3Vyc2l2ZURlZmluaXRpb24gPSByZXF1aXJlKCcuL2RlZmluaXRpb24vcmVjdXJzaXZlJyksXG4gICAgICBOb25MZWZ0UmVjdXJzaXZlUnVsZSA9IHJlcXVpcmUoJy4vcnVsZS9ub25MZWZ0UmVjdXJzaXZlJyksXG4gICAgICBSaWdodFJlY3Vyc2l2ZURlZmluaXRpb24gPSByZXF1aXJlKCcuL2RlZmluaXRpb24vcmlnaHRSZWN1cnNpdmUnKSxcbiAgICAgIHJlY3Vyc2l2ZURlZmluaXRpb25VdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9yZWN1cnNpdmVEZWZpbml0aW9uJyksXG4gICAgICBOb25MZWZ0UmVjdXJzaXZlUnVsZU5hbWVEZWZpbml0aW9uID0gcmVxdWlyZSgnLi9kZWZpbml0aW9uL25vbkxlZnRSZWN1cnNpdmVSdWxlTmFtZScpLFxuICAgICAgTm9uTGVmdFJlY3Vyc2l2ZUFuZFJpZ2h0UmVjdXJzaXZlUnVsZU5hbWVzRGVmaW5pdGlvbiA9IHJlcXVpcmUoJy4vZGVmaW5pdGlvbi9ub25MZWZ0UmVjdXJzaXZlQW5kUmlnaHRSZWN1cnNpdmVSdWxlTmFtZXMnKTtcblxuY29uc3QgeyBmaW5kUnVsZSB9ID0gcnVsZVV0aWxpdGllcyxcbiAgICAgIHsgZmlyc3QsIGZvckVhY2hXaXRoUmVtb3ZlIH0gPSBhcnJheVV0aWxpdGllcyxcbiAgICAgIHsgZmluZEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiB9ID0gcmVjdXJzaXZlRGVmaW5pdGlvblV0aWxpdGllcyxcbiAgICAgIHsgcmlnaHRSZWN1cnNpdmVSdWxlTmFtZUZyb21SdWxlTmFtZSwgbm9uTGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lRnJvbVJ1bGVOYW1lIH0gPSBydWxlTmFtZVV0aWxpdGllcztcblxuZnVuY3Rpb24gZWxpbWluYXRlTGVmdFJlY3Vyc2lvbihydWxlcykge1xuICBjb25zdCBmaXJzdFJ1bGUgPSBmaXJzdChydWxlcyksXG4gICAgICAgIHJ1bGUgPSBmaXJzdFJ1bGUsIC8vL1xuICAgICAgICByZWN1cnNpdmVEZWZpbml0aW9ucyA9IFtdLFxuICAgICAgICBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyA9IFtdO1xuXG4gIHJlbW92ZUltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKHJ1bGUsIHJlY3Vyc2l2ZURlZmluaXRpb25zLCBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZXMpO1xuXG4gIHJld3JpdGVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJ1bGVzKTtcblxuICBjb25zdCBydWxlTmFtZXMgPSBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5tYXAoKGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pID0+IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKSksXG4gICAgICAgIHJ1bGVOYW1lc0xlbmd0aCA9IHJ1bGVOYW1lcy5sZW5ndGg7XG5cbiAgaWYgKHJ1bGVOYW1lc0xlbmd0aCA+IDApIHtcbiAgICBjb25zdCBydWxlTmFtZXNTdHJpbmcgPSBydWxlTmFtZXMucmVkdWNlKChydWxlTmFtZXNTdHJpbmcsIHJ1bGVOYW1lKSA9PiB7XG4gICAgICBydWxlTmFtZXNTdHJpbmcgPSAocnVsZU5hbWVzU3RyaW5nICE9PSAnJykgP1xuICAgICAgICAgICAgICAgICAgICAgICAgIGAke3J1bGVOYW1lc1N0cmluZ30sICcke3J1bGVOYW1lfSdgIDpcbiAgICAgICAgICAgICAgICAgICAgICAgICAgYCcke3J1bGVOYW1lfSdgO1xuXG4gICAgICByZXR1cm4gcnVsZU5hbWVzU3RyaW5nO1xuICAgIH0sICcnKTtcblxuICAgIHRocm93IG5ldyBFcnJvcihgTGVmdCByZWN1cnNpb24gY2Fubm90IGJlIGVsaW1pbmF0ZWQgZnJvbSB0aGUgZm9sbGlvd2luZyBydWxlIG9yIHJ1bGVzOiAke3J1bGVOYW1lc1N0cmluZ30uYCk7XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBlbGltaW5hdGVMZWZ0UmVjdXJzaW9uO1xuXG5mdW5jdGlvbiByZW1vdmVTdHJpY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKHJlY3Vyc2l2ZURlZmluaXRpb24sIGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSB7XG4gIGNvbnN0IHJlY3Vyc2l2ZURlZmluaXRpb25TdHJpY3RseUxlZnRSZWN1cnNpdmUgPSByZWN1cnNpdmVEZWZpbml0aW9uLmlzU3RyaWN0bHlMZWZ0UmVjdXJzaXZlKCk7XG5cbiAgaWYgKHJlY3Vyc2l2ZURlZmluaXRpb25TdHJpY3RseUxlZnRSZWN1cnNpdmUpIHtcbiAgICBjb25zdCBzdHJpY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gcmVjdXJzaXZlRGVmaW5pdGlvbiwgIC8vL1xuICAgICAgICAgIGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSBzdHJpY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uOyAvLy9cblxuICAgIGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLnB1c2goaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZW1vdmVJbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKHJlY3Vyc2l2ZURlZmluaXRpb24sIHJlY3Vyc2l2ZURlZmluaXRpb25zLCBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucykge1xuICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9uTGVmdFJlY3Vyc2l2ZSA9IHJlY3Vyc2l2ZURlZmluaXRpb24uaXNMZWZ0UmVjdXJzaXZlKCk7XG5cbiAgaWYgKHJlY3Vyc2l2ZURlZmluaXRpb25MZWZ0UmVjdXJzaXZlKSB7XG4gICAgY29uc3QgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSByZWN1cnNpdmVEZWZpbml0aW9uLCAgLy8vXG4gICAgICAgICAgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gZmluZEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgcmVjdXJzaXZlRGVmaW5pdGlvbnMpO1xuXG4gICAgaWYgKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uOyAvLy9cblxuICAgICAgaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMucHVzaChpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcblxuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIHJlbW92ZUltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKHJ1bGUsIHJlY3Vyc2l2ZURlZmluaXRpb25zLCBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZXMpIHtcbiAgY29uc3QgcnVsZU5hbWUgPSBydWxlLmdldE5hbWUoKSxcbiAgICAgICAgZGVmaW5pdGlvbnMgPSBydWxlLmdldERlZmluaXRpb25zKCk7XG5cbiAgZm9yRWFjaFdpdGhSZW1vdmUoZGVmaW5pdGlvbnMsIChkZWZpbml0aW9uKSA9PiB7XG4gICAgY29uc3QgcmVjdXJzaXZlRGVmaW5pdGlvbiA9IFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbURlZmluaXRpb25BbmRSdWxlTmFtZShkZWZpbml0aW9uLCBydWxlTmFtZSk7XG5cbiAgICBpZiAocmVjdXJzaXZlRGVmaW5pdGlvbiAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgcmVtb3ZlID0gcmVtb3ZlU3RyaWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihyZWN1cnNpdmVEZWZpbml0aW9uLCBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucylcbiAgICAgICAgICAgICAgICAgICB8fCByZW1vdmVJbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKHJlY3Vyc2l2ZURlZmluaXRpb24sIHJlY3Vyc2l2ZURlZmluaXRpb25zLCBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyk7XG5cbiAgICAgIGlmIChyZW1vdmUpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG5cbiAgICAgIHJlY3Vyc2l2ZURlZmluaXRpb25zID0gWyAuLi5yZWN1cnNpdmVEZWZpbml0aW9ucywgcmVjdXJzaXZlRGVmaW5pdGlvbiBdO1xuXG4gICAgICBjb25zdCByZWN1cnNpdmVSdWxlTmFtZXMgPSByZWN1cnNpdmVEZWZpbml0aW9uLmdldFJlY3Vyc2l2ZVJ1bGVOYW1lcygpLFxuICAgICAgICAgICAgcmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lcyA9IHJlY3Vyc2l2ZURlZmluaXRpb25zLm1hcCgocmVjdXJzaXZlRGVmaW5pdGlvbikgPT4gcmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRSdWxlTmFtZSgpKTtcblxuICAgICAgcmVjdXJzaXZlUnVsZU5hbWVzLmZvckVhY2goKHJlY3Vyc2l2ZVJ1bGVOYW1lKSA9PiB7XG4gICAgICAgIGNvbnN0IHJlY3Vyc2l2ZURlZmluaXRpb25SdWxlTmFtZXNJbmNsdWRlc1JlY3Vyc2l2ZVJ1bGVOYW1lID0gcmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lcy5pbmNsdWRlcyhyZWN1cnNpdmVSdWxlTmFtZSk7XG5cbiAgICAgICAgaWYgKCFyZWN1cnNpdmVEZWZpbml0aW9uUnVsZU5hbWVzSW5jbHVkZXNSZWN1cnNpdmVSdWxlTmFtZSkge1xuICAgICAgICAgIGNvbnN0IHJ1bGVOYW1lID0gcmVjdXJzaXZlUnVsZU5hbWUsICAvLy9cbiAgICAgICAgICAgICAgICBydWxlID0gZmluZFJ1bGUocnVsZU5hbWUsIHJ1bGVzKTtcblxuICAgICAgICAgIGlmIChydWxlICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZW1vdmVJbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhydWxlLCByZWN1cnNpdmVEZWZpbml0aW9ucywgaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJ1bGVzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJld3JpdGVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMoaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJ1bGVzKSB7XG4gIGZvckVhY2hXaXRoUmVtb3ZlKGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCAoaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4ge1xuICAgIGNvbnN0IHJld3JpdGFibGUgPSBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmlzUmV3cml0YWJsZSgpO1xuXG4gICAgaWYgKHJld3JpdGFibGUpIHtcbiAgICAgIGNvbnN0IHJlbW92ZSA9IHJld3JpdGVTdHJpY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sIHJ1bGVzKTtcblxuICAgICAgaWYgKHJlbW92ZSkge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG4gIH0pO1xufVxuXG5mdW5jdGlvbiByZXdyaXRlU3RyaWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbihpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLCBydWxlcykge1xuICBjb25zdCBzdHJpY3RseUxlZnRSZWN1cnNpdmUgPSBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmlzU3RyaWN0bHlMZWZ0UmVjdXJzaXZlKCk7XG5cbiAgaWYgKHN0cmljdGx5TGVmdFJlY3Vyc2l2ZSkge1xuICAgIGNvbnN0IHJ1bGVOYW1lID0gaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgIHJpZ2h0UmVjdXJzaXZlUnVsZU5hbWUgPSByaWdodFJlY3Vyc2l2ZVJ1bGVOYW1lRnJvbVJ1bGVOYW1lKHJ1bGVOYW1lKSxcbiAgICAgICAgICBub25MZWZ0UmVjdXJzaXZlUnVsZU5hbWUgPSBub25MZWZ0UmVjdXJzaXZlUnVsZU5hbWVGcm9tUnVsZU5hbWUocnVsZU5hbWUpO1xuXG4gICAgbGV0IG5vbkxlZnRSZWN1cnNpdmVSdWxlID0gZmluZFJ1bGUobm9uTGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lLCBydWxlcyk7XG5cbiAgICBpZiAobm9uTGVmdFJlY3Vyc2l2ZVJ1bGUgPT09IG51bGwpIHtcbiAgICAgIGxldCBkZWZpbml0aW9ucztcblxuICAgICAgY29uc3QgcnVsZSA9IGZpbmRSdWxlKHJ1bGVOYW1lLCBydWxlcyk7XG5cbiAgICAgIGRlZmluaXRpb25zID0gcnVsZS5nZXREZWZpbml0aW9ucygpO1xuXG4gICAgICBub25MZWZ0UmVjdXJzaXZlUnVsZSA9IE5vbkxlZnRSZWN1cnNpdmVSdWxlLmZyb21Ob25MZWZ0UmVjdXJzaXZlUnVsZU5hbWVBbmREZWZpbml0aW9ucyhub25MZWZ0UmVjdXJzaXZlUnVsZU5hbWUsIGRlZmluaXRpb25zKTtcblxuICAgICAgcnVsZXMucHVzaChub25MZWZ0UmVjdXJzaXZlUnVsZSk7XG5cbiAgICAgIGNvbnN0IGxvb2tBaGVhZCA9IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uaXNMb29rQWhlYWQoKSxcbiAgICAgICAgICAgIGxlZnRSZWN1cnNpdmVSdWxlTmFtZSA9IHJ1bGVOYW1lLCAvLy9cbiAgICAgICAgICAgIG5vbkxlZnRSZWN1cnNpdmVSdWxlTmFtZURlZmluaXRpb24gPSBOb25MZWZ0UmVjdXJzaXZlUnVsZU5hbWVEZWZpbml0aW9uLmZyb21SdWxlTmFtZShydWxlTmFtZSksXG4gICAgICAgICAgICBub25MZWZ0UmVjdXJzaXZlQW5kUmlnaHRSZWN1cnNpdmVSdWxlTmFtZXNEZWZpbml0aW9uID0gTm9uTGVmdFJlY3Vyc2l2ZUFuZFJpZ2h0UmVjdXJzaXZlUnVsZU5hbWVzRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVBbmRMb29rQWhlYWQocnVsZU5hbWUsIGxlZnRSZWN1cnNpdmVSdWxlTmFtZSwgbG9va0FoZWFkKTtcblxuICAgICAgZGVmaW5pdGlvbnMgPSBbXG4gICAgICAgIG5vbkxlZnRSZWN1cnNpdmVBbmRSaWdodFJlY3Vyc2l2ZVJ1bGVOYW1lc0RlZmluaXRpb24sXG4gICAgICAgIG5vbkxlZnRSZWN1cnNpdmVSdWxlTmFtZURlZmluaXRpb25cbiAgICAgIF07XG5cbiAgICAgIHJ1bGUuc2V0RGVmaW5pdGlvbnMoZGVmaW5pdGlvbnMpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBydWxlID0gZmluZFJ1bGUocnVsZU5hbWUsIHJ1bGVzKSxcbiAgICAgICAgICAgIGRlZmluaXRpb25zID0gcnVsZS5nZXREZWZpbml0aW9ucygpLFxuICAgICAgICAgICAgZmlyc3REZWZpbml0aW9uID0gZmlyc3QoZGVmaW5pdGlvbnMpLFxuICAgICAgICAgICAgaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkxvb2tBaGVhZCA9IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uaXNMb29rQWhlYWQoKSxcbiAgICAgICAgICAgIG5vbkxlZnRSZWN1cnNpdmVBbmRSaWdodFJlY3Vyc2l2ZVJ1bGVOYW1lc0RlZmluaXRpb24gPSBmaXJzdERlZmluaXRpb24sIC8vL1xuICAgICAgICAgICAgbm9uTGVmdFJlY3Vyc2l2ZUFuZFJpZ2h0UmVjdXJzaXZlUnVsZU5hbWVzRGVmaW5pdGlvbkxvb2tBaGVhZCA9IG5vbkxlZnRSZWN1cnNpdmVBbmRSaWdodFJlY3Vyc2l2ZVJ1bGVOYW1lc0RlZmluaXRpb24uaXNMb29rQWhlYWQoKTtcblxuICAgICAgaWYgKGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25Mb29rQWhlYWQgIT09IG5vbkxlZnRSZWN1cnNpdmVBbmRSaWdodFJlY3Vyc2l2ZVJ1bGVOYW1lc0RlZmluaXRpb25Mb29rQWhlYWQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIGxldCByaWdodFJlY3Vyc2l2ZVJ1bGUgPSBmaW5kUnVsZShyaWdodFJlY3Vyc2l2ZVJ1bGVOYW1lLCBydWxlcyk7XG5cbiAgICBpZiAocmlnaHRSZWN1cnNpdmVSdWxlID09PSBudWxsKSB7XG4gICAgICByaWdodFJlY3Vyc2l2ZVJ1bGUgPSBSaWdodFJlY3Vyc2l2ZVJ1bGUuZnJvbVJpZ2h0UmVjdXJzaXZlUnVsZU5hbWUocmlnaHRSZWN1cnNpdmVSdWxlTmFtZSk7XG5cbiAgICAgIHJ1bGVzLnB1c2gocmlnaHRSZWN1cnNpdmVSdWxlKTtcbiAgICB9XG5cbiAgICBjb25zdCByaWdodFJlY3Vyc2l2ZURlZmluaXRpb24gPSBSaWdodFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbUltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG5cbiAgICByaWdodFJlY3Vyc2l2ZVJ1bGUuYWRkUmlnaHRSZWN1cnNpdmVEZWZpbml0aW9uKHJpZ2h0UmVjdXJzaXZlRGVmaW5pdGlvbik7XG5cbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiByZXdyaXRlSW1tZWRpYXRlbHlBbmRJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlcykge1xuICBsZXQgcmVtb3ZlID0gZmFsc2U7XG5cbiAgY29uc3QgcnVsZVJld3JpdGFibGUgPSBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5ldmVyeSgoaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4gaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5pc1Jld3JpdGFibGUoKSk7XG5cbiAgaWYgKHJ1bGVSZXdyaXRhYmxlKSB7XG4gICAgY29uc3QgcnVsZU5vblN0cmljdGx5TGVmdFJlY3Vyc2l2ZSA9ICFpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5zb21lKChpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKSA9PiBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmlzU3RyaWN0bHlMZWZ0UmVjdXJzaXZlKCkpO1xuXG4gICAgaWYgKHJ1bGVOb25TdHJpY3RseUxlZnRSZWN1cnNpdmUpIHtcbiAgICAgIGNvbnN0IGxvb2tBaGVhZHMgPSBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5tYXAoKGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pID0+IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uaXNMb29rQWhlYWQoKSksXG4gICAgICAgICAgICBsb29rQWhlYWRzRXF1YWwgPSBhcmVFbGVtZW50c0VxdWFsKGxvb2tBaGVhZHMpLFxuICAgICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lcyA9IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLm1hcCgoaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4gaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRMZWZ0UmVjdXJzaXZlUnVsZU5hbWUoKSksXG4gICAgICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzRXF1YWwgPSBhcmVFbGVtZW50c0VxdWFsKGxlZnRSZWN1cnNpdmVSdWxlTmFtZXMpO1xuXG4gICAgICBpZiAobG9va0FoZWFkc0VxdWFsICYmIGxlZnRSZWN1cnNpdmVSdWxlTmFtZXNFcXVhbCkge1xuICAgICAgICBsZXQgcnVsZSxcbiAgICAgICAgICAgIGRlZmluaXRpb25zLFxuICAgICAgICAgICAgbm9uTGVmdFJlY3Vyc2l2ZVJ1bGUsXG4gICAgICAgICAgICBub25MZWZ0UmVjdXJzaXZlUnVsZU5hbWVEZWZpbml0aW9uO1xuXG4gICAgICAgIHJ1bGUgPSBmaW5kUnVsZShydWxlTmFtZSwgcnVsZXMpO1xuXG4gICAgICAgIGNvbnN0IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZVJ1bGUgPSBydWxlOyAgLy8vXG5cbiAgICAgICAgbm9uTGVmdFJlY3Vyc2l2ZVJ1bGUgPSBOb25MZWZ0UmVjdXJzaXZlUnVsZS5mcm9tSW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlUnVsZShpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVSdWxlKTtcblxuICAgICAgICBjb25zdCByaWdodFJlY3Vyc2l2ZVJ1bGUgPSBSaWdodFJlY3Vyc2l2ZVJ1bGUuZnJvbVJ1bGVOYW1lQW5kSW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlUmVjdXJzaXZlRGVmaW5pdGlvbnMocnVsZU5hbWUsIGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKTtcblxuICAgICAgICBydWxlcy5wdXNoKG5vbkxlZnRSZWN1cnNpdmVSdWxlKTtcblxuICAgICAgICBydWxlcy5wdXNoKHJpZ2h0UmVjdXJzaXZlUnVsZSk7XG5cbiAgICAgICAgY29uc3QgZmlyc3RMb29rQWhlYWQgPSBmaXJzdChsb29rQWhlYWRzKSxcbiAgICAgICAgICAgICAgZmlyc3RMZWZ0UmVjdXJzaXZlUnVsZU5hbWUgPSBmaXJzdChsZWZ0UmVjdXJzaXZlUnVsZU5hbWVzKSxcbiAgICAgICAgICAgICAgbG9va0FoZWFkID0gZmlyc3RMb29rQWhlYWQsIC8vL1xuICAgICAgICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZU5hbWUgPSBmaXJzdExlZnRSZWN1cnNpdmVSdWxlTmFtZTsgLy8vXG5cbiAgICAgICAgbm9uTGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lRGVmaW5pdGlvbiA9IE5vbkxlZnRSZWN1cnNpdmVSdWxlTmFtZURlZmluaXRpb24uZnJvbVJ1bGVOYW1lKHJ1bGVOYW1lKTtcblxuICAgICAgICBjb25zdCBub25MZWZ0UmVjdXJzaXZlQW5kUmlnaHRSZWN1cnNpdmVSdWxlTmFtZXNEZWZpbml0aW9uID0gTm9uTGVmdFJlY3Vyc2l2ZUFuZFJpZ2h0UmVjdXJzaXZlUnVsZU5hbWVzRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVMZWZ0UmVjdXJzaXZlUnVsZU5hbWVBbmRMb29rQWhlYWQocnVsZU5hbWUsIGxlZnRSZWN1cnNpdmVSdWxlTmFtZSwgbG9va0FoZWFkKTtcblxuICAgICAgICBkZWZpbml0aW9ucyA9IFtcbiAgICAgICAgICBub25MZWZ0UmVjdXJzaXZlQW5kUmlnaHRSZWN1cnNpdmVSdWxlTmFtZXNEZWZpbml0aW9uLFxuICAgICAgICAgIG5vbkxlZnRSZWN1cnNpdmVSdWxlTmFtZURlZmluaXRpb25cbiAgICAgICAgXTtcblxuICAgICAgICBpbW1lZGlhdGVseUxlZnRSZWN1cnNpdmVSdWxlLnNldERlZmluaXRpb25zKGRlZmluaXRpb25zKTtcblxuICAgICAgICBjb25zdCBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lLCAvLy9cbiAgICAgICAgICAgICAgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlID0gaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlTmFtZShpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lLCBydWxlcyksXG4gICAgICAgICAgICAgIGZpcnN0SW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0KGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKSxcbiAgICAgICAgICAgICAgaW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGZpcnN0SW1tZWRpYXRlbHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgLy8vXG4gICAgICAgICAgICAgIGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGltbWVkaWF0ZWx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0SW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKCk7XG5cbiAgICAgICAgbm9uTGVmdFJlY3Vyc2l2ZVJ1bGUgPSBOb25MZWZ0UmVjdXJzaXZlUnVsZS5mcm9tSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVSdWxlQW5kSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlUnVsZSwgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcblxuICAgICAgICBjb25zdCBydWxlTmFtZURlZmluaXRpb24gPSBSdWxlTmFtZURlZmluaXRpb24uZnJvbVJ1bGVOYW1lKHJ1bGVOYW1lKTtcblxuICAgICAgICBub25MZWZ0UmVjdXJzaXZlUnVsZU5hbWVEZWZpbml0aW9uID0gTm9uTGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lRGVmaW5pdGlvbi5mcm9tTGVmdFJlY3Vyc2l2ZVJ1bGVOYW1lKGxlZnRSZWN1cnNpdmVSdWxlTmFtZSk7XG5cbiAgICAgICAgZGVmaW5pdGlvbnMgPSBbXG4gICAgICAgICAgcnVsZU5hbWVEZWZpbml0aW9uLFxuICAgICAgICAgIG5vbkxlZnRSZWN1cnNpdmVSdWxlTmFtZURlZmluaXRpb25cbiAgICAgICAgXTtcblxuICAgICAgICBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZVJ1bGUuc2V0RGVmaW5pdGlvbnMoZGVmaW5pdGlvbnMpO1xuXG4gICAgICAgIHJ1bGVzLnB1c2gobm9uTGVmdFJlY3Vyc2l2ZVJ1bGUpO1xuXG4gICAgICAgIHJlbW92ZSA9IHRydWU7XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlbW92ZTtcbn1cbiJdfQ==