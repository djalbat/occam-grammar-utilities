"use strict";
Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.default = eliminateLeftRecursion;
var _reduced = _interopRequireDefault(require("./rule/reduced"));
var _rewritten = _interopRequireDefault(require("./rule/rewritten"));
var _recursive = _interopRequireDefault(require("./definition/recursive"));
var _left = _interopRequireDefault(require("./definition/recursive/left"));
var _directly = _interopRequireDefault(require("./definition/recursive/left/directly"));
var _indirectly = _interopRequireDefault(require("./definition/recursive/left/indirectly"));
var _class = require("./utilities/class");
function eliminateLeftRecursion(startRule, ruleMap) {
    var rule = startRule, reducedRules = [], rewrittenRules = [], leftRecursiveRules = [], recursiveDefinitions = [], leftRecursiveDefinitions = [];
    retrieveLeftRecursiveDefinitions(rule, recursiveDefinitions, leftRecursiveDefinitions, ruleMap);
    retrieveLeftRecursiveRules(leftRecursiveRules, leftRecursiveDefinitions, ruleMap);
    reduceLeftRecursiveRules(leftRecursiveRules, reducedRules, ruleMap);
    rewriteLeftRecursiveRules(leftRecursiveRules, rewrittenRules, ruleMap);
    ///
    eliminateDirectLeftRecursion(rewrittenRules, ruleMap);
    var startRuleName = startRule.getName();
    startRule = ruleMap[startRuleName]; ///
    return startRule;
}
function _arrayLikeToArray(arr, len) {
    if (len == null || len > arr.length) len = arr.length;
    for(var i = 0, arr2 = new Array(len); i < len; i++)arr2[i] = arr[i];
    return arr2;
}
function _arrayWithoutHoles(arr) {
    if (Array.isArray(arr)) return _arrayLikeToArray(arr);
}
function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : {
        default: obj
    };
}
function _iterableToArray(iter) {
    if (typeof Symbol !== "undefined" && iter[Symbol.iterator] != null || iter["@@iterator"] != null) return Array.from(iter);
}
function _nonIterableSpread() {
    throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.");
}
function _toConsumableArray(arr) {
    return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _unsupportedIterableToArray(arr) || _nonIterableSpread();
}
function _unsupportedIterableToArray(o, minLen) {
    if (!o) return;
    if (typeof o === "string") return _arrayLikeToArray(o, minLen);
    var n = Object.prototype.toString.call(o).slice(8, -1);
    if (n === "Object" && o.constructor) n = o.constructor.name;
    if (n === "Map" || n === "Set") return Array.from(n);
    if (n === "Arguments" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return _arrayLikeToArray(o, minLen);
}
function reduceLeftRecursiveRules(leftRecursiveRules, reducedRules, ruleMap) {
    leftRecursiveRules.forEach(function(leftRecursiveRule) {
        var rule = leftRecursiveRule, reducedRule = _reduced.default.fromRule(rule);
        if (reducedRule !== null) {
            var reducedRuleName = reducedRule.getName();
            ruleMap[reducedRuleName] = reducedRule;
            reducedRules.push(reducedRule);
        }
    });
}
function rewriteLeftRecursiveRules(leftRecursiveRules, rewrittenRules, ruleMap) {
    leftRecursiveRules.forEach(function(leftRecursiveRule) {
        var rule = leftRecursiveRule, ruleName = rule.getName(), rewrittenRule = _rewritten.default.fromRule(rule);
        delete ruleMap[ruleName];
        var rewrittenRuleName = ruleName; ///
        ruleMap[rewrittenRuleName] = rewrittenRule;
        rewrittenRules.push(rewrittenRule);
    });
}
function retrieveLeftRecursiveRules(leftRecursiveRules, leftRecursiveDefinitions, ruleMap) {
    leftRecursiveDefinitions.forEach(function(leftRecursiveDefinition) {
        var ruleName = leftRecursiveDefinition.getRuleName(), rule = ruleMap[ruleName], leftRecursiveRulesIncludesRule = leftRecursiveRules.includes(rule);
        if (!leftRecursiveRulesIncludesRule) {
            var leftRecursiveRule = rule; ///
            leftRecursiveRules.push(leftRecursiveRule);
        }
    // const leftRecursiveDefinitionIndirectlyLeftRecursiveDefinition = isInstanceOf(leftRecursiveDefinition, IndirectlyLeftRecursiveDefinition);
    //
    // if (leftRecursiveDefinitionIndirectlyLeftRecursiveDefinition) {
    //   const indirectlyLeftRecursiveDefinition = leftRecursiveDefinition,  ///
    //         implicitlyLeftRecursiveDefinition = indirectlyLeftRecursiveDefinition.getImplicitlyLeftRecursiveDefinition(),
    //         ruleName = implicitlyLeftRecursiveDefinition.getRuleName(),
    //         rule = ruleMap[ruleName],
    //         leftRecursiveRulesIncludesRule = leftRecursiveRules.includes(rule);
    //
    //     if (!leftRecursiveRulesIncludesRule) {
    //       const leftRecursiveRule = rule; ///
    //
    //       leftRecursiveRules.push(leftRecursiveRule);
    //     }
    // }
    });
}
function eliminateDirectLeftRecursion(rewrittenRules, ruleMap) {
    rewrittenRules.forEach(function(rewrittenRule) {
        return rewrittenRule.rewrite(ruleMap);
    });
}
function retrieveLeftRecursiveDefinition(rule, definition, recursiveDefinitions, leftRecursiveDefinitions) {
    var recursiveDefinition;
    var ruleName = rule.getName(), definitionRecursiveDefinition = (0, _class).isInstanceOf(definition, _recursive.default);
    if (definitionRecursiveDefinition) {
        recursiveDefinition = definition; ///
    } else {
        var leftRecursiveDefinition = _indirectly.default.fromRuleNameDefinitionAndRecursiveDefinitions(ruleName, definition, recursiveDefinitions) || _directly.default.fromRuleNameAndDefinition(ruleName, definition) || _left.default.fromRuleNameAndDefinition(ruleName, definition);
        if (leftRecursiveDefinition !== null) {
            leftRecursiveDefinitions.push(leftRecursiveDefinition);
            recursiveDefinition = leftRecursiveDefinition; ///
        } else {
            recursiveDefinition = _recursive.default.fromRuleNameAndDefinition(ruleName, definition);
        }
        if (recursiveDefinition !== null) {
            var replaceDefinition = definition, replacementDefinition = recursiveDefinition; ///
            rule.replaceDefinition(replaceDefinition, replacementDefinition);
        }
    }
    return recursiveDefinition;
}
function retrieveLeftRecursiveDefinitions(rule, recursiveDefinitions, leftRecursiveDefinitions, ruleMap) {
    var definitions = rule.getDefinitions();
    definitions.forEach(function(definition) {
        var recursiveDefinition = retrieveLeftRecursiveDefinition(rule, definition, recursiveDefinitions, leftRecursiveDefinitions);
        if (recursiveDefinition !== null) {
            var previousRecursiveDefinitions = _toConsumableArray(recursiveDefinitions).concat([
                recursiveDefinition
            ]), previousRecursiveRuleNames = previousRecursiveDefinitions.map(function(previousRecursiveDefinition) {
                var previousRecursiveDefinitionRuleName = previousRecursiveDefinition.getRuleName(), previousRecursiveRuleName = previousRecursiveDefinitionRuleName; ///
                return previousRecursiveRuleName;
            }), recursiveRuleNames = recursiveDefinition.getRecursiveRuleNames();
            recursiveRuleNames.forEach(function(recursiveRuleName) {
                var previousRecursiveRuleNamesIncludesRecursiveRuleName = previousRecursiveRuleNames.includes(recursiveRuleName);
                if (!previousRecursiveRuleNamesIncludesRecursiveRuleName) {
                    var ruleName = recursiveRuleName, _$rule = ruleMap[ruleName] || null; ///
                    if (_$rule !== null) {
                        var _$recursiveDefinitions = previousRecursiveDefinitions; ///
                        retrieveLeftRecursiveDefinitions(_$rule, _$recursiveDefinitions, leftRecursiveDefinitions, ruleMap);
                    }
                }
            });
        }
    });
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9lbGltaW5hdGVMZWZ0UmVjdXJzaW9uLmpzIl0sInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5pbXBvcnQgUmVkdWNlZFJ1bGUgZnJvbSBcIi4vcnVsZS9yZWR1Y2VkXCI7XG5pbXBvcnQgUmV3cml0dGVuUnVsZSBmcm9tIFwiLi9ydWxlL3Jld3JpdHRlblwiO1xuaW1wb3J0IFJlY3Vyc2l2ZURlZmluaXRpb24gZnJvbSBcIi4vZGVmaW5pdGlvbi9yZWN1cnNpdmVcIjtcbmltcG9ydCBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0XCI7XG5pbXBvcnQgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiBmcm9tIFwiLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZS9sZWZ0L2RpcmVjdGx5XCI7XG5pbXBvcnQgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIGZyb20gXCIuL2RlZmluaXRpb24vcmVjdXJzaXZlL2xlZnQvaW5kaXJlY3RseVwiO1xuXG5pbXBvcnQgeyBpc0luc3RhbmNlT2YgfSBmcm9tIFwiLi91dGlsaXRpZXMvY2xhc3NcIjtcblxuZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gZWxpbWluYXRlTGVmdFJlY3Vyc2lvbihzdGFydFJ1bGUsIHJ1bGVNYXApIHtcbiAgY29uc3QgcnVsZSA9IHN0YXJ0UnVsZSwgLy8vXG4gICAgICAgIHJlZHVjZWRSdWxlcyA9IFtdLFxuICAgICAgICByZXdyaXR0ZW5SdWxlcyA9IFtdLFxuICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZXMgPSBbXSxcbiAgICAgICAgcmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBbXSxcbiAgICAgICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zID0gW107XG5cbiAgcmV0cmlldmVMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMocnVsZSwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucywgcnVsZU1hcCk7XG5cbiAgcmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZVJ1bGVzLCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJ1bGVNYXApO1xuXG4gIHJlZHVjZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlUnVsZXMsIHJlZHVjZWRSdWxlcywgcnVsZU1hcCk7XG5cbiAgcmV3cml0ZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlUnVsZXMsIHJld3JpdHRlblJ1bGVzLCBydWxlTWFwKTtcblxuICAvLy9cblxuICBlbGltaW5hdGVEaXJlY3RMZWZ0UmVjdXJzaW9uKHJld3JpdHRlblJ1bGVzLCBydWxlTWFwKTtcblxuICBjb25zdCBzdGFydFJ1bGVOYW1lID0gc3RhcnRSdWxlLmdldE5hbWUoKTtcblxuICBzdGFydFJ1bGUgPSBydWxlTWFwW3N0YXJ0UnVsZU5hbWVdOyAvLy9cblxuICByZXR1cm4gc3RhcnRSdWxlO1xufVxuXG5mdW5jdGlvbiByZWR1Y2VMZWZ0UmVjdXJzaXZlUnVsZXMobGVmdFJlY3Vyc2l2ZVJ1bGVzLCByZWR1Y2VkUnVsZXMsIHJ1bGVNYXApIHtcbiAgbGVmdFJlY3Vyc2l2ZVJ1bGVzLmZvckVhY2goKGxlZnRSZWN1cnNpdmVSdWxlKSA9PiB7XG4gICAgY29uc3QgcnVsZSA9IGxlZnRSZWN1cnNpdmVSdWxlLCAvLy9cbiAgICAgICAgICByZWR1Y2VkUnVsZSA9IFJlZHVjZWRSdWxlLmZyb21SdWxlKHJ1bGUpO1xuXG4gICAgaWYgKHJlZHVjZWRSdWxlICE9PSBudWxsKSB7XG4gICAgICBjb25zdCByZWR1Y2VkUnVsZU5hbWUgPSByZWR1Y2VkUnVsZS5nZXROYW1lKCk7XG5cbiAgICAgIHJ1bGVNYXBbcmVkdWNlZFJ1bGVOYW1lXSA9IHJlZHVjZWRSdWxlO1xuXG4gICAgICByZWR1Y2VkUnVsZXMucHVzaChyZWR1Y2VkUnVsZSk7XG4gICAgfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gcmV3cml0ZUxlZnRSZWN1cnNpdmVSdWxlcyhsZWZ0UmVjdXJzaXZlUnVsZXMsIHJld3JpdHRlblJ1bGVzLCBydWxlTWFwKSB7XG4gIGxlZnRSZWN1cnNpdmVSdWxlcy5mb3JFYWNoKChsZWZ0UmVjdXJzaXZlUnVsZSkgPT4ge1xuICAgIGNvbnN0IHJ1bGUgPSBsZWZ0UmVjdXJzaXZlUnVsZSwgLy8vXG4gICAgICAgICAgcnVsZU5hbWUgPSBydWxlLmdldE5hbWUoKSxcbiAgICAgICAgICByZXdyaXR0ZW5SdWxlID0gUmV3cml0dGVuUnVsZS5mcm9tUnVsZShydWxlKTtcblxuICAgIGRlbGV0ZSBydWxlTWFwW3J1bGVOYW1lXTtcblxuICAgIGNvbnN0IHJld3JpdHRlblJ1bGVOYW1lID0gcnVsZU5hbWU7IC8vL1xuXG4gICAgcnVsZU1hcFtyZXdyaXR0ZW5SdWxlTmFtZV0gPSByZXdyaXR0ZW5SdWxlO1xuXG4gICAgcmV3cml0dGVuUnVsZXMucHVzaChyZXdyaXR0ZW5SdWxlKTtcbiAgfSk7XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlTGVmdFJlY3Vyc2l2ZVJ1bGVzKGxlZnRSZWN1cnNpdmVSdWxlcywgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKSB7XG4gIGxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucy5mb3JFYWNoKChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikgPT4ge1xuICAgIGNvbnN0IHJ1bGVOYW1lID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICBydWxlID0gcnVsZU1hcFtydWxlTmFtZV0sXG4gICAgICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVzSW5jbHVkZXNSdWxlID0gbGVmdFJlY3Vyc2l2ZVJ1bGVzLmluY2x1ZGVzKHJ1bGUpO1xuXG4gICAgaWYgKCFsZWZ0UmVjdXJzaXZlUnVsZXNJbmNsdWRlc1J1bGUpIHtcbiAgICAgIGNvbnN0IGxlZnRSZWN1cnNpdmVSdWxlID0gcnVsZTsgLy8vXG5cbiAgICAgIGxlZnRSZWN1cnNpdmVSdWxlcy5wdXNoKGxlZnRSZWN1cnNpdmVSdWxlKTtcbiAgICB9XG5cbiAgICAvLyBjb25zdCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGlzSW5zdGFuY2VPZihsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiwgSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKTtcbiAgICAvL1xuICAgIC8vIGlmIChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbikge1xuICAgIC8vICAgY29uc3QgaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb24sICAvLy9cbiAgICAvLyAgICAgICAgIGltcGxpY2l0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRJbXBsaWNpdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24oKSxcbiAgICAvLyAgICAgICAgIHJ1bGVOYW1lID0gaW1wbGljaXRseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCksXG4gICAgLy8gICAgICAgICBydWxlID0gcnVsZU1hcFtydWxlTmFtZV0sXG4gICAgLy8gICAgICAgICBsZWZ0UmVjdXJzaXZlUnVsZXNJbmNsdWRlc1J1bGUgPSBsZWZ0UmVjdXJzaXZlUnVsZXMuaW5jbHVkZXMocnVsZSk7XG4gICAgLy9cbiAgICAvLyAgICAgaWYgKCFsZWZ0UmVjdXJzaXZlUnVsZXNJbmNsdWRlc1J1bGUpIHtcbiAgICAvLyAgICAgICBjb25zdCBsZWZ0UmVjdXJzaXZlUnVsZSA9IHJ1bGU7IC8vL1xuICAgIC8vXG4gICAgLy8gICAgICAgbGVmdFJlY3Vyc2l2ZVJ1bGVzLnB1c2gobGVmdFJlY3Vyc2l2ZVJ1bGUpO1xuICAgIC8vICAgICB9XG4gICAgLy8gfVxuICB9KTtcbn1cblxuZnVuY3Rpb24gZWxpbWluYXRlRGlyZWN0TGVmdFJlY3Vyc2lvbihyZXdyaXR0ZW5SdWxlcywgcnVsZU1hcCkge1xuICByZXdyaXR0ZW5SdWxlcy5mb3JFYWNoKChyZXdyaXR0ZW5SdWxlKSA9PiByZXdyaXR0ZW5SdWxlLnJld3JpdGUocnVsZU1hcCkpO1xufVxuXG5mdW5jdGlvbiByZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKHJ1bGUsIGRlZmluaXRpb24sIHJlY3Vyc2l2ZURlZmluaXRpb25zLCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpIHtcbiAgbGV0IHJlY3Vyc2l2ZURlZmluaXRpb247XG5cbiAgY29uc3QgcnVsZU5hbWUgPSBydWxlLmdldE5hbWUoKSxcbiAgICAgICAgZGVmaW5pdGlvblJlY3Vyc2l2ZURlZmluaXRpb24gPSBpc0luc3RhbmNlT2YoZGVmaW5pdGlvbiwgUmVjdXJzaXZlRGVmaW5pdGlvbik7XG5cbiAgaWYgKGRlZmluaXRpb25SZWN1cnNpdmVEZWZpbml0aW9uKSB7XG4gICAgcmVjdXJzaXZlRGVmaW5pdGlvbiA9IGRlZmluaXRpb247IC8vL1xuICB9IGVsc2Uge1xuICAgIGNvbnN0IGxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gSW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21SdWxlTmFtZURlZmluaXRpb25BbmRSZWN1cnNpdmVEZWZpbml0aW9ucyhydWxlTmFtZSwgZGVmaW5pdGlvbiwgcmVjdXJzaXZlRGVmaW5pdGlvbnMpIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uLmZyb21SdWxlTmFtZUFuZERlZmluaXRpb24ocnVsZU5hbWUsIGRlZmluaXRpb24pIHx8XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVBbmREZWZpbml0aW9uKHJ1bGVOYW1lLCBkZWZpbml0aW9uKTtcblxuICAgIGlmIChsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiAhPT0gbnVsbCkge1xuICAgICAgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLnB1c2gobGVmdFJlY3Vyc2l2ZURlZmluaXRpb24pO1xuXG4gICAgICByZWN1cnNpdmVEZWZpbml0aW9uID0gbGVmdFJlY3Vyc2l2ZURlZmluaXRpb247ICAvLy9cbiAgICB9IGVsc2Uge1xuICAgICAgcmVjdXJzaXZlRGVmaW5pdGlvbiA9IFJlY3Vyc2l2ZURlZmluaXRpb24uZnJvbVJ1bGVOYW1lQW5kRGVmaW5pdGlvbihydWxlTmFtZSwgZGVmaW5pdGlvbik7XG4gICAgfVxuXG4gICAgaWYgKHJlY3Vyc2l2ZURlZmluaXRpb24gIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IHJlcGxhY2VEZWZpbml0aW9uID0gZGVmaW5pdGlvbiwgLy8vXG4gICAgICAgICAgICByZXBsYWNlbWVudERlZmluaXRpb24gPSByZWN1cnNpdmVEZWZpbml0aW9uOyAgLy8vXG5cbiAgICAgIHJ1bGUucmVwbGFjZURlZmluaXRpb24ocmVwbGFjZURlZmluaXRpb24sIHJlcGxhY2VtZW50RGVmaW5pdGlvbik7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlY3Vyc2l2ZURlZmluaXRpb247XG59XG5cbmZ1bmN0aW9uIHJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zKHJ1bGUsIHJlY3Vyc2l2ZURlZmluaXRpb25zLCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJ1bGVNYXApIHtcbiAgY29uc3QgZGVmaW5pdGlvbnMgPSBydWxlLmdldERlZmluaXRpb25zKCk7XG5cbiAgZGVmaW5pdGlvbnMuZm9yRWFjaCgoZGVmaW5pdGlvbikgPT4ge1xuICAgIGNvbnN0IHJlY3Vyc2l2ZURlZmluaXRpb24gPSByZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uKHJ1bGUsIGRlZmluaXRpb24sIHJlY3Vyc2l2ZURlZmluaXRpb25zLCBsZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbnMpO1xuXG4gICAgaWYgKHJlY3Vyc2l2ZURlZmluaXRpb24gIT09IG51bGwpIHtcbiAgICAgIGNvbnN0IHByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvbnMgPSBbIC4uLnJlY3Vyc2l2ZURlZmluaXRpb25zLCByZWN1cnNpdmVEZWZpbml0aW9uIF0sXG4gICAgICAgICAgICBwcmV2aW91c1JlY3Vyc2l2ZVJ1bGVOYW1lcyA9IHByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvbnMubWFwKChwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb24pID0+IHtcbiAgICAgICAgICAgICAgY29uc3QgcHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9uUnVsZU5hbWUgPSBwcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UnVsZU5hbWUoKSxcbiAgICAgICAgICAgICAgICAgICAgcHJldmlvdXNSZWN1cnNpdmVSdWxlTmFtZSA9IHByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lOyAgLy8vXG5cbiAgICAgICAgICAgICAgcmV0dXJuIHByZXZpb3VzUmVjdXJzaXZlUnVsZU5hbWU7XG4gICAgICAgICAgICB9KSxcbiAgICAgICAgICAgIHJlY3Vyc2l2ZVJ1bGVOYW1lcyA9IHJlY3Vyc2l2ZURlZmluaXRpb24uZ2V0UmVjdXJzaXZlUnVsZU5hbWVzKCk7XG5cbiAgICAgIHJlY3Vyc2l2ZVJ1bGVOYW1lcy5mb3JFYWNoKChyZWN1cnNpdmVSdWxlTmFtZSkgPT4ge1xuICAgICAgICBjb25zdCBwcmV2aW91c1JlY3Vyc2l2ZVJ1bGVOYW1lc0luY2x1ZGVzUmVjdXJzaXZlUnVsZU5hbWUgPSBwcmV2aW91c1JlY3Vyc2l2ZVJ1bGVOYW1lcy5pbmNsdWRlcyhyZWN1cnNpdmVSdWxlTmFtZSk7XG5cbiAgICAgICAgaWYgKCFwcmV2aW91c1JlY3Vyc2l2ZVJ1bGVOYW1lc0luY2x1ZGVzUmVjdXJzaXZlUnVsZU5hbWUpIHtcbiAgICAgICAgICBjb25zdCBydWxlTmFtZSA9IHJlY3Vyc2l2ZVJ1bGVOYW1lLCAgLy8vXG4gICAgICAgICAgICAgICAgcnVsZSA9IHJ1bGVNYXBbcnVsZU5hbWVdIHx8IG51bGw7IC8vL1xuXG4gICAgICAgICAgaWYgKHJ1bGUgIT09IG51bGwpIHtcbiAgICAgICAgICAgIGNvbnN0IHJlY3Vyc2l2ZURlZmluaXRpb25zID0gcHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9uczsgIC8vL1xuXG4gICAgICAgICAgICByZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyhydWxlLCByZWN1cnNpdmVEZWZpbml0aW9ucywgbGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zLCBydWxlTWFwKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfSk7XG59XG4iXSwibmFtZXMiOlsiZWxpbWluYXRlTGVmdFJlY3Vyc2lvbiIsInN0YXJ0UnVsZSIsInJ1bGVNYXAiLCJydWxlIiwicmVkdWNlZFJ1bGVzIiwicmV3cml0dGVuUnVsZXMiLCJsZWZ0UmVjdXJzaXZlUnVsZXMiLCJyZWN1cnNpdmVEZWZpbml0aW9ucyIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9ucyIsInJldHJpZXZlTGVmdFJlY3Vyc2l2ZURlZmluaXRpb25zIiwicmV0cmlldmVMZWZ0UmVjdXJzaXZlUnVsZXMiLCJyZWR1Y2VMZWZ0UmVjdXJzaXZlUnVsZXMiLCJyZXdyaXRlTGVmdFJlY3Vyc2l2ZVJ1bGVzIiwiZWxpbWluYXRlRGlyZWN0TGVmdFJlY3Vyc2lvbiIsInN0YXJ0UnVsZU5hbWUiLCJnZXROYW1lIiwiZm9yRWFjaCIsImxlZnRSZWN1cnNpdmVSdWxlIiwicmVkdWNlZFJ1bGUiLCJSZWR1Y2VkUnVsZSIsImZyb21SdWxlIiwicmVkdWNlZFJ1bGVOYW1lIiwicHVzaCIsInJ1bGVOYW1lIiwicmV3cml0dGVuUnVsZSIsIlJld3JpdHRlblJ1bGUiLCJyZXdyaXR0ZW5SdWxlTmFtZSIsImxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZ2V0UnVsZU5hbWUiLCJsZWZ0UmVjdXJzaXZlUnVsZXNJbmNsdWRlc1J1bGUiLCJpbmNsdWRlcyIsInJld3JpdGUiLCJyZXRyaWV2ZUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZGVmaW5pdGlvbiIsInJlY3Vyc2l2ZURlZmluaXRpb24iLCJkZWZpbml0aW9uUmVjdXJzaXZlRGVmaW5pdGlvbiIsImlzSW5zdGFuY2VPZiIsIlJlY3Vyc2l2ZURlZmluaXRpb24iLCJJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tUnVsZU5hbWVEZWZpbml0aW9uQW5kUmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJEaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZnJvbVJ1bGVOYW1lQW5kRGVmaW5pdGlvbiIsIkxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwicmVwbGFjZURlZmluaXRpb24iLCJyZXBsYWNlbWVudERlZmluaXRpb24iLCJkZWZpbml0aW9ucyIsImdldERlZmluaXRpb25zIiwicHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9ucyIsInByZXZpb3VzUmVjdXJzaXZlUnVsZU5hbWVzIiwibWFwIiwicHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9uIiwicHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9uUnVsZU5hbWUiLCJwcmV2aW91c1JlY3Vyc2l2ZVJ1bGVOYW1lIiwicmVjdXJzaXZlUnVsZU5hbWVzIiwiZ2V0UmVjdXJzaXZlUnVsZU5hbWVzIiwicmVjdXJzaXZlUnVsZU5hbWUiLCJwcmV2aW91c1JlY3Vyc2l2ZVJ1bGVOYW1lc0luY2x1ZGVzUmVjdXJzaXZlUnVsZU5hbWUiXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7OztrQkFXV0Esc0JBQXNCO0FBVHRCLElBQUEsUUFBZ0Isa0NBQWhCLGdCQUFnQixFQUFBO0FBQ2QsSUFBQSxVQUFrQixrQ0FBbEIsa0JBQWtCLEVBQUE7QUFDWixJQUFBLFVBQXdCLGtDQUF4Qix3QkFBd0IsRUFBQTtBQUNwQixJQUFBLEtBQTZCLGtDQUE3Qiw2QkFBNkIsRUFBQTtBQUNyQixJQUFBLFNBQXNDLGtDQUF0QyxzQ0FBc0MsRUFBQTtBQUNw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