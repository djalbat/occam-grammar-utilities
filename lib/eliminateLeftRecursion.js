'use strict';

function _toConsumableArray(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } else { return Array.from(arr); } }

var ruleUtilities = require('./utilities/rule'),
    arrayUtilities = require('./utilities/array'),
    RecursiveDefinition = require('./definition/recursive'),
    DirectlyLeftRecursiveDefinition = require('./definition/leftRecursive/directly'),
    IndirectlyLeftRecursiveDefinition = require('./definition/leftRecursive/indirectly');

var findRule = ruleUtilities.findRule,
    first = arrayUtilities.first,
    forEachWithReplace = arrayUtilities.forEachWithReplace;


function eliminateLeftRecursion(rules) {
  var firstRule = first(rules),
      rule = firstRule,
      ///
  recursiveDefinitions = [],
      replacementDefinitions = [];

  replaceDefinitions(rule, recursiveDefinitions, replacementDefinitions, rules);

  replacementDefinitions.forEach(function (replacementDefinition) {
    return replacementDefinition.rewrite(rules);
  });
}

module.exports = eliminateLeftRecursion;

function replaceDefinition(ruleName, definition, recursiveDefinitions, replacementDefinitions) {
  var replacementDefinition = null;

  var definitionRecursiveDefinition = definition instanceof RecursiveDefinition;

  if (!definitionRecursiveDefinition) {
    if (replacementDefinition === null) {
      var directlyLeftRecursiveDefinition = DirectlyLeftRecursiveDefinition.fromRuleNameAndDefinition(ruleName, definition);

      if (directlyLeftRecursiveDefinition !== null) {
        replacementDefinition = directlyLeftRecursiveDefinition; ///
      }
    }

    if (replacementDefinition === null) {
      var indirectlyLeftRecursiveDefinition = IndirectlyLeftRecursiveDefinition.fromRuleNameDefinitionAndRecursiveDefinitions(ruleName, definition, recursiveDefinitions);

      if (indirectlyLeftRecursiveDefinition !== null) {
        replacementDefinition = indirectlyLeftRecursiveDefinition; ///
      }
    }

    if (replacementDefinition === null) {
      var recursiveDefinition = RecursiveDefinition.fromRuleNameAndDefinition(ruleName, definition);

      if (recursiveDefinition !== null) {
        replacementDefinition = recursiveDefinition; ///
      }
    }
  }

  if (replacementDefinition !== null) {
    replacementDefinitions.push(replacementDefinition);
  }

  return replacementDefinition;
}

function replaceDefinitions(rule, recursiveDefinitions, replacementDefinitions, rules) {
  var ruleName = rule.getName(),
      definitions = rule.getDefinitions();

  forEachWithReplace(definitions, function (definition) {
    var replacementDefinition = replaceDefinition(ruleName, definition, recursiveDefinitions, replacementDefinitions);

    var recursiveDefinition = replacementDefinition; ///

    if (recursiveDefinition === null) {
      var definitionRecursiveDefinition = definition instanceof RecursiveDefinition;

      if (definitionRecursiveDefinition) {
        recursiveDefinition = definition; ///
      }
    }

    if (recursiveDefinition !== null) {
      var previousRecursiveDefinitions = recursiveDefinitions; ///

      recursiveDefinitions = [].concat(_toConsumableArray(previousRecursiveDefinitions), [recursiveDefinition]);

      recursiveDefinitions.forEach(function (recursiveDefinition) {
        var recursiveDefinitionRuleName = recursiveDefinition.getRuleName(),
            recursiveRuleName = recursiveDefinitionRuleName,
            ///
        recursiveRuleNames = recursiveDefinitions.map(function (recursiveDefinition) {
          var recursiveDefinitionRuleName = recursiveDefinition.getRuleName(),
              recursiveRuleName = recursiveDefinitionRuleName; ///

          return recursiveRuleName;
        }),
            recursiveRuleNamesIncludesRecursiveRuleName = recursiveRuleNames.includes(recursiveRuleName);

        if (!recursiveRuleNamesIncludesRecursiveRuleName) {
          var _ruleName = recursiveRuleName,
              ///
          _rule = findRule(_ruleName, rules);

          if (_rule !== null) {
            replaceDefinitions(_rule, recursiveDefinitions, replacementDefinitions, rules);
          }
        }
      });
    }

    return replacementDefinition;
  });
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL2VzNi9lbGltaW5hdGVMZWZ0UmVjdXJzaW9uLmpzIl0sIm5hbWVzIjpbInJ1bGVVdGlsaXRpZXMiLCJyZXF1aXJlIiwiYXJyYXlVdGlsaXRpZXMiLCJSZWN1cnNpdmVEZWZpbml0aW9uIiwiRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsIkluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiIsImZpbmRSdWxlIiwiZmlyc3QiLCJmb3JFYWNoV2l0aFJlcGxhY2UiLCJlbGltaW5hdGVMZWZ0UmVjdXJzaW9uIiwicnVsZXMiLCJmaXJzdFJ1bGUiLCJydWxlIiwicmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJyZXBsYWNlbWVudERlZmluaXRpb25zIiwicmVwbGFjZURlZmluaXRpb25zIiwiZm9yRWFjaCIsInJlcGxhY2VtZW50RGVmaW5pdGlvbiIsInJld3JpdGUiLCJtb2R1bGUiLCJleHBvcnRzIiwicmVwbGFjZURlZmluaXRpb24iLCJydWxlTmFtZSIsImRlZmluaXRpb24iLCJkZWZpbml0aW9uUmVjdXJzaXZlRGVmaW5pdGlvbiIsImRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24iLCJmcm9tUnVsZU5hbWVBbmREZWZpbml0aW9uIiwiaW5kaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uIiwiZnJvbVJ1bGVOYW1lRGVmaW5pdGlvbkFuZFJlY3Vyc2l2ZURlZmluaXRpb25zIiwicmVjdXJzaXZlRGVmaW5pdGlvbiIsInB1c2giLCJnZXROYW1lIiwiZGVmaW5pdGlvbnMiLCJnZXREZWZpbml0aW9ucyIsInByZXZpb3VzUmVjdXJzaXZlRGVmaW5pdGlvbnMiLCJyZWN1cnNpdmVEZWZpbml0aW9uUnVsZU5hbWUiLCJnZXRSdWxlTmFtZSIsInJlY3Vyc2l2ZVJ1bGVOYW1lIiwicmVjdXJzaXZlUnVsZU5hbWVzIiwibWFwIiwicmVjdXJzaXZlUnVsZU5hbWVzSW5jbHVkZXNSZWN1cnNpdmVSdWxlTmFtZSIsImluY2x1ZGVzIl0s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IHN0cmljdCc7XG5cbmNvbnN0IHJ1bGVVdGlsaXRpZXMgPSByZXF1aXJlKCcuL3V0aWxpdGllcy9ydWxlJyksXG4gICAgICBhcnJheVV0aWxpdGllcyA9IHJlcXVpcmUoJy4vdXRpbGl0aWVzL2FycmF5JyksXG4gICAgICBSZWN1cnNpdmVEZWZpbml0aW9uID0gcmVxdWlyZSgnLi9kZWZpbml0aW9uL3JlY3Vyc2l2ZScpLFxuICAgICAgRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IHJlcXVpcmUoJy4vZGVmaW5pdGlvbi9sZWZ0UmVjdXJzaXZlL2RpcmVjdGx5JyksXG4gICAgICBJbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gPSByZXF1aXJlKCcuL2RlZmluaXRpb24vbGVmdFJlY3Vyc2l2ZS9pbmRpcmVjdGx5Jyk7XG5cbmNvbnN0IHsgZmluZFJ1bGUgfSA9IHJ1bGVVdGlsaXRpZXMsXG4gICAgICB7IGZpcnN0LCBmb3JFYWNoV2l0aFJlcGxhY2UgfSA9IGFycmF5VXRpbGl0aWVzO1xuXG5mdW5jdGlvbiBlbGltaW5hdGVMZWZ0UmVjdXJzaW9uKHJ1bGVzKSB7XG4gIGNvbnN0IGZpcnN0UnVsZSA9IGZpcnN0KHJ1bGVzKSxcbiAgICAgICAgcnVsZSA9IGZpcnN0UnVsZSwgLy8vXG4gICAgICAgIHJlY3Vyc2l2ZURlZmluaXRpb25zID0gW10sXG4gICAgICAgIHJlcGxhY2VtZW50RGVmaW5pdGlvbnMgPSBbXTtcblxuICByZXBsYWNlRGVmaW5pdGlvbnMocnVsZSwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJlcGxhY2VtZW50RGVmaW5pdGlvbnMsIHJ1bGVzKTtcblxuICByZXBsYWNlbWVudERlZmluaXRpb25zLmZvckVhY2goKHJlcGxhY2VtZW50RGVmaW5pdGlvbikgPT4gcmVwbGFjZW1lbnREZWZpbml0aW9uLnJld3JpdGUocnVsZXMpKTtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBlbGltaW5hdGVMZWZ0UmVjdXJzaW9uO1xuXG5mdW5jdGlvbiByZXBsYWNlRGVmaW5pdGlvbihydWxlTmFtZSwgZGVmaW5pdGlvbiwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJlcGxhY2VtZW50RGVmaW5pdGlvbnMpIHtcbiAgbGV0IHJlcGxhY2VtZW50RGVmaW5pdGlvbiA9IG51bGw7XG5cbiAgY29uc3QgZGVmaW5pdGlvblJlY3Vyc2l2ZURlZmluaXRpb24gPSAoZGVmaW5pdGlvbiBpbnN0YW5jZW9mIFJlY3Vyc2l2ZURlZmluaXRpb24pO1xuXG4gIGlmICghZGVmaW5pdGlvblJlY3Vyc2l2ZURlZmluaXRpb24pIHtcbiAgICBpZiAocmVwbGFjZW1lbnREZWZpbml0aW9uID09PSBudWxsKSB7XG4gICAgICBjb25zdCBkaXJlY3RseUxlZnRSZWN1cnNpdmVEZWZpbml0aW9uID0gRGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVBbmREZWZpbml0aW9uKHJ1bGVOYW1lLCBkZWZpbml0aW9uKTtcblxuICAgICAgaWYgKGRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb24gIT09IG51bGwpIHtcbiAgICAgICAgcmVwbGFjZW1lbnREZWZpbml0aW9uID0gZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbjsgIC8vL1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChyZXBsYWNlbWVudERlZmluaXRpb24gPT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiA9IEluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVEZWZpbml0aW9uQW5kUmVjdXJzaXZlRGVmaW5pdGlvbnMocnVsZU5hbWUsIGRlZmluaXRpb24sIHJlY3Vyc2l2ZURlZmluaXRpb25zKTtcblxuICAgICAgaWYgKGluZGlyZWN0bHlMZWZ0UmVjdXJzaXZlRGVmaW5pdGlvbiAhPT0gbnVsbCkge1xuICAgICAgICByZXBsYWNlbWVudERlZmluaXRpb24gPSBpbmRpcmVjdGx5TGVmdFJlY3Vyc2l2ZURlZmluaXRpb247ICAvLy9cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocmVwbGFjZW1lbnREZWZpbml0aW9uID09PSBudWxsKSB7XG4gICAgICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9uID0gUmVjdXJzaXZlRGVmaW5pdGlvbi5mcm9tUnVsZU5hbWVBbmREZWZpbml0aW9uKHJ1bGVOYW1lLCBkZWZpbml0aW9uKTtcblxuICAgICAgaWYgKHJlY3Vyc2l2ZURlZmluaXRpb24gIT09IG51bGwpIHtcbiAgICAgICAgcmVwbGFjZW1lbnREZWZpbml0aW9uID0gcmVjdXJzaXZlRGVmaW5pdGlvbjsgIC8vL1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGlmIChyZXBsYWNlbWVudERlZmluaXRpb24gIT09IG51bGwpIHtcbiAgICByZXBsYWNlbWVudERlZmluaXRpb25zLnB1c2gocmVwbGFjZW1lbnREZWZpbml0aW9uKTtcbiAgfVxuXG4gIHJldHVybiByZXBsYWNlbWVudERlZmluaXRpb247XG59XG5cbmZ1bmN0aW9uIHJlcGxhY2VEZWZpbml0aW9ucyhydWxlLCByZWN1cnNpdmVEZWZpbml0aW9ucywgcmVwbGFjZW1lbnREZWZpbml0aW9ucywgcnVsZXMpIHtcbiAgY29uc3QgcnVsZU5hbWUgPSBydWxlLmdldE5hbWUoKSxcbiAgICAgICAgZGVmaW5pdGlvbnMgPSBydWxlLmdldERlZmluaXRpb25zKCk7XG5cbiAgZm9yRWFjaFdpdGhSZXBsYWNlKGRlZmluaXRpb25zLCAoZGVmaW5pdGlvbikgPT4ge1xuICAgIGNvbnN0IHJlcGxhY2VtZW50RGVmaW5pdGlvbiA9IHJlcGxhY2VEZWZpbml0aW9uKHJ1bGVOYW1lLCBkZWZpbml0aW9uLCByZWN1cnNpdmVEZWZpbml0aW9ucywgcmVwbGFjZW1lbnREZWZpbml0aW9ucyk7XG5cbiAgICBsZXQgcmVjdXJzaXZlRGVmaW5pdGlvbiA9IHJlcGxhY2VtZW50RGVmaW5pdGlvbjsgIC8vL1xuXG4gICAgaWYgKHJlY3Vyc2l2ZURlZmluaXRpb24gPT09IG51bGwpIHtcbiAgICAgIGNvbnN0IGRlZmluaXRpb25SZWN1cnNpdmVEZWZpbml0aW9uID0gKGRlZmluaXRpb24gaW5zdGFuY2VvZiBSZWN1cnNpdmVEZWZpbml0aW9uKTtcblxuICAgICAgaWYgKGRlZmluaXRpb25SZWN1cnNpdmVEZWZpbml0aW9uKSB7XG4gICAgICAgIHJlY3Vyc2l2ZURlZmluaXRpb24gPSBkZWZpbml0aW9uOyAvLy9cbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAocmVjdXJzaXZlRGVmaW5pdGlvbiAhPT0gbnVsbCkge1xuICAgICAgY29uc3QgcHJldmlvdXNSZWN1cnNpdmVEZWZpbml0aW9ucyA9IHJlY3Vyc2l2ZURlZmluaXRpb25zOyAgLy8vXG5cbiAgICAgIHJlY3Vyc2l2ZURlZmluaXRpb25zID0gWyAuLi5wcmV2aW91c1JlY3Vyc2l2ZURlZmluaXRpb25zLCByZWN1cnNpdmVEZWZpbml0aW9uIF07XG5cbiAgICAgIHJlY3Vyc2l2ZURlZmluaXRpb25zLmZvckVhY2goKHJlY3Vyc2l2ZURlZmluaXRpb24pID0+IHtcbiAgICAgICAgY29uc3QgcmVjdXJzaXZlRGVmaW5pdGlvblJ1bGVOYW1lID0gcmVjdXJzaXZlRGVmaW5pdGlvbi5nZXRSdWxlTmFtZSgpLFxuICAgICAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZSA9IHJlY3Vyc2l2ZURlZmluaXRpb25SdWxlTmFtZSwgIC8vL1xuICAgICAgICAgICAgICByZWN1cnNpdmVSdWxlTmFtZXMgPSByZWN1cnNpdmVEZWZpbml0aW9ucy5tYXAoKHJlY3Vyc2l2ZURlZmluaXRpb24pID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCByZWN1cnNpdmVEZWZpbml0aW9uUnVsZU5hbWUgPSByZWN1cnNpdmVEZWZpbml0aW9uLmdldFJ1bGVOYW1lKCksXG4gICAgICAgICAgICAgICAgICAgICAgcmVjdXJzaXZlUnVsZU5hbWUgPSByZWN1cnNpdmVEZWZpbml0aW9uUnVsZU5hbWU7ICAvLy9cblxuICAgICAgICAgICAgICAgIHJldHVybiByZWN1cnNpdmVSdWxlTmFtZTtcbiAgICAgICAgICAgICAgfSksXG4gICAgICAgICAgICAgIHJlY3Vyc2l2ZVJ1bGVOYW1lc0luY2x1ZGVzUmVjdXJzaXZlUnVsZU5hbWUgPSByZWN1cnNpdmVSdWxlTmFtZXMuaW5jbHVkZXMocmVjdXJzaXZlUnVsZU5hbWUpO1xuXG4gICAgICAgIGlmICghcmVjdXJzaXZlUnVsZU5hbWVzSW5jbHVkZXNSZWN1cnNpdmVSdWxlTmFtZSkge1xuICAgICAgICAgIGNvbnN0IHJ1bGVOYW1lID0gcmVjdXJzaXZlUnVsZU5hbWUsICAvLy9cbiAgICAgICAgICAgICAgICBydWxlID0gZmluZFJ1bGUocnVsZU5hbWUsIHJ1bGVzKTtcblxuICAgICAgICAgIGlmIChydWxlICE9PSBudWxsKSB7XG4gICAgICAgICAgICByZXBsYWNlRGVmaW5pdGlvbnMocnVsZSwgcmVjdXJzaXZlRGVmaW5pdGlvbnMsIHJlcGxhY2VtZW50RGVmaW5pdGlvbnMsIHJ1bGVzKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiByZXBsYWNlbWVudERlZmluaXRpb247XG4gIH0pO1xufVxuIl19